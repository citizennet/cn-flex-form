{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///all.min.js","webpack:///webpack/bootstrap b9f58669a8fc63b9b274","webpack:///./src/_cn-flex-form.module.js","webpack:///./src/cn-flex-form-config.service.js","webpack:///./src/cn-flex-form-types.service.js","webpack:///./src/cn-flex-form.routes.js","webpack:///./src/schema-form-extensions.js","webpack:///./src/cn-flex-form.service.js","webpack:///external \"lodash\"","webpack:///external \"objectpath\"","webpack:///./src/cn-flex-form-modal-loader.service.js","webpack:///./src/cn-flex-form-modal-loader.js","webpack:///./src/cn-flex-form.directive.js","webpack:///./~/process/browser.js","webpack:///./src/cn-flex-form-header.directive.js","webpack:///./src/cn-flex-form-validate.directive.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_6__","__WEBPACK_EXTERNAL_MODULE_7__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_cnFlexFormConfig","_cnFlexFormConfig2","_cnFlexFormTypes","_cnFlexFormTypes2","_cnFlexForm","_schemaFormExtensions","_cnFlexForm2","_cnFlexForm3","_cnFlexFormModalLoader","_cnFlexFormModalLoader2","_cnFlexFormModalLoader3","_cnFlexForm4","_cnFlexForm5","_cnFlexFormHeader","_cnFlexFormHeader2","_cnFlexFormValidate","_cnFlexFormValidate2","angular","provider","cnFlexFormRoutesProvider","config","cnFlexFormRoutes","schemaFormConfig","run","addTemplates","FlexFormModal","controller","FlexFormModalLoader","directive","name","cnFlexFormConfigProvider","addIgnoreParam","param","ignoreParams","push","cnFlexFormConfig","$stateParams","getStateParams","overrides","arguments","length","undefined","_","omit","v","isUndefined","$inject","$get","_extends","assign","target","i","source","key","prototype","hasOwnProperty","cnFlexFormTypesProvider","registerFieldType","fieldType","fieldTypeRegister","unshift","cnFlexFormTypes","getFieldType","field","l","condition","type","schema","includes","titleMap","titleMapResolve","titleMapQuery","format","$stateProvider","addStates","_ref","permissions","shared","controllerAs","state","url","templateUrl","cnFlexFormServiceProvider","tv4","addFormat","data","isString","test","extensions","each","extension","registerField","$templateCache","put","sharedAutocompleteTpl","_defineProperty","enumerable","configurable","writable","_toConsumableArray","arr","Array","isArray","arr2","from","schemaFormDecoratorsProvider","handler","fieldTypeHandlers","addMapping","createDirective","CNFlexFormService","Api","$parse","sfPath","$interpolate","$timeout","cnUtil","getService","fn","find","services","destroyService","service","cleanup","empty","remove","s","CNFlexFormConstructor","_len","args","_key","model","_args$","curService","compile","newService","CNFlexForm","debug","window","arrayCopies","arrayListeners","dataCache","defaults","errors","events","formCache","scopeCache","listeners","resolveRegister","updates","skipDefault","getParams","params","getScope","scope","isCompiled","setupConfig","forms","form","processField","bind","initModelWatch","initArrayCopyWatch","broadcastErrors","setValue","compiled","formCtrl","updateSchema","getSchema","getSchemaForm","setupSchemaRefresh","getParamOverrides","noop","processSchema","getSchemaType","first","processDefault","curDefault","getKey","replaceArrayIndex","arrayIndex","parseCondition","parseExpression","modelValue","get","has","equals","isTrulyEmpty","set","copy","validationMessage","processFieldset","fieldset","items","forEach","pos","htmlClass","collapsible","toggleCollapse","collapsed","render","processFieldType","secondPass","isFunction","getOgKeys","reject","keys","isDefined","_ogKeys","addToFormCache","description","showClearAll","processFieldProps","$broadcast","getDotKey","error","buildError","isEmpty","ngModelOptions","allowInvalid","fieldPropHandlers","prop","reduce","total","next","depth","ObjectPath","parse","properties","shift","getDefault","getFromFormCache","getWatchables","exp","watchables","nested","matchNestedExpression","replaceStr","replace","concat","processResolve","resolve","dataProp","fieldProp","handleResolve","watchable","_ref2","match","_ref3","_slicedToArray","base","registerResolve","registerHandler","parseAny","result","eithers","split","x","parseAll","all","acc","last","skipPropHandlers","cursor","loadMore","refreshSchema","val","val1","_ref4","fieldKey","register","processConditional","conditionals","prev","getFromScopeCache","map","path","processFieldWatch","watch","resolution","cur","adjustment","date","units","trim","math","operator","+","-","*","/","adjuster","trigger","curCondition","console","updatePath","fromPath","update","moment","add","toDate","floor","ceil","round","initialize","startsWith","_condition$match","_condition$match2","list","predicateParams","predicateBody","generatePredicate","body","_len2","_key2","processFieldUpdatedSchema","curVal","runHandler","isObject","arrMatch","registerArrayHandlers","handlers","arrKey","onArray","reorder","lastKey","deregisterHandlers","arrVal","listenerKey","deregisterArrayHandlers","item","watching","modelWatch","$watch","onModelWatch","initSchemaParams","firstUpdate","cleanModel","prevParams","listener","isInitArray","incrementUpdates","stripIndexes","$on","event","cacheKey","uniqueId","isNumber","genericKey","index","getArrayCopy","addArrayCopy","$emit","addToScopeCache","deleteArrayCopiesFor","link","splice","copies","getArrayCopies","pluck","getArrayScopes","getArrayCopiesFor","keyStart","filter","warn","addToDataCache","getFromDataCache","matchIntStrIndex","_ref5","_ref6","toReplace","replaced","_ref7","_ref8","_ref9","_ref10","_ref11","_ref12","resolveNestedExpressions","_ref13","_ref14","parsed","keyVal","_ref15","_ref16","isStr","parseFloat","resolved","start","getAssignable","_ref17","noConstruction","progress","fullPath","slice","options","_ref18","_getAssignable","silent","silenceListeners","skipDefaults","indexOf","getArrayIndex","ks","k","skipKeys","indexedKey","setArrayIndex","childKeys","_loop","indexedChildKey","processArray","array","sortOptions","e","ui","processSection","section","processComponent","component","cols","processCurrency","currencyFormat","currency-dollars","currency-microcents","currency","processNumber","processPercentage","processUrl","processReusable","view","processFacebookVideo","processCreativeImage","processMediaUpload","processCsvUpload","processRadios","processRadiobuttons","radios","fullWidth","btnClass","divide","processDate","maxView","iconClass","modelFormatter","multiply","hours","minutes","modelParser","d","parseInt","startOf","viewFormatter","dateFormat","viewParser","getSelectValProp","select","valueProperty","getAllowedSelectValue","getTitleMap","valProp","omitHashKey","identity","partialRight","findFn","compose","partial","processSchedule","startEmpty","processSelect","onInit","setter","newVal","queryParams","paramsKeys","showClearCache","refreshData","singleQuery","minLookup","titleQuery","q","_ref19","variables","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","err","return","skipFiltering","onAdd","displayFormat","itemFormatter","processTemplate","detailedList","destroyStrategy","selectionStyle","maxItems","valid","$setDirty","processToggle","toggle","processHelp","help","processDisplay","display","getDisplay","tpl","parseScope","processor","processTable","table","row","columns","extend","processSelectDisplay","selectDisplay","selectField","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","linkModel","featureKey","showFeature","features","show","selectKey","elem","indexedSelectKey","selectModel","refresh","debounce","diff","isNull","then","processUpdatedSchema","onProcessDiff","reset","registers","reprocessSchema","curKeys","compact","prevSchema","newSchema","readonly","getFormsToProcess","reprocessField","el","document","getElementsByClassName","oldScroll","scrollTop","setTimeout","resetUpdates","_ref20","_ref21","cached","current","isChild","redraw","log","subKey","join","message","arrayIndexKey","exec","re","RegExp","asArray","keyCopy","clone","indexOfIndex","sliceIterator","_arr","_n","_d","_e","_s","_i","TypeError","cn-radios","cn-radiobuttons","cn-autocomplete","cn-datetimepicker","cn-display","cn-number","cn-currency","cn-percentage","cn-url","cn-mediaupload","cn-creativeimage","cn-facebookvideo","cn-csvupload","cn-reusable","cn-toggle","cn-table","tabarray","cn-schedule","getPromises","promiseMap","promise","getPromise","$q","promises","defer","cnFlexFormModalLoaderServiceProvider","def","parent","modalMap","modal","modalId","cnFlexFormModalLoaderService","resolveMapping","getMapping","removeMapping","$state","$rootScope","$scope","FFModalLoaderTag","activate","open","vm","_ref$options","onDismiss","onAfterDismiss","finally","goBack","catch","restParams","dismissEvent","dismissModal","transition","go","opened","dismiss","__tag","$uibModal","process","cnFlexForm","restrict","template","formIndex","formName","delayForm","cleanupEvent","FlexForm","bindToController","cnFlexFormService","$location","cnFlexFormTag","search","showForm","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","timeout","len","Item","nextTick","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","dir","umask","cnFlexFormHeader","submit","loadOffscreen","FlexFormHeader","ffHeaderTag","initTitle","initActionConfig","actionConfig","returnState","returnStyle","returnText","closeButton","actions","updateData","$parent","isDisabled","btnConfig","ffValidate","attrs","ngModel","ffValidateTag","required","$viewValue","$setValidity"],"mappings":"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","file":"all.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cn-flex-form\", [\"lodash\", \"objectpath\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cn-flex-form\"] = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse\n\t\troot[\"cn-flex-form\"] = factory(root[\"lodash\"], root[\"objectpath\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cn-flex-form\", [\"lodash\", \"objectpath\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cn-flex-form\"] = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse\n\t\troot[\"cn-flex-form\"] = factory(root[\"lodash\"], root[\"objectpath\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _cnFlexFormConfig = __webpack_require__(1);\n\t\n\tvar _cnFlexFormConfig2 = _interopRequireDefault(_cnFlexFormConfig);\n\t\n\tvar _cnFlexFormTypes = __webpack_require__(2);\n\t\n\tvar _cnFlexFormTypes2 = _interopRequireDefault(_cnFlexFormTypes);\n\t\n\tvar _cnFlexForm = __webpack_require__(3);\n\t\n\tvar _schemaFormExtensions = __webpack_require__(4);\n\t\n\tvar _cnFlexForm2 = __webpack_require__(5);\n\t\n\tvar _cnFlexForm3 = _interopRequireDefault(_cnFlexForm2);\n\t\n\tvar _cnFlexFormModalLoader = __webpack_require__(8);\n\t\n\tvar _cnFlexFormModalLoader2 = _interopRequireDefault(_cnFlexFormModalLoader);\n\t\n\tvar _cnFlexFormModalLoader3 = __webpack_require__(9);\n\t\n\tvar _cnFlexForm4 = __webpack_require__(10);\n\t\n\tvar _cnFlexForm5 = _interopRequireDefault(_cnFlexForm4);\n\t\n\tvar _cnFlexFormHeader = __webpack_require__(12);\n\t\n\tvar _cnFlexFormHeader2 = _interopRequireDefault(_cnFlexFormHeader);\n\t\n\tvar _cnFlexFormValidate = __webpack_require__(13);\n\t\n\tvar _cnFlexFormValidate2 = _interopRequireDefault(_cnFlexFormValidate);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\texports.default = angular.module('cn.flex-form', ['ui.router', 'schemaForm', 'ui.bootstrap.datetimepicker', 'cnTagsInput', 'cn.util']).provider('cnFlexFormConfig', _cnFlexFormConfig2.default).provider('cnFlexFormTypes', _cnFlexFormTypes2.default).provider('cnFlexFormRoutes', _cnFlexForm.cnFlexFormRoutesProvider).config(_cnFlexForm.cnFlexFormRoutes).config(_schemaFormExtensions.schemaFormConfig).run(_schemaFormExtensions.addTemplates).provider('cnFlexFormService', _cnFlexForm3.default).provider('cnFlexFormModalLoaderService', _cnFlexFormModalLoader2.default).factory('FlexFormModal', _cnFlexFormModalLoader3.FlexFormModal).controller('FlexFormModalLoader', _cnFlexFormModalLoader3.FlexFormModalLoader).directive('cnFlexForm', _cnFlexForm5.default).directive('cnFlexFormHeader', _cnFlexFormHeader2.default).directive('ffValidate', _cnFlexFormValidate2.default).name;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tfunction cnFlexFormConfigProvider() {\n\t\n\t  cnFlexFormConfig.$inject = [\"$stateParams\"];\n\t  var ignoreParams = ['page', 'debug', 'sandbox', 'modal', 'modalId'];\n\t\n\t  return {\n\t    addIgnoreParam: addIgnoreParam,\n\t    $get: cnFlexFormConfig\n\t  };\n\t\n\t  ////////\n\t\n\t  function addIgnoreParam(param) {\n\t    ignoreParams.push(param);\n\t  }\n\t\n\t  function cnFlexFormConfig($stateParams) {\n\t    'ngInject';\n\t\n\t    return {\n\t      getStateParams: getStateParams,\n\t      ignoreParams: ignoreParams\n\t    };\n\t\n\t    ////////\n\t\n\t    function getStateParams() {\n\t      var overrides = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t\n\t      return _(_extends({}, $stateParams, overrides)).omit(ignoreParams).omit(function (v) {\n\t        return _.isUndefined(v) || v === null;\n\t      }).value();\n\t    }\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormConfig', cnFlexFormConfigProvider);\n\t\n\texports.default = cnFlexFormConfigProvider;\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexFormTypesProvider() {\n\t\n\t  var fieldTypeRegister = [{\n\t    condition: function condition(field) {\n\t      return field.type === 'hidden';\n\t    },\n\t    type: 'hidden'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('radios');\n\t    },\n\t    type: 'cn-radios'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('radiobuttons');\n\t    },\n\t    type: 'cn-radiobuttons'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('autocomplete') || field.titleMap || field.titleMapResolve || field.titleMapQuery;\n\t    },\n\t    type: 'cn-autocomplete'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'cn-datetimepicker' || field.type === 'datetime-local' || field.type === 'time-minutes';\n\t    },\n\t    type: 'cn-datetimepicker'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'help';\n\t    },\n\t    type: 'help'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('display');\n\t    },\n\t    type: 'cn-display'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.schema && field.schema.format && field.schema.format.includes('currency');\n\t    },\n\t    type: 'cn-currency'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.schema && field.schema.format === 'percentage';\n\t    },\n\t    type: 'cn-percentage'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.schema && field.type === 'url';\n\t    },\n\t    type: 'cn-url'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'toggle' || field.type === 'boolean';\n\t    },\n\t    type: 'cn-toggle'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'creativeimage';\n\t    },\n\t    type: 'cn-creativeimage'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'facebookvideo';\n\t    },\n\t    type: 'cn-facebookvideo'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'mediaupload';\n\t    },\n\t    type: 'cn-mediaupload'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'csvupload';\n\t    },\n\t    type: 'cn-csvupload'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'reusable';\n\t    },\n\t    type: 'cn-reusable'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'table';\n\t    },\n\t    type: 'cn-table'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'array';\n\t    },\n\t    type: 'array'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'schedule';\n\t    },\n\t    type: 'cn-schedule'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.schema && field.schema.type === 'number';\n\t    },\n\t    type: 'cn-number'\n\t  }];\n\t\n\t  return {\n\t    registerFieldType: registerFieldType,\n\t    $get: cnFlexFormTypes\n\t  };\n\t\n\t  ////////\n\t\n\t  function registerFieldType(fieldType) {\n\t    fieldTypeRegister.unshift(fieldType);\n\t  }\n\t\n\t  function cnFlexFormTypes() {\n\t    return {\n\t      fieldTypeRegister: fieldTypeRegister,\n\t      getFieldType: getFieldType\n\t    };\n\t\n\t    /////////\n\t\n\t    function getFieldType(field) {\n\t      for (var i = 0, l = fieldTypeRegister.length; i < l; i++) {\n\t        if (fieldTypeRegister[i].condition(field)) {\n\t          return fieldTypeRegister[i].type;\n\t        }\n\t      }\n\t      return field.type || field.schema && field.schema.type;\n\t    }\n\t  }\n\t}\n\t\n\texports.default = cnFlexFormTypesProvider;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tcnFlexFormRoutesProvider.$inject = [\"$stateProvider\"];\n\tcnFlexFormRoutes.$inject = [\"$stateProvider\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tfunction cnFlexFormRoutesProvider($stateProvider) {\n\t  'ngInject';\n\t\n\t  return {\n\t    addStates: addStates,\n\t    $get: $get\n\t  };\n\t\n\t  ////////////\n\t\n\t  function $get() {\n\t    // nothing to do here, but required\n\t  }\n\t\n\t  function addStates(_ref) {\n\t    var permissions = _ref.permissions,\n\t        name = _ref.name;\n\t\n\t    var shared = {\n\t      controller: 'FlexFormModalLoader',\n\t      controllerAs: 'vm',\n\t      permissions: permissions\n\t    };\n\t    $stateProvider.state(name + '.page.modal', _extends({\n\t      url: '/~:modal/:modalId'\n\t    }, shared)).state(name + '.page.modalParams', _extends({\n\t      url: '/~:modal/:modalId/:restParams'\n\t    }, shared));\n\t  }\n\t}\n\t\n\tfunction cnFlexFormRoutes($stateProvider) {\n\t  'ngInject';\n\t\n\t  $stateProvider.state('flex-form-sandbox', {\n\t    url: '/flex-form/sandbox',\n\t    controller: 'FlexFormSandbox',\n\t    controllerAs: 'vm',\n\t    templateUrl: 'app/components/cn-flex-form/sandbox.html'\n\t  });\n\t}\n\t\n\texports.cnFlexFormRoutes = cnFlexFormRoutes;\n\texports.cnFlexFormRoutesProvider = cnFlexFormRoutesProvider;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tschemaFormConfig.$inject = [\"cnFlexFormServiceProvider\"];\n\taddTemplates.$inject = [\"$templateCache\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction schemaFormConfig(cnFlexFormServiceProvider) {\n\t  'ngInject';\n\t\n\t  tv4.addFormat({\n\t    'url': function url(data) {\n\t      return _.isString(data) && !/^(https?:\\/\\/.{2}|$)/.test(data) && 'invalid url';\n\t    }\n\t  });\n\t\n\t  var extensions = ['cn-fieldset', 'cn-toggle', 'cn-datetimepicker', 'cn-autocomplete', 'cn-autocomplete-detailed', 'cn-number', 'cn-currency', 'cn-url', 'cn-radios', 'cn-radiobuttons', 'cn-percentage', 'cn-display', 'cn-mediaupload', 'cn-csvupload', 'cn-reusable', 'cn-table', 'cn-creativeimage', 'cn-schedule', 'cn-facebookvideo'];\n\t\n\t  _.each(extensions, function (extension) {\n\t    cnFlexFormServiceProvider.registerField({\n\t      type: extension,\n\t      templateUrl: 'app/components/cn-flex-form/forms/' + extension + '.html'\n\t    });\n\t  });\n\t}\n\t\n\tfunction addTemplates($templateCache) {\n\t  'ngInject';\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-toggle.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\n        <div class=\"clearfix\">\\n          <cn-toggle-switch\\n            name=\"{{form.key.join(\\'.\\')}}\"\\n            class=\"pull-left\"\\n            ng-show=\"form.key\"\\n            ng-model-options=\"form.ngModelOptions\"\\n            ng-model=\"$$value$$\"\\n            sf-changed=\"form\"\\n            schema-validate=\"form\"\\n            on-value=\"form.onValue\"\\n            off-value=\"form.offValue\"\\n            ng-required=\"form.required\"\\n            read-only=\"form.readonly\"\\n            undefined-class=\"form.undefinedClass\"/>\\n          <span ng-show=\"form.onText && form.offText\">\\n            {{$$value$$ === form.onValue ? form.onText : form.offText}}\\n          </span>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-datetimepicker.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               for=\"{{form.key.join(\\'.\\')}}\"\\n               ng-show=\"showTitle()\">{{form.title}}</label>\\n        <cn-datetimepicker\\n          ng-show=\"form.key\"\\n          ng-model=\"$$value$$\"\\n          ng-model-options=\"form.ngModelOptions\"\\n          is-disabled=\"form.readonly\"\\n          sf-changed=\"form\"\\n          schema-validate=\"form\"\\n          input-id=\"{{form.key.join(\\'.\\')}}\"\\n          min-date=\"form.minDate\"\\n          max-date=\"form.maxDate\"\\n          max-view=\"{{form.maxView}}\"\\n          default-time=\"form.defaultTime\"\\n          cn-date-required=\"form.required\"\\n          placeholder=\"{{form.placeholder}}\"\\n          model-type=\"{{form.schema.type}}\"\\n          model-formatter=\"form.modelFormatter\"\\n          model-parser=\"form.modelParser\"\\n          view-formatter=\"form.viewFormatter\"\\n          view-parser=\"form.viewParser\"\\n          format-string={{form.dateFormat}}\\n          icon-class={{form.iconClass}}>\\n        </cn-datetimepicker>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  var sharedAutocompleteTpl = '\\n        <tags-input\\n          ng-show=\"form.key\"\\n          ng-model=\"$$value$$\"\\n          ng-model-options=\"form.ngModelOptions\"\\n          ng-disabled=\"form.readonly\"\\n          sf-changed=\"form\"\\n          schema-validate=\"form\"\\n          input-id=\"{{form.key.join(\\'.\\')}}\"\\n          display-property=\"{{form.displayProperty || \\'name\\'}}\"\\n          value-property=\"{{form.valueProperty}}\"\\n          placeholder=\"{{form.placeholder || \\' \\'}}\"\\n          clear-on-blur=\"true\"\\n          add-on-comma=\"false\"\\n          add-from-autocomplete-only=\"{{!form.allowNew}}\"\\n          on-before-tag-added=\"form.onAdd({value: $tag}, form, $event, $prev)\"\\n          on-init=\"form.onInit($tag, form, $event, $setter)\"\\n          model-type=\"{{form.getSchemaType()}}\"\\n          array-value-type=\"{{form.schema.items.type}}\"\\n          hide-tags=\"{{form.detailedList}}\"\\n          tags-style=\"{{form.selectionStyle}}\"\\n          required=\"{{form.required}}\"\\n          min-length=\"{{form.minLength}}\"\\n          allowed-tags-pattern=\".*\"\\n          dropdown-icon=\"true\"\\n          item-formatter=\"form.itemFormatter\"\\n          min-tags=\"{{form.minItems || form.schema.minItems}}\"\\n          max-tags=\"{{form.maxItems || form.schema.maxItems || (form.getSchemaType() !== \\'array\\' ? 1 : 0)}}\"\\n          allow-bulk=\"{{form.bulkAdd}}\"\\n          bulk-delimiter=\"{{form.bulkDelimiter}}\"\\n          bulk-placeholder=\"{{form.bulkPlaceholder}}\"\\n          bulk-single-request=\"{{form.bulkSingleRequest}}\"\\n          sort-filtered-results=\"{{(form.titleMapResolve || form.titleMap) && !form.titleMapQuery}}\"\\n          show-clear-all=\"{{form.showClearAll}}\"\\n          show-clear-cache=\"{{form.showClearCache}}\"\\n          show-button=\"true\">\\n          <auto-complete\\n            source=\"form.getTitleMap && form.getTitleMap() || form.titleQuery($query, options)\"\\n            skip-filtering=\"{{form.skipFiltering}}\"\\n            single-query=\"{{form.singleQuery}}\"\\n            debounce-delay=\"{{form.debounceDelay}}\"\\n            min-length=\"{{form.minLookup}}\">\\n          </auto-complete>\\n        </tags-input>';\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-autocomplete.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               for=\"{{form.key.join(\\'.\\')}}-input\"\\n               ng-show=\"showTitle()\">{{form.title}}</label>\\n        ' + sharedAutocompleteTpl + '\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-autocomplete-detailed.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               for=\"{{form.key.join(\\'.\\')}}-input\"\\n               ng-show=\"showTitle()\">{{form.title}}</label>\\n        <div sf-array=\"form\">\\n          <ol class=\"list-group cn-autocomplete-list\"\\n              ng-if=\"modelArray.length\"\\n              ng-model=\"modelArray\">\\n            <li class=\"list-group-item {{form.fieldHtmlClass}}\"\\n                ng-repeat=\"item in modelArray track by $index\">\\n              <button ng-hide=\"form.readonly || form.remove === null\"\\n                      ng-click=\"deleteFromArray($index)\"\\n                      type=\"button\" class=\"close pull-right\">\\n                <span aria-hidden=\"true\">&times;</span>\\n              </button>\\n              <sf-decorator form=\"copyWithIndex($index)\"/>\\n            </li>\\n          </ol>\\n        </div>\\n        ' + sharedAutocompleteTpl + '\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-number.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\n        <div class=\"{{form.fieldClass}}\">\\n          <input class=\"form-control\"\\n                 cn-number\\n                 ng-show=\"form.key\"\\n                 ng-model-options=\"form.ngModelOptions\"\\n                 ng-disabled=\"form.readonly\"\\n                 sf-changed=\"form\"\\n                 schema-validate=\"form\"\\n                 type=\"text\"\\n                 step=\"any\"\\n                 min=\"{{form.min}}\"\\n                 max=\"{{form.max}}\"\\n                 id=\"{{form.key.join(\\'.\\')}}\"\\n                 name=\"{{form.key.join(\\'.\\')}}\"\\n                 ng-model=\"$$value$$\">\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-currency.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\n        <div class=\"{{form.fieldClass}} input-group\">\\n          <label class=\"input-group-addon\"\\n                 ng-disabled=\"form.readonly\"\\n                 for=\"{{form.key.join(\\'.\\')}}\">$</label>\\n          <input class=\"form-control\"\\n                 cn-currency-format=\"{{form.currencyFormat}}\"\\n                 cn-currency-placeholder=\"{{form.placeholder}}\"\\n                 ng-show=\"form.key\"\\n                 ng-model-options=\"form.ngModelOptions\"\\n                 ng-disabled=\"form.readonly\"\\n                 sf-changed=\"form\"\\n                 schema-validate=\"form\"\\n                 type=\"text\"\\n                 step=\"any\"\\n                 min=\"{{form.min}}\"\\n                 max=\"{{form.max}}\"\\n                 id=\"{{form.key.join(\\'.\\')}}\"\\n                 name=\"{{form.key.join(\\'.\\')}}\"\\n                 ng-model=\"$$value$$\">\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-url.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\n        <input class=\"form-control\"\\n               placeholder=\"https://\"\\n               cn-url-format\\n               ng-show=\"form.key\"\\n               ng-model-options=\"form.ngModelOptions\"\\n               ng-disabled=\"form.readonly\"\\n               sf-changed=\"form\"\\n               schema-validate=\"form\"\\n               type=\"text\"\\n               id=\"{{form.key.join(\\'.\\')}}\"\\n               name=\"{{form.key.join(\\'.\\')}}\"\\n               ng-model=\"$$value$$\">\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-radios.html', '<div class=\"form-group {{form.htmlClass}}\"\\n            ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n         <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\n         <div class=\"btn-group clearfix\">\\n           <label class=\"radio radio-block\"\\n                  ng-repeat=\"item in form.titleMap\">\\n             <input type=\"radio\"\\n                    sf-changed=\"form\"\\n                    ng-disabled=\"form.readonly\"\\n                    ng-model=\"$$value$$\"\\n                    ng-model-options=\"form.ngModelOptions\"\\n                    schema-validate=\"form\"\\n                    ff-validate=\"form\"\\n                    ng-value=\"item.value\"\\n                    name=\"{{form.key.join(\\'.\\')}}\">\\n             <span class=\"radio-block-icon\" ng-if=\"item.iconClass || item.iconPath\">\\n               <i ng-if=\"item.iconClass\" class=\"fa fa-{{item.iconClass}} fa-lg\"></i>\\n               <img ng-if=\"item.iconPath\" class=\"custom\" ng-src=\"{{item.iconPath}}\"/>\\n             </span>\\n             <span ng-bind-html=\"item.name\"></span>\\n           </label>\\n         </div>\\n         <span class=\"help-block\" sf-message=\"form.description\"></span>\\n       </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-radiobuttons.html', '\\n      <div class=\"form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\n        <div class=\"btn-group clearfix\">\\n          <label class=\"btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? \\'active\\' : \\'\\'}}\"\\n                 ng-repeat=\"item in form.titleMap\">\\n            <input type=\"radio\"\\n                   class=\"{{form.fieldHtmlClass}} hide\"\\n                   sf-changed=\"form\"\\n                   ng-disabled=\"form.readonly\"\\n                   ng-model=\"$$value$$\"\\n                   ng-model-options=\"form.ngModelOptions\"\\n                   schema-validate=\"form\"\\n                   ff-validate=\"form\"\\n                   ng-value=\"item.value\"\\n                   name=\"{{form.key.join(\\'.\\')}}\">\\n            <i class=\"fa fa-{{item.value}} fa-lg\"></i>\\n            <span ng-bind-html=\"item.name\"></span>\\n          </label>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-percentage.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <div class=\"{{form.fieldClass}} input-group\">\\n          <input class=\"form-control\"\\n                 cn-percentage-format\\n                 ng-show=\"form.key\"\\n                 ng-model-options=\"form.ngModelOptions\"\\n                 ng-disabled=\"form.readonly\"\\n                 sf-changed=\"form\"\\n                 schema-validate=\"form\"\\n                 type=\"number\"\\n                 step=\"any\"\\n                 min=\"{{form.min}}\"\\n                 max=\"{{form.max}}\"\\n                 id=\"{{form.key && form.key[0]}}\"\\n                 name=\"{{form.key && form.key[0]}}\"\\n                 ng-model=\"$$value$$\">\\n           <div class=\"input-group-addon\"\\n                  ng-disabled=\"form.readonly\"\\n                  for=\"{{form.key && form.key[0]}}\">%</div>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-display.html', '\\n      <div class=\"form-group cn-display{{form.htmlClass}}\">\\n        <input ng-show=\"form.key\"\\n               class=\"form-control\"\\n               id=\"{{form.key.join(\\'.\\')}}\"\\n               name=\"{{form.key.join(\\'.\\')}}\"\\n               ng-disabled=\"true\"\\n               value=\"{{form.getDisplay(form.key, form.arrayIndex)}}\">\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-fieldset.html', '\\n      <fieldset\\n        ng-disabled=\"form.readonly\"\\n        class=\"schema-form-fieldset {{form.htmlClass}}\"\\n        ng-class=\"{\\'borderless\\': form.pos === 0, \\'notitle\\': form.notitle || !form.title}\">\\n        <legend ng-hide=\"form.notitle\"\\n                ng-click=\"form.toggleCollapse(form)\"\\n                ng-class=\"{\\'sr-only\\': !showTitle(), collapsible: form.collapsible}\"\\n                ng-mouseenter=\"form.render = true\">\\n          <i ng-show=\"form.collapsible\"\\n             class=\"fa fa-caret-{{form.collapsed ? \\'right\\' : \\'down\\'}}\"></i>\\n          {{ form.title }}\\n        </legend>\\n        <div class=\"help-block\" ng-show=\"form.description\" ng-bind-html=\"form.description\"></div>\\n        <div uib-collapse=\"form.collapsed\">\\n          <div ng-if=\"form.render\">\\n            <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\\n          </div>\\n        </div>\\n      </fieldset>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-mediaupload.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <media-upload ng-model=\"$$value$$\"\\n                      cn-disabled=\"form.readonly\"\\n                      cn-file-type=\"form.fileType\"\\n                      cn-text-button=\"form.textButton\"\\n                      cn-upload-path=\"form.uploadPath\"\\n                      cn-data=\"form.data\"\\n                      cn-preview-path=\"form.previewPath\"\\n                      cn-model-value-key=\"form.modelValueKey\"\\n                      cn-existing-preview=\"form.existingPreview\"\\n                      cn-image-previews=\"form.data.imagePreviews\"\\n                      cn-key=\"form.key && form.key[0]\"\\n                      cn-form=\"form\"\\n                      ng-model-options=\"form.ngModelOptions\"\\n                      sf-changed=\"form\"\\n                      schema-validate=\"form\"\\n                      ff-form=\"form\"\\n                      class=\"clearfix\">\\n        </media-upload>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n     </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-csvupload.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <csv-upload ng-model=\"$$value$$\"\\n                      cn-upload-path=\"form.uploadPath\"\\n                      ng-model-options=\"form.ngModelOptions\"\\n                      sf-changed=\"form\"\\n                      schema-validate=\"form\"\\n                      ff-form=\"form\"\\n                      class=\"clearfix\">\\n        </csv-upload>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n     </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-reusable.html', '\\n      <div class=\"form-group cn-reusable {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\n        <cn-select-or\\n          ng-show=\"form.key\"\\n          select-from=\"form.library\"\\n          ng-model=\"$$value$$\"\\n          ng-model-options=\"form.ngModelOptions\"\\n          sf-changed=\"form\"\\n          schema-validate=\"form\"\\n          ff-form=\"form\"\\n          directiveId=\"form.directiveId\"\\n          item-template=\"form.itemTemplate\"\\n          toggle-text=\"form.toggleText\"\\n          ng-disabled=\"form.readonly\"\\n          view=\"form.view\">\\n          <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\\n        </cn-select-or>\\n        <p ng-if=\"form.loadMore && form.view === \\'list\\'\">\\n          <a ng-click=\"form.loadMore()\"\\n             class=\"btn btn-default btn-block\">Load More</a>\\n        </p>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-table.html', '\\n      <div class=\"form-group cn-ff-table {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <h6>{{form.title}}</h6>\\n        <div class=\"row\">\\n          <div ng-repeat=\"col in form.columns\" class=\"{{col.columnWidth}}\">\\n            <p class=\"column-header\">{{col.columnHeader}}</p>\\n          </div>\\n        </div>\\n        <div class=\"row\" ng-repeat=\"row in form.items\">\\n          <div ng-repeat=\"col in row.items\" class=\"{{col.columnWidth}}\">\\n            <sf-decorator form=\"col\"></sf-decorator>\\n          </div>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-creativeimage.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <cn-creative-image ng-model=\"$$value$$\"\\n                      cn-disabled=\"form.readonly\"\\n                      cn-upload-path=\"form.uploadPath\"\\n                      cn-data=\"form.data\"\\n                      cn-preview-path=\"form.previewPath\"\\n                      cn-model-value-key=\"form.modelValueKey\"\\n                      cn-existing-preview=\"form.existingPreview\"\\n                      ng-model-options=\"form.ngModelOptions\"\\n                      cn-ng-model-key=\"form.ngModelKey\"\\n                      sf-changed=\"form\"\\n                      schema-validate=\"form\"\\n                      ff-form=\"form\"\\n                      class=\"clearfix\">\\n        </cn-creative-image>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n     </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-schedule.html', '\\n      <div class=\"form-group {{ form.htmlClass }}\"\\n           ng-class=\"{ \\'has-error\\': hasError(), \\'has-success\\': hasSuccess() }\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{ form.key.join(\\'.\\') }}\">\\n          {{ form.title }}\\n        </label>\\n        <cn-schedule form=\"form\"\\n                     ng-model=\"$$value$$\">\\n        </cn-schedule>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>\\n    ');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-facebookvideo.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <cn-facebook-video ng-model=\"$$value$$\"\\n                      cn-disabled=\"form.readonly\"\\n                      cn-upload-path=\"form.uploadPath\"\\n                      cn-data=\"form.data\"\\n                      cn-preview-path=\"form.previewPath\"\\n                      cn-model-value-key=\"form.modelValueKey\"\\n                      cn-existing-preview=\"form.existingPreview\"\\n                      ng-model-options=\"form.ngModelOptions\"\\n                      cn-video-key=\"form.videoKey\"\\n                      cn-thumbnail-key=\"form.thumbnailKey\"\\n                      cn-image-id-key=\"form.imageIdKey\"\\n                      sf-changed=\"form\"\\n                      schema-validate=\"form\"\\n                      ff-form=\"form\"\\n                      class=\"clearfix\">\\n        </cn-facebook-video>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n     </div>');\n\t}\n\t\n\texports.schemaFormConfig = schemaFormConfig;\n\texports.addTemplates = addTemplates;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tcnFlexFormServiceProvider.$inject = [\"schemaFormDecoratorsProvider\", \"cnFlexFormTypesProvider\"];\n\tCNFlexFormService.$inject = [\"Api\", \"$parse\", \"cnFlexFormConfig\", \"cnFlexFormTypes\", \"sfPath\", \"$interpolate\", \"$timeout\", \"cnUtil\", \"$stateParams\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\t\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\t// Need these modules for test bundle\n\tvar _ = typeof window !== \"undefined\" && window._ || __webpack_require__(6);\n\tvar ObjectPath = typeof window !== \"undefined\" && window.ObjectPath || __webpack_require__(7);\n\t\n\tvar fieldTypeHandlers = {\n\t  fieldset: \"processFieldset\",\n\t  \"cn-radios\": \"processRadios\",\n\t  \"cn-radiobuttons\": \"processRadiobuttons\",\n\t  \"cn-autocomplete\": \"processSelect\",\n\t  \"cn-datetimepicker\": \"processDate\",\n\t  help: \"processHelp\",\n\t  \"cn-display\": \"processDisplay\",\n\t  \"cn-number\": \"processNumber\",\n\t  \"cn-currency\": \"processCurrency\",\n\t  \"cn-percentage\": \"processPercentage\",\n\t  \"cn-url\": \"processUrl\",\n\t  \"cn-mediaupload\": \"processMediaUpload\",\n\t  \"cn-creativeimage\": \"processCreativeImage\",\n\t  \"cn-facebookvideo\": \"processFacebookVideo\",\n\t  \"cn-csvupload\": \"processCsvUpload\",\n\t  \"cn-reusable\": \"processReusable\",\n\t  \"cn-toggle\": \"processToggle\",\n\t  \"cn-table\": \"processTable\",\n\t  component: \"processComponent\",\n\t  section: \"processSection\",\n\t  tabarray: \"processSection\",\n\t  array: \"processArray\",\n\t  \"cn-schedule\": \"processSchedule\"\n\t};\n\t\n\t// handlers that don't run on secondPass are ones that shouldn't ever change\n\t// and we want to avoid compounding their effects\n\tvar fieldPropHandlers = [{\n\t  prop: \"default\",\n\t  handler: function handler(field, service) {\n\t    return service.processDefault(field);\n\t  }\n\t}, {\n\t  prop: \"resolve\",\n\t  handler: function handler(field, service, secondPass) {\n\t    return !secondPass && service.processResolve(field);\n\t  }\n\t}, {\n\t  prop: \"selectDisplay\",\n\t  handler: function handler(field, service) {\n\t    return service.processSelectDisplay(field);\n\t  }\n\t}, {\n\t  prop: \"schema\",\n\t  handler: function handler(field, service) {\n\t    return _.isUndefined(field.default) && !_.isUndefined(field.schema.default) && service.processDefault(field);\n\t  }\n\t}, {\n\t  prop: \"watch\",\n\t  handler: function handler(field, service, secondPass) {\n\t    return !secondPass && field.watch && service.processFieldWatch(field);\n\t  }\n\t}, {\n\t  prop: \"type\",\n\t  handler: function handler(field, service, secondPass) {\n\t    return service.processFieldType(field, secondPass);\n\t  }\n\t}, {\n\t  prop: \"conditionals\",\n\t  handler: function handler(field, service) {\n\t    return service.processConditional(field);\n\t  }\n\t}, {\n\t  prop: \"updateSchema\",\n\t  handler: function handler(field, service, secondPass) {\n\t    return !secondPass && service.processFieldUpdatedSchema(field);\n\t  }\n\t}];\n\t\n\tfunction cnFlexFormServiceProvider(schemaFormDecoratorsProvider, cnFlexFormTypesProvider) {\n\t  \"ngInject\";\n\t\n\t  return {\n\t    registerField: registerField,\n\t    $get: CNFlexFormService\n\t  };\n\t\n\t  //////////\n\t\n\t  function registerField(fieldType) {\n\t    if (fieldType.condition) {\n\t      cnFlexFormTypesProvider.registerFieldType({\n\t        condition: fieldType.condition,\n\t        type: fieldType.type\n\t      });\n\t    }\n\t\n\t    if (fieldType.handler) {\n\t      fieldTypeHandlers[fieldType.type] = fieldType.handler;\n\t    }\n\t\n\t    if (fieldType.templateUrl) {\n\t      schemaFormDecoratorsProvider.addMapping(\"bootstrapDecorator\", fieldType.type, fieldType.templateUrl);\n\t      schemaFormDecoratorsProvider.createDirective(fieldType.type, fieldType.templateUrl);\n\t    }\n\t  }\n\t}\n\t\n\tfunction CNFlexFormService(Api, $parse, cnFlexFormConfig, cnFlexFormTypes, sfPath, $interpolate, $timeout, cnUtil, $stateParams) {\n\t  \"ngInject\";\n\t\n\t  var services = [];\n\t  var prototype = {\n\t    compile: compile,\n\t    addArrayCopy: addArrayCopy,\n\t    addToDataCache: addToDataCache,\n\t    addToFormCache: addToFormCache,\n\t    addToScopeCache: addToScopeCache,\n\t    broadcastErrors: broadcastErrors,\n\t    buildError: buildError,\n\t    cleanup: cleanup,\n\t    deleteArrayCopiesFor: deleteArrayCopiesFor,\n\t    deregisterHandlers: deregisterHandlers,\n\t    deregisterArrayHandlers: deregisterArrayHandlers,\n\t    getArrayCopy: getArrayCopy,\n\t    getArrayCopies: getArrayCopies,\n\t    getArrayCopiesFor: getArrayCopiesFor,\n\t    getArrayScopes: getArrayScopes,\n\t    getDefault: getDefault,\n\t    getFromDataCache: getFromDataCache,\n\t    getFromFormCache: getFromFormCache,\n\t    getFromScopeCache: getFromScopeCache,\n\t    getFormsToProcess: getFormsToProcess,\n\t    getKey: getKey,\n\t    getSchema: getSchema,\n\t    getWatchables: getWatchables,\n\t    handleResolve: handleResolve,\n\t    incrementUpdates: incrementUpdates,\n\t    initArrayCopyWatch: initArrayCopyWatch,\n\t    initModelWatch: initModelWatch,\n\t    initSchemaParams: initSchemaParams,\n\t    isCompiled: isCompiled,\n\t    onModelWatch: onModelWatch,\n\t    parseAll: parseAll,\n\t    parseAny: parseAny,\n\t    parseCondition: parseCondition,\n\t    parseExpression: parseExpression,\n\t    processArray: processArray,\n\t    processCreativeImage: processCreativeImage,\n\t    processDefault: processDefault,\n\t    processDisplay: processDisplay,\n\t    processFacebookVideo: processFacebookVideo,\n\t    processField: processField,\n\t    processFieldset: processFieldset,\n\t    processFieldProps: processFieldProps,\n\t    processFieldType: processFieldType,\n\t    processFieldUpdatedSchema: processFieldUpdatedSchema,\n\t    processFieldWatch: processFieldWatch,\n\t    processComponent: processComponent,\n\t    processConditional: processConditional,\n\t    processCurrency: processCurrency,\n\t    processNumber: processNumber,\n\t    processPercentage: processPercentage,\n\t    processUrl: processUrl,\n\t    processDate: processDate,\n\t    processHelp: processHelp,\n\t    processRadios: processRadios,\n\t    processRadiobuttons: processRadiobuttons,\n\t    processReusable: processReusable,\n\t    processSchema: processSchema,\n\t    processSelectDisplay: processSelectDisplay,\n\t    processResolve: processResolve,\n\t    processSection: processSection,\n\t    processSelect: processSelect,\n\t    processSchedule: processSchedule,\n\t    processTable: processTable,\n\t    processTemplate: processTemplate,\n\t    processToggle: processToggle,\n\t    processUpdatedSchema: processUpdatedSchema,\n\t    processMediaUpload: processMediaUpload,\n\t    processCsvUpload: processCsvUpload,\n\t    registerArrayHandlers: registerArrayHandlers,\n\t    registerHandler: registerHandler,\n\t    registerResolve: registerResolve,\n\t    replaceArrayIndex: replaceArrayIndex,\n\t    reprocessField: reprocessField,\n\t    resetUpdates: resetUpdates,\n\t    resolveNestedExpressions: resolveNestedExpressions,\n\t    setArrayIndex: setArrayIndex,\n\t    setupConfig: setupConfig,\n\t    setupSchemaRefresh: setupSchemaRefresh,\n\t    silenceListeners: silenceListeners,\n\t    skipDefaults: skipDefaults\n\t  };\n\t\n\t  function getService(fn) {\n\t    return _.find(services, fn);\n\t  }\n\t\n\t  function destroyService(fn) {\n\t    var service = getService(fn);\n\t    if (service) {\n\t      service.cleanup();\n\t      _.empty(service);\n\t      _.remove(services, function (s) {\n\t        return s === service;\n\t      });\n\t    }\n\t  }\n\t\n\t  function CNFlexFormConstructor() {\n\t    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t      args[_key] = arguments[_key];\n\t    }\n\t\n\t    if (args.length > 1) {\n\t      var schema = args[0],\n\t          model = args[1],\n\t          config = args[2];\n\t    } else {\n\t      var _args$ = args[0],\n\t          schema = _args$.schema,\n\t          model = _args$.model,\n\t          config = _args$.config;\n\t    }\n\t\n\t    var curService = getService(function (service) {\n\t      return service.model === model;\n\t    });\n\t    if (curService) {\n\t      if (schema) {\n\t        curService.compile(schema, model, config);\n\t      }\n\t      return curService;\n\t    }\n\t\n\t    var newService = new CNFlexForm(schema, model, config);\n\t    services.push(newService);\n\t    return newService;\n\t  }\n\t\n\t  function CNFlexForm(schema, model, config) {\n\t    if ($stateParams.debug) {\n\t      window.services = services;\n\t    }\n\t\n\t    this.arrayCopies = {};\n\t    this.arrayListeners = {};\n\t    this.dataCache = {};\n\t    this.defaults = {};\n\t    this.errors = [];\n\t    this.events = [];\n\t    this.formCache = {};\n\t    this.scopeCache = {};\n\t    this.listeners = {};\n\t    this.resolveRegister = {};\n\t    this.model = model;\n\t    this.updates = 0;\n\t    this.skipDefault = {};\n\t\n\t    var overrides = config.getParams ? config.getParams() : {};\n\t    this.params = cnFlexFormConfig.getStateParams(overrides);\n\t\n\t    this._ = _;\n\t\n\t    this.compile(schema, model, config);\n\t  }\n\t\n\t  _.extend(CNFlexForm.prototype, prototype);\n\t  _.extend(CNFlexFormConstructor, prototype, { getService: getService, destroyService: destroyService });\n\t\n\t  return CNFlexFormConstructor;\n\t\n\t  //////////////\n\t\n\t  function compile(schema, model, config) {\n\t    var service = this;\n\t\n\t    if (config && config.getScope) {\n\t      service.scope = config.getScope();\n\t    }\n\t    service.schema = schema;\n\t    service.model = model;\n\t\n\t    if (!service.isCompiled()) {\n\t      service.setupConfig(config);\n\t\n\t      if (schema.forms) {\n\t        _.each(schema.forms, function (form) {\n\t          _.each(form.form, service.processField.bind(service));\n\t        });\n\t      } else {\n\t        _.each(schema.form, service.processField.bind(service));\n\t      }\n\t\n\t      service.initModelWatch();\n\t      service.initArrayCopyWatch();\n\t      service.isCompiled(true);\n\t    }\n\t\n\t    service.broadcastErrors();\n\t  }\n\t\n\t  function isCompiled(setValue) {\n\t    var service = this;\n\t    if (setValue) {\n\t      service.schema.compiled = setValue;\n\t    }\n\t    return service.schema && service.schema.compiled;\n\t  }\n\t\n\t  function setupConfig(config) {\n\t    var service = this;\n\t    if (config) {\n\t      if (config.formCtrl) service.formCtrl = config.formCtrl;\n\t      if (config.updateSchema) service.updateSchema = config.updateSchema;\n\t      if (config.getSchema) service.getSchemaForm = service.setupSchemaRefresh(config.getSchema);\n\t    }\n\t    service.getParamOverrides = config.getParams || _.noop;\n\t  }\n\t\n\t  function processSchema(field) {\n\t    var service = this;\n\t    var schema = field.schema;\n\t\n\t\n\t    field.getSchemaType = function () {\n\t      return _.isArray(schema.type) ? _.first(schema.type) : schema.type;\n\t    };\n\t    if (!field.type) field.type = field.getSchemaType && field.getSchemaType();\n\t  }\n\t\n\t  function processDefault(field) {\n\t    var service = this;\n\t    var schema = field.schema;\n\t\n\t    var curDefault = field.default || schema.default;\n\t    var key = service.getKey(field.key);\n\t\n\t    if (service.skipDefault[key]) {\n\t      delete service.skipDefault[key];\n\t      return;\n\t    }\n\t\n\t    if (field.condition) {\n\t      var condition = replaceArrayIndex(field.condition, field.arrayIndex || key);\n\t      if (!service.parseCondition(condition)) return;\n\t    }\n\t\n\t    // if schemaUpdate hasn't been triggered, let schemaForm directive handle defaults\n\t    //if(service.updates || field.default) {\n\t    if (!_.isUndefined(curDefault)) {\n\t      if (key.includes && key.includes(\"[]\")) return;\n\t      var model = service.parseExpression(field.key, service.model);\n\t      var modelValue = model.get();\n\t      // if there's an existing default and it's the same as the current value\n\t      // update the current value to the new default\n\t      if (_.isUndefined(modelValue) || (_.has(service.defaults, key) ? angular.equals(modelValue, service.defaults[key]) : _.isTrulyEmpty(modelValue)) && !angular.equals(modelValue, curDefault)) {\n\t        model.set(angular.copy(curDefault));\n\t      }\n\t    }\n\t    service.defaults[key] = angular.copy(curDefault);\n\t\n\t    if (schema.format === \"url\" && !field.validationMessage) {\n\t      if (!field.type) field.type = \"cn-url\";\n\t      field.validationMessage = \"Must be a valid url (https://...)\";\n\t    }\n\t  }\n\t\n\t  function processFieldset(fieldset) {\n\t    var service = this;\n\t\n\t    fieldset.type = \"cn-fieldset\";\n\t    fieldset.items.forEach(service.processField.bind(service));\n\t\n\t    if (_.has(fieldset, \"pos\") && fieldset.pos === 0) {\n\t      fieldset.htmlClass = (fieldset.htmlClass || \"\") + \" borderless\";\n\t    }\n\t    if (fieldset.collapsible) {\n\t      fieldset.toggleCollapse = function (fieldset) {\n\t        if (fieldset.collapsible) {\n\t          fieldset.collapsed = !fieldset.collapsed;\n\t        }\n\t      };\n\t\n\t      fieldset.render = !fieldset.collapsed;\n\t    } else {\n\t      fieldset.render = true;\n\t    }\n\t  }\n\t\n\t  function processFieldType(field, secondPass) {\n\t    var service = this;\n\t    var fieldType = cnFlexFormTypes.getFieldType(field);\n\t    var handler = fieldTypeHandlers[fieldType];\n\t    if (_.isString(handler)) {\n\t      service[handler](field, secondPass);\n\t    } else if (_.isFunction(handler)) {\n\t      handler.call(service, field, secondPass);\n\t    }\n\t  }\n\t\n\t  function getOgKeys(field) {\n\t    return _.reject(_.keys(field), function (key) {\n\t      return (/^key$|^htmlClass$|^_/.test(key)\n\t      );\n\t    });\n\t  }\n\t\n\t  function processField(field, pos) {\n\t    var service = this;\n\t\n\t    if (angular.isDefined(pos)) {\n\t      field.pos = pos;\n\t    }\n\t\n\t    if (!field._ogKeys) {\n\t      field._ogKeys = getOgKeys(field);\n\t    }\n\t\n\t    var key = service.getKey(field.key);\n\t\n\t    if (key) {\n\t      service.addToFormCache(field, key);\n\t      var schema = service.getSchema(key);\n\t\n\t      if (schema) {\n\t        field.schema = schema;\n\t        if (schema.description) field.description = schema.description;\n\t        if (schema.type === \"array\" && !(\"showClearAll\" in field)) field.showClearAll = true;\n\t      }\n\t\n\t      service.processSchema(field);\n\t    }\n\t\n\t    service.processFieldProps(field);\n\t\n\t    if (key) {\n\t      (function (key) {\n\t        if (_.find(service.errors, { key: key })) {\n\t          service.errors = _.reject(service.errors, { key: key });\n\t          service.scope.$broadcast(\"schemaForm.error.\" + key, \"serverValidation\", true);\n\t          service.scope.$broadcast(\"schemaForm.error.\" + key, \"schemaForm\", true);\n\t        }\n\t      })(getDotKey(key));\n\t\n\t      if (field.error) {\n\t        service.errors.push(service.buildError(field));\n\t        if (_.isEmpty(field.ngModelOptions)) {\n\t          field.ngModelOptions = {\n\t            allowInvalid: true\n\t          };\n\t        } else {\n\t          field.ngModelOptions.allowInvalid = true;\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  function processFieldProps(field, secondPass) {\n\t    var service = this;\n\t    fieldPropHandlers.forEach(function (_ref) {\n\t      var prop = _ref.prop,\n\t          handler = _ref.handler;\n\t      return _.has(field, prop) && handler(field, service, secondPass);\n\t    });\n\t  }\n\t\n\t  function getKey(key) {\n\t    if (_.isArray(key)) {\n\t      key = _.reduce(key, function (total, next) {\n\t        return (/^(-?\\d*)$/.test(next) ? total + \"[\" + next + \"]\" : total + \".\" + next\n\t        );\n\t      });\n\t    }\n\t    return key;\n\t  }\n\t\n\t  function getSchema(key, depth) {\n\t    var service = this;\n\t    if (!key) return;\n\t\n\t    key = ObjectPath.parse(service.getKey(key));\n\t    depth = depth || service.schema.schema.properties;\n\t    var first = void 0,\n\t        next = void 0;\n\t\n\t    while (key.length > 1) {\n\t      next = key[1];\n\t      if (/^-?\\d*$/.test(next)) {\n\t        if (key.length === 2) {\n\t          depth = depth[key.shift()];\n\t        } else {\n\t          depth = depth[key.shift()].items.properties;\n\t          key.shift();\n\t        }\n\t      } else {\n\t        depth = depth[key.shift()].properties;\n\t      }\n\t    }\n\t\n\t    // if array item\n\t    first = key[0] || \"items\";\n\t\n\t    return depth[first];\n\t  }\n\t\n\t  function getDefault(field) {\n\t    var service = this;\n\t    field = field.key ? field : service.getFromFormCache(field);\n\t    return field && (angular.isDefined(field.default) ? field.default : field.schema && field.schema.default);\n\t  }\n\t\n\t  function getWatchables(exp) {\n\t    var watchables = [];\n\t    var nested = matchNestedExpression(exp);\n\t    var replaceStr = \"\";\n\t\n\t    while (nested) {\n\t      if (/^-?\\d+$/.test(nested[1]) || /^(\"|').*(\"|')$/.test(nested[1])) {\n\t        replaceStr = nested[0];\n\t        exp = exp.replace(nested[0], \"ff_replace_ff\");\n\t      } else {\n\t        watchables.push(nested[1].replace(/ff_replace_ff/g, replaceStr));\n\t        replaceStr = \"\";\n\t        exp = exp.replace(nested[0], \"\");\n\t      }\n\t      nested = matchNestedExpression(exp);\n\t    }\n\t\n\t    return [].concat(watchables, [exp.replace(/ff_replace_ff/g, replaceStr)]);\n\t  }\n\t\n\t  function processResolve(field) {\n\t    var service = this;\n\t    var key = service.getKey(field.key);\n\t\n\t    _.each(field.resolve, function (dataProp, fieldProp) {\n\t      dataProp = replaceArrayIndex(dataProp, key || field.arrayIndex);\n\t      if (dataProp.includes(\"[arrayIndex]\")) return;\n\t\n\t      service.handleResolve(field, fieldProp, dataProp, true);\n\t\n\t      getWatchables(dataProp).forEach(function (watchable) {\n\t        var _ref2 = watchable.match(/(schema\\.data\\.|model\\.)(\\S+)/) || [],\n\t            _ref3 = _slicedToArray(_ref2, 3),\n\t            base = _ref3[1],\n\t            exp = _ref3[2];\n\t\n\t        if (base) {\n\t          if (base === \"schema.data.\") {\n\t            service.registerResolve(field, fieldProp, exp, dataProp);\n\t          } else if (base === \"model.\") {\n\t            service.registerHandler(exp, function () {\n\t              service.handleResolve(field, fieldProp, dataProp);\n\t            });\n\t          }\n\t        }\n\t      });\n\t    });\n\t\n\t    return field;\n\t  }\n\t\n\t  function parseAny(exp, base) {\n\t    var service = this;\n\t    var result = void 0;\n\t    var eithers = exp.split(\" || \");\n\t    var match = _.find(eithers, function (x) {\n\t      var v = service.parseExpression(x, base).get();\n\t      if (!_.isUndefined(v)) {\n\t        result = v;\n\t        return true;\n\t      }\n\t    });\n\t    return result;\n\t  }\n\t\n\t  function parseAll(exp, base) {\n\t    var service = this;\n\t    var all = exp.split(\" && \");\n\t    var match = _.reduce(all, function (acc, x) {\n\t      var v = service.parseExpression(x, base).get();\n\t      if (!_.isUndefined(v)) {\n\t        acc.push(v);\n\t      }\n\t      return acc;\n\t    }, []);\n\t    return all.length === match.length ? _.last(match) : undefined;\n\t  }\n\t\n\t  function handleResolve(field, fieldProp, exp, skipPropHandlers) {\n\t    var service = this;\n\t    var data = exp.includes(\" || \") ? service.parseAny(exp) : exp.includes(\" && \") ? service.parseAll(exp) : service.parseExpression(exp).get();\n\t\n\t    if (data && data.cursor) {\n\t      field.loadMore = function () {\n\t        var dataProp = exp.match(/schema\\.data\\.(.+)/)[1];\n\t        service.refreshSchema(\"data:\" + dataProp + \":\" + data.cursor);\n\t      };\n\t    } else {\n\t      delete field.loadMore;\n\t    }\n\t\n\t    var val = data && data.data ? data.data : data;\n\t    var val1 = fieldProp === \"condition\" ? val + \"\" : val;\n\t    service.parseExpression(fieldProp, field).set(val1);\n\t\n\t    if (!skipPropHandlers) {\n\t      fieldPropHandlers.forEach(function (_ref4) {\n\t        var prop = _ref4.prop,\n\t            handler = _ref4.handler;\n\t        return prop === fieldProp && handler(field, service);\n\t      });\n\t    }\n\t  }\n\t\n\t  function registerResolve(field, fieldProp, dataProp, exp) {\n\t    var service = this;\n\t\n\t    var fieldKey = service.getKey(field.key);\n\t    service.resolveRegister[dataProp] = service.resolveRegister[dataProp] || {};\n\t\n\t    var register = service.resolveRegister[dataProp];\n\t    register[fieldKey] = register[fieldKey] || [];\n\t    register[fieldKey].push({ field: field, prop: fieldProp, exp: exp });\n\t  }\n\t\n\t  function processConditional(field) {\n\t    var service = this;\n\t    _.each(field.conditionals, function (condition, key) {\n\t      var handler = function handler(val, prev) {\n\t        field[key] = service.parseCondition(condition);\n\t        var scope = service.getFromScopeCache(service.getKey(field.key));\n\t        if (key === \"required\" && scope) {\n\t          service.scope.$broadcast(\"schemaFormValidate\");\n\t        }\n\t      };\n\t      field.conditionals[key].match(/model\\.([^\\s]+)/g).map(function (path) {\n\t        return path.match(/model\\.([^\\s]+)/)[1];\n\t      }).forEach(function (key) {\n\t        service.registerHandler(key, handler);\n\t      });\n\t      handler();\n\t    });\n\t  }\n\t\n\t  function processFieldWatch(field) {\n\t    var service = this;\n\t    if (!field.watch) return;\n\t\n\t    var schema = field.schema;\n\t    field.watch = _.isArray(field.watch) ? field.watch : [field.watch];\n\t\n\t    _.each(field.watch, function (watch) {\n\t      if (watch.resolution) {\n\t        var condition = void 0;\n\t        if (_.isString(field.condition)) {\n\t          // if the condition isn't already wrapped in parens, wrap it\n\t          condition = /^\\(.*\\)$/.test(field.condition) ? field.condition : \"(\" + field.condition + \")\";\n\t        }\n\t        if (_.isString(watch.condition)) {\n\t          condition = condition ? condition + \" && \" + watch.condition : watch.condition;\n\t        }\n\t        var resolution = watch.resolution;\n\t        var handler = void 0;\n\t\n\t        if (_.isFunction(resolution)) {\n\t          handler = function handler(cur, prev) {\n\t            if (!condition || service.parseCondition(condition)) {\n\t              resolution(cur, prev);\n\t            }\n\t          };\n\t        } else {\n\t          var adjustment = {};\n\t\n\t          adjustment.date = resolution.match(/\\+ ?(\\d+) (days|hours)/);\n\t\n\t          if (adjustment.date) {\n\t            adjustment.date = {\n\t              val: adjustment.date[1],\n\t              units: adjustment.date[2]\n\t            };\n\t            resolution = resolution.replace(adjustment.date.val, \"\").trim();\n\t          } else {\n\t            adjustment.math = resolution.match(/(\\+|\\-|\\/|\\*) ?(\\S+)/);\n\t\n\t            if (adjustment.math) {\n\t              adjustment.operator = {\n\t                \"+\": \"add\",\n\t                \"-\": \"subtract\",\n\t                \"*\": \"multiply\",\n\t                \"/\": \"divide\"\n\t              }[adjustment.math[1]];\n\t\n\t              adjustment.adjuster = service.parseExpression(adjustment.math[2]);\n\t            }\n\t          }\n\t\n\t          resolution = resolution.match(/(\\S+) ?= ?(\\S+)/);\n\t\n\t          handler = function handler(val, prev, key, trigger) {\n\t            var curCondition = condition && replaceArrayIndex(condition, key);\n\t            if (_.isString(curCondition) && curCondition.includes(\"[arrayIndex]\")) {\n\t              return console.error(\"arrayIndex could not be repalced from expression '\" + curCondition + \"'\");\n\t            }\n\t            var updatePath = replaceArrayIndex(resolution[1], key);\n\t            var fromPath = replaceArrayIndex(resolution[2], key);\n\t\n\t            var update = service.parseExpression(updatePath);\n\t\n\t            // avoid loop where two watches keep triggering each other\n\t            if (trigger === update.path().key) return;\n\t            trigger = update.path().key;\n\t\n\t            var from = service.parseExpression(fromPath);\n\t\n\t            if (!condition || service.parseCondition(curCondition)) {\n\t              if (adjustment.date) {\n\t                update.set(moment(from.get()).add(adjustment.date.val, adjustment.date.units).toDate());\n\t              } else if (adjustment.math) {\n\t                //var result = _[adjustment.operator](from.get(), adjustment.adjuster.get());\n\t                //let result = eval(from.get() + adjustment.math[1] + adjustment.adjuster.get());\n\t                var result = $parse(from.get() + adjustment.math[1] + adjustment.adjuster.get())();\n\t                schema = schema || field.items && (field.items[0].schema || field.items[0].items && field.items[0].items[0].schema);\n\t                if (field.type === \"cn-currency\") {\n\t                  var p = schema && schema.format === \"currency-dollars\" ? 2 : 0;\n\t\n\t                  if (adjustment.math[1] === \"*\") {\n\t                    result = _.floor(result, p);\n\t                  } else if (adjustment.math[1] === \"/\") {\n\t                    result = _.ceil(result, p);\n\t                  } else {\n\t                    result = _.round(result, p);\n\t                  }\n\t                }\n\t                //service.listeners[update.path().key].prev = result;\n\t                if (service.listeners[trigger]) {\n\t                  service.listeners[trigger].trigger = key;\n\t                }\n\t                update.set(result || 0);\n\t              } else {\n\t                update.set(from.get());\n\t              }\n\t            }\n\t          };\n\t        }\n\t\n\t        service.registerHandler(field, handler, field.updateSchema, watch.initialize);\n\t      }\n\t    });\n\t  }\n\t\n\t  function parseCondition(condition) {\n\t    var service = this;\n\t    if (condition.startsWith(\"_\")) {\n\t      var exp = /^_\\.(.*?)\\((.*?),[\\s(]*(.*?)\\)?\\s*=>[{\\s]*(?:return)?(.*?)\\}?\\)$/;\n\t\n\t      var _condition$match = condition.match(exp),\n\t          _condition$match2 = _slicedToArray(_condition$match, 5),\n\t          fn = _condition$match2[1],\n\t          list = _condition$match2[2],\n\t          predicateParams = _condition$match2[3],\n\t          predicateBody = _condition$match2[4];\n\t\n\t      return _[fn]($parse(list)(service), generatePredicate(predicateParams, predicateBody));\n\t    } else {\n\t      return $parse(condition)(service);\n\t    }\n\t  }\n\t\n\t  function generatePredicate(params, body) {\n\t    return function () {\n\t      for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t        args[_key2] = arguments[_key2];\n\t      }\n\t\n\t      return $parse(body)(params.replace(/\\s/g, \"\").split(\",\").reduce(function (acc, cur, i) {\n\t        acc[cur] = args[i];\n\t        return acc;\n\t      }, {}));\n\t    };\n\t  }\n\t\n\t  function processFieldUpdatedSchema(field) {\n\t    var service = this;\n\t    var key = service.getKey(field.key);\n\t    if (!service.updates && field.updateSchema && !service.schema.params[key]) {\n\t      // by this point defaults should be processed so we can get value directly from model\n\t      var curVal = service.parseExpression(key, service.model).get();\n\t      if (!_.isUndefined(curVal)) service.schema.params[key] = curVal;\n\t    }\n\t    service.registerHandler(field, null, field.updateSchema);\n\t  }\n\t\n\t  function registerHandler(key, handler, updateSchema, runHandler) {\n\t    var service = this;\n\t\n\t    // if field is passed instead of key\n\t    if (_.isObject(key) && !_.isArray(key)) {\n\t      if (!key.key && key.items) {\n\t        _.each(key.items, function (field) {\n\t          service.registerHandler(field, handler, field.updateSchema);\n\t        });\n\t        return;\n\t      } else {\n\t        key = key.key;\n\t      }\n\t    }\n\t\n\t    key = service.getKey(key);\n\t    var arrMatch = key.match(/(.*)\\[]\\.?(.*)/);\n\t\n\t    if (arrMatch) {\n\t      service.registerArrayHandlers(arrMatch[1], arrMatch[2], handler, updateSchema, runHandler);\n\t      return;\n\t    }\n\t\n\t    var cur = service.parseExpression(key, service.model).get();\n\t    var defaultValue = _.get(service.getSchema(key), \"default\");\n\t\n\t    if (!service.listeners[key]) {\n\t      var prev = angular.copy(cur);\n\t      service.listeners[key] = {\n\t        handlers: [],\n\t        updateSchema: updateSchema,\n\t        prev: prev\n\t      };\n\t    }\n\t\n\t    if (handler) {\n\t      service.listeners[key].handlers.push(handler);\n\t      if (runHandler) handler(cur, null, key);\n\t    }\n\t  }\n\t\n\t  function registerArrayHandlers(arrKey, fieldKey, handler, updateSchema, runHandler) {\n\t    var service = this;\n\t    var onArray = function onArray(cur, prev, reorder) {\n\t      if (!prev && prev !== 0 && (cur | 0) < 1) return;\n\t      var i, l, key;\n\t\n\t      if (prev > cur || reorder) {\n\t        var lastKey = fieldKey ? arrKey + \"[\" + (prev - 1) + \"].\" + fieldKey : arrKey + \"[\" + (prev - 1) + \"]\";\n\t\n\t        // only deregister handlers once each time an element is removed\n\t        if (service.listeners[lastKey]) {\n\t          for (i = 0, l = prev; i < l; i++) {\n\t            key = fieldKey ? arrKey + \"[\" + i + \"].\" + fieldKey : arrKey + \"[\" + i + \"]\";\n\t\n\t            service.deregisterHandlers(key);\n\t          }\n\t        }\n\t        for (i = 0, l = cur; i < l; i++) {\n\t          key = fieldKey ? arrKey + \"[\" + i + \"].\" + fieldKey : arrKey + \"[\" + i + \"]\";\n\t\n\t          service.registerHandler(key, handler, updateSchema);\n\t          //no need to call if just reregisering handlers\n\t          //if(runHandler) handler(null, null, key);\n\t        }\n\t      } else if (cur > (prev || 0)) {\n\t        for (i = prev | 0, l = cur; i < l; i++) {\n\t          key = fieldKey ? arrKey + \"[\" + i + \"].\" + fieldKey : arrKey + \"[\" + i + \"]\";\n\t\n\t          service.registerHandler(key, handler, updateSchema, runHandler);\n\t          //if(runHandler) handler(null, null, key);\n\t        }\n\t      }\n\t    };\n\t\n\t    var arrVal = service.parseExpression(arrKey, service.model).get();\n\t    _.each(arrVal, function (field, i) {\n\t      var key = fieldKey ? arrKey + \"[\" + i + \"].\" + fieldKey : arrKey + \"[\" + i + \"]\";\n\t\n\t      service.registerHandler(key, handler, updateSchema);\n\t      if (runHandler) handler(null, null, key);\n\t    });\n\t\n\t    var listenerKey = arrKey + \".length\";\n\t    if (service.arrayListeners[listenerKey]) {\n\t      service.arrayListeners[listenerKey].handlers.push(onArray);\n\t    } else {\n\t      service.arrayListeners[listenerKey] = {\n\t        handlers: [onArray],\n\t        prev: arrVal ? arrVal.length : 0\n\t      };\n\t    }\n\t  }\n\t\n\t  function deregisterHandlers(key) {\n\t    var service = this;\n\t\n\t    key = service.getKey(key);\n\t\n\t    var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.*)/);\n\t\n\t    if (arrMatch) {\n\t      service.deregisterArrayHandlers(arrMatch[1], arrMatch[2]);\n\t      return;\n\t    }\n\t\n\t    if (service.listeners[key]) service.listeners[key].handlers = [];\n\t    //if(service.listeners[key]) delete service.listeners[key];\n\t  }\n\t\n\t  function deregisterArrayHandlers(arrKey, fieldKey) {\n\t    var service = this;\n\t\n\t    service.parseExpression(arrKey, service.model).get().forEach(function (item, i) {\n\t      fieldKey ? service.deregisterHandlers(arrKey + \"[\" + i + \"].\" + fieldKey) : service.deregisterHandlers(arrKey + \"[\" + i + \"]\");\n\t    });\n\t  }\n\t\n\t  function initModelWatch() {\n\t    var service = this;\n\t    if (service.watching) return;\n\t    if (service.modelWatch) service.modelWatch();\n\t\n\t    service.modelWatch = service.scope.$watch(function () {\n\t      return service.model;\n\t    }, service.onModelWatch.bind(service), true);\n\t\n\t    service.initSchemaParams();\n\t    service.watching = true;\n\t    service.firstUpdate = true;\n\t  }\n\t\n\t  function onModelWatch(cur, prev) {\n\t    var service = this;\n\t    // we always run through the listeners on the first update because angular seems to mess up\n\t    // when the defaults are applied and uses the same object for both cur and prev\n\t    if (service.firstUpdate || !angular.equals(cur, prev)) {\n\t      service.firstUpdate = false;\n\t      cnUtil.cleanModel(service.model);\n\t\n\t      service.prevParams = angular.copy(service.params);\n\t\n\t      _.each(service.arrayListeners, function (listener, key) {\n\t        var val = service.parseExpression(key, service.model).get();\n\t        if (!angular.equals(val, listener.prev)) {\n\t          listener.handlers.forEach(function (handler) {\n\t            return handler(val, listener.prev);\n\t          });\n\t          listener.prev = angular.copy(val);\n\t        }\n\t      });\n\t\n\t      _.each(service.listeners, function (listener, key) {\n\t        if (listener) {\n\t          var val = service.parseExpression(key, service.model).get();\n\t          var isInitArray = angular.equals(val, []) && !listener.prev;\n\t          if (!angular.equals(val, listener.prev) && !isInitArray) {\n\t            listener.handlers.forEach(function (handler) {\n\t              handler(val, listener.prev, key, listener.trigger);\n\t            });\n\t            listener.trigger = null;\n\t            listener.prev = angular.copy(val);\n\t          }\n\t          if (listener.updateSchema && !angular.isUndefined(val) && !isInitArray && val !== null /* &&\n\t                                                                                                 !angular.equals(val, service.getDefault(key))*/\n\t          ) {\n\t              service.params[key] = val;\n\t            } else {\n\t            delete service.params[key];\n\t          }\n\t        }\n\t      });\n\t\n\t      if (!angular.equals(service.params, service.prevParams)) {\n\t        if (service.model.id && !service.updates && _.isEmpty(service.prevParams)) {\n\t          service.incrementUpdates();\n\t        } else {\n\t          if (_.isFunction(service.refreshSchema)) {\n\t            service.refreshSchema();\n\t          }\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  function initSchemaParams() {\n\t    var service = this;\n\t    _.each(service.listeners, function (listener, key) {\n\t      if (listener) {\n\t        var val = service.parseExpression(key, service.model).get();\n\t        if (listener.updateSchema && !angular.isUndefined(val) && val !== null) {\n\t          service.params[key] = val;\n\t        }\n\t      }\n\t    });\n\t  }\n\t\n\t  function stripIndexes(key) {\n\t    return key.replace(/\\[\\d+]/g, \"[]\");\n\t  }\n\t\n\t  function initArrayCopyWatch() {\n\t    var service = this;\n\t\n\t    service.events.push(service.scope.$on(\"schemaFormPropagateFormController\", function (event, scope) {\n\t      var form = scope.form;\n\t\n\t      if (!form.key) {\n\t        form.cacheKey = form.type + \"-\" + _.uniqueId();\n\t      }\n\t      var key = form.cacheKey || service.getKey(form.key);\n\t\n\t      if (_.isNumber(scope.arrayIndex)) {\n\t        var genericKey = stripIndexes(key);\n\t        var index = scope.arrayIndex;\n\t        form.arrayIndex = index;\n\t\n\t        if (!service.getArrayCopy(genericKey, index)) {\n\t          service.processFieldProps(form, true);\n\t        }\n\t\n\t        if (!form.condition) form.condition = \"true\";\n\t        // else if (form.condition.includes(\"arrayIndex\")) {\n\t        //   form.condition = service.replaceArrayIndex(form.condition, key);\n\t        // }\n\t\n\t        service.addArrayCopy(scope, genericKey, index);\n\t        scope.$emit(\"flexFormArrayCopyAdded\", genericKey);\n\t      } else {\n\t        service.addToScopeCache(scope, key);\n\t      }\n\t    }));\n\t\n\t    service.events.push(service.scope.$on(\"schemaFormDeleteScope\", function (event, scope, index) {\n\t      var key = service.getKey(scope.form.key);\n\t      var listener = service.listeners[key];\n\t      if (listener) listener.handlers = [];\n\t\n\t      service.deleteArrayCopiesFor(key, index);\n\t\n\t      if (scope.form.link) {\n\t        var list = service.parseExpression(scope.form.link, service.model).get();\n\t        list.splice(index, 1);\n\t        service.deleteArrayCopiesFor(scope.form.link, index);\n\t      }\n\t    }));\n\t  }\n\t\n\t  function addArrayCopy(form, key, index) {\n\t    var service = this;\n\t    if (!index || index < 0) index = 0;\n\t    if (!service.arrayCopies[key]) service.arrayCopies[key] = [];\n\t    service.arrayCopies[key][index] = form;\n\t    //service.arrayCopies[key].push(form);\n\t  }\n\t\n\t  function getArrayCopy(key, index) {\n\t    var service = this;\n\t    var copies = service.arrayCopies[key];\n\t    return copies && copies[index];\n\t  }\n\t\n\t  function getArrayCopies(key) {\n\t    var service = this;\n\t    return _.pluck(service.getArrayScopes(key), \"form\");\n\t  }\n\t\n\t  function getArrayCopiesFor(keyStart) {\n\t    var service = this;\n\t    keyStart += \"[]\";\n\t\n\t    return _.filter(service.arrayCopies, function (copy, key) {\n\t      return key.includes(keyStart);\n\t    });\n\t  }\n\t\n\t  function deleteArrayCopiesFor(key, index) {\n\t    var service = this;\n\t    var copies = service.getArrayCopiesFor(key);\n\t    _.each(copies, function (list) {\n\t      return list && list.splice(index, 1);\n\t    });\n\t  }\n\t\n\t  function getArrayScopes(key) {\n\t    var service = this;\n\t    return service.arrayCopies[key];\n\t  }\n\t\n\t  function addToScopeCache(scope, key) {\n\t    var service = this;\n\t    if (service.scopeCache[key]) {\n\t      console.warn(\"caching duplicate scope for\", key);\n\t    }\n\t    return service.scopeCache[key] = scope;\n\t  }\n\t\n\t  function getFromScopeCache(key) {\n\t    var service = this;\n\t    return service.scopeCache[key];\n\t  }\n\t\n\t  function addToFormCache(field, key) {\n\t    var service = this;\n\t    key = key || service.getKey(field.key);\n\t    if (!service.getFromFormCache(key)) service.formCache[key] = field;\n\t  }\n\t\n\t  function getFromFormCache(key) {\n\t    var service = this;\n\t    return service.formCache[key];\n\t  }\n\t\n\t  function addToDataCache(key, modelValue) {\n\t    var service = this;\n\t\n\t    if (key) {\n\t      service.dataCache[key] = modelValue;\n\t    }\n\t  }\n\t\n\t  function getFromDataCache(key) {\n\t    var service = this;\n\t\n\t    return service.dataCache[key];\n\t  }\n\t\n\t  function matchIntStrIndex(exp) {\n\t    return exp.match(/\\[(-?\\d+|\".*\"|'.*')]/);\n\t  }\n\t\n\t  function matchNestedExpression(exp) {\n\t    var _ref5 = matchIntStrIndex(exp) || [],\n\t        _ref6 = _slicedToArray(_ref5, 1),\n\t        toReplace = _ref6[0];\n\t\n\t    var replaced = [];\n\t\n\t    while (toReplace) {\n\t      replaced.push(toReplace);\n\t      exp = exp.replace(toReplace, \"ff_r\" + (replaced.length - 1) + \"_ff\");\n\t\n\t      var _ref7 = matchIntStrIndex(exp) || [];\n\t\n\t      var _ref8 = _slicedToArray(_ref7, 1);\n\t\n\t      toReplace = _ref8[0];\n\t    }\n\t\n\t    var match = exp.match(/\\[([^[\\]]+)]([^[\\]]*)/);\n\t\n\t    return match && replaced.length ? match.map(function (exp) {\n\t      var _ref9 = exp.match(/ff_r(\\d+)_ff/) || [],\n\t          _ref10 = _slicedToArray(_ref9, 2),\n\t          toReplace = _ref10[0],\n\t          index = _ref10[1];\n\t\n\t      while (toReplace) {\n\t        exp = exp.replace(toReplace, replaced[index]);\n\t\n\t        var _ref11 = exp.match(/ff_r(\\d+)_ff/) || [];\n\t\n\t        var _ref12 = _slicedToArray(_ref11, 2);\n\t\n\t        toReplace = _ref12[0];\n\t        index = _ref12[1];\n\t      }\n\t      return exp;\n\t    }) : match;\n\t  }\n\t\n\t  function resolveNestedExpressions(exp, depth) {\n\t    var service = this;\n\t\n\t    var _ref13 = matchNestedExpression(exp) || [],\n\t        _ref14 = _slicedToArray(_ref13, 2),\n\t        nested = _ref14[1];\n\t\n\t    while (nested) {\n\t      var parsed = service.parseExpression(nested, depth).get();\n\t      var keyVal = _.isUndefined(parsed) ? \"\" : _.isString(parsed) ? \"\\\"\" + parsed + \"\\\"\" : parsed;\n\t      exp = exp.replace(\"[\" + nested + \"]\", \"[\" + keyVal + \"]\");\n\t\n\t      var _ref15 = matchNestedExpression(exp) || [];\n\t\n\t      var _ref16 = _slicedToArray(_ref15, 2);\n\t\n\t      nested = _ref16[1];\n\t    }\n\t\n\t    return exp;\n\t  }\n\t\n\t  function parseExpression(exp, depth) {\n\t    var service = this;\n\t\n\t    if (!_.isString(exp) && !_.isArray(exp)) {\n\t      return { get: function get() {\n\t          return exp;\n\t        } };\n\t    }\n\t\n\t    // if expression is specific value\n\t    if (/^(null|false|true|undefined|'[^\\']*'|\"[^\\\"]*\"|-?[0-9.]+|\\[]|\\{})$/.test(exp)) {\n\t      return {\n\t        get: function get() {\n\t          if (!exp) return exp;\n\t          var isStr = exp.match(/\"([^\\\"]*)\"/) || exp.match(/'([^\\']*)'/);\n\t          if (isStr) return isStr[1];\n\t          switch (exp) {\n\t            case \"null\":\n\t              return null;\n\t            case \"false\":\n\t              return false;\n\t            case \"true\":\n\t              return true;\n\t            case \"undefined\":\n\t              return;\n\t            case \"[]\":\n\t              return [];\n\t            case \"{}\":\n\t              return {};\n\t            default:\n\t              return parseFloat(exp);\n\t          }\n\t        }\n\t      };\n\t    }\n\t\n\t    exp = service.getKey(exp);\n\t\n\t    var match = exp.match(/^(model\\.)?(\\S+)$/);\n\t\n\t    var modelValue = {\n\t      get: function get() {\n\t        var resolved = service.resolveNestedExpressions(exp, depth);\n\t        var path = ObjectPath.parse(resolved);\n\t        var start = depth || service;\n\t\n\t        while (start && path.length > 1) {\n\t          start = start[path.shift()];\n\t        }\n\t\n\t        return start && start[path[0]];\n\t      },\n\t      getAssignable: function getAssignable() {\n\t        var _ref17 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n\t            noConstruction = _ref17.noConstruction;\n\t\n\t        var resolved = service.resolveNestedExpressions(exp, depth);\n\t        var path = ObjectPath.parse(resolved);\n\t        var progress = [];\n\t        var start = depth || service;\n\t\n\t        while (start && path.length > 1) {\n\t          var key = path.shift();\n\t          progress.push(key);\n\t          if (!start[key]) {\n\t            if (noConstruction) {\n\t              return null;\n\t            }\n\t            if (/^\\d?$/.test(path[0])) {\n\t              start[key] = [];\n\t            } else {\n\t              start[key] = {};\n\t            }\n\t          }\n\t          start = start[key];\n\t        }\n\t\n\t        return {\n\t          obj: start,\n\t          key: path[0],\n\t          path: service.getKey(progress),\n\t          fullPath: service.getKey(progress.concat(path.slice(0, 1)))\n\t        };\n\t      },\n\t      set: function set(val) {\n\t        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\n\t        var resolved = service.resolveNestedExpressions(exp, depth);\n\t        var path = ObjectPath.parse(resolved);\n\t        if (val === \"remove\") {\n\t          var _ref18 = this.getAssignable({ noConstruction: true }) || {},\n\t              obj = _ref18.obj,\n\t              key = _ref18.key;\n\t\n\t          delete service.defaults[resolved.replace(\"model.\", \"\")];\n\t          if (obj) {\n\t            delete obj[key];\n\t          }\n\t        } else {\n\t          var _getAssignable = this.getAssignable(),\n\t              _obj = _getAssignable.obj,\n\t              _key3 = _getAssignable.key;\n\t\n\t          _obj[_key3] = val;\n\t        }\n\t        if (options.silent) {\n\t          service.silenceListeners(resolved, depth);\n\t          service.skipDefaults(resolved);\n\t        }\n\t        return val;\n\t      },\n\t      path: function path() {\n\t        return {\n\t          exp: exp,\n\t          depth: depth,\n\t          key: match[2]\n\t        };\n\t      }\n\t    };\n\t\n\t    return modelValue;\n\t  }\n\t\n\t  function silenceListeners(keyStart, depth) {\n\t    var service = this;\n\t    _.each(service.listeners, function (listener, key) {\n\t      if (key.indexOf(keyStart) === 0) {\n\t        listener.prev = angular.copy(service.parseExpression(key, depth).get());\n\t      }\n\t    });\n\t  }\n\t\n\t  function skipDefaults(keyStart) {\n\t    var service = this;\n\t    var index = keyStart.match(/\\[\\d*\\]/) ? getArrayIndex(keyStart) : null;\n\t    var ks = stripIndexes(keyStart);\n\t    var keys = _.filter(_.keys(service.formCache), function (k) {\n\t      return k.startsWith(ks);\n\t    });\n\t    var skipKeys = [];\n\t    _.each(keys, function (key) {\n\t      var indexedKey = service.setArrayIndex(key, index);\n\t      var model = service.parseExpression(indexedKey, service.model).get();\n\t      if (_.isArray(model)) {\n\t        var childKeys = _.filter(_.keys(service.formCache), function (k) {\n\t          return k.startsWith(key);\n\t        });\n\t\n\t        var _loop = function _loop(i) {\n\t          _.each(childKeys, function (k) {\n\t            skipKeys.push(k);\n\t            var indexedChildKey = service.setArrayIndex(k, [index, i]);\n\t            service.skipDefault[indexedChildKey] = true;\n\t          });\n\t        };\n\t\n\t        for (var i = 0; i < model.length; i++) {\n\t          _loop(i);\n\t        }\n\t      } else if (!skipKeys.includes(key)) {\n\t        service.skipDefault[indexedKey] = true;\n\t      }\n\t    });\n\t  }\n\t\n\t  function processArray(array) {\n\t    var service = this;\n\t    var key = service.getKey(array.key);\n\t\n\t    array.sortOptions = {\n\t      update: function update(e, ui) {\n\t        var listener = service.arrayListeners[key + \".length\"];\n\t        listener.handlers.forEach(function (handler) {\n\t          handler(listener.prev, listener.prev, true);\n\t        });\n\t      }\n\t    };\n\t\n\t    service.processSection(array);\n\t  }\n\t\n\t  function processSection(section, secondPass) {\n\t    var service = this;\n\t    // if we're here because a parent's scope was emitted,\n\t    // scope for this section will soon be emitted, so can skip\n\t    if (secondPass) return;\n\t    _.each(section.items, service.processField.bind(service));\n\t  }\n\t\n\t  function processComponent(component) {\n\t    var service = this;\n\t\n\t    component.type = \"section\";\n\t    component.htmlClass = \"row\";\n\t\n\t    var cols = 12 / _.reject(component.items, \"hidden\").length;\n\t\n\t    _.each(component.items, function (field, i) {\n\t      service.processField(field);\n\t      component.items[i] = {\n\t        type: \"section\",\n\t        htmlClass: \"col-sm-\" + cols,\n\t        items: [field]\n\t      };\n\t    });\n\t  }\n\t\n\t  function processCurrency(field) {\n\t    field.currencyFormat = {\n\t      \"currency-dollars\": \"dollars\",\n\t      \"currency-microcents\": \"microcents\",\n\t      currency: \"cents\"\n\t    }[field.schema.format];\n\t\n\t    field.type = \"cn-currency\";\n\t  }\n\t\n\t  function processNumber(field) {\n\t    field.type = \"cn-number\";\n\t  }\n\t\n\t  function processPercentage(field) {\n\t    field.type = \"cn-percentage\";\n\t  }\n\t\n\t  function processUrl(field) {\n\t    field.type = \"cn-url\";\n\t  }\n\t\n\t  function processReusable(field) {\n\t    var service = this;\n\t    field.type = \"cn-reusable\";\n\t    field.view = field.view || \"new\";\n\t    field.items.forEach(service.processField.bind(service));\n\t    field.items = [{\n\t      type: \"section\",\n\t      items: field.items,\n\t      condition: \"!model.\" + service.getKey(field.key) + \".id\"\n\t    }];\n\t  }\n\t\n\t  function processFacebookVideo(field) {\n\t    var service = this;\n\t    field.type = \"cn-facebookvideo\";\n\t    if (!field.resolve) {\n\t      field.resolve = {};\n\t      _.each(field.data, function (exp, prop) {\n\t        return field.resolve[\"data.\" + prop] = exp;\n\t      });\n\t    }\n\t    service.processResolve(field);\n\t  }\n\t\n\t  function processCreativeImage(field) {\n\t    var service = this;\n\t    field.type = \"cn-creativeimage\";\n\t    if (!field.resolve) {\n\t      field.resolve = {};\n\t      _.each(field.data, function (exp, prop) {\n\t        return field.resolve[\"data.\" + prop] = exp;\n\t      });\n\t    }\n\t    service.processResolve(field);\n\t  }\n\t\n\t  function processMediaUpload(field) {\n\t    var service = this;\n\t    field.type = \"cn-mediaupload\";\n\t    if (!field.resolve) {\n\t      field.resolve = {};\n\t      _.each(field.data, function (exp, prop) {\n\t        return field.resolve[\"data.\" + prop] = exp;\n\t      });\n\t    }\n\t    service.processResolve(field);\n\t  }\n\t\n\t  function processCsvUpload(field) {\n\t    var service = this;\n\t    field.type = \"cn-csvupload\";\n\t  }\n\t\n\t  function processRadios(field) {\n\t    field.type = \"cn-radios\";\n\t  }\n\t\n\t  function processRadiobuttons(radios) {\n\t    var service = this;\n\t    radios.type = \"cn-radiobuttons\";\n\t    if (radios.fullWidth) {\n\t      radios.btnClass = \"col-sm-\" + _.divide(12, radios.titleMap.length);\n\t    }\n\t  }\n\t\n\t  function processDate(date) {\n\t    var service = this;\n\t    date.type = \"cn-datetimepicker\";\n\t\n\t    if (date.schema.format === \"time-minutes\") {\n\t      date.maxView = \"hour\";\n\t      date.iconClass = \"fa fa-clock-o\";\n\t\n\t      date.modelFormatter = function (val) {\n\t        if (!val) return;\n\t\n\t        var m = moment(val);\n\t\n\t        return _.add(_.multiply(m.hours(), 60), m.minutes());\n\t      };\n\t\n\t      date.modelParser = function (val) {\n\t        if (!val) return;\n\t\n\t        var d = parseInt(val);\n\t        var hours = _.floor(d / 60);\n\t        var minutes = d % 60;\n\t\n\t        return moment().startOf(\"day\").add(\"hours\", hours).add(\"minutes\", minutes);\n\t      };\n\t\n\t      date.viewFormatter = function (val) {\n\t        if (!val) return;\n\t\n\t        return date.modelParser(val).format(date.dateFormat);\n\t      };\n\t\n\t      date.viewParser = function (val) {\n\t        if (!val) return;\n\t\n\t        var match = val.match(/^(\\d{1,2}):?(\\d{1,2})? (a|p)/);\n\t        if (!match) return;\n\t\n\t        var hours = _.add(match[1] === \"12\" ? 0 : match[1], match[3] === \"a\" ? 0 : 12);\n\t        var minutes = match[2] || \"00\";\n\t\n\t        if (minutes.length === 1) minutes += \"0\";\n\t\n\t        return _.add(_.multiply(hours, 60), minutes);\n\t      };\n\t    }\n\t  }\n\t\n\t  function getSelectValProp(select) {\n\t    var isArray = select.getSchemaType() === \"array\";\n\t    return select.valueProperty || (isArray ? select.schema.items.type : select.schema.type) !== \"object\" && \"value\";\n\t  }\n\t\n\t  function getAllowedSelectValue(select, val, titleMap) {\n\t    titleMap = titleMap || select.getTitleMap();\n\t    var valProp = getSelectValProp(select);\n\t    var omitHashKey = valProp ? _.identity : _.partialRight(_.omit, \"$$hashKey\");\n\t    var findFn = valProp ? _.compose(_.partial(_.find, titleMap), _.partial(_.set, {}, valProp), omitHashKey) : _.compose(_.partial(_.find, titleMap), omitHashKey);\n\t    if (select.getSchemaType() === \"array\") {\n\t      if (!val || !_.isArray(val)) return;\n\t      return val.map(findFn).filter(function (x) {\n\t        return x !== undefined;\n\t      });\n\t    } else {\n\t      return findFn(val);\n\t    }\n\t  }\n\t\n\t  function processSchedule(field) {\n\t    field.startEmpty = true;\n\t    field.type = \"cn-schedule\";\n\t  }\n\t\n\t  function processSelect(select) {\n\t    var service = this;\n\t    var schema = select.schema;\n\t\n\t    if (select.titleMapResolve || select.titleMap) {\n\t      select.getTitleMap = function () {\n\t        return select.titleMap || service.schema.data[select.titleMapResolve];\n\t      };\n\t\n\t      select.onInit = function (val, form, event, setter) {\n\t        // make sure we use correct value\n\t        var modelValue = service.parseExpression(form.key, service.model);\n\t        if (event === \"tag-init\") {\n\t          var newVal = getAllowedSelectValue(select, modelValue.get());\n\t          if (newVal !== undefined) setter(newVal);\n\t        }\n\t      };\n\t    }\n\t\n\t    if (select.titleMapQuery) {\n\t      var queryParams = select.titleMapQuery.params;\n\t      var paramsKeys = _.keys(queryParams);\n\t      select.showClearAll = true;\n\t      select.showClearCache = !!select.titleMapQuery.params.refreshData;\n\t      select.singleQuery = select.minLookup === 0;\n\t      select.titleQuery = function (q, _ref19) {\n\t        var refreshData = _ref19.refreshData;\n\t\n\t        var params = _(paramsKeys).reduce(function (acc, key) {\n\t          if (key === \"q\") {\n\t            acc[queryParams[key]] = q;\n\t          } else if (key === \"refreshData\") {\n\t            if (refreshData) acc[queryParams[key]] = true;\n\t          } else {\n\t            var exp = service.replaceArrayIndex(queryParams[key], select.arrayIndex);\n\t            var val = null,\n\t                variables = exp.split(\"||\");\n\t            var _iteratorNormalCompletion = true;\n\t            var _didIteratorError = false;\n\t            var _iteratorError = undefined;\n\t\n\t            try {\n\t              for (var _iterator = variables[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t                var _exp = _step.value;\n\t\n\t                val = service.parseExpression(_exp.trim()).get();\n\t                if (val) {\n\t                  break;\n\t                }\n\t              }\n\t            } catch (err) {\n\t              _didIteratorError = true;\n\t              _iteratorError = err;\n\t            } finally {\n\t              try {\n\t                if (!_iteratorNormalCompletion && _iterator.return) {\n\t                  _iterator.return();\n\t                }\n\t              } finally {\n\t                if (_didIteratorError) {\n\t                  throw _iteratorError;\n\t                }\n\t              }\n\t            }\n\t\n\t            acc[key] = val;\n\t          }\n\t          return acc;\n\t        }, {});\n\t        return Api.get({\n\t          url: select.titleMapQuery.url,\n\t          params: params\n\t        });\n\t      };\n\t\n\t      if (!_.isNumber(select.minLookup)) select.minLookup = paramsKeys.length ? 3 : 0;\n\t      if (!_.has(select, \"skipFiltering\")) select.skipFiltering = !!select.minLookup;\n\t\n\t      select.onInit = function (val, form, event, setter) {\n\t        if (event === \"tag-init\") {\n\t          setter(val);\n\t        }\n\t      };\n\t    }\n\t\n\t    if (!_.isNumber(select.minLookup)) select.minLookup = 0;\n\t\n\t    if (schema.items) {\n\t      var defaults = [];\n\t      _.each(schema.items.properties, function (schema, key) {\n\t        if (angular.isDefined(schema.default)) {\n\t          defaults.push({\n\t            key: key,\n\t            default: schema.default\n\t          });\n\t        }\n\t      });\n\t      if (defaults.length) {\n\t        select.onAdd = function (val, form, event) {\n\t          if (val.value && event === \"tag-added\") {\n\t            _.each(defaults, function (prop) {\n\t              if (!val.value[prop.key]) val.value[prop.key] = prop.default;\n\t            });\n\t          }\n\t        };\n\t      }\n\t    }\n\t\n\t    if (select.displayFormat) {\n\t      select.itemFormatter = service.processTemplate(select.displayFormat);\n\t    }\n\t\n\t    if (!select.type.includes(\"cn-autocomplete\")) {\n\t      if (select.items) {\n\t        select.detailedList = true;\n\t\n\t        if (select.items[0].type !== \"component\") {\n\t          if (select.items.length > 1) {\n\t            _.each(select.items, function (i) {\n\t              return i.destroyStrategy = \"retain\";\n\t            });\n\t            select.items = [{\n\t              type: \"component\",\n\t              items: select.items\n\t            }];\n\t          }\n\t\n\t          service.processFieldset(select);\n\t        }\n\t\n\t        select.type = \"cn-autocomplete-detailed\";\n\t        select.destroyStrategy = \"retain\";\n\t      } else {\n\t        if (!select.selectionStyle) {\n\t          select.selectionStyle = select.key === \"tags\" ? \"tags\" : select.getSchemaType() === \"array\" && select.schema.maxItems !== 1 ? \"list\" : \"select\";\n\t        }\n\t        select.type = \"cn-autocomplete\";\n\t      }\n\t\n\t      if (select.titleMapResolve) {\n\t        service.scope.$on(\"cnFlexFormDiff:data\", function (e, data) {\n\t          if (data[select.titleMapResolve]) {\n\t            var modelValue = service.parseExpression(select.key, service.model);\n\t            var val = modelValue.get();\n\t            if (val !== undefined) {\n\t              var valid = getAllowedSelectValue(select, val, data[select.titleMapResolve]);\n\t              if (valid === undefined || _.isArray(valid) && _.isEmpty(valid)) modelValue.set();\n\t            }\n\t          }\n\t        });\n\t      }\n\t\n\t      service.registerHandler(select.key, function (val) {\n\t        var form = service.formCtrl && service.formCtrl[service.getKey(select.key)];\n\t        if (form && form.$setDirty) form.$setDirty();\n\t      }, select.updateSchema);\n\t    }\n\t  }\n\t\n\t  function processToggle(toggle) {\n\t    toggle.type = \"cn-toggle\";\n\t  }\n\t\n\t  function processHelp(help) {\n\t    help.htmlClass = \"help-block\";\n\t  }\n\t\n\t  function processDisplay(display) {\n\t    var service = this;\n\t    display.type = \"cn-display\";\n\t    display.getDisplay = service.processTemplate(display.displayFormat, true);\n\t  }\n\t\n\t  function processTemplate(tpl, parseScope) {\n\t    var service = this;\n\t    //var processor = /<(\\S+)[^>]*>.*<\\/\\1>/.test(tpl) ? $compile : $interpolate;\n\t    var processor = $interpolate;\n\t    return function (scope, arrayIndex) {\n\t      if (parseScope) {\n\t        if (angular.isDefined(arrayIndex)) {\n\t          scope = _.map(scope, function (key) {\n\t            return key === \"arrayIndex\" ? arrayIndex : key;\n\t          });\n\t        }\n\t        scope = service.parseExpression(scope, service.model).get();\n\t      }\n\t      return processor(tpl)(scope);\n\t    };\n\t  }\n\t\n\t  function processTable(table) {\n\t    var service = this;\n\t    table.type = \"cn-table\";\n\t    table.items.forEach(function (row) {\n\t      for (var i = 0; i < table.columns.length; i++) {\n\t        _.extend(row.items[i], table.columns[i]);\n\t        service.processField(row.items[i]);\n\t      }\n\t    });\n\t  }\n\t\n\t  function processSelectDisplay(selectDisplay) {\n\t    var service = this;\n\t    // Needed for batchform to check recursively\n\t    var selectField = null;\n\t    var _iteratorNormalCompletion2 = true;\n\t    var _didIteratorError2 = false;\n\t    var _iteratorError2 = undefined;\n\t\n\t    try {\n\t      for (var _iterator2 = selectDisplay.items[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t        var item = _step2.value;\n\t\n\t        if (item.selectField) {\n\t          selectField = item;\n\t        } else if (item.items) {\n\t          selectField = _.find(item.items, \"selectField\");\n\t        }\n\t        if (selectField) {\n\t          break;\n\t        }\n\t      }\n\t\n\t      // band-aid because this is being set as an object instead of array somwhere\n\t      // deep in the angular or angular-schema-form nether-regions\n\t    } catch (err) {\n\t      _didIteratorError2 = true;\n\t      _iteratorError2 = err;\n\t    } finally {\n\t      try {\n\t        if (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t          _iterator2.return();\n\t        }\n\t      } finally {\n\t        if (_didIteratorError2) {\n\t          throw _iteratorError2;\n\t        }\n\t      }\n\t    }\n\t\n\t    var linkModel = service.parseExpression(selectDisplay.link, service.model);\n\t    if (!linkModel.get()) linkModel.set([]);\n\t\n\t    _.each(selectDisplay.items, function (item) {\n\t      if (item.selectField === true) return;\n\t\n\t      var key = _.isArray(item.key) ? item.key : ObjectPath.parse(item.key);\n\t      var featureKey = _.last(key);\n\t\n\t      item.showFeature = function (index) {\n\t        var features = service.parseExpression(\"model.\" + selectDisplay.link + \"[\" + index + \"].features\").get();\n\t        var show = features && features.includes(featureKey);\n\t        return show;\n\t      };\n\t\n\t      var condition = \"form.showFeature(arrayIndex)\";\n\t      item.condition = item.condition ? \"(\" + item.condition + \") && \" + condition : condition;\n\t    });\n\t    // handle legacy objects that don't have values set in the selectField\n\t    var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n\t    var selectKey = service.getKey(selectField.key);\n\t    _.each(model, function (elem, i) {\n\t      var indexedSelectKey = service.setArrayIndex(selectKey, i);\n\t      var selectModel = service.parseExpression(indexedSelectKey, service.model);\n\t      if (!selectModel.get()) selectModel.set([]);\n\t    });\n\t  }\n\t\n\t  function setupSchemaRefresh(refresh) {\n\t    var service = this;\n\t    service.refreshSchema = _.debounce(function (updateSchema) {\n\t      var params = _extends({}, cnFlexFormConfig.getStateParams(service.getParamOverrides()), service.params);\n\t      var diff = _.omit(cnUtil.diff(service.schema.params, params, true), \"updates\");\n\t      var keys = void 0;\n\t\n\t      if (!_.isEmpty(diff) || updateSchema) {\n\t        if (updateSchema) params.updateSchema = updateSchema;else {\n\t          keys = _.keys(diff);\n\t\n\t          if (keys.length > 1) {\n\t            diff = _.omit(diff, _.isNull);\n\t            keys = _.keys(diff);\n\t          }\n\t\n\t          params.updateSchema = _.first(keys);\n\t        }\n\t\n\t        if (!params.updateSchema) {\n\t          diff = cnUtil.diff(params, _.omit(service.schema.params, [\"updateSchema\", \"updates\"]));\n\t          keys = _.keys(diff);\n\t\n\t          params.updateSchema = _.first(keys);\n\t        }\n\t\n\t        refresh(params).then(function (schema) {\n\t          service.processUpdatedSchema(schema);\n\t        });\n\t      }\n\t    }, 100);\n\t\n\t    service.refreshData = _.debounce(function () {\n\t      refresh(_.extend(service.schema.params, { updateSchema: \"refreshData\" })).then(function (schema) {\n\t        service.processUpdatedSchema(schema);\n\t      });\n\t    }, 100);\n\t\n\t    service.events.push(service.scope.$on(\"ffRefreshData\", service.refreshData));\n\t  }\n\t\n\t  function processUpdatedSchema(schema) {\n\t    var service = this;\n\t    if (schema.diff) {\n\t      service.incrementUpdates();\n\t      service.schema.params = schema.params;\n\t      if (cnFlexFormConfig.onProcessDiff) {\n\t        cnFlexFormConfig.onProcessDiff(schema);\n\t      }\n\t\n\t      if (Object.keys(schema.diff.data).length > 0) {\n\t        service.scope.$broadcast(\"cnFlexFormDiff:data\", schema.diff.data);\n\t        _.each(schema.diff.data, function (data, prop) {\n\t          if (data && data.data && !_.isEmpty(service.schema.data[prop].data) && !data.reset) {\n\t            data.data = service.schema.data[prop].data.concat(data.data);\n\t          }\n\t          service.schema.data[prop] = data;\n\t          if (service.resolveRegister[prop]) {\n\t            _.each(service.resolveRegister[prop], function (registers) {\n\t              registers.forEach(function (register) {\n\t                service.handleResolve(register.field, register.prop, register.exp);\n\t              });\n\t            });\n\t          }\n\t        });\n\t      }\n\t\n\t      var keys = [];\n\t\n\t      if (Object.keys(schema.diff.schema).length > 0) {\n\t        service.scope.$broadcast(\"cnFlexFormDiff:schema\", schema.diff.schema);\n\t        _.each(schema.diff.schema, function (schema, key) {\n\t          reprocessSchema(schema, key, keys);\n\t          var curKeys = _.filter(keys, function (k) {\n\t            return _.startsWith(k, key);\n\t          });\n\t          _.each(curKeys, function (key) {\n\t            var forms = _.compact([service.getFromFormCache(key)].concat(_toConsumableArray(service.getArrayCopies(key) || [])));\n\t            _.each(forms, function (form) {\n\t              var prevSchema = form.schema;\n\t              var newSchema = service.getSchema(key, _defineProperty({}, schema.key, schema));\n\t              if (prevSchema.readonly && !newSchema.readonly) form.readonly = false;\n\t            });\n\t          });\n\t          service.schema.schema.properties[key] = schema;\n\t        });\n\t      }\n\t\n\t      if (Object.keys(schema.diff.form) > 0) {\n\t        service.scope.$broadcast(\"cnFlexFormDiff:form\", schema.diff.form);\n\t        _.each(schema.diff.form, function (form, key) {\n\t          if (!keys.includes(key)) {\n\t            keys.push(key);\n\t          }\n\t\n\t          // don't want to override key when extending cached objects\n\t          //var key = form.key;\n\t          //delete form.key;\n\t\n\t          _.each(service.getFormsToProcess(key), function (copy) {\n\t            copy && service.reprocessField(copy, form);\n\t          });\n\t        });\n\t\n\t        var el = document.getElementsByClassName(\"cn-form\")[0];\n\t        var oldScroll = el ? el.scrollTop : 0;\n\t\n\t        service.scope.$broadcast(\"schemaFormRedraw\");\n\t\n\t        setTimeout(function () {\n\t          if (el) {\n\t            el.scrollTop = oldScroll;\n\t          }\n\t        }, 1000);\n\t      }\n\t\n\t      if (keys.length) {\n\t        _.each(keys, function (key) {\n\t          _.each(service.getFormsToProcess(key), function (copy) {\n\t            return copy && service.processField(copy);\n\t          });\n\t        });\n\t      }\n\t\n\t      service.broadcastErrors();\n\t    } else {\n\t      service.resetUpdates();\n\t      service.updateSchema(schema);\n\t    }\n\t  }\n\t\n\t  function getFormsToProcess(key) {\n\t    var service = this;\n\t\n\t    var _ref20 = key.match(/\\[(\\d)+]/) || [],\n\t        _ref21 = _slicedToArray(_ref20, 2),\n\t        arrayIndex = _ref21[1];\n\t\n\t    var copies = service.getArrayCopies(key.replace(/\\[\\d+]/g, \"[]\"));\n\t    if (_.isUndefined(arrayIndex)) {\n\t      var cached = service.getFromFormCache(key);\n\t      return [cached].concat(_toConsumableArray(copies));\n\t    }\n\t    return [copies[arrayIndex]];\n\t  }\n\t\n\t  function reprocessField(current, update, isChild) {\n\t    var service = this;\n\t    var key = service.getKey(current.key);\n\t\n\t    // other logic in the service will add conition = 'true' to force\n\t    // condition to eval true, so we set the update condition to 'true'\n\t    // before comparing\n\t    if (!update.condition && current.condition) update.condition = \"true\";\n\t    var redraw = !isChild && current.condition !== update.condition;\n\t\n\t    _.extend(current, _.omit(update, \"items\", \"key\"));\n\t\n\t    current._ogKeys.forEach(function (prop) {\n\t      if (!update[prop]) {\n\t        delete current[prop];\n\t      }\n\t    });\n\t    current._ogKeys = getOgKeys(update);\n\t\n\t    //service.deregisterHandlers(key);\n\t\n\t    service.scope.$broadcast(\"cnFlexFormReprocessField\", key);\n\t\n\t    // why do we redraw? If we're doing it to show error message\n\t    // that has been addressed from the angular-schema-form library\n\t    // if there's another issue, try triggering the specific action required\n\t    // instead of redrawing the whole form\n\t    if (redraw && current.redraw) {\n\t      console.log(\"TODO: see if this can be removed\");\n\t      current.redraw();\n\t    }\n\t  }\n\t\n\t  function reprocessSchema(schema, key, keys) {\n\t    keys.push(key);\n\t    if (schema.properties) {\n\t      _.each(schema.properties, function (schema, subKey) {\n\t        reprocessSchema(schema, key + \".\" + subKey, keys);\n\t      });\n\t    }\n\t    if (schema.items && schema.items.properties) {\n\t      _.each(schema.properties, function (schema, subKey) {\n\t        reprocessSchema(schema, key + \"[].\" + subKey, keys);\n\t      });\n\t    }\n\t  }\n\t\n\t  function getDotKey(key) {\n\t    return (_.isString(key) ? ObjectPath.parse(key) : key).join(\".\");\n\t  }\n\t\n\t  function buildError(field) {\n\t    return {\n\t      key: getDotKey(field.key),\n\t      message: field.error\n\t    };\n\t  }\n\t\n\t  function broadcastErrors() {\n\t    var service = this;\n\t    $timeout(function () {\n\t      if (_.get(service, \"errors\")) {\n\t        service.errors.forEach(function (error) {\n\t          service.scope.$broadcast(\"schemaForm.error.\" + error.key, \"serverValidation\", error.message);\n\t        });\n\t      }\n\t    }, 1);\n\t  }\n\t\n\t  function replaceArrayIndex(resolve, key) {\n\t    while (resolve.includes(\"arrayIndex\")) {\n\t      if (_.isNumber(key)) return resolve.replace(/arrayIndex/g, key);\n\t      var arrayIndexKey = /([^.[]*)\\[arrayIndex\\]/.exec(resolve);\n\t      var re = new RegExp(arrayIndexKey[1] + \"\\\\[(-?\\\\d+)\\\\]\");\n\t      var index = re.exec(key);\n\t      if (!index) return resolve;\n\t      resolve = resolve.replace(new RegExp(arrayIndexKey[0].replace(/(\\[|\\])/g, \"\\\\$1\"), \"g\"), index[0]);\n\t    }\n\t    return resolve;\n\t  }\n\t\n\t  function getArrayIndex(key) {\n\t    if (_.isObject(key)) {\n\t      return _.find(key.key, function (key) {\n\t        return _.isNumber(key);\n\t      });\n\t    }\n\t    return (/\\[(\\d*)\\]/.exec(key)[1]\n\t    );\n\t  }\n\t\n\t  function setArrayIndex(key, index, asArray) {\n\t    var service = this;\n\t    var keyCopy = void 0;\n\t    if (!_.isArray(index)) {\n\t      index = [index];\n\t    }\n\t    if (_.isString(key)) {\n\t      keyCopy = ObjectPath.parse(key);\n\t    } else {\n\t      keyCopy = _.clone(key);\n\t    }\n\t    while (index.length && keyCopy.indexOf(\"\") > -1) {\n\t      var indexOfIndex = keyCopy.indexOf(\"\");\n\t      keyCopy[indexOfIndex] = index.shift();\n\t    }\n\t    if (asArray) {\n\t      return keyCopy;\n\t    } else {\n\t      return service.getKey(keyCopy);\n\t    }\n\t  }\n\t\n\t  function cleanup() {\n\t    var service = this;\n\t    _.each(service.events, function (listener) {\n\t      listener();\n\t    });\n\t  }\n\t\n\t  function resetUpdates() {\n\t    var service = this;\n\t    service.updates = 0;\n\t    service.params.updates = service.updates;\n\t  }\n\t\n\t  function incrementUpdates() {\n\t    var service = this;\n\t    ++service.updates;\n\t    service.params.updates = service.updates;\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormService', cnFlexFormServiceProvider);\n\t\n\texports.default = cnFlexFormServiceProvider;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tcnFlexFormModalLoaderService.$inject = [\"$stateParams\", \"$q\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar modalMap = {};\n\tvar promiseMap = {};\n\t\n\tfunction getPromises(state) {\n\t  if (promiseMap[state]) return promiseMap[state];\n\t\n\t  var promise = {};\n\t  promiseMap[state] = promise;\n\t  return promise;\n\t}\n\t\n\tfunction getPromise(state, id, $q) {\n\t  var promises = getPromises(state);\n\t  if (promises[id]) return promises[id];\n\t\n\t  var promise = $q.defer();\n\t  promises[id] = promise;\n\t  return promise;\n\t}\n\t\n\tfunction cnFlexFormModalLoaderServiceProvider() {\n\t\n\t  parent.$inject = [\"$stateParams\", \"$q\"];\n\t  return {\n\t    addMapping: addMapping,\n\t    $get: cnFlexFormModalLoaderService\n\t  };\n\t\n\t  ////////////\n\t\n\t  function addMapping(state, def) {\n\t    def.resolve = { parent: parent };\n\t    modalMap[state] = def;\n\t  }\n\t\n\t  function parent($stateParams, $q) {\n\t    'ngInject';\n\t\n\t    return getPromise($stateParams.modal, $stateParams.modalId, $q).promise.then(function (_ref) {\n\t      var parent = _ref.parent;\n\t      return parent;\n\t    });\n\t  }\n\t}\n\t\n\tfunction cnFlexFormModalLoaderService($stateParams, $q) {\n\t  'ngInject';\n\t\n\t  return {\n\t    getMapping: getMapping,\n\t    resolveMapping: resolveMapping,\n\t    removeMapping: removeMapping\n\t  };\n\t\n\t  /////////////\n\t\n\t  function resolveMapping(state, id, parent) {\n\t    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\t    var scope = options.scope;\n\t\n\t    if (scope) {\n\t      scope.options = scope.options || {};\n\t      scope.options.destroyStrategy = 'retain';\n\t      modalMap[state].scope = scope;\n\t    }\n\t    var d = getPromise(state, id, $q);\n\t    d.resolve({ parent: parent, options: options });\n\t    return d.promise;\n\t  }\n\t\n\t  function getMapping(state) {\n\t    var d = $q.defer();\n\t    getPromise($stateParams.modal, $stateParams.modalId, $q).promise.then(function (_ref2) {\n\t      var parent = _ref2.parent,\n\t          options = _ref2.options;\n\t\n\t      d.resolve({ state: modalMap[state], options: options });\n\t      return parent;\n\t    });\n\t    return d.promise;\n\t  }\n\t\n\t  // Holding on to scope references creates memory leaks\n\t  function removeMapping(state) {\n\t    modalMap[state] = null;\n\t    promiseMap[state] = null;\n\t  }\n\t}\n\t\n\texports.default = cnFlexFormModalLoaderServiceProvider;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tFlexFormModalLoader.$inject = [\"FlexFormModal\", \"$state\", \"$rootScope\", \"$stateParams\", \"$scope\"];\n\tFlexFormModal.$inject = [\"cnFlexFormModalLoaderService\", \"$uibModal\", \"$stateParams\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction FlexFormModalLoader(FlexFormModal, $state, $rootScope, $stateParams, $scope) {\n\t  'ngInject';\n\t\n\t  function FFModalLoaderTag() {}\n\t  $scope.__tag = FFModalLoaderTag();\n\t\n\t  var vm = this;\n\t\n\t  activate();\n\t\n\t  //////////\n\t\n\t  function activate() {\n\t    FlexFormModal.open(vm).then(function (_ref) {\n\t      var modal = _ref.modal,\n\t          _ref$options = _ref.options,\n\t          onDismiss = _ref$options.onDismiss,\n\t          onAfterDismiss = _ref$options.onAfterDismiss;\n\t\n\t      vm.modal = modal;\n\t      vm.modal.result.finally(goBack);\n\t\n\t      if (onDismiss) vm.modal.result.catch(function () {\n\t        return onDismiss($stateParams.restParams);\n\t      });\n\t      vm.dismissEvent = $rootScope.$on('$stateChangeStart', dismissModal);\n\t    });\n\t  }\n\t\n\t  function goBack() {\n\t    if (!$state.transition) {\n\t      $state.go('^');\n\t    }\n\t  }\n\t\n\t  function dismissModal() {\n\t    // unbind event\n\t    vm.dismissEvent();\n\t    vm.modal.opened.then(function () {\n\t      return vm.modal.dismiss();\n\t    });\n\t  }\n\t}\n\t\n\tfunction FlexFormModal(cnFlexFormModalLoaderService, $uibModal, $stateParams) {\n\t  'ngInject';\n\t\n\t  return { open: open };\n\t\n\t  ////////////\n\t\n\t  function open() {\n\t    return cnFlexFormModalLoaderService.getMapping($stateParams.modal).then(function (_ref2) {\n\t      var state = _ref2.state,\n\t          options = _ref2.options;\n\t      return {\n\t        modal: $uibModal.open(state),\n\t        options: options\n\t      };\n\t    });\n\t  }\n\t}\n\t\n\texports.FlexFormModalLoader = FlexFormModalLoader;\n\texports.FlexFormModal = FlexFormModal;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(process) {'use strict';\n\t\n\tFlexForm.$inject = [\"cnFlexFormService\", \"$scope\", \"$location\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexForm() {\n\t  return {\n\t    restrict: 'E',\n\t    template: '\\n      <div ng-if=\"vm.showForm()\">\\n        <!-- we process defaults ourselves, hence setSchemaDefaults: false -->\\n        <ng-form\\n          class=\"clearfix\"\\n          name=\"{{vm.formName}}\"\\n          sf-options=\"{ setSchemaDefaults: false }\"\\n          sf-schema=\"vm.config.schema.schema\"\\n          sf-form=\"vm.form\"\\n          sf-model=\"vm.model\">\\n        </ng-form>\\n        <!-- debug panel to display model -->\\n        <section ng-if=\"vm.debug\">\\n          <json-explorer json-data=\"vm.model || \\'...model not loaded yet\\'\"/>\\n        </section>\\n      </div>\\n    ',\n\t    scope: {\n\t      config: '=ffConfig',\n\t      model: '=ffModel',\n\t      formIndex: '=ffFormIndex',\n\t      formName: '=ffFormName',\n\t      delayForm: '=ffDelayForm',\n\t      cleanupEvent: '=ffCleanupEvent'\n\t    },\n\t    controller: FlexForm,\n\t    controllerAs: 'vm',\n\t    bindToController: true\n\t  };\n\t}\n\t\n\tfunction FlexForm(cnFlexFormService, $scope, $location) {\n\t  'ngInject';\n\t\n\t  function cnFlexFormTag() {}\n\t  $scope.__tag = new cnFlexFormTag();\n\t\n\t  var vm = this;\n\t  vm.service = undefined;\n\t  vm.events = [];\n\t\n\t  vm.activate = activate;\n\t  vm.cleanup = cleanup;\n\t  vm.process = process;\n\t  vm.showForm = showForm;\n\t\n\t  vm.events.push($scope.$watch(function () {\n\t    return vm.config.schema;\n\t  }, vm.process));\n\t\n\t  vm.activate();\n\t\n\t  $scope.$on(vm.cleanupEvent || '$destroy', vm.cleanup);\n\t\n\t  //////////\n\t\n\t  function activate() {\n\t    if (angular.isNumber(vm.formIndex)) {\n\t      vm.form = vm.config.schema.forms[vm.formIndex].form;\n\t    } else {\n\t      vm.form = vm.config.schema.form;\n\t    }\n\t\n\t    // debug\n\t    if ($location.search().debug) {\n\t      vm.debug = true;\n\t    }\n\t  }\n\t\n\t  function process(cur, prev) {\n\t    if (vm.form) {\n\t      if (!vm.service) {\n\t        vm.service = cnFlexFormService(vm.config.schema, vm.model, {\n\t          getScope: vm.config.getScope || function () {\n\t            return $scope;\n\t          },\n\t          formCtrl: vm.config.formCtrl,\n\t          getSchema: vm.config.getSchema,\n\t          updateSchema: updateSchema\n\t        });\n\t      } else {\n\t        vm.service.compile(vm.config.schema, vm.model, vm.config);\n\t      }\n\t    }\n\t  }\n\t\n\t  function showForm() {\n\t    return !vm.delayForm && vm.service && vm.service.isCompiled();\n\t  }\n\t\n\t  function updateSchema(schema) {\n\t    vm.config.schema = schema;\n\t    vm.activate();\n\t  }\n\t\n\t  function cleanup() {\n\t    _.each(vm.events, function (listener) {\n\t      listener();\n\t    });\n\t\n\t    cnFlexFormService.destroyService(vm.service);\n\t  }\n\t}\n\t\n\texports.default = cnFlexForm;\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(11)))\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\t// shim for using process in browser\n\tvar process = module.exports = {};\n\t\n\t// cached from whatever global is present so that test runners that stub it\n\t// don't break things.  But we need to wrap it in a try catch in case it is\n\t// wrapped in strict mode code which doesn't define any globals.  It's inside a\n\t// function because try/catches deoptimize in certain engines.\n\t\n\tvar cachedSetTimeout;\n\tvar cachedClearTimeout;\n\t\n\tfunction defaultSetTimout() {\n\t    throw new Error('setTimeout has not been defined');\n\t}\n\tfunction defaultClearTimeout () {\n\t    throw new Error('clearTimeout has not been defined');\n\t}\n\t(function () {\n\t    try {\n\t        if (typeof setTimeout === 'function') {\n\t            cachedSetTimeout = setTimeout;\n\t        } else {\n\t            cachedSetTimeout = defaultSetTimout;\n\t        }\n\t    } catch (e) {\n\t        cachedSetTimeout = defaultSetTimout;\n\t    }\n\t    try {\n\t        if (typeof clearTimeout === 'function') {\n\t            cachedClearTimeout = clearTimeout;\n\t        } else {\n\t            cachedClearTimeout = defaultClearTimeout;\n\t        }\n\t    } catch (e) {\n\t        cachedClearTimeout = defaultClearTimeout;\n\t    }\n\t} ())\n\tfunction runTimeout(fun) {\n\t    if (cachedSetTimeout === setTimeout) {\n\t        //normal enviroments in sane situations\n\t        return setTimeout(fun, 0);\n\t    }\n\t    // if setTimeout wasn't available but was latter defined\n\t    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n\t        cachedSetTimeout = setTimeout;\n\t        return setTimeout(fun, 0);\n\t    }\n\t    try {\n\t        // when when somebody has screwed with setTimeout but no I.E. maddness\n\t        return cachedSetTimeout(fun, 0);\n\t    } catch(e){\n\t        try {\n\t            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n\t            return cachedSetTimeout.call(null, fun, 0);\n\t        } catch(e){\n\t            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n\t            return cachedSetTimeout.call(this, fun, 0);\n\t        }\n\t    }\n\t\n\t\n\t}\n\tfunction runClearTimeout(marker) {\n\t    if (cachedClearTimeout === clearTimeout) {\n\t        //normal enviroments in sane situations\n\t        return clearTimeout(marker);\n\t    }\n\t    // if clearTimeout wasn't available but was latter defined\n\t    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n\t        cachedClearTimeout = clearTimeout;\n\t        return clearTimeout(marker);\n\t    }\n\t    try {\n\t        // when when somebody has screwed with setTimeout but no I.E. maddness\n\t        return cachedClearTimeout(marker);\n\t    } catch (e){\n\t        try {\n\t            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n\t            return cachedClearTimeout.call(null, marker);\n\t        } catch (e){\n\t            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n\t            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n\t            return cachedClearTimeout.call(this, marker);\n\t        }\n\t    }\n\t\n\t\n\t\n\t}\n\tvar queue = [];\n\tvar draining = false;\n\tvar currentQueue;\n\tvar queueIndex = -1;\n\t\n\tfunction cleanUpNextTick() {\n\t    if (!draining || !currentQueue) {\n\t        return;\n\t    }\n\t    draining = false;\n\t    if (currentQueue.length) {\n\t        queue = currentQueue.concat(queue);\n\t    } else {\n\t        queueIndex = -1;\n\t    }\n\t    if (queue.length) {\n\t        drainQueue();\n\t    }\n\t}\n\t\n\tfunction drainQueue() {\n\t    if (draining) {\n\t        return;\n\t    }\n\t    var timeout = runTimeout(cleanUpNextTick);\n\t    draining = true;\n\t\n\t    var len = queue.length;\n\t    while(len) {\n\t        currentQueue = queue;\n\t        queue = [];\n\t        while (++queueIndex < len) {\n\t            if (currentQueue) {\n\t                currentQueue[queueIndex].run();\n\t            }\n\t        }\n\t        queueIndex = -1;\n\t        len = queue.length;\n\t    }\n\t    currentQueue = null;\n\t    draining = false;\n\t    runClearTimeout(timeout);\n\t}\n\t\n\tprocess.nextTick = function (fun) {\n\t    var args = new Array(arguments.length - 1);\n\t    if (arguments.length > 1) {\n\t        for (var i = 1; i < arguments.length; i++) {\n\t            args[i - 1] = arguments[i];\n\t        }\n\t    }\n\t    queue.push(new Item(fun, args));\n\t    if (queue.length === 1 && !draining) {\n\t        runTimeout(drainQueue);\n\t    }\n\t};\n\t\n\t// v8 likes predictible objects\n\tfunction Item(fun, array) {\n\t    this.fun = fun;\n\t    this.array = array;\n\t}\n\tItem.prototype.run = function () {\n\t    this.fun.apply(null, this.array);\n\t};\n\tprocess.title = 'browser';\n\tprocess.browser = true;\n\tprocess.env = {};\n\tprocess.argv = [];\n\tprocess.version = ''; // empty string to avoid regexp issues\n\tprocess.versions = {};\n\t\n\tfunction noop() {}\n\t\n\tprocess.on = noop;\n\tprocess.addListener = noop;\n\tprocess.once = noop;\n\tprocess.off = noop;\n\tprocess.removeListener = noop;\n\tprocess.removeAllListeners = noop;\n\tprocess.emit = noop;\n\t\n\tprocess.binding = function (name) {\n\t    throw new Error('process.binding is not supported');\n\t};\n\t\n\tprocess.cwd = function () { return '/' };\n\tprocess.chdir = function (dir) {\n\t    throw new Error('process.chdir is not supported');\n\t};\n\tprocess.umask = function() { return 0; };\n\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tFlexFormHeader.$inject = [\"$scope\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexFormHeader() {\n\t  return {\n\t    restrict: 'E',\n\t    scope: {\n\t      config: '=ffHeaderConfig',\n\t      submit: '&ffSubmit',\n\t      loadOffscreen: '&ffLoadOffscreen'\n\t    },\n\t    controller: FlexFormHeader,\n\t    bindToController: true,\n\t    controllerAs: 'vm',\n\t    template: '\\n        <div class=\"col-md-6\">\\n          <h5 ng-if=\"vm.title.lead\">{{::vm.title.lead}}</h5>\\n          <h1>\\n            <i ng-show=\"vm.title.icon\" class=\"{{vm.title.icon}}\"/>\\n            {{vm.title.main}}\\n          </h1>\\n          <h5 ng-if=\"vm.title.sub\">{{::vm.title.sub}}</h5>\\n        </div>\\n        <div class=\"{{vm.buttonContainerClass || \\'page-action-btns\\'}}\">\\n          <div class=\"btn-options\"\\n               ng-mouseover=\"vm.loadOffscreen()\">\\n            <a class=\"btn btn-{{vm.returnStyle ? vm.returnStyle : \\'default-dark\\'\"\\n               ng-if=\"vm.returnState\"\\n               ui-sref=\"{{vm.returnState}}\">\\n              {{vm.returnText || \\'Cancel\\'}}\\n            </a>\\n            <a class=\"btn btn-{{vm.closeButton.style ? vm.closeButton.style : \\'default-dark\\'}}\"\\n               ng-if=\"vm.closeButton\"\\n               ng-click=\"vm.closeButton.handler()\">\\n               Cancel\\n            </a>\\n            <span ng-repeat=\"button in vm.actions\">\\n              <span ng-class=\"{\\'btn-group\\': button.options}\">\\n                <a class=\"btn {{button.style ? \\'btn-\\'+button.style : ($index === vm.actions.length - 1 ? \\'btn-primary\\' : \\'btn-default-dark\\')}}\"\\n                   ng-disabled=\"vm.isDisabled(button)\"\\n                   ng-click=\"vm.isDisabled(button) || vm.submit({handler: button.handler})\"\\n                   uib-tooltip=\"{{button.helptext}}\"\\n                   uib-tooltip-placement=\"bottom\"\\n                   ng-bind-html=\"button.text || \\'Save\\'\">\\n                </a>\\n                <a class=\"btn {{button.style ? \\'btn-\\'+button.style : ($index === vm.actions.length - 1 ? \\'btn-primary\\' : \\'btn-default-dark\\')}} dropdown-toggle\"\\n                        ng-disabled=\"vm.isDisabled(button)\"\\n                        ng-show=\"button.options\"\\n                        data-toggle=\"dropdown\">\\n                  <span class=\"caret\"></span>\\n                </a>\\n                <ul class=\"dropdown-menu\" ng-if=\"button.options\">\\n                  <li ng-repeat=\"option in button.options\"\\n                      ng-disabled=\"vm.isDisabled(option)\">\\n                    <a ng-click=\"vm.isDisabled(option) || vm.submit({handler: option.handler})\"\\n                       ng-bind-html=\"option.text\">\\n                    </a>\\n                  </li>\\n                </ul>\\n              </span>\\n            </span>\\n          </div>\\n          <p class=\"data-updated-at text-right\"\\n             id=\"data-updated-at\"\\n             ng-hide=\"vm.config.noData\">\\n            <a ng-click=\"vm.updateData()\">Update Data</a>\\n          </p>\\n        </div>'\n\t  };\n\t}\n\t\n\tfunction FlexFormHeader($scope) {\n\t  'ngInject';\n\t\n\t  function ffHeaderTag() {}\n\t  $scope.__tag = new ffHeaderTag();\n\t\n\t  var vm = this;\n\t\n\t  vm.updateData = updateData;\n\t  vm.isDisabled = isDisabled;\n\t\n\t  //activate();\n\t  //$scope.$on('$destroy', cleanup);\n\t  $scope.$watch('vm.config.title', initTitle, true);\n\t  $scope.$watch('vm.config.actionConfig', initActionConfig, true);\n\t\n\t  ///////////\n\t\n\t  function initTitle() {\n\t    vm.title = vm.config.title;\n\t  }\n\t\n\t  function initActionConfig() {\n\t    var _ref = vm.config.actionConfig || {};\n\t\n\t    vm.returnState = _ref.returnState;\n\t    vm.returnStyle = _ref.returnStyle;\n\t    vm.returnText = _ref.returnText;\n\t    vm.closeButton = _ref.closeButton;\n\t    vm.actions = _ref.actions;\n\t  }\n\t\n\t  function updateData() {\n\t    // $scope.$emit('ffRefreshData');\n\t    // this component will often be siblings to the flex forms one,\n\t    // so need to broadcast from shared parent...yes it's ugly\n\t    $scope.$parent.$parent.$broadcast('ffRefreshData');\n\t  }\n\t\n\t  function isDisabled(btnConfig) {\n\t    if (vm.config.isDisabled) return vm.config.isDisabled(btnConfig);\n\t    return false;\n\t  }\n\t}\n\t\n\texports.default = cnFlexFormHeader;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction ffValidate() {\n\t  return {\n\t    restrict: 'A',\n\t    scope: { form: '=ffValidate' },\n\t    require: 'ngModel',\n\t    link: link\n\t  };\n\t}\n\t\n\tfunction link($scope, elem, attrs, ngModel) {\n\t  function ffValidateTag() {}\n\t  $scope.__tag = new ffValidateTag();\n\t\n\t  if ($scope.form && $scope.form.required) {\n\t    $scope.$watch(function () {\n\t      return ngModel.$viewValue;\n\t    }, function (value) {\n\t      // override schemaForm validation\n\t      ngModel.$setValidity('schemaForm', true);\n\t      ngModel.$setValidity('tv4-302', value);\n\t    });\n\t  }\n\t}\n\t\n\texports.default = ffValidate;\n\n/***/ }\n/******/ ])\n});\n;\n\n\n// WEBPACK FOOTER //\n// all.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b9f58669a8fc63b9b274","import cnFlexFormConfigProvider from './cn-flex-form-config.service';\nimport cnFlexFormTypesProvider from './cn-flex-form-types.service';\nimport { cnFlexFormRoutesProvider, cnFlexFormRoutes } from './cn-flex-form.routes';\nimport { schemaFormConfig, addTemplates } from './schema-form-extensions';\nimport cnFlexFormServiceProvider from './cn-flex-form.service';\nimport cnFlexFormModalLoaderServiceProvider from './cn-flex-form-modal-loader.service';\nimport { FlexFormModalLoader, FlexFormModal } from './cn-flex-form-modal-loader';\nimport cnFlexForm from './cn-flex-form.directive';\nimport cnFlexFormHeader from './cn-flex-form-header.directive';\nimport ffValidate from './cn-flex-form-validate.directive';\n\nexport default angular\n  .module('cn.flex-form', [\n    'ui.router',\n    'schemaForm',\n    'ui.bootstrap.datetimepicker',\n    'cnTagsInput',\n    'cn.util'\n  ])\n  .provider('cnFlexFormConfig', cnFlexFormConfigProvider)\n  .provider('cnFlexFormTypes', cnFlexFormTypesProvider)\n  .provider('cnFlexFormRoutes', cnFlexFormRoutesProvider)\n  .config(cnFlexFormRoutes)\n  .config(schemaFormConfig)\n  .run(addTemplates)\n  .provider('cnFlexFormService', cnFlexFormServiceProvider)\n  .provider('cnFlexFormModalLoaderService', cnFlexFormModalLoaderServiceProvider)\n  .factory('FlexFormModal', FlexFormModal)\n  .controller('FlexFormModalLoader', FlexFormModalLoader)\n  .directive('cnFlexForm', cnFlexForm)\n  .directive('cnFlexFormHeader', cnFlexFormHeader)\n  .directive('ffValidate', ffValidate)\n  .name;\n\n\n\n// WEBPACK FOOTER //\n// ./src/_cn-flex-form.module.js","function cnFlexFormConfigProvider() {\n\n  const ignoreParams = ['page', 'debug', 'sandbox', 'modal', 'modalId'];\n\n  return {\n    addIgnoreParam,\n    $get: cnFlexFormConfig\n  };\n\n  ////////\n\n  function addIgnoreParam(param) {\n    ignoreParams.push(param);\n  }\n\n  function cnFlexFormConfig($stateParams) {\n    'ngInject';\n\n    return {\n      getStateParams,\n      ignoreParams\n    };\n\n    ////////\n\n    function getStateParams(overrides = {}) {\n      return (\n        _({ ...$stateParams, ...overrides })\n        .omit(ignoreParams)\n        .omit(v => (_.isUndefined(v) || v === null))\n        .value()\n      );\n    }\n  }\n\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.provider('cnFlexFormConfig', cnFlexFormConfigProvider);\n\nexport default cnFlexFormConfigProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-config.service.js","function cnFlexFormTypesProvider() {\n\n  var fieldTypeRegister = [{\n    condition: field => field.type === 'hidden',\n    type: 'hidden'\n  }, {\n    condition: field => field.type.includes('radios'),\n    type: 'cn-radios'\n  }, {\n    condition: field => field.type.includes('radiobuttons'),\n    type: 'cn-radiobuttons'\n  }, {\n    condition: field => field.type.includes('autocomplete') || field.titleMap || field.titleMapResolve || field.titleMapQuery,\n    type: 'cn-autocomplete'\n  }, {\n    condition: field => field.type === 'cn-datetimepicker' || field.type === 'datetime-local' || field.type === 'time-minutes',\n    type: 'cn-datetimepicker'\n  }, {\n    condition: field => field.type === 'help',\n    type: 'help'\n  }, {\n    condition: field => field.type.includes('display'),\n    type: 'cn-display'\n  }, {\n    condition: field => field.schema && field.schema.format && field.schema.format.includes('currency'),\n    type: 'cn-currency'\n  }, {\n    condition: field => field.schema && field.schema.format === 'percentage',\n    type: 'cn-percentage'\n  }, {\n    condition: field => field.schema && field.type === 'url',\n    type: 'cn-url'\n  }, {\n    condition: field => field.type === 'toggle' || field.type === 'boolean',\n    type: 'cn-toggle'\n  }, {\n    condition: field => field.type === 'creativeimage',\n    type: 'cn-creativeimage'\n  }, {\n    condition: field => field.type === 'facebookvideo',\n    type: 'cn-facebookvideo'\n  }, {\n    condition: field => field.type === 'mediaupload',\n    type: 'cn-mediaupload'\n  }, {\n    condition: field => field.type === 'csvupload',\n    type: 'cn-csvupload'\n  }, {\n    condition: field => field.type === 'reusable',\n    type: 'cn-reusable'\n  }, {\n    condition: field => field.type === 'table',\n    type: 'cn-table'\n  }, {\n    condition: field => field.type === 'array',\n    type: 'array'\n  }, {\n    condition: field => field.type === 'schedule',\n    type: 'cn-schedule'\n  }, {\n    condition: field => field.schema && field.schema.type === 'number',\n    type: 'cn-number'\n  }];\n\n  return {\n    registerFieldType: registerFieldType,\n    $get: cnFlexFormTypes\n  };\n\n  ////////\n\n  function registerFieldType(fieldType) {\n    fieldTypeRegister.unshift(fieldType);\n  }\n\n  function cnFlexFormTypes() {\n    return {\n      fieldTypeRegister: fieldTypeRegister,\n      getFieldType: getFieldType\n    };\n\n    /////////\n\n    function getFieldType(field) {\n      for(var i = 0, l = fieldTypeRegister.length; i < l; i++) {\n        if(fieldTypeRegister[i].condition(field)) {\n          return fieldTypeRegister[i].type;\n        }\n      }\n      return field.type || field.schema && field.schema.type;\n    }\n  }\n\n}\n\nexport default cnFlexFormTypesProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-types.service.js","function cnFlexFormRoutesProvider($stateProvider) {\n  'ngInject';\n\n  return {\n    addStates,\n    $get\n  };\n\n  ////////////\n\n  function $get() {\n    // nothing to do here, but required\n  }\n\n  function addStates({ permissions, name }) {\n    const shared = {\n      controller: 'FlexFormModalLoader',\n      controllerAs: 'vm',\n      permissions\n    };\n    $stateProvider\n        .state(`${name}.page.modal`, {\n          url: '/~:modal/:modalId',\n          ...shared\n        })\n        .state(`${name}.page.modalParams`, {\n          url: '/~:modal/:modalId/:restParams',\n          ...shared\n        });\n  }\n}\n\nfunction cnFlexFormRoutes($stateProvider) {\n  'ngInject';\n\n  $stateProvider\n      .state('flex-form-sandbox', {\n        url: '/flex-form/sandbox',\n        controller: 'FlexFormSandbox',\n        controllerAs: 'vm',\n        templateUrl: 'app/components/cn-flex-form/sandbox.html'\n      });\n}\n\nexport { cnFlexFormRoutes, cnFlexFormRoutesProvider };\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form.routes.js","function schemaFormConfig(cnFlexFormServiceProvider) {\n  'ngInject';\n\n  tv4.addFormat({\n    'url': data => _.isString(data) && !/^(https?:\\/\\/.{2}|$)/.test(data) && 'invalid url'\n  });\n\n  var extensions = [\n    'cn-fieldset',\n    'cn-toggle',\n    'cn-datetimepicker',\n    'cn-autocomplete',\n    'cn-autocomplete-detailed',\n    'cn-number',\n    'cn-currency',\n    'cn-url',\n    'cn-radios',\n    'cn-radiobuttons',\n    'cn-percentage',\n    'cn-display',\n    'cn-mediaupload',\n    'cn-csvupload',\n    'cn-reusable',\n    'cn-table',\n    'cn-creativeimage',\n    'cn-schedule',\n    'cn-facebookvideo'\n  ];\n\n  _.each(extensions, function(extension) {\n    cnFlexFormServiceProvider.registerField({\n      type: extension,\n      templateUrl: `app/components/cn-flex-form/forms/${extension}.html`\n    });\n  });\n}\n\nfunction addTemplates($templateCache) {\n  'ngInject';\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-toggle.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n        <div class=\"clearfix\">\n          <cn-toggle-switch\n            name=\"{{form.key.join('.')}}\"\n            class=\"pull-left\"\n            ng-show=\"form.key\"\n            ng-model-options=\"form.ngModelOptions\"\n            ng-model=\"$$value$$\"\n            sf-changed=\"form\"\n            schema-validate=\"form\"\n            on-value=\"form.onValue\"\n            off-value=\"form.offValue\"\n            ng-required=\"form.required\"\n            read-only=\"form.readonly\"\n            undefined-class=\"form.undefinedClass\"/>\n          <span ng-show=\"form.onText && form.offText\">\n            {{$$value$$ === form.onValue ? form.onText : form.offText}}\n          </span>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-datetimepicker.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               for=\"{{form.key.join('.')}}\"\n               ng-show=\"showTitle()\">{{form.title}}</label>\n        <cn-datetimepicker\n          ng-show=\"form.key\"\n          ng-model=\"$$value$$\"\n          ng-model-options=\"form.ngModelOptions\"\n          is-disabled=\"form.readonly\"\n          sf-changed=\"form\"\n          schema-validate=\"form\"\n          input-id=\"{{form.key.join('.')}}\"\n          min-date=\"form.minDate\"\n          max-date=\"form.maxDate\"\n          max-view=\"{{form.maxView}}\"\n          default-time=\"form.defaultTime\"\n          cn-date-required=\"form.required\"\n          placeholder=\"{{form.placeholder}}\"\n          model-type=\"{{form.schema.type}}\"\n          model-formatter=\"form.modelFormatter\"\n          model-parser=\"form.modelParser\"\n          view-formatter=\"form.viewFormatter\"\n          view-parser=\"form.viewParser\"\n          format-string={{form.dateFormat}}\n          icon-class={{form.iconClass}}>\n        </cn-datetimepicker>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  var sharedAutocompleteTpl = `\n        <tags-input\n          ng-show=\"form.key\"\n          ng-model=\"$$value$$\"\n          ng-model-options=\"form.ngModelOptions\"\n          ng-disabled=\"form.readonly\"\n          sf-changed=\"form\"\n          schema-validate=\"form\"\n          input-id=\"{{form.key.join('.')}}\"\n          display-property=\"{{form.displayProperty || 'name'}}\"\n          value-property=\"{{form.valueProperty}}\"\n          placeholder=\"{{form.placeholder || ' '}}\"\n          clear-on-blur=\"true\"\n          add-on-comma=\"false\"\n          add-from-autocomplete-only=\"{{!form.allowNew}}\"\n          on-before-tag-added=\"form.onAdd({value: $tag}, form, $event, $prev)\"\n          on-init=\"form.onInit($tag, form, $event, $setter)\"\n          model-type=\"{{form.getSchemaType()}}\"\n          array-value-type=\"{{form.schema.items.type}}\"\n          hide-tags=\"{{form.detailedList}}\"\n          tags-style=\"{{form.selectionStyle}}\"\n          required=\"{{form.required}}\"\n          min-length=\"{{form.minLength}}\"\n          allowed-tags-pattern=\".*\"\n          dropdown-icon=\"true\"\n          item-formatter=\"form.itemFormatter\"\n          min-tags=\"{{form.minItems || form.schema.minItems}}\"\n          max-tags=\"{{form.maxItems || form.schema.maxItems || (form.getSchemaType() !== 'array' ? 1 : 0)}}\"\n          allow-bulk=\"{{form.bulkAdd}}\"\n          bulk-delimiter=\"{{form.bulkDelimiter}}\"\n          bulk-placeholder=\"{{form.bulkPlaceholder}}\"\n          bulk-single-request=\"{{form.bulkSingleRequest}}\"\n          sort-filtered-results=\"{{(form.titleMapResolve || form.titleMap) && !form.titleMapQuery}}\"\n          show-clear-all=\"{{form.showClearAll}}\"\n          show-clear-cache=\"{{form.showClearCache}}\"\n          show-button=\"true\">\n          <auto-complete\n            source=\"form.getTitleMap && form.getTitleMap() || form.titleQuery($query, options)\"\n            skip-filtering=\"{{form.skipFiltering}}\"\n            single-query=\"{{form.singleQuery}}\"\n            debounce-delay=\"{{form.debounceDelay}}\"\n            min-length=\"{{form.minLookup}}\">\n          </auto-complete>\n        </tags-input>`;\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-autocomplete.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               for=\"{{form.key.join('.')}}-input\"\n               ng-show=\"showTitle()\">{{form.title}}</label>\n        ${sharedAutocompleteTpl}\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-autocomplete-detailed.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               for=\"{{form.key.join('.')}}-input\"\n               ng-show=\"showTitle()\">{{form.title}}</label>\n        <div sf-array=\"form\">\n          <ol class=\"list-group cn-autocomplete-list\"\n              ng-if=\"modelArray.length\"\n              ng-model=\"modelArray\">\n            <li class=\"list-group-item {{form.fieldHtmlClass}}\"\n                ng-repeat=\"item in modelArray track by $index\">\n              <button ng-hide=\"form.readonly || form.remove === null\"\n                      ng-click=\"deleteFromArray($index)\"\n                      type=\"button\" class=\"close pull-right\">\n                <span aria-hidden=\"true\">&times;</span>\n              </button>\n              <sf-decorator form=\"copyWithIndex($index)\"/>\n            </li>\n          </ol>\n        </div>\n        ${sharedAutocompleteTpl}\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-number.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key.join('.')}}\">{{form.title}}</label>\n        <div class=\"{{form.fieldClass}}\">\n          <input class=\"form-control\"\n                 cn-number\n                 ng-show=\"form.key\"\n                 ng-model-options=\"form.ngModelOptions\"\n                 ng-disabled=\"form.readonly\"\n                 sf-changed=\"form\"\n                 schema-validate=\"form\"\n                 type=\"text\"\n                 step=\"any\"\n                 min=\"{{form.min}}\"\n                 max=\"{{form.max}}\"\n                 id=\"{{form.key.join('.')}}\"\n                 name=\"{{form.key.join('.')}}\"\n                 ng-model=\"$$value$$\">\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-currency.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key.join('.')}}\">{{form.title}}</label>\n        <div class=\"{{form.fieldClass}} input-group\">\n          <label class=\"input-group-addon\"\n                 ng-disabled=\"form.readonly\"\n                 for=\"{{form.key.join('.')}}\">$</label>\n          <input class=\"form-control\"\n                 cn-currency-format=\"{{form.currencyFormat}}\"\n                 cn-currency-placeholder=\"{{form.placeholder}}\"\n                 ng-show=\"form.key\"\n                 ng-model-options=\"form.ngModelOptions\"\n                 ng-disabled=\"form.readonly\"\n                 sf-changed=\"form\"\n                 schema-validate=\"form\"\n                 type=\"text\"\n                 step=\"any\"\n                 min=\"{{form.min}}\"\n                 max=\"{{form.max}}\"\n                 id=\"{{form.key.join('.')}}\"\n                 name=\"{{form.key.join('.')}}\"\n                 ng-model=\"$$value$$\">\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-url.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key.join('.')}}\">{{form.title}}</label>\n        <input class=\"form-control\"\n               placeholder=\"https://\"\n               cn-url-format\n               ng-show=\"form.key\"\n               ng-model-options=\"form.ngModelOptions\"\n               ng-disabled=\"form.readonly\"\n               sf-changed=\"form\"\n               schema-validate=\"form\"\n               type=\"text\"\n               id=\"{{form.key.join('.')}}\"\n               name=\"{{form.key.join('.')}}\"\n               ng-model=\"$$value$$\">\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-radios.html',\n      `<div class=\"form-group {{form.htmlClass}}\"\n            ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n         <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n         <div class=\"btn-group clearfix\">\n           <label class=\"radio radio-block\"\n                  ng-repeat=\"item in form.titleMap\">\n             <input type=\"radio\"\n                    sf-changed=\"form\"\n                    ng-disabled=\"form.readonly\"\n                    ng-model=\"$$value$$\"\n                    ng-model-options=\"form.ngModelOptions\"\n                    schema-validate=\"form\"\n                    ff-validate=\"form\"\n                    ng-value=\"item.value\"\n                    name=\"{{form.key.join('.')}}\">\n             <span class=\"radio-block-icon\" ng-if=\"item.iconClass || item.iconPath\">\n               <i ng-if=\"item.iconClass\" class=\"fa fa-{{item.iconClass}} fa-lg\"></i>\n               <img ng-if=\"item.iconPath\" class=\"custom\" ng-src=\"{{item.iconPath}}\"/>\n             </span>\n             <span ng-bind-html=\"item.name\"></span>\n           </label>\n         </div>\n         <span class=\"help-block\" sf-message=\"form.description\"></span>\n       </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-radiobuttons.html',\n      `\n      <div class=\"form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n        <div class=\"btn-group clearfix\">\n          <label class=\"btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? 'active' : ''}}\"\n                 ng-repeat=\"item in form.titleMap\">\n            <input type=\"radio\"\n                   class=\"{{form.fieldHtmlClass}} hide\"\n                   sf-changed=\"form\"\n                   ng-disabled=\"form.readonly\"\n                   ng-model=\"$$value$$\"\n                   ng-model-options=\"form.ngModelOptions\"\n                   schema-validate=\"form\"\n                   ff-validate=\"form\"\n                   ng-value=\"item.value\"\n                   name=\"{{form.key.join('.')}}\">\n            <i class=\"fa fa-{{item.value}} fa-lg\"></i>\n            <span ng-bind-html=\"item.name\"></span>\n          </label>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-percentage.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <div class=\"{{form.fieldClass}} input-group\">\n          <input class=\"form-control\"\n                 cn-percentage-format\n                 ng-show=\"form.key\"\n                 ng-model-options=\"form.ngModelOptions\"\n                 ng-disabled=\"form.readonly\"\n                 sf-changed=\"form\"\n                 schema-validate=\"form\"\n                 type=\"number\"\n                 step=\"any\"\n                 min=\"{{form.min}}\"\n                 max=\"{{form.max}}\"\n                 id=\"{{form.key && form.key[0]}}\"\n                 name=\"{{form.key && form.key[0]}}\"\n                 ng-model=\"$$value$$\">\n           <div class=\"input-group-addon\"\n                  ng-disabled=\"form.readonly\"\n                  for=\"{{form.key && form.key[0]}}\">%</div>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-display.html',\n      `\n      <div class=\"form-group cn-display{{form.htmlClass}}\">\n        <input ng-show=\"form.key\"\n               class=\"form-control\"\n               id=\"{{form.key.join('.')}}\"\n               name=\"{{form.key.join('.')}}\"\n               ng-disabled=\"true\"\n               value=\"{{form.getDisplay(form.key, form.arrayIndex)}}\">\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-fieldset.html',\n      `\n      <fieldset\n        ng-disabled=\"form.readonly\"\n        class=\"schema-form-fieldset {{form.htmlClass}}\"\n        ng-class=\"{'borderless': form.pos === 0, 'notitle': form.notitle || !form.title}\">\n        <legend ng-hide=\"form.notitle\"\n                ng-click=\"form.toggleCollapse(form)\"\n                ng-class=\"{'sr-only': !showTitle(), collapsible: form.collapsible}\"\n                ng-mouseenter=\"form.render = true\">\n          <i ng-show=\"form.collapsible\"\n             class=\"fa fa-caret-{{form.collapsed ? 'right' : 'down'}}\"></i>\n          {{ form.title }}\n        </legend>\n        <div class=\"help-block\" ng-show=\"form.description\" ng-bind-html=\"form.description\"></div>\n        <div uib-collapse=\"form.collapsed\">\n          <div ng-if=\"form.render\">\n            <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\n          </div>\n        </div>\n      </fieldset>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-mediaupload.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <media-upload ng-model=\"$$value$$\"\n                      cn-disabled=\"form.readonly\"\n                      cn-file-type=\"form.fileType\"\n                      cn-text-button=\"form.textButton\"\n                      cn-upload-path=\"form.uploadPath\"\n                      cn-data=\"form.data\"\n                      cn-preview-path=\"form.previewPath\"\n                      cn-model-value-key=\"form.modelValueKey\"\n                      cn-existing-preview=\"form.existingPreview\"\n                      cn-image-previews=\"form.data.imagePreviews\"\n                      cn-key=\"form.key && form.key[0]\"\n                      cn-form=\"form\"\n                      ng-model-options=\"form.ngModelOptions\"\n                      sf-changed=\"form\"\n                      schema-validate=\"form\"\n                      ff-form=\"form\"\n                      class=\"clearfix\">\n        </media-upload>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n     </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-csvupload.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <csv-upload ng-model=\"$$value$$\"\n                      cn-upload-path=\"form.uploadPath\"\n                      ng-model-options=\"form.ngModelOptions\"\n                      sf-changed=\"form\"\n                      schema-validate=\"form\"\n                      ff-form=\"form\"\n                      class=\"clearfix\">\n        </csv-upload>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n     </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-reusable.html',\n      `\n      <div class=\"form-group cn-reusable {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key.join('.')}}\">{{form.title}}</label>\n        <cn-select-or\n          ng-show=\"form.key\"\n          select-from=\"form.library\"\n          ng-model=\"$$value$$\"\n          ng-model-options=\"form.ngModelOptions\"\n          sf-changed=\"form\"\n          schema-validate=\"form\"\n          ff-form=\"form\"\n          directiveId=\"form.directiveId\"\n          item-template=\"form.itemTemplate\"\n          toggle-text=\"form.toggleText\"\n          ng-disabled=\"form.readonly\"\n          view=\"form.view\">\n          <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\n        </cn-select-or>\n        <p ng-if=\"form.loadMore && form.view === 'list'\">\n          <a ng-click=\"form.loadMore()\"\n             class=\"btn btn-default btn-block\">Load More</a>\n        </p>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-table.html',\n      `\n      <div class=\"form-group cn-ff-table {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <h6>{{form.title}}</h6>\n        <div class=\"row\">\n          <div ng-repeat=\"col in form.columns\" class=\"{{col.columnWidth}}\">\n            <p class=\"column-header\">{{col.columnHeader}}</p>\n          </div>\n        </div>\n        <div class=\"row\" ng-repeat=\"row in form.items\">\n          <div ng-repeat=\"col in row.items\" class=\"{{col.columnWidth}}\">\n            <sf-decorator form=\"col\"></sf-decorator>\n          </div>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-creativeimage.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <cn-creative-image ng-model=\"$$value$$\"\n                      cn-disabled=\"form.readonly\"\n                      cn-upload-path=\"form.uploadPath\"\n                      cn-data=\"form.data\"\n                      cn-preview-path=\"form.previewPath\"\n                      cn-model-value-key=\"form.modelValueKey\"\n                      cn-existing-preview=\"form.existingPreview\"\n                      ng-model-options=\"form.ngModelOptions\"\n                      cn-ng-model-key=\"form.ngModelKey\"\n                      sf-changed=\"form\"\n                      schema-validate=\"form\"\n                      ff-form=\"form\"\n                      class=\"clearfix\">\n        </cn-creative-image>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n     </div>`\n  );\n\n  $templateCache.put(\n    'app/components/cn-flex-form/forms/cn-schedule.html',\n    `\n      <div class=\"form-group {{ form.htmlClass }}\"\n           ng-class=\"{ 'has-error': hasError(), 'has-success': hasSuccess() }\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{ form.key.join('.') }}\">\n          {{ form.title }}\n        </label>\n        <cn-schedule form=\"form\"\n                     ng-model=\"$$value$$\">\n        </cn-schedule>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>\n    `\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-facebookvideo.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <cn-facebook-video ng-model=\"$$value$$\"\n                      cn-disabled=\"form.readonly\"\n                      cn-upload-path=\"form.uploadPath\"\n                      cn-data=\"form.data\"\n                      cn-preview-path=\"form.previewPath\"\n                      cn-model-value-key=\"form.modelValueKey\"\n                      cn-existing-preview=\"form.existingPreview\"\n                      ng-model-options=\"form.ngModelOptions\"\n                      cn-video-key=\"form.videoKey\"\n                      cn-thumbnail-key=\"form.thumbnailKey\"\n                      cn-image-id-key=\"form.imageIdKey\"\n                      sf-changed=\"form\"\n                      schema-validate=\"form\"\n                      ff-form=\"form\"\n                      class=\"clearfix\">\n        </cn-facebook-video>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n     </div>`\n  );\n}\n\nexport { schemaFormConfig, addTemplates };\n\n\n\n// WEBPACK FOOTER //\n// ./src/schema-form-extensions.js","// Need these modules for test bundle\nvar _ = (typeof window !== \"undefined\" && window._) || require(\"lodash\");\nvar ObjectPath =\n  (typeof window !== \"undefined\" && window.ObjectPath) || require(\"objectpath\");\n\nconst fieldTypeHandlers = {\n  fieldset: \"processFieldset\",\n  \"cn-radios\": \"processRadios\",\n  \"cn-radiobuttons\": \"processRadiobuttons\",\n  \"cn-autocomplete\": \"processSelect\",\n  \"cn-datetimepicker\": \"processDate\",\n  help: \"processHelp\",\n  \"cn-display\": \"processDisplay\",\n  \"cn-number\": \"processNumber\",\n  \"cn-currency\": \"processCurrency\",\n  \"cn-percentage\": \"processPercentage\",\n  \"cn-url\": \"processUrl\",\n  \"cn-mediaupload\": \"processMediaUpload\",\n  \"cn-creativeimage\": \"processCreativeImage\",\n  \"cn-facebookvideo\": \"processFacebookVideo\",\n  \"cn-csvupload\": \"processCsvUpload\",\n  \"cn-reusable\": \"processReusable\",\n  \"cn-toggle\": \"processToggle\",\n  \"cn-table\": \"processTable\",\n  component: \"processComponent\",\n  section: \"processSection\",\n  tabarray: \"processSection\",\n  array: \"processArray\",\n  \"cn-schedule\": \"processSchedule\",\n};\n\n// handlers that don't run on secondPass are ones that shouldn't ever change\n// and we want to avoid compounding their effects\nconst fieldPropHandlers = [\n  {\n    prop: \"default\",\n    handler: (field, service) => service.processDefault(field),\n  },\n  {\n    prop: \"resolve\",\n    handler: (field, service, secondPass) =>\n      !secondPass && service.processResolve(field),\n  },\n  {\n    prop: \"selectDisplay\",\n    handler: (field, service) => service.processSelectDisplay(field),\n  },\n  {\n    prop: \"schema\",\n    handler: (field, service) =>\n      _.isUndefined(field.default) &&\n      !_.isUndefined(field.schema.default) &&\n      service.processDefault(field),\n  },\n  {\n    prop: \"watch\",\n    handler: (field, service, secondPass) =>\n      !secondPass && field.watch && service.processFieldWatch(field),\n  },\n  {\n    prop: \"type\",\n    handler: (field, service, secondPass) =>\n      service.processFieldType(field, secondPass),\n  },\n  {\n    prop: \"conditionals\",\n    handler: (field, service) => service.processConditional(field),\n  },\n  {\n    prop: \"updateSchema\",\n    handler: (field, service, secondPass) =>\n      !secondPass && service.processFieldUpdatedSchema(field),\n  },\n];\n\nfunction cnFlexFormServiceProvider(\n  schemaFormDecoratorsProvider,\n  cnFlexFormTypesProvider\n) {\n  \"ngInject\";\n\n  return {\n    registerField,\n    $get: CNFlexFormService,\n  };\n\n  //////////\n\n  function registerField(fieldType) {\n    if (fieldType.condition) {\n      cnFlexFormTypesProvider.registerFieldType({\n        condition: fieldType.condition,\n        type: fieldType.type,\n      });\n    }\n\n    if (fieldType.handler) {\n      fieldTypeHandlers[fieldType.type] = fieldType.handler;\n    }\n\n    if (fieldType.templateUrl) {\n      schemaFormDecoratorsProvider.addMapping(\n        \"bootstrapDecorator\",\n        fieldType.type,\n        fieldType.templateUrl\n      );\n      schemaFormDecoratorsProvider.createDirective(\n        fieldType.type,\n        fieldType.templateUrl\n      );\n    }\n  }\n}\n\nfunction CNFlexFormService(\n  Api,\n  $parse,\n  cnFlexFormConfig,\n  cnFlexFormTypes,\n  sfPath,\n  $interpolate,\n  $timeout,\n  cnUtil,\n  $stateParams\n) {\n  \"ngInject\";\n\n  const services = [];\n  const prototype = {\n    compile,\n    addArrayCopy,\n    addToDataCache,\n    addToFormCache,\n    addToScopeCache,\n    broadcastErrors,\n    buildError,\n    cleanup,\n    deleteArrayCopiesFor,\n    deregisterHandlers,\n    deregisterArrayHandlers,\n    getArrayCopy,\n    getArrayCopies,\n    getArrayCopiesFor,\n    getArrayScopes,\n    getDefault,\n    getFromDataCache,\n    getFromFormCache,\n    getFromScopeCache,\n    getFormsToProcess,\n    getKey,\n    getSchema,\n    getWatchables,\n    handleResolve,\n    incrementUpdates,\n    initArrayCopyWatch,\n    initModelWatch,\n    initSchemaParams,\n    isCompiled,\n    onModelWatch,\n    parseAll,\n    parseAny,\n    parseCondition,\n    parseExpression,\n    processArray,\n    processCreativeImage,\n    processDefault,\n    processDisplay,\n    processFacebookVideo,\n    processField,\n    processFieldset,\n    processFieldProps,\n    processFieldType,\n    processFieldUpdatedSchema,\n    processFieldWatch,\n    processComponent,\n    processConditional,\n    processCurrency,\n    processNumber,\n    processPercentage,\n    processUrl,\n    processDate,\n    processHelp,\n    processRadios,\n    processRadiobuttons,\n    processReusable,\n    processSchema,\n    processSelectDisplay,\n    processResolve,\n    processSection,\n    processSelect,\n    processSchedule,\n    processTable,\n    processTemplate,\n    processToggle,\n    processUpdatedSchema,\n    processMediaUpload,\n    processCsvUpload,\n    registerArrayHandlers,\n    registerHandler,\n    registerResolve,\n    replaceArrayIndex,\n    reprocessField,\n    resetUpdates,\n    resolveNestedExpressions,\n    setArrayIndex,\n    setupConfig,\n    setupSchemaRefresh,\n    silenceListeners,\n    skipDefaults,\n  };\n\n  function getService(fn) {\n    return _.find(services, fn);\n  }\n\n  function destroyService(fn) {\n    const service = getService(fn);\n    if (service) {\n      service.cleanup();\n      _.empty(service);\n      _.remove(services, (s) => s === service);\n    }\n  }\n\n  function CNFlexFormConstructor(...args) {\n    if (args.length > 1) {\n      var [schema, model, config] = args;\n    } else {\n      var { schema, model, config } = args[0];\n    }\n\n    const curService = getService((service) => service.model === model);\n    if (curService) {\n      if (schema) {\n        curService.compile(schema, model, config);\n      }\n      return curService;\n    }\n\n    const newService = new CNFlexForm(schema, model, config);\n    services.push(newService);\n    return newService;\n  }\n\n  function CNFlexForm(schema, model, config) {\n    if ($stateParams.debug) {\n      window.services = services;\n    }\n\n    this.arrayCopies = {};\n    this.arrayListeners = {};\n    this.dataCache = {};\n    this.defaults = {};\n    this.errors = [];\n    this.events = [];\n    this.formCache = {};\n    this.scopeCache = {};\n    this.listeners = {};\n    this.resolveRegister = {};\n    this.model = model;\n    this.updates = 0;\n    this.skipDefault = {};\n\n    const overrides = config.getParams ? config.getParams() : {};\n    this.params = cnFlexFormConfig.getStateParams(overrides);\n\n    this._ = _;\n\n    this.compile(schema, model, config);\n  }\n\n  _.extend(CNFlexForm.prototype, prototype);\n  _.extend(CNFlexFormConstructor, prototype, { getService, destroyService });\n\n  return CNFlexFormConstructor;\n\n  //////////////\n\n  function compile(schema, model, config) {\n    var service = this;\n\n    if (config && config.getScope) {\n      service.scope = config.getScope();\n    }\n    service.schema = schema;\n    service.model = model;\n\n    if (!service.isCompiled()) {\n      service.setupConfig(config);\n\n      if (schema.forms) {\n        _.each(schema.forms, function (form) {\n          _.each(form.form, service.processField.bind(service));\n        });\n      } else {\n        _.each(schema.form, service.processField.bind(service));\n      }\n\n      service.initModelWatch();\n      service.initArrayCopyWatch();\n      service.isCompiled(true);\n    }\n\n    service.broadcastErrors();\n  }\n\n  function isCompiled(setValue) {\n    var service = this;\n    if (setValue) {\n      service.schema.compiled = setValue;\n    }\n    return service.schema && service.schema.compiled;\n  }\n\n  function setupConfig(config) {\n    var service = this;\n    if (config) {\n      if (config.formCtrl) service.formCtrl = config.formCtrl;\n      if (config.updateSchema) service.updateSchema = config.updateSchema;\n      if (config.getSchema)\n        service.getSchemaForm = service.setupSchemaRefresh(config.getSchema);\n    }\n    service.getParamOverrides = config.getParams || _.noop;\n  }\n\n  function processSchema(field) {\n    const service = this;\n    const { schema } = field;\n\n    field.getSchemaType = () =>\n      _.isArray(schema.type) ? _.first(schema.type) : schema.type;\n    if (!field.type) field.type = field.getSchemaType && field.getSchemaType();\n  }\n\n  function processDefault(field) {\n    const service = this;\n    const { schema } = field;\n    const curDefault = field.default || schema.default;\n    const key = service.getKey(field.key);\n\n    if (service.skipDefault[key]) {\n      delete service.skipDefault[key];\n      return;\n    }\n\n    if (field.condition) {\n      const condition = replaceArrayIndex(\n        field.condition,\n        field.arrayIndex || key\n      );\n      if (!service.parseCondition(condition)) return;\n    }\n\n    // if schemaUpdate hasn't been triggered, let schemaForm directive handle defaults\n    //if(service.updates || field.default) {\n    if (!_.isUndefined(curDefault)) {\n      if (key.includes && key.includes(\"[]\")) return;\n      const model = service.parseExpression(field.key, service.model);\n      const modelValue = model.get();\n      // if there's an existing default and it's the same as the current value\n      // update the current value to the new default\n      if (\n        _.isUndefined(modelValue) ||\n        ((_.has(service.defaults, key)\n          ? angular.equals(modelValue, service.defaults[key])\n          : _.isTrulyEmpty(modelValue)) &&\n          !angular.equals(modelValue, curDefault))\n      ) {\n        model.set(angular.copy(curDefault));\n      }\n    }\n    service.defaults[key] = angular.copy(curDefault);\n\n    if (schema.format === \"url\" && !field.validationMessage) {\n      if (!field.type) field.type = \"cn-url\";\n      field.validationMessage = \"Must be a valid url (https://...)\";\n    }\n  }\n\n  function processFieldset(fieldset) {\n    var service = this;\n\n    fieldset.type = \"cn-fieldset\";\n    fieldset.items.forEach(service.processField.bind(service));\n\n    if (_.has(fieldset, \"pos\") && fieldset.pos === 0) {\n      fieldset.htmlClass = (fieldset.htmlClass || \"\") + \" borderless\";\n    }\n    if (fieldset.collapsible) {\n      fieldset.toggleCollapse = (fieldset) => {\n        if (fieldset.collapsible) {\n          fieldset.collapsed = !fieldset.collapsed;\n        }\n      };\n\n      fieldset.render = !fieldset.collapsed;\n    } else {\n      fieldset.render = true;\n    }\n  }\n\n  function processFieldType(field, secondPass) {\n    const service = this;\n    const fieldType = cnFlexFormTypes.getFieldType(field);\n    const handler = fieldTypeHandlers[fieldType];\n    if (_.isString(handler)) {\n      service[handler](field, secondPass);\n    } else if (_.isFunction(handler)) {\n      handler.call(service, field, secondPass);\n    }\n  }\n\n  function getOgKeys(field) {\n    return _.reject(_.keys(field), (key) => /^key$|^htmlClass$|^_/.test(key));\n  }\n\n  function processField(field, pos) {\n    const service = this;\n\n    if (angular.isDefined(pos)) {\n      field.pos = pos;\n    }\n\n    if (!field._ogKeys) {\n      field._ogKeys = getOgKeys(field);\n    }\n\n    const key = service.getKey(field.key);\n\n    if (key) {\n      service.addToFormCache(field, key);\n      const schema = service.getSchema(key);\n\n      if (schema) {\n        field.schema = schema;\n        if (schema.description) field.description = schema.description;\n        if (schema.type === \"array\" && !(\"showClearAll\" in field))\n          field.showClearAll = true;\n      }\n\n      service.processSchema(field);\n    }\n\n    service.processFieldProps(field);\n\n    if (key) {\n      ((key) => {\n        if (_.find(service.errors, { key })) {\n          service.errors = _.reject(service.errors, { key });\n          service.scope.$broadcast(\n            \"schemaForm.error.\" + key,\n            \"serverValidation\",\n            true\n          );\n          service.scope.$broadcast(\n            \"schemaForm.error.\" + key,\n            \"schemaForm\",\n            true\n          );\n        }\n      })(getDotKey(key));\n\n      if (field.error) {\n        service.errors.push(service.buildError(field));\n        if (_.isEmpty(field.ngModelOptions)) {\n          field.ngModelOptions = {\n            allowInvalid: true,\n          };\n        } else {\n          field.ngModelOptions.allowInvalid = true;\n        }\n      }\n    }\n  }\n\n  function processFieldProps(field, secondPass) {\n    const service = this;\n    fieldPropHandlers.forEach(\n      ({ prop, handler }) =>\n        _.has(field, prop) && handler(field, service, secondPass)\n    );\n  }\n\n  function getKey(key) {\n    if (_.isArray(key)) {\n      key = _.reduce(key, (total, next) =>\n        /^(-?\\d*)$/.test(next) ? total + \"[\" + next + \"]\" : total + \".\" + next\n      );\n    }\n    return key;\n  }\n\n  function getSchema(key, depth) {\n    var service = this;\n    if (!key) return;\n\n    key = ObjectPath.parse(service.getKey(key));\n    depth = depth || service.schema.schema.properties;\n    let first, next;\n\n    while (key.length > 1) {\n      next = key[1];\n      if (/^-?\\d*$/.test(next)) {\n        if (key.length === 2) {\n          depth = depth[key.shift()];\n        } else {\n          depth = depth[key.shift()].items.properties;\n          key.shift();\n        }\n      } else {\n        depth = depth[key.shift()].properties;\n      }\n    }\n\n    // if array item\n    first = key[0] || \"items\";\n\n    return depth[first];\n  }\n\n  function getDefault(field) {\n    const service = this;\n    field = field.key ? field : service.getFromFormCache(field);\n    return (\n      field &&\n      (angular.isDefined(field.default)\n        ? field.default\n        : field.schema && field.schema.default)\n    );\n  }\n\n  function getWatchables(exp) {\n    const watchables = [];\n    let nested = matchNestedExpression(exp);\n    let replaceStr = \"\";\n\n    while (nested) {\n      if (/^-?\\d+$/.test(nested[1]) || /^(\"|').*(\"|')$/.test(nested[1])) {\n        replaceStr = nested[0];\n        exp = exp.replace(nested[0], \"ff_replace_ff\");\n      } else {\n        watchables.push(nested[1].replace(/ff_replace_ff/g, replaceStr));\n        replaceStr = \"\";\n        exp = exp.replace(nested[0], \"\");\n      }\n      nested = matchNestedExpression(exp);\n    }\n\n    return [...watchables, exp.replace(/ff_replace_ff/g, replaceStr)];\n  }\n\n  function processResolve(field) {\n    const service = this;\n    const key = service.getKey(field.key);\n\n    _.each(field.resolve, function (dataProp, fieldProp) {\n      dataProp = replaceArrayIndex(dataProp, key || field.arrayIndex);\n      if (dataProp.includes(\"[arrayIndex]\")) return;\n\n      service.handleResolve(field, fieldProp, dataProp, true);\n\n      getWatchables(dataProp).forEach((watchable) => {\n        const [, base, exp] =\n          watchable.match(/(schema\\.data\\.|model\\.)(\\S+)/) || [];\n\n        if (base) {\n          if (base === \"schema.data.\") {\n            service.registerResolve(field, fieldProp, exp, dataProp);\n          } else if (base === \"model.\") {\n            service.registerHandler(exp, () => {\n              service.handleResolve(field, fieldProp, dataProp);\n            });\n          }\n        }\n      });\n    });\n\n    return field;\n  }\n\n  function parseAny(exp, base) {\n    const service = this;\n    let result;\n    const eithers = exp.split(\" || \");\n    const match = _.find(eithers, (x) => {\n      const v = service.parseExpression(x, base).get();\n      if (!_.isUndefined(v)) {\n        result = v;\n        return true;\n      }\n    });\n    return result;\n  }\n\n  function parseAll(exp, base) {\n    const service = this;\n    const all = exp.split(\" && \");\n    const match = _.reduce(\n      all,\n      (acc, x) => {\n        const v = service.parseExpression(x, base).get();\n        if (!_.isUndefined(v)) {\n          acc.push(v);\n        }\n        return acc;\n      },\n      []\n    );\n    return all.length === match.length ? _.last(match) : undefined;\n  }\n\n  function handleResolve(field, fieldProp, exp, skipPropHandlers) {\n    const service = this;\n    const data = exp.includes(\" || \")\n      ? service.parseAny(exp)\n      : exp.includes(\" && \")\n      ? service.parseAll(exp)\n      : service.parseExpression(exp).get();\n\n    if (data && data.cursor) {\n      field.loadMore = function () {\n        const dataProp = exp.match(/schema\\.data\\.(.+)/)[1];\n        service.refreshSchema(`data:${dataProp}:${data.cursor}`);\n      };\n    } else {\n      delete field.loadMore;\n    }\n\n    const val = data && data.data ? data.data : data;\n    const val1 = fieldProp === \"condition\" ? val + \"\" : val;\n    service.parseExpression(fieldProp, field).set(val1);\n\n    if (!skipPropHandlers) {\n      fieldPropHandlers.forEach(\n        ({ prop, handler }) => prop === fieldProp && handler(field, service)\n      );\n    }\n  }\n\n  function registerResolve(field, fieldProp, dataProp, exp) {\n    var service = this;\n\n    let fieldKey = service.getKey(field.key);\n    service.resolveRegister[dataProp] = service.resolveRegister[dataProp] || {};\n\n    let register = service.resolveRegister[dataProp];\n    register[fieldKey] = register[fieldKey] || [];\n    register[fieldKey].push({ field, prop: fieldProp, exp });\n  }\n\n  function processConditional(field) {\n    const service = this;\n    _.each(field.conditionals, (condition, key) => {\n      const handler = (val, prev) => {\n        field[key] = service.parseCondition(condition);\n        const scope = service.getFromScopeCache(service.getKey(field.key));\n        if (key === \"required\" && scope) {\n          service.scope.$broadcast(\"schemaFormValidate\");\n        }\n      };\n      field.conditionals[key]\n        .match(/model\\.([^\\s]+)/g)\n        .map((path) => path.match(/model\\.([^\\s]+)/)[1])\n        .forEach((key) => {\n          service.registerHandler(key, handler);\n        });\n      handler();\n    });\n  }\n\n  function processFieldWatch(field) {\n    const service = this;\n    if (!field.watch) return;\n\n    let schema = field.schema;\n    field.watch = _.isArray(field.watch) ? field.watch : [field.watch];\n\n    _.each(field.watch, function (watch) {\n      if (watch.resolution) {\n        let condition;\n        if (_.isString(field.condition)) {\n          // if the condition isn't already wrapped in parens, wrap it\n          condition = /^\\(.*\\)$/.test(field.condition)\n            ? field.condition\n            : `(${field.condition})`;\n        }\n        if (_.isString(watch.condition)) {\n          condition = condition\n            ? `${condition} && ${watch.condition}`\n            : watch.condition;\n        }\n        let resolution = watch.resolution;\n        let handler;\n\n        if (_.isFunction(resolution)) {\n          handler = function (cur, prev) {\n            if (!condition || service.parseCondition(condition)) {\n              resolution(cur, prev);\n            }\n          };\n        } else {\n          var adjustment = {};\n\n          adjustment.date = resolution.match(/\\+ ?(\\d+) (days|hours)/);\n\n          if (adjustment.date) {\n            adjustment.date = {\n              val: adjustment.date[1],\n              units: adjustment.date[2],\n            };\n            resolution = resolution.replace(adjustment.date.val, \"\").trim();\n          } else {\n            adjustment.math = resolution.match(/(\\+|\\-|\\/|\\*) ?(\\S+)/);\n\n            if (adjustment.math) {\n              adjustment.operator = {\n                \"+\": \"add\",\n                \"-\": \"subtract\",\n                \"*\": \"multiply\",\n                \"/\": \"divide\",\n              }[adjustment.math[1]];\n\n              adjustment.adjuster = service.parseExpression(adjustment.math[2]);\n            }\n          }\n\n          resolution = resolution.match(/(\\S+) ?= ?(\\S+)/);\n\n          handler = (val, prev, key, trigger) => {\n            let curCondition = condition && replaceArrayIndex(condition, key);\n            if (\n              _.isString(curCondition) &&\n              curCondition.includes(\"[arrayIndex]\")\n            ) {\n              return console.error(\n                `arrayIndex could not be repalced from expression '${curCondition}'`\n              );\n            }\n            let updatePath = replaceArrayIndex(resolution[1], key);\n            let fromPath = replaceArrayIndex(resolution[2], key);\n\n            let update = service.parseExpression(updatePath);\n\n            // avoid loop where two watches keep triggering each other\n            if (trigger === update.path().key) return;\n            trigger = update.path().key;\n\n            let from = service.parseExpression(fromPath);\n\n            if (!condition || service.parseCondition(curCondition)) {\n              if (adjustment.date) {\n                update.set(\n                  moment(from.get())\n                    .add(adjustment.date.val, adjustment.date.units)\n                    .toDate()\n                );\n              } else if (adjustment.math) {\n                //var result = _[adjustment.operator](from.get(), adjustment.adjuster.get());\n                //let result = eval(from.get() + adjustment.math[1] + adjustment.adjuster.get());\n                let result = $parse(\n                  from.get() + adjustment.math[1] + adjustment.adjuster.get()\n                )();\n                schema =\n                  schema ||\n                  (field.items &&\n                    (field.items[0].schema ||\n                      (field.items[0].items &&\n                        field.items[0].items[0].schema)));\n                if (field.type === \"cn-currency\") {\n                  let p =\n                    schema && schema.format === \"currency-dollars\" ? 2 : 0;\n\n                  if (adjustment.math[1] === \"*\") {\n                    result = _.floor(result, p);\n                  } else if (adjustment.math[1] === \"/\") {\n                    result = _.ceil(result, p);\n                  } else {\n                    result = _.round(result, p);\n                  }\n                }\n                //service.listeners[update.path().key].prev = result;\n                if (service.listeners[trigger]) {\n                  service.listeners[trigger].trigger = key;\n                }\n                update.set(result || 0);\n              } else {\n                update.set(from.get());\n              }\n            }\n          };\n        }\n\n        service.registerHandler(\n          field,\n          handler,\n          field.updateSchema,\n          watch.initialize\n        );\n      }\n    });\n  }\n\n  function parseCondition(condition) {\n    const service = this;\n    if (condition.startsWith(\"_\")) {\n      let exp =\n        /^_\\.(.*?)\\((.*?),[\\s(]*(.*?)\\)?\\s*=>[{\\s]*(?:return)?(.*?)\\}?\\)$/;\n      let [, fn, list, predicateParams, predicateBody] = condition.match(exp);\n      return _[fn](\n        $parse(list)(service),\n        generatePredicate(predicateParams, predicateBody)\n      );\n    } else {\n      return $parse(condition)(service);\n    }\n  }\n\n  function generatePredicate(params, body) {\n    return (...args) =>\n      $parse(body)(\n        params\n          .replace(/\\s/g, \"\")\n          .split(\",\")\n          .reduce((acc, cur, i) => {\n            acc[cur] = args[i];\n            return acc;\n          }, {})\n      );\n  }\n\n  function processFieldUpdatedSchema(field) {\n    const service = this;\n    const key = service.getKey(field.key);\n    if (!service.updates && field.updateSchema && !service.schema.params[key]) {\n      // by this point defaults should be processed so we can get value directly from model\n      const curVal = service.parseExpression(key, service.model).get();\n      if (!_.isUndefined(curVal)) service.schema.params[key] = curVal;\n    }\n    service.registerHandler(field, null, field.updateSchema);\n  }\n\n  function registerHandler(key, handler, updateSchema, runHandler) {\n    var service = this;\n\n    // if field is passed instead of key\n    if (_.isObject(key) && !_.isArray(key)) {\n      if (!key.key && key.items) {\n        _.each(key.items, function (field) {\n          service.registerHandler(field, handler, field.updateSchema);\n        });\n        return;\n      } else {\n        key = key.key;\n      }\n    }\n\n    key = service.getKey(key);\n    var arrMatch = key.match(/(.*)\\[]\\.?(.*)/);\n\n    if (arrMatch) {\n      service.registerArrayHandlers(\n        arrMatch[1],\n        arrMatch[2],\n        handler,\n        updateSchema,\n        runHandler\n      );\n      return;\n    }\n\n    var cur = service.parseExpression(key, service.model).get();\n    let defaultValue = _.get(service.getSchema(key), \"default\");\n\n    if (!service.listeners[key]) {\n      var prev = angular.copy(cur);\n      service.listeners[key] = {\n        handlers: [],\n        updateSchema: updateSchema,\n        prev: prev,\n      };\n    }\n\n    if (handler) {\n      service.listeners[key].handlers.push(handler);\n      if (runHandler) handler(cur, null, key);\n    }\n  }\n\n  function registerArrayHandlers(\n    arrKey,\n    fieldKey,\n    handler,\n    updateSchema,\n    runHandler\n  ) {\n    const service = this;\n    const onArray = (cur, prev, reorder) => {\n      if (!prev && prev !== 0 && (cur | 0) < 1) return;\n      var i, l, key;\n\n      if (prev > cur || reorder) {\n        const lastKey = fieldKey\n          ? `${arrKey}[${prev - 1}].${fieldKey}`\n          : `${arrKey}[${prev - 1}]`;\n\n        // only deregister handlers once each time an element is removed\n        if (service.listeners[lastKey]) {\n          for (i = 0, l = prev; i < l; i++) {\n            key = fieldKey ? `${arrKey}[${i}].${fieldKey}` : `${arrKey}[${i}]`;\n\n            service.deregisterHandlers(key);\n          }\n        }\n        for (i = 0, l = cur; i < l; i++) {\n          key = fieldKey ? `${arrKey}[${i}].${fieldKey}` : `${arrKey}[${i}]`;\n\n          service.registerHandler(key, handler, updateSchema);\n          //no need to call if just reregisering handlers\n          //if(runHandler) handler(null, null, key);\n        }\n      } else if (cur > (prev || 0)) {\n        for (i = prev | 0, l = cur; i < l; i++) {\n          key = fieldKey ? `${arrKey}[${i}].${fieldKey}` : `${arrKey}[${i}]`;\n\n          service.registerHandler(key, handler, updateSchema, runHandler);\n          //if(runHandler) handler(null, null, key);\n        }\n      }\n    };\n\n    const arrVal = service.parseExpression(arrKey, service.model).get();\n    _.each(arrVal, (field, i) => {\n      const key = fieldKey ? `${arrKey}[${i}].${fieldKey}` : `${arrKey}[${i}]`;\n\n      service.registerHandler(key, handler, updateSchema);\n      if (runHandler) handler(null, null, key);\n    });\n\n    const listenerKey = `${arrKey}.length`;\n    if (service.arrayListeners[listenerKey]) {\n      service.arrayListeners[listenerKey].handlers.push(onArray);\n    } else {\n      service.arrayListeners[listenerKey] = {\n        handlers: [onArray],\n        prev: arrVal ? arrVal.length : 0,\n      };\n    }\n  }\n\n  function deregisterHandlers(key) {\n    var service = this;\n\n    key = service.getKey(key);\n\n    var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.*)/);\n\n    if (arrMatch) {\n      service.deregisterArrayHandlers(arrMatch[1], arrMatch[2]);\n      return;\n    }\n\n    if (service.listeners[key]) service.listeners[key].handlers = [];\n    //if(service.listeners[key]) delete service.listeners[key];\n  }\n\n  function deregisterArrayHandlers(arrKey, fieldKey) {\n    var service = this;\n\n    service\n      .parseExpression(arrKey, service.model)\n      .get()\n      .forEach((item, i) => {\n        fieldKey\n          ? service.deregisterHandlers(`${arrKey}[${i}].${fieldKey}`)\n          : service.deregisterHandlers(`${arrKey}[${i}]`);\n      });\n  }\n\n  function initModelWatch() {\n    var service = this;\n    if (service.watching) return;\n    if (service.modelWatch) service.modelWatch();\n\n    service.modelWatch = service.scope.$watch(\n      () => service.model,\n      service.onModelWatch.bind(service),\n      true\n    );\n\n    service.initSchemaParams();\n    service.watching = true;\n    service.firstUpdate = true;\n  }\n\n  function onModelWatch(cur, prev) {\n    var service = this;\n    // we always run through the listeners on the first update because angular seems to mess up\n    // when the defaults are applied and uses the same object for both cur and prev\n    if (service.firstUpdate || !angular.equals(cur, prev)) {\n      service.firstUpdate = false;\n      cnUtil.cleanModel(service.model);\n\n      service.prevParams = angular.copy(service.params);\n\n      _.each(service.arrayListeners, (listener, key) => {\n        let val = service.parseExpression(key, service.model).get();\n        if (!angular.equals(val, listener.prev)) {\n          listener.handlers.forEach((handler) => handler(val, listener.prev));\n          listener.prev = angular.copy(val);\n        }\n      });\n\n      _.each(service.listeners, (listener, key) => {\n        if (listener) {\n          let val = service.parseExpression(key, service.model).get();\n          const isInitArray = angular.equals(val, []) && !listener.prev;\n          if (!angular.equals(val, listener.prev) && !isInitArray) {\n            listener.handlers.forEach((handler) => {\n              handler(val, listener.prev, key, listener.trigger);\n            });\n            listener.trigger = null;\n            listener.prev = angular.copy(val);\n          }\n          if (\n            listener.updateSchema &&\n            !angular.isUndefined(val) &&\n            !isInitArray &&\n            val !== null /* &&\n            !angular.equals(val, service.getDefault(key))*/\n          ) {\n            service.params[key] = val;\n          } else {\n            delete service.params[key];\n          }\n        }\n      });\n\n      if (!angular.equals(service.params, service.prevParams)) {\n        if (\n          service.model.id &&\n          !service.updates &&\n          _.isEmpty(service.prevParams)\n        ) {\n          service.incrementUpdates();\n        } else {\n          if (_.isFunction(service.refreshSchema)) {\n            service.refreshSchema();\n          }\n        }\n      }\n    }\n  }\n\n  function initSchemaParams() {\n    var service = this;\n    _.each(service.listeners, function (listener, key) {\n      if (listener) {\n        var val = service.parseExpression(key, service.model).get();\n        if (\n          listener.updateSchema &&\n          !angular.isUndefined(val) &&\n          val !== null\n        ) {\n          service.params[key] = val;\n        }\n      }\n    });\n  }\n\n  function stripIndexes(key) {\n    return key.replace(/\\[\\d+]/g, \"[]\");\n  }\n\n  function initArrayCopyWatch() {\n    const service = this;\n\n    service.events.push(\n      service.scope.$on(\"schemaFormPropagateFormController\", (event, scope) => {\n        const { form } = scope;\n        if (!form.key) {\n          form.cacheKey = `${form.type}-${_.uniqueId()}`;\n        }\n        const key = form.cacheKey || service.getKey(form.key);\n\n        if (_.isNumber(scope.arrayIndex)) {\n          const genericKey = stripIndexes(key);\n          const index = scope.arrayIndex;\n          form.arrayIndex = index;\n\n          if (!service.getArrayCopy(genericKey, index)) {\n            service.processFieldProps(form, true);\n          }\n\n          if (!form.condition) form.condition = \"true\";\n          // else if (form.condition.includes(\"arrayIndex\")) {\n          //   form.condition = service.replaceArrayIndex(form.condition, key);\n          // }\n\n          service.addArrayCopy(scope, genericKey, index);\n          scope.$emit(\"flexFormArrayCopyAdded\", genericKey);\n        } else {\n          service.addToScopeCache(scope, key);\n        }\n      })\n    );\n\n    service.events.push(\n      service.scope.$on(\"schemaFormDeleteScope\", (event, scope, index) => {\n        const key = service.getKey(scope.form.key);\n        const listener = service.listeners[key];\n        if (listener) listener.handlers = [];\n\n        service.deleteArrayCopiesFor(key, index);\n\n        if (scope.form.link) {\n          const list = service\n            .parseExpression(scope.form.link, service.model)\n            .get();\n          list.splice(index, 1);\n          service.deleteArrayCopiesFor(scope.form.link, index);\n        }\n      })\n    );\n  }\n\n  function addArrayCopy(form, key, index) {\n    const service = this;\n    if (!index || index < 0) index = 0;\n    if (!service.arrayCopies[key]) service.arrayCopies[key] = [];\n    service.arrayCopies[key][index] = form;\n    //service.arrayCopies[key].push(form);\n  }\n\n  function getArrayCopy(key, index) {\n    const service = this;\n    const copies = service.arrayCopies[key];\n    return copies && copies[index];\n  }\n\n  function getArrayCopies(key) {\n    const service = this;\n    return _.pluck(service.getArrayScopes(key), \"form\");\n  }\n\n  function getArrayCopiesFor(keyStart) {\n    const service = this;\n    keyStart += \"[]\";\n\n    return _.filter(service.arrayCopies, (copy, key) => key.includes(keyStart));\n  }\n\n  function deleteArrayCopiesFor(key, index) {\n    const service = this;\n    const copies = service.getArrayCopiesFor(key);\n    _.each(copies, (list) => list && list.splice(index, 1));\n  }\n\n  function getArrayScopes(key) {\n    var service = this;\n    return service.arrayCopies[key];\n  }\n\n  function addToScopeCache(scope, key) {\n    const service = this;\n    if (service.scopeCache[key]) {\n      console.warn(\"caching duplicate scope for\", key);\n    }\n    return (service.scopeCache[key] = scope);\n  }\n\n  function getFromScopeCache(key) {\n    const service = this;\n    return service.scopeCache[key];\n  }\n\n  function addToFormCache(field, key) {\n    var service = this;\n    key = key || service.getKey(field.key);\n    if (!service.getFromFormCache(key)) service.formCache[key] = field;\n  }\n\n  function getFromFormCache(key) {\n    var service = this;\n    return service.formCache[key];\n  }\n\n  function addToDataCache(key, modelValue) {\n    var service = this;\n\n    if (key) {\n      service.dataCache[key] = modelValue;\n    }\n  }\n\n  function getFromDataCache(key) {\n    var service = this;\n\n    return service.dataCache[key];\n  }\n\n  function matchIntStrIndex(exp) {\n    return exp.match(/\\[(-?\\d+|\".*\"|'.*')]/);\n  }\n\n  function matchNestedExpression(exp) {\n    let [toReplace] = matchIntStrIndex(exp) || [];\n    const replaced = [];\n\n    while (toReplace) {\n      replaced.push(toReplace);\n      exp = exp.replace(toReplace, `ff_r${replaced.length - 1}_ff`);\n      [toReplace] = matchIntStrIndex(exp) || [];\n    }\n\n    const match = exp.match(/\\[([^[\\]]+)]([^[\\]]*)/);\n\n    return match && replaced.length\n      ? match.map((exp) => {\n          let [toReplace, index] = exp.match(/ff_r(\\d+)_ff/) || [];\n          while (toReplace) {\n            exp = exp.replace(toReplace, replaced[index]);\n            [toReplace, index] = exp.match(/ff_r(\\d+)_ff/) || [];\n          }\n          return exp;\n        })\n      : match;\n  }\n\n  function resolveNestedExpressions(exp, depth) {\n    const service = this;\n    let [, nested] = matchNestedExpression(exp) || [];\n\n    while (nested) {\n      const parsed = service.parseExpression(nested, depth).get();\n      const keyVal = _.isUndefined(parsed)\n        ? \"\"\n        : _.isString(parsed)\n        ? `\"${parsed}\"`\n        : parsed;\n      exp = exp.replace(`[${nested}]`, `[${keyVal}]`);\n      [, nested] = matchNestedExpression(exp) || [];\n    }\n\n    return exp;\n  }\n\n  function parseExpression(exp, depth) {\n    const service = this;\n\n    if (!_.isString(exp) && !_.isArray(exp)) {\n      return { get: () => exp };\n    }\n\n    // if expression is specific value\n    if (\n      /^(null|false|true|undefined|'[^\\']*'|\"[^\\\"]*\"|-?[0-9.]+|\\[]|\\{})$/.test(\n        exp\n      )\n    ) {\n      return {\n        get: function () {\n          if (!exp) return exp;\n          const isStr = exp.match(/\"([^\\\"]*)\"/) || exp.match(/'([^\\']*)'/);\n          if (isStr) return isStr[1];\n          switch (exp) {\n            case \"null\":\n              return null;\n            case \"false\":\n              return false;\n            case \"true\":\n              return true;\n            case \"undefined\":\n              return;\n            case \"[]\":\n              return [];\n            case \"{}\":\n              return {};\n            default:\n              return parseFloat(exp);\n          }\n        },\n      };\n    }\n\n    exp = service.getKey(exp);\n\n    const match = exp.match(/^(model\\.)?(\\S+)$/);\n\n    const modelValue = {\n      get() {\n        let resolved = service.resolveNestedExpressions(exp, depth);\n        let path = ObjectPath.parse(resolved);\n        let start = depth || service;\n\n        while (start && path.length > 1) {\n          start = start[path.shift()];\n        }\n\n        return start && start[path[0]];\n      },\n\n      getAssignable({ noConstruction } = {}) {\n        let resolved = service.resolveNestedExpressions(exp, depth);\n        let path = ObjectPath.parse(resolved);\n        let progress = [];\n        let start = depth || service;\n\n        while (start && path.length > 1) {\n          let key = path.shift();\n          progress.push(key);\n          if (!start[key]) {\n            if (noConstruction) {\n              return null;\n            }\n            if (/^\\d?$/.test(path[0])) {\n              start[key] = [];\n            } else {\n              start[key] = {};\n            }\n          }\n          start = start[key];\n        }\n\n        return {\n          obj: start,\n          key: path[0],\n          path: service.getKey(progress),\n          fullPath: service.getKey(progress.concat(path.slice(0, 1))),\n        };\n      },\n\n      set(val, options = {}) {\n        let resolved = service.resolveNestedExpressions(exp, depth);\n        let path = ObjectPath.parse(resolved);\n        if (val === \"remove\") {\n          let { obj, key } = this.getAssignable({ noConstruction: true }) || {};\n          delete service.defaults[resolved.replace(\"model.\", \"\")];\n          if (obj) {\n            delete obj[key];\n          }\n        } else {\n          let { obj, key } = this.getAssignable();\n          obj[key] = val;\n        }\n        if (options.silent) {\n          service.silenceListeners(resolved, depth);\n          service.skipDefaults(resolved);\n        }\n        return val;\n      },\n\n      path() {\n        return {\n          exp: exp,\n          depth: depth,\n          key: match[2],\n        };\n      },\n    };\n\n    return modelValue;\n  }\n\n  function silenceListeners(keyStart, depth) {\n    const service = this;\n    _.each(service.listeners, (listener, key) => {\n      if (key.indexOf(keyStart) === 0) {\n        listener.prev = angular.copy(service.parseExpression(key, depth).get());\n      }\n    });\n  }\n\n  function skipDefaults(keyStart) {\n    const service = this;\n    const index = keyStart.match(/\\[\\d*\\]/) ? getArrayIndex(keyStart) : null;\n    const ks = stripIndexes(keyStart);\n    const keys = _.filter(_.keys(service.formCache), (k) => k.startsWith(ks));\n    let skipKeys = [];\n    _.each(keys, (key) => {\n      const indexedKey = service.setArrayIndex(key, index);\n      const model = service.parseExpression(indexedKey, service.model).get();\n      if (_.isArray(model)) {\n        const childKeys = _.filter(_.keys(service.formCache), (k) =>\n          k.startsWith(key)\n        );\n        for (let i = 0; i < model.length; i++) {\n          _.each(childKeys, (k) => {\n            skipKeys.push(k);\n            const indexedChildKey = service.setArrayIndex(k, [index, i]);\n            service.skipDefault[indexedChildKey] = true;\n          });\n        }\n      } else if (!skipKeys.includes(key)) {\n        service.skipDefault[indexedKey] = true;\n      }\n    });\n  }\n\n  function processArray(array) {\n    var service = this;\n    var key = service.getKey(array.key);\n\n    array.sortOptions = {\n      update: function (e, ui) {\n        let listener = service.arrayListeners[`${key}.length`];\n        listener.handlers.forEach((handler) => {\n          handler(listener.prev, listener.prev, true);\n        });\n      },\n    };\n\n    service.processSection(array);\n  }\n\n  function processSection(section, secondPass) {\n    var service = this;\n    // if we're here because a parent's scope was emitted,\n    // scope for this section will soon be emitted, so can skip\n    if (secondPass) return;\n    _.each(section.items, service.processField.bind(service));\n  }\n\n  function processComponent(component) {\n    var service = this;\n\n    component.type = \"section\";\n    component.htmlClass = \"row\";\n\n    var cols = 12 / _.reject(component.items, \"hidden\").length;\n\n    _.each(component.items, function (field, i) {\n      service.processField(field);\n      component.items[i] = {\n        type: \"section\",\n        htmlClass: \"col-sm-\" + cols,\n        items: [field],\n      };\n    });\n  }\n\n  function processCurrency(field) {\n    field.currencyFormat = {\n      \"currency-dollars\": \"dollars\",\n      \"currency-microcents\": \"microcents\",\n      currency: \"cents\",\n    }[field.schema.format];\n\n    field.type = \"cn-currency\";\n  }\n\n  function processNumber(field) {\n    field.type = \"cn-number\";\n  }\n\n  function processPercentage(field) {\n    field.type = \"cn-percentage\";\n  }\n\n  function processUrl(field) {\n    field.type = \"cn-url\";\n  }\n\n  function processReusable(field) {\n    var service = this;\n    field.type = \"cn-reusable\";\n    field.view = field.view || \"new\";\n    field.items.forEach(service.processField.bind(service));\n    field.items = [\n      {\n        type: \"section\",\n        items: field.items,\n        condition: \"!model.\" + service.getKey(field.key) + \".id\",\n      },\n    ];\n  }\n\n  function processFacebookVideo(field) {\n    var service = this;\n    field.type = \"cn-facebookvideo\";\n    if (!field.resolve) {\n      field.resolve = {};\n      _.each(field.data, (exp, prop) => (field.resolve[`data.${prop}`] = exp));\n    }\n    service.processResolve(field);\n  }\n\n  function processCreativeImage(field) {\n    var service = this;\n    field.type = \"cn-creativeimage\";\n    if (!field.resolve) {\n      field.resolve = {};\n      _.each(field.data, (exp, prop) => (field.resolve[`data.${prop}`] = exp));\n    }\n    service.processResolve(field);\n  }\n\n  function processMediaUpload(field) {\n    var service = this;\n    field.type = \"cn-mediaupload\";\n    if (!field.resolve) {\n      field.resolve = {};\n      _.each(field.data, (exp, prop) => (field.resolve[`data.${prop}`] = exp));\n    }\n    service.processResolve(field);\n  }\n\n  function processCsvUpload(field) {\n    var service = this;\n    field.type = \"cn-csvupload\";\n  }\n\n  function processRadios(field) {\n    field.type = \"cn-radios\";\n  }\n\n  function processRadiobuttons(radios) {\n    var service = this;\n    radios.type = \"cn-radiobuttons\";\n    if (radios.fullWidth) {\n      radios.btnClass = \"col-sm-\" + _.divide(12, radios.titleMap.length);\n    }\n  }\n\n  function processDate(date) {\n    var service = this;\n    date.type = \"cn-datetimepicker\";\n\n    if (date.schema.format === \"time-minutes\") {\n      date.maxView = \"hour\";\n      date.iconClass = \"fa fa-clock-o\";\n\n      date.modelFormatter = (val) => {\n        if (!val) return;\n\n        let m = moment(val);\n\n        return _.add(_.multiply(m.hours(), 60), m.minutes());\n      };\n\n      date.modelParser = (val) => {\n        if (!val) return;\n\n        let d = parseInt(val);\n        let hours = _.floor(d / 60);\n        let minutes = d % 60;\n\n        return moment()\n          .startOf(\"day\")\n          .add(\"hours\", hours)\n          .add(\"minutes\", minutes);\n      };\n\n      date.viewFormatter = (val) => {\n        if (!val) return;\n\n        return date.modelParser(val).format(date.dateFormat);\n      };\n\n      date.viewParser = (val) => {\n        if (!val) return;\n\n        let match = val.match(/^(\\d{1,2}):?(\\d{1,2})? (a|p)/);\n        if (!match) return;\n\n        let hours = _.add(\n          match[1] === \"12\" ? 0 : match[1],\n          match[3] === \"a\" ? 0 : 12\n        );\n        let minutes = match[2] || \"00\";\n\n        if (minutes.length === 1) minutes += \"0\";\n\n        return _.add(_.multiply(hours, 60), minutes);\n      };\n    }\n  }\n\n  function getSelectValProp(select) {\n    let isArray = select.getSchemaType() === \"array\";\n    return (\n      select.valueProperty ||\n      ((isArray ? select.schema.items.type : select.schema.type) !== \"object\" &&\n        \"value\")\n    );\n  }\n\n  function getAllowedSelectValue(select, val, titleMap) {\n    titleMap = titleMap || select.getTitleMap();\n    let valProp = getSelectValProp(select);\n    let omitHashKey = valProp\n      ? _.identity\n      : _.partialRight(_.omit, \"$$hashKey\");\n    let findFn = valProp\n      ? _.compose(\n          _.partial(_.find, titleMap),\n          _.partial(_.set, {}, valProp),\n          omitHashKey\n        )\n      : _.compose(_.partial(_.find, titleMap), omitHashKey);\n    if (select.getSchemaType() === \"array\") {\n      if (!val || !_.isArray(val)) return;\n      return val.map(findFn).filter((x) => x !== undefined);\n    } else {\n      return findFn(val);\n    }\n  }\n\n  function processSchedule(field) {\n    field.startEmpty = true;\n    field.type = \"cn-schedule\";\n  }\n\n  function processSelect(select) {\n    const service = this;\n    const schema = select.schema;\n\n    if (select.titleMapResolve || select.titleMap) {\n      select.getTitleMap = () =>\n        select.titleMap || service.schema.data[select.titleMapResolve];\n\n      select.onInit = function (val, form, event, setter) {\n        // make sure we use correct value\n        var modelValue = service.parseExpression(form.key, service.model);\n        if (event === \"tag-init\") {\n          let newVal = getAllowedSelectValue(select, modelValue.get());\n          if (newVal !== undefined) setter(newVal);\n        }\n      };\n    }\n\n    if (select.titleMapQuery) {\n      const queryParams = select.titleMapQuery.params;\n      const paramsKeys = _.keys(queryParams);\n      select.showClearAll = true;\n      select.showClearCache = !!select.titleMapQuery.params.refreshData;\n      select.singleQuery = select.minLookup === 0;\n      select.titleQuery = (q, { refreshData }) => {\n        const params = _(paramsKeys).reduce((acc, key) => {\n          if (key === \"q\") {\n            acc[queryParams[key]] = q;\n          } else if (key === \"refreshData\") {\n            if (refreshData) acc[queryParams[key]] = true;\n          } else {\n            const exp = service.replaceArrayIndex(\n              queryParams[key],\n              select.arrayIndex\n            );\n            let val = null,\n              variables = exp.split(\"||\");\n            for (let exp of variables) {\n              val = service.parseExpression(exp.trim()).get();\n              if (val) {\n                break;\n              }\n            }\n            acc[key] = val;\n          }\n          return acc;\n        }, {});\n        return Api.get({\n          url: select.titleMapQuery.url,\n          params,\n        });\n      };\n\n      if (!_.isNumber(select.minLookup))\n        select.minLookup = paramsKeys.length ? 3 : 0;\n      if (!_.has(select, \"skipFiltering\"))\n        select.skipFiltering = !!select.minLookup;\n\n      select.onInit = function (val, form, event, setter) {\n        if (event === \"tag-init\") {\n          setter(val);\n        }\n      };\n    }\n\n    if (!_.isNumber(select.minLookup)) select.minLookup = 0;\n\n    if (schema.items) {\n      var defaults = [];\n      _.each(schema.items.properties, function (schema, key) {\n        if (angular.isDefined(schema.default)) {\n          defaults.push({\n            key: key,\n            default: schema.default,\n          });\n        }\n      });\n      if (defaults.length) {\n        select.onAdd = function (val, form, event) {\n          if (val.value && event === \"tag-added\") {\n            _.each(defaults, function (prop) {\n              if (!val.value[prop.key]) val.value[prop.key] = prop.default;\n            });\n          }\n        };\n      }\n    }\n\n    if (select.displayFormat) {\n      select.itemFormatter = service.processTemplate(select.displayFormat);\n    }\n\n    if (!select.type.includes(\"cn-autocomplete\")) {\n      if (select.items) {\n        select.detailedList = true;\n\n        if (select.items[0].type !== \"component\") {\n          if (select.items.length > 1) {\n            _.each(select.items, (i) => (i.destroyStrategy = \"retain\"));\n            select.items = [\n              {\n                type: \"component\",\n                items: select.items,\n              },\n            ];\n          }\n\n          service.processFieldset(select);\n        }\n\n        select.type = \"cn-autocomplete-detailed\";\n        select.destroyStrategy = \"retain\";\n      } else {\n        if (!select.selectionStyle) {\n          select.selectionStyle =\n            select.key === \"tags\"\n              ? \"tags\"\n              : select.getSchemaType() === \"array\" &&\n                select.schema.maxItems !== 1\n              ? \"list\"\n              : \"select\";\n        }\n        select.type = \"cn-autocomplete\";\n      }\n\n      if (select.titleMapResolve) {\n        service.scope.$on(\"cnFlexFormDiff:data\", (e, data) => {\n          if (data[select.titleMapResolve]) {\n            let modelValue = service.parseExpression(select.key, service.model);\n            let val = modelValue.get();\n            if (val !== undefined) {\n              let valid = getAllowedSelectValue(\n                select,\n                val,\n                data[select.titleMapResolve]\n              );\n              if (valid === undefined || (_.isArray(valid) && _.isEmpty(valid)))\n                modelValue.set();\n            }\n          }\n        });\n      }\n\n      service.registerHandler(\n        select.key,\n        function (val) {\n          var form =\n            service.formCtrl && service.formCtrl[service.getKey(select.key)];\n          if (form && form.$setDirty) form.$setDirty();\n        },\n        select.updateSchema\n      );\n    }\n  }\n\n  function processToggle(toggle) {\n    toggle.type = \"cn-toggle\";\n  }\n\n  function processHelp(help) {\n    help.htmlClass = \"help-block\";\n  }\n\n  function processDisplay(display) {\n    var service = this;\n    display.type = \"cn-display\";\n    display.getDisplay = service.processTemplate(display.displayFormat, true);\n  }\n\n  function processTemplate(tpl, parseScope) {\n    var service = this;\n    //var processor = /<(\\S+)[^>]*>.*<\\/\\1>/.test(tpl) ? $compile : $interpolate;\n    var processor = $interpolate;\n    return function (scope, arrayIndex) {\n      if (parseScope) {\n        if (angular.isDefined(arrayIndex)) {\n          scope = _.map(scope, function (key) {\n            return key === \"arrayIndex\" ? arrayIndex : key;\n          });\n        }\n        scope = service.parseExpression(scope, service.model).get();\n      }\n      return processor(tpl)(scope);\n    };\n  }\n\n  function processTable(table) {\n    var service = this;\n    table.type = \"cn-table\";\n    table.items.forEach(function (row) {\n      for (var i = 0; i < table.columns.length; i++) {\n        _.extend(row.items[i], table.columns[i]);\n        service.processField(row.items[i]);\n      }\n    });\n  }\n\n  function processSelectDisplay(selectDisplay) {\n    const service = this;\n    // Needed for batchform to check recursively\n    let selectField = null;\n    for (let item of selectDisplay.items) {\n      if (item.selectField) {\n        selectField = item;\n      } else if (item.items) {\n        selectField = _.find(item.items, \"selectField\");\n      }\n      if (selectField) {\n        break;\n      }\n    }\n\n    // band-aid because this is being set as an object instead of array somwhere\n    // deep in the angular or angular-schema-form nether-regions\n    const linkModel = service.parseExpression(\n      selectDisplay.link,\n      service.model\n    );\n    if (!linkModel.get()) linkModel.set([]);\n\n    _.each(selectDisplay.items, (item) => {\n      if (item.selectField === true) return;\n\n      const key = _.isArray(item.key) ? item.key : ObjectPath.parse(item.key);\n      const featureKey = _.last(key);\n\n      item.showFeature = (index) => {\n        const features = service\n          .parseExpression(`model.${selectDisplay.link}[${index}].features`)\n          .get();\n        const show = features && features.includes(featureKey);\n        return show;\n      };\n\n      const condition = `form.showFeature(arrayIndex)`;\n      item.condition = item.condition\n        ? `(${item.condition}) && ${condition}`\n        : condition;\n    });\n    // handle legacy objects that don't have values set in the selectField\n    var model = service\n      .parseExpression(service.getKey(selectDisplay.key), service.model)\n      .get();\n    var selectKey = service.getKey(selectField.key);\n    _.each(model, function (elem, i) {\n      var indexedSelectKey = service.setArrayIndex(selectKey, i);\n      var selectModel = service.parseExpression(\n        indexedSelectKey,\n        service.model\n      );\n      if (!selectModel.get()) selectModel.set([]);\n    });\n  }\n\n  function setupSchemaRefresh(refresh) {\n    const service = this;\n    service.refreshSchema = _.debounce((updateSchema) => {\n      const params = {\n        ...cnFlexFormConfig.getStateParams(service.getParamOverrides()),\n        ...service.params,\n      };\n      let diff = _.omit(\n        cnUtil.diff(service.schema.params, params, true),\n        \"updates\"\n      );\n      let keys;\n\n      if (!_.isEmpty(diff) || updateSchema) {\n        if (updateSchema) params.updateSchema = updateSchema;\n        else {\n          keys = _.keys(diff);\n\n          if (keys.length > 1) {\n            diff = _.omit(diff, _.isNull);\n            keys = _.keys(diff);\n          }\n\n          params.updateSchema = _.first(keys);\n        }\n\n        if (!params.updateSchema) {\n          diff = cnUtil.diff(\n            params,\n            _.omit(service.schema.params, [\"updateSchema\", \"updates\"])\n          );\n          keys = _.keys(diff);\n\n          params.updateSchema = _.first(keys);\n        }\n\n        refresh(params).then(function (schema) {\n          service.processUpdatedSchema(schema);\n        });\n      }\n    }, 100);\n\n    service.refreshData = _.debounce(function () {\n      refresh(\n        _.extend(service.schema.params, { updateSchema: \"refreshData\" })\n      ).then(function (schema) {\n        service.processUpdatedSchema(schema);\n      });\n    }, 100);\n\n    service.events.push(\n      service.scope.$on(\"ffRefreshData\", service.refreshData)\n    );\n  }\n\n  function processUpdatedSchema(schema) {\n    var service = this;\n    if (schema.diff) {\n      service.incrementUpdates();\n      service.schema.params = schema.params;\n      if (cnFlexFormConfig.onProcessDiff) {\n        cnFlexFormConfig.onProcessDiff(schema);\n      }\n\n      if (Object.keys(schema.diff.data).length > 0) {\n        service.scope.$broadcast(\"cnFlexFormDiff:data\", schema.diff.data);\n        _.each(schema.diff.data, (data, prop) => {\n          if (\n            data &&\n            data.data &&\n            !_.isEmpty(service.schema.data[prop].data) &&\n            !data.reset\n          ) {\n            data.data = service.schema.data[prop].data.concat(data.data);\n          }\n          service.schema.data[prop] = data;\n          if (service.resolveRegister[prop]) {\n            _.each(service.resolveRegister[prop], (registers) => {\n              registers.forEach((register) => {\n                service.handleResolve(\n                  register.field,\n                  register.prop,\n                  register.exp\n                );\n              });\n            });\n          }\n        });\n      }\n\n      const keys = [];\n\n      if (Object.keys(schema.diff.schema).length > 0) {\n        service.scope.$broadcast(\"cnFlexFormDiff:schema\", schema.diff.schema);\n        _.each(schema.diff.schema, function (schema, key) {\n          reprocessSchema(schema, key, keys);\n          const curKeys = _.filter(keys, (k) => _.startsWith(k, key));\n          _.each(curKeys, (key) => {\n            const forms = _.compact([\n              service.getFromFormCache(key),\n              ...(service.getArrayCopies(key) || []),\n            ]);\n            _.each(forms, (form) => {\n              const prevSchema = form.schema;\n              const newSchema = service.getSchema(key, {\n                [schema.key]: schema,\n              });\n              if (prevSchema.readonly && !newSchema.readonly)\n                form.readonly = false;\n            });\n          });\n          service.schema.schema.properties[key] = schema;\n        });\n      }\n\n      if (Object.keys(schema.diff.form) > 0) {\n        service.scope.$broadcast(\"cnFlexFormDiff:form\", schema.diff.form);\n        _.each(schema.diff.form, (form, key) => {\n          if (!keys.includes(key)) {\n            keys.push(key);\n          }\n\n          // don't want to override key when extending cached objects\n          //var key = form.key;\n          //delete form.key;\n\n          _.each(service.getFormsToProcess(key), (copy) => {\n            copy && service.reprocessField(copy, form);\n          });\n        });\n\n        const el = document.getElementsByClassName(\"cn-form\")[0];\n        const oldScroll = el ? el.scrollTop : 0;\n\n        service.scope.$broadcast(\"schemaFormRedraw\");\n\n        setTimeout(() => {\n          if (el) {\n            el.scrollTop = oldScroll;\n          }\n        }, 1000);\n      }\n\n      if (keys.length) {\n        _.each(keys, (key) => {\n          _.each(\n            service.getFormsToProcess(key),\n            (copy) => copy && service.processField(copy)\n          );\n        });\n      }\n\n      service.broadcastErrors();\n    } else {\n      service.resetUpdates();\n      service.updateSchema(schema);\n    }\n  }\n\n  function getFormsToProcess(key) {\n    const service = this;\n    const [, arrayIndex] = key.match(/\\[(\\d)+]/) || [];\n    const copies = service.getArrayCopies(key.replace(/\\[\\d+]/g, \"[]\"));\n    if (_.isUndefined(arrayIndex)) {\n      const cached = service.getFromFormCache(key);\n      return [cached, ...copies];\n    }\n    return [copies[arrayIndex]];\n  }\n\n  function reprocessField(current, update, isChild) {\n    const service = this;\n    const key = service.getKey(current.key);\n\n    // other logic in the service will add conition = 'true' to force\n    // condition to eval true, so we set the update condition to 'true'\n    // before comparing\n    if (!update.condition && current.condition) update.condition = \"true\";\n    let redraw = !isChild && current.condition !== update.condition;\n\n    _.extend(current, _.omit(update, \"items\", \"key\"));\n\n    current._ogKeys.forEach((prop) => {\n      if (!update[prop]) {\n        delete current[prop];\n      }\n    });\n    current._ogKeys = getOgKeys(update);\n\n    //service.deregisterHandlers(key);\n\n    service.scope.$broadcast(\"cnFlexFormReprocessField\", key);\n\n    // why do we redraw? If we're doing it to show error message\n    // that has been addressed from the angular-schema-form library\n    // if there's another issue, try triggering the specific action required\n    // instead of redrawing the whole form\n    if (redraw && current.redraw) {\n      console.log(\"TODO: see if this can be removed\");\n      current.redraw();\n    }\n  }\n\n  function reprocessSchema(schema, key, keys) {\n    keys.push(key);\n    if (schema.properties) {\n      _.each(schema.properties, function (schema, subKey) {\n        reprocessSchema(schema, key + \".\" + subKey, keys);\n      });\n    }\n    if (schema.items && schema.items.properties) {\n      _.each(schema.properties, function (schema, subKey) {\n        reprocessSchema(schema, key + \"[].\" + subKey, keys);\n      });\n    }\n  }\n\n  function getDotKey(key) {\n    return (_.isString(key) ? ObjectPath.parse(key) : key).join(\".\");\n  }\n\n  function buildError(field) {\n    return {\n      key: getDotKey(field.key),\n      message: field.error,\n    };\n  }\n\n  function broadcastErrors() {\n    var service = this;\n    $timeout(function () {\n      if (_.get(service, \"errors\")) {\n        service.errors.forEach(function (error) {\n          service.scope.$broadcast(\n            \"schemaForm.error.\" + error.key,\n            \"serverValidation\",\n            error.message\n          );\n        });\n      }\n    }, 1);\n  }\n\n  function replaceArrayIndex(resolve, key) {\n    while (resolve.includes(\"arrayIndex\")) {\n      if (_.isNumber(key)) return resolve.replace(/arrayIndex/g, key);\n      const arrayIndexKey = /([^.[]*)\\[arrayIndex\\]/.exec(resolve);\n      const re = new RegExp(arrayIndexKey[1] + \"\\\\[(-?\\\\d+)\\\\]\");\n      const index = re.exec(key);\n      if (!index) return resolve;\n      resolve = resolve.replace(\n        new RegExp(arrayIndexKey[0].replace(/(\\[|\\])/g, \"\\\\$1\"), \"g\"),\n        index[0]\n      );\n    }\n    return resolve;\n  }\n\n  function getArrayIndex(key) {\n    if (_.isObject(key)) {\n      return _.find(key.key, function (key) {\n        return _.isNumber(key);\n      });\n    }\n    return /\\[(\\d*)\\]/.exec(key)[1];\n  }\n\n  function setArrayIndex(key, index, asArray) {\n    const service = this;\n    let keyCopy;\n    if (!_.isArray(index)) {\n      index = [index];\n    }\n    if (_.isString(key)) {\n      keyCopy = ObjectPath.parse(key);\n    } else {\n      keyCopy = _.clone(key);\n    }\n    while (index.length && keyCopy.indexOf(\"\") > -1) {\n      let indexOfIndex = keyCopy.indexOf(\"\");\n      keyCopy[indexOfIndex] = index.shift();\n    }\n    if (asArray) {\n      return keyCopy;\n    } else {\n      return service.getKey(keyCopy);\n    }\n  }\n\n  function cleanup() {\n    var service = this;\n    _.each(service.events, function (listener) {\n      listener();\n    });\n  }\n\n  function resetUpdates() {\n    const service = this;\n    service.updates = 0;\n    service.params.updates = service.updates;\n  }\n\n  function incrementUpdates() {\n    const service = this;\n    ++service.updates;\n    service.params.updates = service.updates;\n  }\n}\n\n//angular\n//.module('cn.flex-form')\n//.provider('cnFlexFormService', cnFlexFormServiceProvider);\n\nexport default cnFlexFormServiceProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form.service.js","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 6\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"objectpath\"\n// module id = 7\n// module chunks = 0","const modalMap = {};\nconst promiseMap = {};\n\nfunction getPromises(state) {\n  if(promiseMap[state]) return promiseMap[state];\n\n  const promise = {};\n  promiseMap[state] = promise;\n  return promise;\n}\n\nfunction getPromise(state, id, $q) {\n  const promises = getPromises(state);\n  if(promises[id]) return promises[id];\n\n  const promise = $q.defer();\n  promises[id] = promise;\n  return promise;\n}\n\nfunction cnFlexFormModalLoaderServiceProvider() {\n\n  return {\n    addMapping,\n    $get: cnFlexFormModalLoaderService\n  };\n\n  ////////////\n\n  function addMapping(state, def) {\n    def.resolve = { parent };\n    modalMap[state] = def;\n  }\n\n  function parent($stateParams, $q) {\n    'ngInject';\n\n    return (\n      getPromise($stateParams.modal, $stateParams.modalId, $q)\n      .promise\n      .then(({ parent }) => parent)\n    );\n  }\n}\n\nfunction cnFlexFormModalLoaderService($stateParams, $q) {\n  'ngInject';\n\n  return {\n    getMapping,\n    resolveMapping,\n    removeMapping\n  };\n\n  /////////////\n\n  function resolveMapping(state, id, parent, options = {}) {\n    const { scope } = options;\n    if(scope) {\n      scope.options = scope.options || {};\n      scope.options.destroyStrategy = 'retain';\n      modalMap[state].scope = scope;\n    }\n    const d = getPromise(state, id, $q);\n    d.resolve({ parent, options });\n    return d.promise;\n  }\n\n  function getMapping(state) {\n    const d = $q.defer();\n    getPromise($stateParams.modal, $stateParams.modalId, $q)\n      .promise\n      .then(({ parent, options }) => {\n        d.resolve({ state: modalMap[state], options });\n        return parent;\n      });\n    return d.promise;\n  }\n\n  // Holding on to scope references creates memory leaks\n  function removeMapping(state) {\n    modalMap[state] = null;\n    promiseMap[state] = null;\n  }\n}\n\nexport default cnFlexFormModalLoaderServiceProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-modal-loader.service.js","function FlexFormModalLoader(FlexFormModal, $state, $rootScope, $stateParams, $scope) {\n  'ngInject';\n\n  function FFModalLoaderTag() {}\n  $scope.__tag = FFModalLoaderTag();\n\n  const vm = this;\n\n  activate();\n\n  //////////\n\n  function activate() {\n    FlexFormModal\n      .open(vm)\n      .then(({ modal, options: { onDismiss, onAfterDismiss } }) => {\n        vm.modal = modal;\n        vm.modal.result.finally(goBack);\n\n        if(onDismiss) vm.modal.result.catch(() => onDismiss($stateParams.restParams));\n        vm.dismissEvent = $rootScope.$on('$stateChangeStart', dismissModal);\n      });\n  }\n\n  function goBack() {\n    if(!$state.transition) {\n      $state.go('^');\n    }\n  }\n\n  function dismissModal() {\n    // unbind event\n    vm.dismissEvent();\n    vm.modal.opened.then(() =>\n        vm.modal.dismiss()\n    );\n  }\n}\n\nfunction FlexFormModal(cnFlexFormModalLoaderService, $uibModal, $stateParams) {\n  'ngInject';\n\n  return { open };\n\n  ////////////\n\n  function open() {\n    return (\n      cnFlexFormModalLoaderService\n        .getMapping($stateParams.modal)\n        .then(({ state, options }) => ({\n          modal: $uibModal.open(state),\n          options\n        }))\n    );\n  }\n\n}\n\nexport { FlexFormModalLoader, FlexFormModal };\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-modal-loader.js","function cnFlexForm() {\n  return {\n    restrict: 'E',\n    template: `\n      <div ng-if=\"vm.showForm()\">\n        <!-- we process defaults ourselves, hence setSchemaDefaults: false -->\n        <ng-form\n          class=\"clearfix\"\n          name=\"{{vm.formName}}\"\n          sf-options=\"{ setSchemaDefaults: false }\"\n          sf-schema=\"vm.config.schema.schema\"\n          sf-form=\"vm.form\"\n          sf-model=\"vm.model\">\n        </ng-form>\n        <!-- debug panel to display model -->\n        <section ng-if=\"vm.debug\">\n          <json-explorer json-data=\"vm.model || '...model not loaded yet'\"/>\n        </section>\n      </div>\n    `,\n    scope: {\n      config: '=ffConfig',\n      model: '=ffModel',\n      formIndex: '=ffFormIndex',\n      formName: '=ffFormName',\n      delayForm: '=ffDelayForm',\n      cleanupEvent: '=ffCleanupEvent'\n    },\n    controller: FlexForm,\n    controllerAs: 'vm',\n    bindToController: true\n  };\n}\n\nfunction FlexForm(cnFlexFormService, $scope, $location) {\n  'ngInject';\n\n  function cnFlexFormTag() {}\n  $scope.__tag = new cnFlexFormTag();\n\n  var vm = this;\n  vm.service = undefined;\n  vm.events = [];\n\n  vm.activate = activate;\n  vm.cleanup = cleanup;\n  vm.process = process;\n  vm.showForm = showForm;\n\n  vm.events.push($scope.$watch(() => vm.config.schema, vm.process));\n\n  vm.activate();\n\n  $scope.$on(vm.cleanupEvent || '$destroy', vm.cleanup);\n\n  //////////\n\n  function activate() {\n    if(angular.isNumber(vm.formIndex)) {\n      vm.form = vm.config.schema.forms[vm.formIndex].form;\n    }\n    else {\n      vm.form = vm.config.schema.form;\n    }\n\n    // debug\n    if($location.search().debug) {\n      vm.debug = true;\n    }\n  }\n\n  function process(cur, prev) {\n    if(vm.form) {\n      if(!vm.service) {\n        vm.service = cnFlexFormService(vm.config.schema, vm.model, {\n          getScope: vm.config.getScope || (() => $scope),\n          formCtrl: vm.config.formCtrl,\n          getSchema: vm.config.getSchema,\n          updateSchema: updateSchema\n        });\n      }\n      else {\n        vm.service.compile(vm.config.schema, vm.model, vm.config);\n      }\n    }\n  }\n\n  function showForm() {\n    return !vm.delayForm && vm.service && vm.service.isCompiled();\n  }\n\n  function updateSchema(schema) {\n    vm.config.schema = schema;\n    vm.activate();\n  }\n\n  function cleanup() {\n    _.each(vm.events, function(listener) {\n      listener();\n    });\n\n    cnFlexFormService.destroyService(vm.service);\n  }\n\n}\n\nexport default cnFlexForm;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form.directive.js","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 11\n// module chunks = 0","function cnFlexFormHeader() {\n  return {\n    restrict: 'E',\n    scope: {\n      config: '=ffHeaderConfig',\n      submit: '&ffSubmit',\n      loadOffscreen: '&ffLoadOffscreen'\n    },\n    controller: FlexFormHeader,\n    bindToController: true,\n    controllerAs: 'vm',\n    template: `\n        <div class=\"col-md-6\">\n          <h5 ng-if=\"vm.title.lead\">{{::vm.title.lead}}</h5>\n          <h1>\n            <i ng-show=\"vm.title.icon\" class=\"{{vm.title.icon}}\"/>\n            {{vm.title.main}}\n          </h1>\n          <h5 ng-if=\"vm.title.sub\">{{::vm.title.sub}}</h5>\n        </div>\n        <div class=\"{{vm.buttonContainerClass || 'page-action-btns'}}\">\n          <div class=\"btn-options\"\n               ng-mouseover=\"vm.loadOffscreen()\">\n            <a class=\"btn btn-{{vm.returnStyle ? vm.returnStyle : 'default-dark'\"\n               ng-if=\"vm.returnState\"\n               ui-sref=\"{{vm.returnState}}\">\n              {{vm.returnText || 'Cancel'}}\n            </a>\n            <a class=\"btn btn-{{vm.closeButton.style ? vm.closeButton.style : 'default-dark'}}\"\n               ng-if=\"vm.closeButton\"\n               ng-click=\"vm.closeButton.handler()\">\n               Cancel\n            </a>\n            <span ng-repeat=\"button in vm.actions\">\n              <span ng-class=\"{'btn-group': button.options}\">\n                <a class=\"btn {{button.style ? 'btn-'+button.style : ($index === vm.actions.length - 1 ? 'btn-primary' : 'btn-default-dark')}}\"\n                   ng-disabled=\"vm.isDisabled(button)\"\n                   ng-click=\"vm.isDisabled(button) || vm.submit({handler: button.handler})\"\n                   uib-tooltip=\"{{button.helptext}}\"\n                   uib-tooltip-placement=\"bottom\"\n                   ng-bind-html=\"button.text || 'Save'\">\n                </a>\n                <a class=\"btn {{button.style ? 'btn-'+button.style : ($index === vm.actions.length - 1 ? 'btn-primary' : 'btn-default-dark')}} dropdown-toggle\"\n                        ng-disabled=\"vm.isDisabled(button)\"\n                        ng-show=\"button.options\"\n                        data-toggle=\"dropdown\">\n                  <span class=\"caret\"></span>\n                </a>\n                <ul class=\"dropdown-menu\" ng-if=\"button.options\">\n                  <li ng-repeat=\"option in button.options\"\n                      ng-disabled=\"vm.isDisabled(option)\">\n                    <a ng-click=\"vm.isDisabled(option) || vm.submit({handler: option.handler})\"\n                       ng-bind-html=\"option.text\">\n                    </a>\n                  </li>\n                </ul>\n              </span>\n            </span>\n          </div>\n          <p class=\"data-updated-at text-right\"\n             id=\"data-updated-at\"\n             ng-hide=\"vm.config.noData\">\n            <a ng-click=\"vm.updateData()\">Update Data</a>\n          </p>\n        </div>`\n  };\n}\n\nfunction FlexFormHeader($scope) {\n  'ngInject';\n\n  function ffHeaderTag() {}\n  $scope.__tag = new ffHeaderTag();\n\n  const vm = this;\n\n  vm.updateData = updateData;\n  vm.isDisabled = isDisabled;\n\n  //activate();\n  //$scope.$on('$destroy', cleanup);\n  $scope.$watch('vm.config.title', initTitle, true);\n  $scope.$watch('vm.config.actionConfig', initActionConfig, true);\n\n  ///////////\n\n  function initTitle() {\n    ({ title: vm.title } = vm.config);\n  }\n\n  function initActionConfig() {\n    ({\n      returnState: vm.returnState,\n      returnStyle: vm.returnStyle,\n      returnText: vm.returnText,\n      closeButton: vm.closeButton,\n      actions: vm.actions\n    } = vm.config.actionConfig || {});\n  }\n\n  function updateData() {\n    // $scope.$emit('ffRefreshData');\n    // this component will often be siblings to the flex forms one,\n    // so need to broadcast from shared parent...yes it's ugly\n    $scope.$parent.$parent.$broadcast('ffRefreshData');\n  }\n\n  function isDisabled(btnConfig) {\n    if(vm.config.isDisabled) return vm.config.isDisabled(btnConfig);\n    return false;\n  }\n}\n\nexport default cnFlexFormHeader;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-header.directive.js","function ffValidate() {\n  return {\n    restrict: 'A',\n    scope: { form: '=ffValidate' },\n    require: 'ngModel',\n    link: link\n  };\n}\n\nfunction link($scope, elem, attrs, ngModel) {\n  function ffValidateTag() {}\n  $scope.__tag = new ffValidateTag();\n\n  if($scope.form && $scope.form.required) {\n    $scope.$watch(function() { return ngModel.$viewValue; }, function(value) {\n      // override schemaForm validation\n      ngModel.$setValidity('schemaForm', true);\n      ngModel.$setValidity('tv4-302', value);\n    });\n  }\n}\n\nexport default ffValidate;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-validate.directive.js"],"sourceRoot":""}