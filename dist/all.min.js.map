{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///all.min.js","webpack:///webpack/bootstrap 55f0361318dfd494b69e","webpack:///./src/_cn-flex-form.module.js","webpack:///./src/cn-flex-form-config.service.js","webpack:///./src/cn-flex-form-types.service.js","webpack:///./src/cn-flex-form.routes.js","webpack:///./src/schema-form-extensions.js","webpack:///./src/cn-flex-form.service.js","webpack:///external \"lodash\"","webpack:///external \"objectpath\"","webpack:///./src/cn-flex-form-modal-loader.service.js","webpack:///./src/cn-flex-form-modal-loader.js","webpack:///./src/cn-flex-form.directive.js","webpack:///./~/process/browser.js","webpack:///./src/cn-flex-form-header.directive.js","webpack:///./src/cn-flex-form-validate.directive.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_6__","__WEBPACK_EXTERNAL_MODULE_7__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_cnFlexFormConfig","_cnFlexFormConfig2","_cnFlexFormTypes","_cnFlexFormTypes2","_cnFlexForm","_schemaFormExtensions","_cnFlexForm2","_cnFlexForm3","_cnFlexFormModalLoader","_cnFlexFormModalLoader2","_cnFlexFormModalLoader3","_cnFlexForm4","_cnFlexForm5","_cnFlexFormHeader","_cnFlexFormHeader2","_cnFlexFormValidate","_cnFlexFormValidate2","console","log","angular","provider","cnFlexFormRoutesProvider","config","cnFlexFormRoutes","schemaFormConfig","run","addTemplates","FlexFormModal","controller","FlexFormModalLoader","directive","name","cnFlexFormConfigProvider","addIgnoreParam","param","ignoreParams","push","cnFlexFormConfig","$stateParams","getStateParams","_","chain","omit","v","isUndefined","isNull","$inject","$get","cnFlexFormTypesProvider","registerFieldType","fieldType","fieldTypeRegister","unshift","cnFlexFormTypes","getFieldType","field","i","l","length","condition","type","schema","includes","titleMap","titleMapResolve","titleMapQuery","format","$stateProvider","addStates","_ref","permissions","shared","controllerAs","state","_extends","url","templateUrl","assign","target","arguments","source","key","prototype","hasOwnProperty","cnFlexFormServiceProvider","tv4","addFormat","data","isString","test","extensions","each","extension","registerField","$templateCache","put","sharedAutocompleteTpl","_defineProperty","enumerable","configurable","writable","schemaFormDecoratorsProvider","handler","fieldTypeHandlers","addMapping","createDirective","CNFlexFormService","Api","$parse","sfPath","$interpolate","$rootScope","$timeout","cnUtil","CNFlexFormConstructor","model","service","services","compile","CNFlexForm","debug","window","arrayCopies","arrayListeners","dataCache","defaults","errors","events","formCache","scopeCache","listeners","resolveRegister","updates","params","isCompiled","setupConfig","forms","form","processField","bind","initModelWatch","initArrayCopyWatch","broadcastErrors","setValue","compiled","formCtrl","updateSchema","getSchema","getSchemaForm","setupSchemaRefresh","processSchema","getSchemaType","isArray","first","processDefault","curDefault","getKey","parseExpression","modelValue","get","isTrulyEmpty","has","equals","set","copy","validationMessage","processFieldset","fieldset","items","forEach","collapsible","toggleCollapse","collapsed","render","processFieldType","isFunction","_ogKeys","without","keys","addToFormCache","description","readonly","showClearAll","processFieldProps","find","reject","$broadcast","error","buildError","isEmpty","ngModelOptions","allowInvalid","fieldPropHandlers","prop","reduce","total","next","depth","ObjectPath","parse","properties","shift","getDefault","getFromFormCache","isDefined","getWatchables","exp","watchables","nested","matchNestedExpression","replaceStr","replace","concat","processResolve","resolve","dataProp","fieldProp","replaceArrayIndex","handleResolve","watchable","resolveType","match","registerResolve","registerHandler","indexOf","cachedField","cursor","loadMore","refreshSchema","_ref2","fieldKey","register","processConditional","conditionals","val","prev","parseCondition","scope","getFromScopeCache","map","path","processFieldWatch","watch","resolution","adjustment","cur","date","trim","math","operator","+","-","*","/","adjuster","trigger","curCondition","updatePath","fromPath","update","from","moment","add","toDate","result","floor","ceil","round","initialize","startsWith","_condition$match","_condition$match2","_slicedToArray","fn","list","predicateParams","predicateBody","generatePredicate","body","_len","args","Array","_key","split","acc","runHandler","isObject","arrMatch","registerArrayHandlers","defaultValue","handlers","arrKey","onArray","reorder","lastKey","deregisterHandlers","arrVal","deregisterArrayHandlers","item","watching","modelWatch","$watch","onModelWatch","initSchemaParams","firstUpdate","cleanModel","prevParams","listener","isInitArray","$on","event","index","parseInt","getArrayCopy","addArrayCopy","$emit","addToScopeCache","unindexedKey","copies","getArrayCopiesFor","splice","link","getArrayCopies","pluck","getArrayScopes","keyStart","filter","warn","addToDataCache","getFromDataCache","resolveNestedExpressions","parseFloat","resolved","start","getAssignable","progress","fullPath","slice","assignable","processArray","array","sortOptions","e","ui","processSection","section","processComponent","component","htmlClass","cols","processCurrency","currencyFormat","currency-dollars","currency-microcents","currency","processPercentage","processReusable","view","processMediaUpload","processCsvUpload","processRadios","processRadiobuttons","radios","fullWidth","btnClass","divide","processDate","maxView","iconClass","modelFormatter","multiply","hours","minutes","modelParser","d","startOf","viewFormatter","dateFormat","viewParser","getSelectValProp","select","valueProperty","getAllowedSelectValue","getTitleMap","valProp","mapVal","x","undefined","processSelect","onInit","setter","newVal","q","titleQuery","minLookup","onAdd","detailedList","selectionStyle","maxItems","valid","displayFormat","itemFormatter","processTemplate","$setDirty","processToggle","toggle","processHelp","help","processDisplay","display","getDisplay","tpl","parseScope","processor","arrayIndex","processTable","table","row","columns","extend","processSelectDisplay","selectDisplay","selectField","setupArraySelectDisplay","setupSelectDisplay","getArrayIndex","selectKey","splitKey","indexedSelectKey","setArrayIndex","selectValue","formCopies","elem","indexedKey","splitIndexedKey","selectModel","itemValue","count","keyMap","once","resetCount","refresh","debounce","diff","then","processUpdatedSchema","refreshData","reset","registers","reprocessSchema","cached","reprocessField","current","isChild","redraw","subKey","message","arrayIndexKey","exec","re","RegExp","isNumber","asArray","keyCopy","clone","indexOfIndex","cleanup","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Symbol","iterator","done","err","TypeError","cn-radios","cn-radiobuttons","cn-autocomplete","cn-datetimepicker","cn-display","cn-currency","cn-percentage","cn-mediaupload","cn-csvupload","cn-reusable","cn-toggle","cn-table","tabarray","getPromises","promiseMap","promise","getPromise","$q","promises","defer","cnFlexFormModalLoaderServiceProvider","def","parent","modalMap","modal","modalId","cnFlexFormModalLoaderService","resolveMapping","options","getMapping","$state","activate","open","vm","onDismiss","finally","goBack","catch","restParams","dismissEvent","dismissModal","transition","go","dismiss","$uibModal","process","cnFlexForm","restrict","template","formIndex","formName","delayForm","cleanupEvent","FlexForm","bindToController","cnFlexFormService","$scope","$location","search","showForm","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","setTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","timeout","len","Item","noop","nextTick","apply","title","browser","env","argv","version","versions","on","addListener","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","dir","umask","cnFlexFormHeader","submit","loadOffscreen","FlexFormHeader","updateData","isDisabled","btnConfig","ffValidate","attrs","ngModel","required","$viewValue","$setValidity"],"mappings":"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","file":"all.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cn-flex-form\", [\"lodash\", \"objectpath\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cn-flex-form\"] = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse\n\t\troot[\"cn-flex-form\"] = factory(root[\"lodash\"], root[\"objectpath\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cn-flex-form\", [\"lodash\", \"objectpath\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cn-flex-form\"] = factory(require(\"lodash\"), require(\"objectpath\"));\n\telse\n\t\troot[\"cn-flex-form\"] = factory(root[\"lodash\"], root[\"objectpath\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _cnFlexFormConfig = __webpack_require__(1);\n\t\n\tvar _cnFlexFormConfig2 = _interopRequireDefault(_cnFlexFormConfig);\n\t\n\tvar _cnFlexFormTypes = __webpack_require__(2);\n\t\n\tvar _cnFlexFormTypes2 = _interopRequireDefault(_cnFlexFormTypes);\n\t\n\tvar _cnFlexForm = __webpack_require__(3);\n\t\n\tvar _schemaFormExtensions = __webpack_require__(4);\n\t\n\tvar _cnFlexForm2 = __webpack_require__(5);\n\t\n\tvar _cnFlexForm3 = _interopRequireDefault(_cnFlexForm2);\n\t\n\tvar _cnFlexFormModalLoader = __webpack_require__(8);\n\t\n\tvar _cnFlexFormModalLoader2 = _interopRequireDefault(_cnFlexFormModalLoader);\n\t\n\tvar _cnFlexFormModalLoader3 = __webpack_require__(9);\n\t\n\tvar _cnFlexForm4 = __webpack_require__(10);\n\t\n\tvar _cnFlexForm5 = _interopRequireDefault(_cnFlexForm4);\n\t\n\tvar _cnFlexFormHeader = __webpack_require__(12);\n\t\n\tvar _cnFlexFormHeader2 = _interopRequireDefault(_cnFlexFormHeader);\n\t\n\tvar _cnFlexFormValidate = __webpack_require__(13);\n\t\n\tvar _cnFlexFormValidate2 = _interopRequireDefault(_cnFlexFormValidate);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tconsole.log(_cnFlexForm3.default);\n\t\n\texports.default = angular.module('cn.flex-form', ['ui.router', 'schemaForm', 'ui.bootstrap.datetimepicker', 'cnTagsInput',\n\t//'ngJsonExplorer',\n\t'cn.util']).provider('cnFlexFormConfig', _cnFlexFormConfig2.default).provider('cnFlexFormTypes', _cnFlexFormTypes2.default).provider('cnFlexFormRoutes', _cnFlexForm.cnFlexFormRoutesProvider).config(_cnFlexForm.cnFlexFormRoutes).config(_schemaFormExtensions.schemaFormConfig).run(_schemaFormExtensions.addTemplates).provider('cnFlexFormService', _cnFlexForm3.default).provider('cnFlexFormModalLoaderService', _cnFlexFormModalLoader2.default).factory('FlexFormModal', _cnFlexFormModalLoader3.FlexFormModal).controller('FlexFormModalLoader', _cnFlexFormModalLoader3.FlexFormModalLoader).directive('cnFlexForm', _cnFlexForm5.default).directive('cnFlexFormHeader', _cnFlexFormHeader2.default).directive('ffValidate', _cnFlexFormValidate2.default).name;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexFormConfigProvider() {\n\t\n\t  cnFlexFormConfig.$inject = [\"$stateParams\"];\n\t  var ignoreParams = ['page', 'debug', 'sandbox', 'modal', 'modalId'];\n\t\n\t  return {\n\t    addIgnoreParam: addIgnoreParam,\n\t    $get: cnFlexFormConfig\n\t  };\n\t\n\t  ////////\n\t\n\t  function addIgnoreParam(param) {\n\t    ignoreParams.push(param);\n\t  }\n\t\n\t  function cnFlexFormConfig($stateParams) {\n\t    'ngInject';\n\t\n\t    return {\n\t      getStateParams: getStateParams,\n\t      ignoreParams: ignoreParams\n\t    };\n\t\n\t    ////////\n\t\n\t    function getStateParams() {\n\t      return _.chain($stateParams).omit(ignoreParams).omit(function (v) {\n\t        return _.isUndefined(v) || _.isNull(v);\n\t      }).value();\n\t    }\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormConfig', cnFlexFormConfigProvider);\n\t\n\texports.default = cnFlexFormConfigProvider;\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexFormTypesProvider() {\n\t\n\t  var fieldTypeRegister = [{\n\t    condition: function condition(field) {\n\t      return field.type === 'hidden';\n\t    },\n\t    type: 'hidden'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('radios');\n\t    },\n\t    type: 'cn-radios'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('radiobuttons');\n\t    },\n\t    type: 'cn-radiobuttons'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('autocomplete') || field.titleMap || field.titleMapResolve || field.titleMapQuery;\n\t    },\n\t    type: 'cn-autocomplete'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'cn-datetimepicker' || field.type === 'datetime-local' || field.type === 'time-minutes';\n\t    },\n\t    type: 'cn-datetimepicker'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'help';\n\t    },\n\t    type: 'help'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type.includes('display');\n\t    },\n\t    type: 'cn-display'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.schema && field.schema.format && field.schema.format.includes('currency');\n\t    },\n\t    type: 'cn-currency'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.schema && field.schema.format === 'percentage';\n\t    },\n\t    type: 'cn-percentage'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'toggle' || field.type === 'boolean';\n\t    },\n\t    type: 'cn-toggle'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'mediaupload';\n\t    },\n\t    type: 'cn-mediaupload'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'csvupload';\n\t    },\n\t    type: 'cn-csvupload'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'reusable';\n\t    },\n\t    type: 'cn-reusable'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'table';\n\t    },\n\t    type: 'cn-table'\n\t  }, {\n\t    condition: function condition(field) {\n\t      return field.type === 'array';\n\t    },\n\t    type: 'array'\n\t  }];\n\t\n\t  return {\n\t    registerFieldType: registerFieldType,\n\t    $get: cnFlexFormTypes\n\t  };\n\t\n\t  ////////\n\t\n\t  function registerFieldType(fieldType) {\n\t    fieldTypeRegister.unshift(fieldType);\n\t  }\n\t\n\t  function cnFlexFormTypes() {\n\t    return {\n\t      fieldTypeRegister: fieldTypeRegister,\n\t      getFieldType: getFieldType\n\t    };\n\t\n\t    /////////\n\t\n\t    function getFieldType(field) {\n\t      for (var i = 0, l = fieldTypeRegister.length; i < l; i++) {\n\t        if (fieldTypeRegister[i].condition(field)) {\n\t          return fieldTypeRegister[i].type;\n\t        }\n\t      }\n\t      return field.type || field.schema && field.schema.type;\n\t    }\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormTypes', cnFlexFormTypesProvider);\n\t\n\texports.default = cnFlexFormTypesProvider;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tcnFlexFormRoutesProvider.$inject = [\"$stateProvider\"];\n\tcnFlexFormRoutes.$inject = [\"$stateProvider\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\t\n\tfunction cnFlexFormRoutesProvider($stateProvider) {\n\t  'ngInject';\n\t\n\t  return {\n\t    addStates: addStates,\n\t    $get: $get\n\t  };\n\t\n\t  ////////////\n\t\n\t  function $get() {\n\t    // nothing to do here, but required\n\t  }\n\t\n\t  function addStates(_ref) {\n\t    var permissions = _ref.permissions,\n\t        name = _ref.name;\n\t\n\t    var shared = {\n\t      controller: 'FlexFormModalLoader',\n\t      controllerAs: 'vm',\n\t      permissions: permissions\n\t    };\n\t    $stateProvider.state(name + '.page.modal', _extends({\n\t      url: '/~:modal/:modalId'\n\t    }, shared)).state(name + '.page.modalParams', _extends({\n\t      url: '/~:modal/:modalId/:restParams'\n\t    }, shared));\n\t  }\n\t}\n\t\n\tfunction cnFlexFormRoutes($stateProvider) {\n\t  'ngInject';\n\t\n\t  $stateProvider.state('flex-form-sandbox', {\n\t    url: '/flex-form/sandbox',\n\t    controller: 'FlexFormSandbox',\n\t    controllerAs: 'vm',\n\t    templateUrl: 'app/components/cn-flex-form/sandbox.html'\n\t  });\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormRoutes', cnFlexFormRoutesProvider)\n\t//.config(cnFlexFormRoutes);\n\t\n\texports.cnFlexFormRoutes = cnFlexFormRoutes;\n\texports.cnFlexFormRoutesProvider = cnFlexFormRoutesProvider;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tschemaFormConfig.$inject = [\"cnFlexFormServiceProvider\"];\n\taddTemplates.$inject = [\"$templateCache\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t//angular.module('cn.flex-form')\n\t//.config(schemaFormConfig)\n\t//.run(addTemplates);\n\t\n\tfunction schemaFormConfig(cnFlexFormServiceProvider) {\n\t  'ngInject';\n\t\n\t  tv4.addFormat({\n\t    'url': function url(data) {\n\t      return _.isString(data) && !/^(https?:\\/\\/.{2}|$)/.test(data) && 'invalid url';\n\t    }\n\t  });\n\t\n\t  var extensions = ['cn-fieldset', 'cn-toggle', 'cn-datetimepicker', 'cn-autocomplete', 'cn-autocomplete-detailed', 'cn-currency', 'cn-radios', 'cn-radiobuttons', 'cn-percentage', 'cn-display', 'cn-mediaupload', 'cn-csvupload', 'cn-reusable', 'cn-table'];\n\t\n\t  _.each(extensions, function (extension) {\n\t    cnFlexFormServiceProvider.registerField({\n\t      type: extension,\n\t      templateUrl: 'app/components/cn-flex-form/forms/' + extension + '.html'\n\t    });\n\t  });\n\t}\n\t\n\tfunction addTemplates($templateCache) {\n\t  'ngInject';\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-toggle.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\n        <div class=\"clearfix\">\\n          <cn-toggle-switch\\n            class=\"pull-left\"\\n            ng-show=\"form.key\"\\n            ng-model-options=\"form.ngModelOptions\"\\n            ng-model=\"$$value$$\"\\n            sf-changed=\"form\"\\n            schema-validate=\"form\"\\n            on-value=\"form.onValue\"\\n            off-value=\"form.offValue\"\\n            read-only=\"form.readonly\"\\n            undefined-class=\"form.undefinedClass\"/>\\n          <span ng-show=\"form.onText && form.offText\">\\n            {{$$value$$ === form.onValue ? form.onText : form.offText}}\\n          </span>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-datetimepicker.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               for=\"{{form.key.join(\\'.\\')}}\"\\n               ng-show=\"showTitle()\">{{form.title}}</label>\\n        <cn-datetimepicker\\n          ng-show=\"form.key\"\\n          ng-model=\"$$value$$\"\\n          ng-model-options=\"form.ngModelOptions\"\\n          is-disabled=\"form.readonly\"\\n          sf-changed=\"form\"\\n          schema-validate=\"form\"\\n          input-id=\"{{form.key.join(\\'.\\')}}\"\\n          min-date=\"form.minDate\"\\n          max-date=\"form.maxDate\"\\n          max-view=\"{{form.maxView}}\"\\n          cn-date-required=\"form.required\"\\n          placeholder=\"{{form.placeholder}}\"\\n          model-type=\"{{form.schema.type}}\"\\n          model-formatter=\"form.modelFormatter\"\\n          model-parser=\"form.modelParser\"\\n          view-formatter=\"form.viewFormatter\"\\n          view-parser=\"form.viewParser\"\\n          format-string={{form.dateFormat}}\\n          icon-class={{form.iconClass}}>\\n        </cn-datetimepicker>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  var sharedAutocompleteTpl = '\\n        <tags-input\\n          ng-show=\"form.key\"\\n          ng-model=\"$$value$$\"\\n          ng-model-options=\"form.ngModelOptions\"\\n          ng-disabled=\"form.readonly\"\\n          sf-changed=\"form\"\\n          schema-validate=\"form\"\\n          input-id=\"{{form.key.join(\\'.\\')}}\"\\n          display-property=\"{{form.displayProperty || \\'name\\'}}\"\\n          value-property=\"{{form.valueProperty}}\"\\n          placeholder=\"{{form.placeholder || \\' \\'}}\"\\n          clear-on-blur=\"true\"\\n          add-on-comma=\"false\"\\n          add-from-autocomplete-only=\"{{!form.allowNew}}\"\\n          on-before-tag-added=\"form.onAdd({value: $tag}, form, $event, $prev)\"\\n          on-init=\"form.onInit($tag, form, $event, $setter)\"\\n          model-type=\"{{form.getSchemaType()}}\"\\n          array-value-type=\"{{form.schema.items.type}}\"\\n          hide-tags=\"{{form.detailedList}}\"\\n          tags-style=\"{{form.selectionStyle}}\"\\n          required=\"{{form.required}}\"\\n          min-length=\"{{form.minLength}}\"\\n          allowed-tags-pattern=\".*\"\\n          dropdown-icon=\"true\"\\n          item-formatter=\"form.itemFormatter\"\\n          min-tags=\"{{form.schema.minItems}}\"\\n          max-tags=\"{{form.schema.maxItems || form.getSchemaType() !== \\'array\\' ? 1 : 0}}\"\\n          allow-bulk=\"{{form.bulkAdd}}\"\\n          bulk-delimiter=\"{{form.bulkDelimiter}}\"\\n          bulk-placeholder=\"{{form.bulkPlaceholder}}\"\\n          show-clear-all=\"{{form.showClearAll}}\"\\n          show-button=\"true\">\\n          <auto-complete\\n            source=\"form.getTitleMap && form.getTitleMap() || form.titleQuery($query)\"\\n            skip-filtering=\"{{form.titleQuery ? true : false}}\"\\n            min-length=\"{{form.minLookup || (form.titleQuery && 3 || 0)}}\">\\n          </auto-complete>\\n        </tags-input>';\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-autocomplete.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               for=\"{{form.key.join(\\'.\\')}}-input\"\\n               ng-show=\"showTitle()\">{{form.title}}</label>\\n        ' + sharedAutocompleteTpl + '\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-autocomplete-detailed.html', '\\n      <div sf-array=\"form\"\\n           class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               for=\"{{form.key.join(\\'.\\')}}-input\"\\n               ng-show=\"showTitle()\">{{form.title}}</label>\\n        <ol class=\"list-group cn-autocomplete-list\"\\n            ng-show=\"modelArray.length\"\\n            ng-model=\"modelArray\">\\n          <li class=\"list-group-item {{form.fieldHtmlClass}}\"\\n              ng-repeat=\"item in modelArray track by $index\">\\n            <button ng-hide=\"form.readonly || form.remove === null\"\\n                    ng-click=\"deleteFromArray($index)\"\\n                    type=\"button\" class=\"close pull-right\">\\n              <span aria-hidden=\"true\">&times;</span>\\n            </button>\\n            <sf-decorator ng-init=\"arrayIndex = $index\" form=\"copyWithIndex($index)\"/>\\n          </li>\\n        </ol>\\n        ' + sharedAutocompleteTpl + '\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-currency.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\n        <div class=\"{{form.fieldClass}} input-group\">\\n          <label class=\"input-group-addon\"\\n                 ng-disabled=\"form.readonly\"\\n                 for=\"{{form.key.join(\\'.\\')}}\">$</label>\\n          <input class=\"form-control\"\\n                 cn-currency-format=\"{{form.currencyFormat}}\"\\n                 cn-currency-placeholder=\"{{form.placeholder}}\"\\n                 ng-show=\"form.key\"\\n                 ng-model-options=\"form.ngModelOptions\"\\n                 ng-disabled=\"form.readonly\"\\n                 sf-changed=\"form\"\\n                 schema-validate=\"form\"\\n                 type=\"text\"\\n                 step=\"any\"\\n                 min=\"{{form.min}}\"\\n                 max=\"{{form.max}}\"\\n                 id=\"{{form.key.join(\\'.\\')}}\"\\n                 name=\"{{form.key.join(\\'.\\')}}\"\\n                 ng-model=\"$$value$$\">\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-radios.html', '<div class=\"form-group {{form.htmlClass}}\"\\n            ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n         <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\n         <div class=\"btn-group clearfix\">\\n           <label class=\"radio radio-block\"\\n                  ng-repeat=\"item in form.titleMap\">\\n             <input type=\"radio\"\\n                    sf-changed=\"form\"\\n                    ng-disabled=\"form.readonly\"\\n                    ng-model=\"$$value$$\"\\n                    ng-model-options=\"form.ngModelOptions\"\\n                    schema-validate=\"form\"\\n                    ff-validate=\"form\"\\n                    ng-value=\"item.value\"\\n                    name=\"{{form.key.join(\\'.\\')}}\">\\n             <span class=\"radio-block-icon\" ng-if=\"item.iconClass\">\\n               <i class=\"fa fa-{{item.iconClass}} fa-lg\"></i>\\n             </span>\\n             <span ng-bind-html=\"item.name\"></span>\\n           </label>\\n         </div>\\n         <span class=\"help-block\" sf-message=\"form.description\"></span>\\n       </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-radiobuttons.html', '\\n      <div class=\"form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\n        <div class=\"btn-group clearfix\">\\n          <label class=\"btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? \\'active\\' : \\'\\'}}\"\\n                 ng-repeat=\"item in form.titleMap\">\\n            <input type=\"radio\"\\n                   class=\"{{form.fieldHtmlClass}} hide\"\\n                   sf-changed=\"form\"\\n                   ng-disabled=\"form.readonly\"\\n                   ng-model=\"$$value$$\"\\n                   ng-model-options=\"form.ngModelOptions\"\\n                   schema-validate=\"form\"\\n                   ff-validate=\"form\"\\n                   ng-value=\"item.value\"\\n                   name=\"{{form.key.join(\\'.\\')}}\">\\n            <i class=\"fa fa-{{item.value}} fa-lg\"></i>\\n            <span ng-bind-html=\"item.name\"></span>\\n          </label>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-percentage.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <div class=\"{{form.fieldClass}} input-group\">\\n          <input class=\"form-control\"\\n                 cn-percentage-format\\n                 ng-show=\"form.key\"\\n                 ng-model-options=\"form.ngModelOptions\"\\n                 ng-disabled=\"form.readonly\"\\n                 sf-changed=\"form\"\\n                 schema-validate=\"form\"\\n                 type=\"number\"\\n                 step=\"any\"\\n                 min=\"{{form.min}}\"\\n                 max=\"{{form.max}}\"\\n                 id=\"{{form.key && form.key[0]}}\"\\n                 name=\"{{form.key && form.key[0]}}\"\\n                 ng-model=\"$$value$$\">\\n           <div class=\"input-group-addon\"\\n                  ng-disabled=\"form.readonly\"\\n                  for=\"{{form.key && form.key[0]}}\">%</div>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-display.html', '\\n      <div class=\"form-group cn-display{{form.htmlClass}}\">\\n        <input ng-show=\"form.key\"\\n               class=\"form-control\"\\n               id=\"{{form.key.join(\\'.\\')}}\"\\n               name=\"{{form.key.join(\\'.\\')}}\"\\n               ng-disabled=\"true\"\\n               value=\"{{form.getDisplay(form.key, form.arrayIndex)}}\">\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-fieldset.html', '\\n      <fieldset ng-disabled=\"form.readonly\" class=\"schema-form-fieldset {{form.htmlClass}}\">\\n        <legend ng-click=\"form.toggleCollapse(form)\"\\n                ng-class=\"{\\'sr-only\\': !showTitle(), collapsible: form.collapsible}\"\\n                ng-mouseenter=\"form.render = true\">\\n          <i ng-show=\"form.collapsible\"\\n             class=\"fa fa-caret-{{form.collapsed ? \\'right\\' : \\'down\\'}}\"></i>\\n          {{ form.title }}\\n        </legend>\\n        <div class=\"help-block\" ng-show=\"form.description\" ng-bind-html=\"form.description\"></div>\\n        <div uib-collapse=\"form.collapsed\">\\n          <div ng-if=\"form.render\">\\n            <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\\n          </div>\\n        </div>\\n      </fieldset>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-mediaupload.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <media-upload ng-model=\"$$value$$\"\\n                      cn-file-type=\"form.fileType\"\\n                      cn-upload-path=\"form.uploadPath\"\\n                      cn-data=\"form.data\"\\n                      cn-preview-path=\"form.previewPath\"\\n                      cn-model-value-key=\"form.modelValueKey\"\\n                      ng-model-options=\"form.ngModelOptions\"\\n                      sf-changed=\"form\"\\n                      schema-validate=\"form\"\\n                      ff-form=\"form\"\\n                      class=\"clearfix\">\\n        </media-upload>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n     </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-csvupload.html', '\\n      <div class=\"form-group {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\n        <csv-upload ng-model=\"$$value$$\"\\n                      cn-upload-path=\"form.uploadPath\"\\n                      ng-model-options=\"form.ngModelOptions\"\\n                      sf-changed=\"form\"\\n                      schema-validate=\"form\"\\n                      ff-form=\"form\"\\n                      class=\"clearfix\">\\n        </csv-upload>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n     </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-reusable.html', '\\n      <div class=\"form-group cn-reusable {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <label class=\"control-label\"\\n               ng-show=\"showTitle()\"\\n               for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\n        <cn-select-or\\n          ng-show=\"form.key\"\\n          select-from=\"form.library\"\\n          ng-model=\"$$value$$\"\\n          ng-model-options=\"form.ngModelOptions\"\\n          sf-changed=\"form\"\\n          schema-validate=\"form\"\\n          ff-form=\"form\"\\n          directiveId=\"form.directiveId\"\\n          item-template=\"form.itemTemplate\"\\n          toggle-text=\"form.toggleText\"\\n          disabled=\"form.readonly\"\\n          view=\"form.view\">\\n          <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\\n        </cn-select-or>\\n        <p ng-if=\"form.loadMore && form.view === \\'list\\'\">\\n          <a ng-click=\"form.loadMore()\"\\n             class=\"btn btn-default btn-block\">Load More</a>\\n        </p>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t\n\t  $templateCache.put('app/components/cn-flex-form/forms/cn-table.html', '\\n      <div class=\"form-group cn-ff-table {{form.htmlClass}}\"\\n           ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\n        <h6>{{form.title}}</h6>\\n        <div class=\"row\">\\n          <div ng-repeat=\"col in form.columns\" class=\"{{col.columnWidth}}\">\\n            <p class=\"column-header\">{{col.columnHeader}}</p>\\n          </div>\\n        </div>\\n        <div class=\"row\" ng-repeat=\"row in form.items\">\\n          <div ng-repeat=\"col in row.items\" class=\"{{col.columnWidth}}\">\\n            <sf-decorator form=\"col\"></sf-decorator>\\n          </div>\\n        </div>\\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\\n      </div>');\n\t}\n\t\n\texports.schemaFormConfig = schemaFormConfig;\n\texports.addTemplates = addTemplates;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tcnFlexFormServiceProvider.$inject = [\"schemaFormDecoratorsProvider\", \"cnFlexFormTypesProvider\"];\n\tCNFlexFormService.$inject = [\"Api\", \"$parse\", \"cnFlexFormConfig\", \"cnFlexFormTypes\", \"sfPath\", \"$interpolate\", \"$rootScope\", \"$timeout\", \"cnUtil\", \"$stateParams\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\t\n\tfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\t\n\t// Need these modules for test bundle\n\tvar _ = typeof window !== 'undefined' && window._ || __webpack_require__(6);\n\tvar ObjectPath = typeof window !== 'undefined' && window.ObjectPath || __webpack_require__(7);\n\t\n\tvar fieldTypeHandlers = {\n\t  'fieldset': 'processFieldset',\n\t  'cn-radios': 'processRadios',\n\t  'cn-radiobuttons': 'processRadiobuttons',\n\t  'cn-autocomplete': 'processSelect',\n\t  'cn-datetimepicker': 'processDate',\n\t  'help': 'processHelp',\n\t  'cn-display': 'processDisplay',\n\t  'cn-currency': 'processCurrency',\n\t  'cn-percentage': 'processPercentage',\n\t  'cn-mediaupload': 'processMediaUpload',\n\t  'cn-csvupload': 'processCsvUpload',\n\t  'cn-reusable': 'processReusable',\n\t  'cn-toggle': 'processToggle',\n\t  'cn-table': 'processTable',\n\t  'component': 'processComponent',\n\t  'section': 'processSection',\n\t  'tabarray': 'processSection',\n\t  'array': 'processArray'\n\t};\n\t\n\tvar fieldPropHandlers = [{\n\t  prop: 'selectDisplay',\n\t  handler: function handler(field, service) {\n\t    return service.processSelectDisplay(field);\n\t  }\n\t}, {\n\t  prop: 'resolve',\n\t  handler: function handler(field, service) {\n\t    return service.processResolve(field);\n\t  }\n\t}, {\n\t  prop: 'watch',\n\t  handler: function handler(field, service) {\n\t    return service.processFieldWatch(field);\n\t  }\n\t}, {\n\t  prop: 'type',\n\t  handler: function handler(field, service) {\n\t    return service.processFieldType(field);\n\t  }\n\t}, {\n\t  prop: 'conditionals',\n\t  handler: function handler(field, service) {\n\t    return service.processConditional(field);\n\t  }\n\t}, {\n\t  prop: 'default',\n\t  handler: function handler(field, service) {\n\t    return service.processDefault(field);\n\t  }\n\t}, {\n\t  prop: 'schema',\n\t  handler: function handler(field, service) {\n\t    return _.isUndefined(field.default) && !_.isUndefined(field.schema.default) && service.processDefault(field);\n\t  }\n\t}, {\n\t  prop: 'updateSchema',\n\t  handler: function handler(field, service) {\n\t    return service.registerHandler(field, null, field.updateSchema);\n\t  }\n\t}];\n\t\n\tfunction cnFlexFormServiceProvider(schemaFormDecoratorsProvider, cnFlexFormTypesProvider) {\n\t  'ngInject';\n\t\n\t  return {\n\t    registerField: registerField,\n\t    $get: CNFlexFormService\n\t  };\n\t\n\t  //////////\n\t\n\t  function registerField(fieldType) {\n\t    if (fieldType.condition) {\n\t      cnFlexFormTypesProvider.registerFieldType({\n\t        condition: fieldType.condition,\n\t        type: fieldType.type\n\t      });\n\t    }\n\t\n\t    if (fieldType.handler) {\n\t      fieldTypeHandlers[fieldType.type] = fieldType.handler;\n\t    }\n\t\n\t    if (fieldType.templateUrl) {\n\t      schemaFormDecoratorsProvider.addMapping('bootstrapDecorator', fieldType.type, fieldType.templateUrl);\n\t      schemaFormDecoratorsProvider.createDirective(fieldType.type, fieldType.templateUrl);\n\t    }\n\t  }\n\t}\n\t\n\tfunction CNFlexFormService(Api, $parse, cnFlexFormConfig, cnFlexFormTypes, sfPath, $interpolate, $rootScope, $timeout, cnUtil, $stateParams) {\n\t  'ngInject';\n\t\n\t  var services = [];\n\t  var prototype = {\n\t    compile: compile,\n\t    addArrayCopy: addArrayCopy,\n\t    addToDataCache: addToDataCache,\n\t    addToFormCache: addToFormCache,\n\t    addToScopeCache: addToScopeCache,\n\t    broadcastErrors: broadcastErrors,\n\t    buildError: buildError,\n\t    cleanup: cleanup,\n\t    deregisterHandlers: deregisterHandlers,\n\t    deregisterArrayHandlers: deregisterArrayHandlers,\n\t    getArrayCopy: getArrayCopy,\n\t    getArrayCopies: getArrayCopies,\n\t    getArrayCopiesFor: getArrayCopiesFor,\n\t    getArrayScopes: getArrayScopes,\n\t    getDefault: getDefault,\n\t    getFromDataCache: getFromDataCache,\n\t    getFromFormCache: getFromFormCache,\n\t    getFromScopeCache: getFromScopeCache,\n\t    getKey: getKey,\n\t    getSchema: getSchema,\n\t    getWatchables: getWatchables,\n\t    handleResolve: handleResolve,\n\t    initArrayCopyWatch: initArrayCopyWatch,\n\t    initModelWatch: initModelWatch,\n\t    initSchemaParams: initSchemaParams,\n\t    isCompiled: isCompiled,\n\t    onModelWatch: onModelWatch,\n\t    parseCondition: parseCondition,\n\t    parseExpression: parseExpression,\n\t    processArray: processArray,\n\t    processDefault: processDefault,\n\t    processDisplay: processDisplay,\n\t    processField: processField,\n\t    processFieldset: processFieldset,\n\t    processFieldProps: processFieldProps,\n\t    processFieldType: processFieldType,\n\t    processFieldWatch: processFieldWatch,\n\t    processComponent: processComponent,\n\t    processConditional: processConditional,\n\t    processCurrency: processCurrency,\n\t    processPercentage: processPercentage,\n\t    processDate: processDate,\n\t    processHelp: processHelp,\n\t    processRadios: processRadios,\n\t    processRadiobuttons: processRadiobuttons,\n\t    processReusable: processReusable,\n\t    processSchema: processSchema,\n\t    processSelectDisplay: processSelectDisplay,\n\t    processResolve: processResolve,\n\t    processSection: processSection,\n\t    processSelect: processSelect,\n\t    processTable: processTable,\n\t    processTemplate: processTemplate,\n\t    processToggle: processToggle,\n\t    processUpdatedSchema: processUpdatedSchema,\n\t    processMediaUpload: processMediaUpload,\n\t    processCsvUpload: processCsvUpload,\n\t    registerArrayHandlers: registerArrayHandlers,\n\t    registerHandler: registerHandler,\n\t    registerResolve: registerResolve,\n\t    replaceArrayIndex: replaceArrayIndex,\n\t    reprocessField: reprocessField,\n\t    resolveNestedExpressions: resolveNestedExpressions,\n\t    setArrayIndex: setArrayIndex,\n\t    setupConfig: setupConfig,\n\t    setupArraySelectDisplay: setupArraySelectDisplay,\n\t    setupSelectDisplay: setupSelectDisplay,\n\t    setupSchemaRefresh: setupSchemaRefresh\n\t  };\n\t\n\t  function CNFlexFormConstructor(schema, model, config) {\n\t    var service;\n\t    if (services.length) {\n\t      for (var i = 0, l = services.length; i < l; i++) {\n\t        if (services[i].model === model) {\n\t          service = services[i];\n\t          service.compile(schema, model, config);\n\t          break;\n\t        }\n\t      }\n\t    }\n\t    if (!service) {\n\t      service = new CNFlexForm(schema, model, config);\n\t      services.push(service);\n\t    }\n\t    return service || new CNFlexForm(schema, model, config);\n\t  }\n\t\n\t  function CNFlexForm(schema, model, config) {\n\t\n\t    if ($stateParams.debug) {\n\t      window.services = services;\n\t    }\n\t\n\t    this.arrayCopies = {};\n\t    this.arrayListeners = {};\n\t    this.dataCache = {};\n\t    this.defaults = {};\n\t    this.errors = [];\n\t    this.events = [];\n\t    this.formCache = {};\n\t    this.scopeCache = {};\n\t    this.listeners = {};\n\t    this.resolveRegister = {};\n\t    this.model = model;\n\t    this.updates = 0;\n\t\n\t    this.params = cnFlexFormConfig.getStateParams();\n\t\n\t    this._ = _;\n\t\n\t    this.compile(schema, model, config);\n\t  }\n\t\n\t  _.extend(CNFlexForm.prototype, prototype);\n\t  _.extend(CNFlexFormConstructor, prototype);\n\t\n\t  return CNFlexFormConstructor;\n\t\n\t  //////////////\n\t\n\t  function compile(schema, model, config) {\n\t    var service = this;\n\t\n\t    service.schema = schema;\n\t    service.model = model;\n\t\n\t    if (!service.isCompiled()) {\n\t      service.setupConfig(config);\n\t\n\t      if (schema.forms) {\n\t        _.each(schema.forms, function (form) {\n\t          _.each(form.form, service.processField.bind(service));\n\t        });\n\t      } else {\n\t        _.each(schema.form, service.processField.bind(service));\n\t      }\n\t\n\t      service.initModelWatch();\n\t      service.initArrayCopyWatch();\n\t      service.isCompiled(true);\n\t    }\n\t\n\t    service.broadcastErrors();\n\t  }\n\t\n\t  function isCompiled(setValue) {\n\t    var service = this;\n\t    if (setValue) {\n\t      service.schema.compiled = setValue;\n\t    }\n\t    return service.schema && service.schema.compiled;\n\t  }\n\t\n\t  function setupConfig(config) {\n\t    var service = this;\n\t    if (config) {\n\t      if (config.formCtrl) service.formCtrl = config.formCtrl;\n\t      if (config.updateSchema) service.updateSchema = config.updateSchema;\n\t      if (config.getSchema) service.getSchemaForm = service.setupSchemaRefresh(config.getSchema);\n\t    }\n\t  }\n\t\n\t  function processSchema(field) {\n\t    var service = this;\n\t    var schema = field.schema;\n\t\n\t\n\t    field.getSchemaType = function () {\n\t      return _.isArray(schema.type) ? _.first(schema.type) : schema.type;\n\t    };\n\t    if (!field.type) field.type = field.getSchemaType && field.getSchemaType();\n\t  }\n\t\n\t  function processDefault(field) {\n\t    var service = this;\n\t    var schema = field.schema;\n\t\n\t    var curDefault = field.default || schema.default;\n\t\n\t    var key = service.getKey(field.key);\n\t    // if schemaUpdate hasn't been triggered, let schemaForm directive handle defaults\n\t    if (service.updates || field.default) {\n\t      if (key.includes && key.includes('[]')) return;\n\t      var model = service.parseExpression(field.key, service.model);\n\t      var modelValue = model.get();\n\t      // if there's an existing default and it's the same as the current value\n\t      // update the current value to the new default\n\t      if (_.isTrulyEmpty(modelValue) || _.has(service.defaults, key) && angular.equals(modelValue, service.defaults[key])) {\n\t        model.set(curDefault);\n\t      }\n\t    }\n\t    service.defaults[key] = angular.copy(curDefault);\n\t\n\t    if (schema.format === 'url' && !field.validationMessage) {\n\t      if (!field.type) field.type = 'url';\n\t      field.validationMessage = 'Must be a valid url (https://...)';\n\t    }\n\t  }\n\t\n\t  function processFieldset(fieldset) {\n\t    var service = this;\n\t\n\t    fieldset.type = 'cn-fieldset';\n\t    fieldset.items.forEach(service.processField.bind(service));\n\t\n\t    if (fieldset.collapsible) {\n\t      fieldset.toggleCollapse = function (fieldset) {\n\t        if (fieldset.collapsible) {\n\t          fieldset.collapsed = !fieldset.collapsed;\n\t        }\n\t      };\n\t\n\t      fieldset.render = !fieldset.collapsed;\n\t    } else {\n\t      fieldset.render = true;\n\t    }\n\t  }\n\t\n\t  function processFieldType(field) {\n\t    var service = this;\n\t    var fieldType = cnFlexFormTypes.getFieldType(field);\n\t    var handler = fieldTypeHandlers[fieldType];\n\t    if (_.isString(handler)) {\n\t      service[handler](field);\n\t    } else if (_.isFunction(handler)) {\n\t      handler.call(service, field);\n\t    }\n\t  }\n\t\n\t  function processField(field) {\n\t    var service = this;\n\t\n\t    if (!field._ogKeys) {\n\t      field._ogKeys = _.without(_.keys(field), 'key', 'htmlClass');\n\t    }\n\t\n\t    var key = service.getKey(field.key);\n\t\n\t    if (key) {\n\t      service.addToFormCache(field, key);\n\t      var schema = service.getSchema(key);\n\t\n\t      if (schema) {\n\t        field.schema = schema;\n\t        if (schema.description) field.description = schema.description;\n\t        if (field.readonly && !schema.readonly) field.readonly = false;\n\t        if (schema.type === 'array' && !('showClearAll' in field)) field.showClearAll = true;\n\t      }\n\t\n\t      service.processSchema(field);\n\t    }\n\t\n\t    service.processFieldProps(field);\n\t\n\t    if (key) {\n\t      if (_.find(service.errors, { key: key })) {\n\t        service.errors = _.reject(service.errors, { key: key });\n\t        $rootScope.$broadcast('schemaForm.error.' + key, 'schemaForm', true);\n\t        $rootScope.$broadcast('schemaForm.error.' + key, 'serverValidation', true);\n\t      }\n\t\n\t      if (field.error) {\n\t        service.errors.push(service.buildError(field));\n\t        if (_.isEmpty(field.ngModelOptions)) {\n\t          field.ngModelOptions = {\n\t            allowInvalid: true\n\t          };\n\t        } else {\n\t          field.ngModelOptions.allowInvalid = true;\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  function processFieldProps(field) {\n\t    var service = this;\n\t    fieldPropHandlers.forEach(function (_ref) {\n\t      var prop = _ref.prop,\n\t          handler = _ref.handler;\n\t      return _.has(field, prop) && handler(field, service);\n\t    });\n\t  }\n\t\n\t  function getKey(key) {\n\t    if (_.isArray(key)) {\n\t      key = _.reduce(key, function (total, next) {\n\t        return (/^(-?\\d*)$/.test(next) ? total + '[' + next + ']' : total + '.' + next\n\t        );\n\t      });\n\t    }\n\t    return key;\n\t  }\n\t\n\t  function getSchema(key, depth) {\n\t    var service = this;\n\t    if (!key) return;\n\t\n\t    key = ObjectPath.parse(service.getKey(key));\n\t    depth = depth || service.schema.schema.properties;\n\t\n\t    var first = void 0,\n\t        next = void 0;\n\t\n\t    while (key.length > 1) {\n\t      first = key[0];\n\t      next = key[1];\n\t      if (/^-?\\d*$/.test(next)) {\n\t        if (key.length === 2) {\n\t          depth = depth = depth[key.shift()];\n\t        } else {\n\t          depth = depth[key.shift()].items.properties;\n\t          key.shift();\n\t        }\n\t      } else {\n\t        depth = depth[key.shift()].properties;\n\t      }\n\t    }\n\t\n\t    // if array item\n\t    first = key[0] || 'items';\n\t\n\t    return depth[first];\n\t  }\n\t\n\t  function getDefault(field) {\n\t    var service = this;\n\t    console.log(':: getDefault ::', field);\n\t    field = field.key ? field : service.getFromFormCache(field);\n\t    console.log(':: getDefault ::', field);\n\t    return field && (angular.isDefined(field.default) ? field.default : field.schema && field.schema.default);\n\t  }\n\t\n\t  function getWatchables(exp) {\n\t    var watchables = [];\n\t    var nested = matchNestedExpression(exp);\n\t    var replaceStr = '';\n\t\n\t    while (nested) {\n\t      if (/^-?\\d+$/.test(nested[1])) {\n\t        replaceStr = nested[0];\n\t        exp = exp.replace(nested[0], 'ff_replace_ff');\n\t      } else {\n\t        watchables.push(nested[1].replace(/ff_replace_ff/g, replaceStr));\n\t        replaceStr = '';\n\t        exp = exp.replace(nested[0], '');\n\t      }\n\t      nested = matchNestedExpression(exp);\n\t    }\n\t\n\t    return [].concat(watchables, [exp.replace(/ff_replace_ff/g, replaceStr)]);\n\t  }\n\t\n\t  function processResolve(field) {\n\t    var service = this;\n\t    var key = service.getKey(field.key);\n\t\n\t    _.each(field.resolve, function (dataProp, fieldProp) {\n\t      dataProp = replaceArrayIndex(dataProp, key);\n\t      if (dataProp.includes('[arrayIndex]')) return;\n\t\n\t      service.handleResolve(field, fieldProp, dataProp);\n\t\n\t      getWatchables(dataProp).forEach(function (watchable) {\n\t        var resolveType = watchable.match(/(schema\\.data\\.|model\\.)(\\S+)/);\n\t\n\t        if (resolveType) {\n\t          if (resolveType[1] === 'schema.data.') {\n\t            service.registerResolve(field, fieldProp, resolveType[2], dataProp);\n\t          } else if (resolveType[1] === 'model.') {\n\t            service.registerHandler(resolveType[2], function () {\n\t              service.handleResolve(field, fieldProp, dataProp);\n\t            });\n\t          }\n\t        }\n\t      });\n\t    });\n\t\n\t    return field;\n\t  }\n\t\n\t  function handleResolve(field, fieldProp, exp) {\n\t    var service = this;\n\t    var data = service.parseExpression(exp).get();\n\t    // if we're resolving from model but defaults haven't been applied yet, resolve from default itself\n\t    if (!data && exp.indexOf('model.') === 0) {\n\t      var key = exp.replace('model.', '');\n\t      var cachedField = service.getFromFormCache(key);\n\t\n\t      if (cachedField && cachedField.default) data = cachedField.default;else data = field.default || service.getSchema(key).default;\n\t    }\n\t    if (data && data.cursor) {\n\t      field.loadMore = function () {\n\t        var dataProp = exp.match(/schema\\.data\\.(.+)/)[1];\n\t        service.refreshSchema('data:' + dataProp + ':' + data.cursor);\n\t      };\n\t    } else {\n\t      delete field.loadMore;\n\t    }\n\t    field[fieldProp] = data && data.data ? data.data : data;\n\t\n\t    fieldPropHandlers.forEach(function (_ref2) {\n\t      var prop = _ref2.prop,\n\t          handler = _ref2.handler;\n\t      return prop === fieldProp && handler(field, service);\n\t    });\n\t  }\n\t\n\t  function registerResolve(field, fieldProp, dataProp, exp) {\n\t    var service = this;\n\t\n\t    var fieldKey = service.getKey(field.key);\n\t    service.resolveRegister[dataProp] = service.resolveRegister[dataProp] || {};\n\t\n\t    var register = service.resolveRegister[dataProp];\n\t    register[fieldKey] = register[fieldKey] || [];\n\t    register[fieldKey].push({ field: field, prop: fieldProp, exp: exp });\n\t  }\n\t\n\t  function processConditional(field) {\n\t    var service = this;\n\t\n\t    _.each(field.conditionals, function (condition, key) {\n\t      var handler = function handler(val, prev) {\n\t        field[key] = service.parseCondition(condition);\n\t        var scope = service.getFromScopeCache(service.getKey(field.key));\n\t        if (key === 'required' && scope) {\n\t          $rootScope.$broadcast('schemaFormValidate');\n\t        }\n\t      };\n\t      field.conditionals[key].match(/model\\.([^\\s]+)/g).map(function (path) {\n\t        return path.match(/model\\.([^\\s]+)/)[1];\n\t      }).forEach(function (key) {\n\t        service.registerHandler(key, handler);\n\t      });\n\t      handler();\n\t    });\n\t  }\n\t\n\t  function processFieldWatch(field) {\n\t    var service = this;\n\t    var schema = field.schema;\n\t\n\t    field.watch = _.isArray(field.watch) ? field.watch : [field.watch];\n\t\n\t    _.each(field.watch, function (watch) {\n\t      if (watch.resolution) {\n\t        var adjustment;\n\t\n\t        (function () {\n\t          var condition = watch.condition;\n\t          var resolution = watch.resolution;\n\t          var handler = void 0;\n\t\n\t          if (_.isFunction(resolution)) {\n\t            handler = function handler(cur, prev) {\n\t              if (!condition || service.parseCondition(condition)) {\n\t                resolution(cur, prev);\n\t              }\n\t            };\n\t          } else {\n\t            adjustment = {};\n\t\n\t\n\t            adjustment.date = resolution.match(/\\+ ?(\\d+) days/);\n\t\n\t            if (adjustment.date) {\n\t              adjustment.date = adjustment.date[1];\n\t              resolution = resolution.replace(adjustment.date, '').trim();\n\t            } else {\n\t              adjustment.math = resolution.match(/(\\+|\\-|\\/|\\*) ?(\\S+)/);\n\t\n\t              if (adjustment.math) {\n\t                adjustment.operator = {\n\t                  '+': 'add',\n\t                  '-': 'subtract',\n\t                  '*': 'multiply',\n\t                  '/': 'divide'\n\t                }[adjustment.math[1]];\n\t\n\t                adjustment.adjuster = service.parseExpression(adjustment.math[2]);\n\t              }\n\t            }\n\t\n\t            resolution = resolution.match(/(\\S+) ?= ?(\\S+)/);\n\t\n\t            handler = function handler(val, prev, key, trigger) {\n\t              var curCondition = condition && replaceArrayIndex(condition, key);\n\t              var updatePath = replaceArrayIndex(resolution[1], key);\n\t              var fromPath = replaceArrayIndex(resolution[2], key);\n\t\n\t              var update = service.parseExpression(updatePath);\n\t\n\t              // avoid loop where two watches keep triggering each other\n\t              if (trigger === update.path().key) return;\n\t              trigger = update.path().key;\n\t\n\t              var from = service.parseExpression(fromPath);\n\t\n\t              if (!condition || service.parseCondition(curCondition)) {\n\t                if (adjustment.date) {\n\t                  update.set(moment(from.get()).add(adjustment.date, 'days').toDate());\n\t                } else if (adjustment.math) {\n\t                  //var result = _[adjustment.operator](from.get(), adjustment.adjuster.get());\n\t                  //let result = eval(from.get() + adjustment.math[1] + adjustment.adjuster.get());\n\t                  var result = $parse(from.get() + adjustment.math[1] + adjustment.adjuster.get())();\n\t                  schema = schema || field.items && (field.items[0].schema || field.items[0].items && field.items[0].items[0].schema);\n\t                  if (field.type === 'cn-currency') {\n\t                    var p = schema && schema.format === 'currency-dollars' ? 2 : 0;\n\t\n\t                    if (adjustment.math[1] === '*') {\n\t                      result = _.floor(result, p);\n\t                    } else if (adjustment.math[1] === '/') {\n\t                      result = _.ceil(result, p);\n\t                    } else {\n\t                      result = _.round(result, p);\n\t                    }\n\t                  }\n\t                  //service.listeners[update.path().key].prev = result;\n\t                  if (service.listeners[trigger]) {\n\t                    service.listeners[trigger].trigger = key;\n\t                  }\n\t                  update.set(result || 0);\n\t                } else {\n\t                  update.set(from.get());\n\t                }\n\t              }\n\t            };\n\t          }\n\t\n\t          service.registerHandler(field, handler, field.updateSchema, watch.initialize);\n\t        })();\n\t      }\n\t    });\n\t  }\n\t\n\t  function parseCondition(condition) {\n\t    var service = this;\n\t    if (condition.startsWith(\"_\")) {\n\t      var exp = /^_\\.(.*?)\\((.*?),[\\s(]*(.*?)\\)?\\s*=>[{\\s]*(?:return)?(.*?)\\}?\\)$/;\n\t\n\t      var _condition$match = condition.match(exp),\n\t          _condition$match2 = _slicedToArray(_condition$match, 5),\n\t          fn = _condition$match2[1],\n\t          list = _condition$match2[2],\n\t          predicateParams = _condition$match2[3],\n\t          predicateBody = _condition$match2[4];\n\t\n\t      return _[fn]($parse(list)(service), generatePredicate(predicateParams, predicateBody));\n\t    } else {\n\t      return $parse(condition)(service);\n\t    }\n\t  }\n\t\n\t  function generatePredicate(params, body) {\n\t    return function () {\n\t      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t        args[_key] = arguments[_key];\n\t      }\n\t\n\t      return $parse(body)(params.replace(/\\s/g, '').split(',').reduce(function (acc, cur, i) {\n\t        acc[cur] = args[i];return acc;\n\t      }, {}));\n\t    };\n\t  }\n\t\n\t  function registerHandler(key, handler, updateSchema, runHandler) {\n\t    var service = this;\n\t\n\t    // if field is passed instead of key\n\t    if (_.isObject(key) && !_.isArray(key)) {\n\t      if (!key.key && key.items) {\n\t        _.each(key.items, function (field) {\n\t          service.registerHandler(field, handler, field.updateSchema);\n\t        });\n\t        return;\n\t      } else {\n\t        key = key.key;\n\t      }\n\t    }\n\t\n\t    key = service.getKey(key);\n\t    var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.*)/);\n\t\n\t    if (arrMatch) {\n\t      service.registerArrayHandlers(arrMatch[1], arrMatch[2], handler, updateSchema, runHandler);\n\t      return;\n\t    }\n\t\n\t    var cur = service.parseExpression(key, service.model).get();\n\t    var defaultValue = _.get(service.getSchema(key), 'default');\n\t\n\t    if (!service.listeners[key]) {\n\t      var prev = _.isUndefined(cur) ? angular.copy(defaultValue) : angular.copy(cur);\n\t      service.listeners[key] = {\n\t        handlers: [],\n\t        updateSchema: updateSchema,\n\t        prev: prev\n\t      };\n\t    }\n\t\n\t    if (handler) {\n\t      service.listeners[key].handlers.push(handler);\n\t      if (runHandler) handler(cur, null, key);\n\t    }\n\t  }\n\t\n\t  function registerArrayHandlers(arrKey, fieldKey, handler, updateSchema, runHandler) {\n\t    var service = this;\n\t    var onArray = function onArray(cur, prev, reorder) {\n\t\n\t      if (!prev && prev !== 0 && (cur | 0) < 1) return;\n\t      var i, l, key;\n\t\n\t      if (prev > cur || reorder) {\n\t        var lastKey = fieldKey ? arrKey + '[' + (prev - 1) + ']' + '.' + fieldKey : arrKey + '[' + (prev - 1) + ']';\n\t\n\t        // only deregister handlers once each time an element is removed\n\t        if (service.listeners[lastKey]) {\n\t          for (i = 0, l = prev; i < l; i++) {\n\t            key = fieldKey ? arrKey + '[' + i + ']' + '.' + fieldKey : arrKey + '[' + i + ']';\n\t\n\t            service.deregisterHandlers(key);\n\t          }\n\t        }\n\t        for (i = 0, l = cur; i < l; i++) {\n\t          key = fieldKey ? arrKey + '[' + i + ']' + '.' + fieldKey : arrKey + '[' + i + ']';\n\t\n\t          service.registerHandler(key, handler, updateSchema);\n\t          //no need to call if just reregisering handlers\n\t          //if(runHandler) handler(null, null, key);\n\t        }\n\t      } else if (cur > (prev || 0)) {\n\t        for (i = prev | 0, l = cur; i < l; i++) {\n\t          key = fieldKey ? arrKey + '[' + i + ']' + '.' + fieldKey : arrKey + '[' + i + ']';\n\t\n\t          service.registerHandler(key, handler, updateSchema, runHandler);\n\t          //if(runHandler) handler(null, null, key);\n\t        }\n\t      }\n\t    };\n\t\n\t    var arrVal = service.parseExpression(arrKey, service.model).get();\n\t    _.each(arrVal, function (field, i) {\n\t      var key = fieldKey ? arrKey + '[' + i + ']' + '.' + fieldKey : arrKey + '[' + i + ']';\n\t\n\t      service.registerHandler(key, handler, updateSchema);\n\t      if (runHandler) handler(null, null, key);\n\t    });\n\t\n\t    if (service.arrayListeners[arrKey + '.length']) {\n\t      service.arrayListeners[arrKey + '.length'].handlers.push(onArray);\n\t    } else {\n\t      service.arrayListeners[arrKey + '.length'] = {\n\t        handlers: [onArray],\n\t        prev: arrVal ? arrVal.length : 0\n\t      };\n\t    }\n\t  }\n\t\n\t  function deregisterHandlers(key) {\n\t    var service = this;\n\t\n\t    key = service.getKey(key);\n\t\n\t    var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.*)/);\n\t\n\t    if (arrMatch) {\n\t      service.deregisterArrayHandlers(arrMatch[1], arrMatch[2]);\n\t      return;\n\t    }\n\t\n\t    if (service.listeners[key]) service.listeners[key].handlers = [];\n\t  }\n\t\n\t  function deregisterArrayHandlers(arrKey, fieldKey) {\n\t    var service = this;\n\t\n\t    service.parseExpression(arrKey, service.model).get().forEach(function (item, i) {\n\t      fieldKey ? service.deregisterHandlers(arrKey + '[' + i + '].' + fieldKey) : service.deregisterHandlers(arrKey + '[' + i + ']');\n\t    });\n\t  }\n\t\n\t  function initModelWatch() {\n\t    var service = this;\n\t    if (service.watching) return;\n\t    if (service.modelWatch) service.modelWatch();\n\t\n\t    service.modelWatch = $rootScope.$watch(function () {\n\t      return service.model;\n\t    }, service.onModelWatch.bind(service), true);\n\t\n\t    service.initSchemaParams();\n\t    service.watching = true;\n\t    service.firstUpdate = true;\n\t  }\n\t\n\t  function onModelWatch(cur, prev) {\n\t    var service = this;\n\t    // we always run through the listeners on the first update because angular seems to mess up\n\t    // when the defaults are applied and uses the same object for both cur and prev\n\t    if (service.firstUpdate || !angular.equals(cur, prev)) {\n\t      service.firstUpdate = false;\n\t      cnUtil.cleanModel(service.model);\n\t\n\t      service.prevParams = angular.copy(service.params);\n\t\n\t      _.each(service.arrayListeners, function (listener, key) {\n\t        var val = service.parseExpression(key, service.model).get();\n\t        if (!angular.equals(val, listener.prev)) {\n\t          listener.handlers.forEach(function (handler) {\n\t            return handler(val, listener.prev);\n\t          });\n\t          listener.prev = angular.copy(val);\n\t        }\n\t      });\n\t\n\t      _.each(service.listeners, function (listener, key) {\n\t        if (listener) {\n\t          (function () {\n\t            var val = service.parseExpression(key, service.model).get();\n\t            var isInitArray = angular.equals(val, []) && !listener.prev;\n\t            if (!angular.equals(val, listener.prev) && !isInitArray) {\n\t              listener.handlers.forEach(function (handler) {\n\t                handler(val, listener.prev, key, listener.trigger);\n\t              });\n\t              listener.trigger = null;\n\t              listener.prev = angular.copy(val);\n\t            }\n\t            if (listener.updateSchema && !angular.isUndefined(val) && !isInitArray && val !== null /* &&\n\t                                                                                                   !angular.equals(val, service.getDefault(key))*/) {\n\t                service.params[key] = val;\n\t              } else {\n\t              delete service.params[key];\n\t            }\n\t          })();\n\t        }\n\t      });\n\t\n\t      if (!angular.equals(service.params, service.prevParams)) {\n\t        if (service.model.id && !service.updates && _.isEmpty(service.prevParams)) {\n\t          ++service.updates;\n\t        } else {\n\t          service.refreshSchema();\n\t        }\n\t      }\n\t    }\n\t  }\n\t\n\t  function initSchemaParams() {\n\t    var service = this;\n\t    _.each(service.listeners, function (listener, key) {\n\t      if (listener) {\n\t        var val = service.parseExpression(key, service.model).get();\n\t        if (listener.updateSchema && !angular.isUndefined(val) && val !== null) {\n\t          service.params[key] = val;\n\t        }\n\t      }\n\t    });\n\t  }\n\t\n\t  function initArrayCopyWatch() {\n\t    var service = this;\n\t\n\t    service.events.push($rootScope.$on('schemaFormPropagateScope', function (event, scope) {\n\t      var key = service.getKey(scope.form.key);\n\t      var index = key.match(/^.*\\[(\\d+)].*$/);\n\t\n\t      if (index) {\n\t        key = key.replace(/\\[\\d+]/g, '[]');\n\t        index = index && parseInt(index[1]);\n\t\n\t        if (!service.getArrayCopy(key, index)) {\n\t          service.processFieldProps(scope.form);\n\t        }\n\t\n\t        if (!scope.form.condition) scope.form.condition = 'true';\n\t\n\t        service.addArrayCopy(scope, key, index);\n\t        scope.$emit('flexFormArrayCopyAdded', key);\n\t      } else {\n\t        service.addToScopeCache(scope, key);\n\t      }\n\t    }));\n\t\n\t    service.events.push($rootScope.$on('schemaFormDeleteScope', function (event, scope, index) {\n\t      var key = service.getKey(scope.form.key);\n\t      var listener = service.listeners[key];\n\t      if (listener) listener.handlers = [];\n\t\n\t      var unindexedKey = key.replace(/\\[\\d+]/g, '[]');\n\t      var copies = service.getArrayCopiesFor(unindexedKey);\n\t\n\t      copies.forEach(function (list) {\n\t        return list.splice(index, 1);\n\t      });\n\t\n\t      if (scope.form.link) {\n\t        var list = service.parseExpression(scope.form.link, service.model).get();\n\t        list.splice(index, 1);\n\t      }\n\t    }));\n\t  }\n\t\n\t  function addArrayCopy(form, key, index) {\n\t    var service = this;\n\t    if (!index || index < 0) index = 0;\n\t    if (!service.arrayCopies[key]) service.arrayCopies[key] = [];\n\t    service.arrayCopies[key][index] = form;\n\t    //service.arrayCopies[key].push(form);\n\t  }\n\t\n\t  function getArrayCopy(key, index) {\n\t    var service = this;\n\t    var copies = service.arrayCopies[key];\n\t    return copies && copies[index];\n\t  }\n\t\n\t  function getArrayCopies(key) {\n\t    var service = this;\n\t    return _.pluck(service.getArrayScopes(key), 'form');\n\t  }\n\t\n\t  function getArrayCopiesFor(keyStart) {\n\t    var service = this;\n\t    keyStart += '[]';\n\t\n\t    return _.filter(service.arrayCopies, function (copy, key) {\n\t      return key.includes(keyStart);\n\t    });\n\t  }\n\t\n\t  function getArrayScopes(key) {\n\t    var service = this;\n\t    return service.arrayCopies[key];\n\t  }\n\t\n\t  function addToScopeCache(scope, key) {\n\t    var service = this;\n\t    if (service.scopeCache[key]) {\n\t      console.warn('caching duplicate scope for', key);\n\t    }\n\t    return service.scopeCache[key] = scope;\n\t  }\n\t\n\t  function getFromScopeCache(key) {\n\t    var service = this;\n\t    return service.scopeCache[key];\n\t  }\n\t\n\t  function addToFormCache(field, key) {\n\t    var service = this;\n\t    key = key || service.getKey(field.key);\n\t    if (!service.getFromFormCache(key)) service.formCache[key] = field;\n\t  }\n\t\n\t  function getFromFormCache(key) {\n\t    var service = this;\n\t    return service.formCache[key];\n\t  }\n\t\n\t  function addToDataCache(key, modelValue) {\n\t    var service = this;\n\t\n\t    if (key) {\n\t      service.dataCache[key] = modelValue;\n\t    }\n\t  }\n\t\n\t  function getFromDataCache(key) {\n\t    var service = this;\n\t\n\t    return service.dataCache[key];\n\t  }\n\t\n\t  function matchNestedExpression(exp) {\n\t    return exp.match(/\\[([^[\\]]+)]([^[\\]]*)/);\n\t  }\n\t\n\t  function resolveNestedExpressions(exp, depth) {\n\t    var service = this;\n\t    var nested = matchNestedExpression(exp);\n\t\n\t    while (nested) {\n\t      exp = exp.replace('[' + nested[1] + ']', '.' + service.parseExpression(nested[1], depth).get());\n\t      nested = matchNestedExpression(exp);\n\t    }\n\t\n\t    return exp;\n\t  }\n\t\n\t  function parseExpression(exp, depth) {\n\t    var service = this;\n\t    // if expression is specific value\n\t    if (!exp || /^(null|false|true|undefined|''|-?[0-9.]+|\\[]|\\{})$/.test(exp)) {\n\t      return {\n\t        \"get\": function get() {\n\t          if (!exp) return exp;\n\t          switch (exp) {\n\t            case 'null':\n\t              return null;\n\t            case 'false':\n\t              return false;\n\t            case 'true':\n\t              return true;\n\t            case 'undefined':\n\t              return;\n\t            case '\\'\\'':\n\t              return '';\n\t            case '[]':\n\t              return [];\n\t            case '{}':\n\t              return {};\n\t            default:\n\t              return parseFloat(exp);\n\t          }\n\t        }\n\t      };\n\t    }\n\t\n\t    exp = service.getKey(exp);\n\t\n\t    var match = exp.match(/^(model\\.)?(\\S+)$/);\n\t\n\t    var modelValue = {\n\t      get: function get() {\n\t        var resolved = service.resolveNestedExpressions(exp, depth);\n\t        var path = ObjectPath.parse(resolved);\n\t        var start = depth || service;\n\t\n\t        while (start && path.length > 1) {\n\t          start = start[path.shift()];\n\t        }\n\t\n\t        return start && start[path[0]];\n\t      },\n\t      getAssignable: function getAssignable() {\n\t        var resolved = service.resolveNestedExpressions(exp, depth);\n\t        var path = ObjectPath.parse(resolved);\n\t        var progress = [];\n\t        var start = depth || service;\n\t\n\t        while (start && path.length > 1) {\n\t          var key = path.shift();\n\t          progress.push(key);\n\t          if (!start[key]) {\n\t            if (/^\\d?$/.test(path[0])) {\n\t              start[key] = [];\n\t            } else {\n\t              start[key] = {};\n\t            }\n\t          }\n\t          start = start[key];\n\t        }\n\t\n\t        return {\n\t          obj: start,\n\t          key: path[0],\n\t          path: service.getKey(progress),\n\t          fullPath: service.getKey(progress.concat(path.slice(0, 1)))\n\t        };\n\t      },\n\t      set: function set(val) {\n\t        var resolved = service.resolveNestedExpressions(exp, depth);\n\t        var path = ObjectPath.parse(resolved);\n\t        var assignable = this.getAssignable();\n\t        assignable.obj[assignable.key] = val;\n\t        return val;\n\t      },\n\t      path: function path() {\n\t        return {\n\t          exp: exp,\n\t          depth: depth,\n\t          key: match[2]\n\t        };\n\t      }\n\t    };\n\t\n\t    return modelValue;\n\t  }\n\t\n\t  function processArray(array) {\n\t    var service = this;\n\t    var key = service.getKey(array.key);\n\t\n\t    array.sortOptions = {\n\t      update: function update(e, ui) {\n\t        var listener = service.arrayListeners[key + '.length'];\n\t        listener.handlers.forEach(function (handler) {\n\t          handler(listener.prev, listener.prev, true);\n\t        });\n\t      }\n\t    };\n\t\n\t    service.processSection(array);\n\t  }\n\t\n\t  function processSection(section) {\n\t    var service = this;\n\t    _.each(section.items, service.processField.bind(service));\n\t  }\n\t\n\t  function processComponent(component) {\n\t    var service = this;\n\t\n\t    component.type = 'section';\n\t    component.htmlClass = 'row';\n\t\n\t    var cols = 12 / _.reject(component.items, 'hidden').length;\n\t\n\t    _.each(component.items, function (field, i) {\n\t      service.processField(field);\n\t      component.items[i] = {\n\t        type: 'section',\n\t        htmlClass: 'col-sm-' + cols,\n\t        items: [field]\n\t      };\n\t    });\n\t  }\n\t\n\t  function processCurrency(field) {\n\t    field.currencyFormat = {\n\t      'currency-dollars': 'dollars',\n\t      'currency-microcents': 'microcents',\n\t      'currency': 'cents'\n\t    }[field.schema.format];\n\t\n\t    field.type = 'cn-currency';\n\t  }\n\t\n\t  function processPercentage(field) {\n\t    field.type = 'cn-percentage';\n\t  }\n\t\n\t  function processReusable(field) {\n\t    var service = this;\n\t    field.type = 'cn-reusable';\n\t    field.view = field.view || 'new';\n\t    field.items.forEach(service.processField.bind(service));\n\t    field.items = [{\n\t      type: 'section',\n\t      items: field.items,\n\t      condition: '!model.' + service.getKey(field.key) + '.id'\n\t    }];\n\t  }\n\t\n\t  function processMediaUpload(field) {\n\t    var service = this;\n\t    field.type = 'cn-mediaupload';\n\t    _.each(field.data, function (dataProp, key) {\n\t      field.data[key] = service.parseExpression(dataProp).get();\n\t    });\n\t  }\n\t\n\t  function processCsvUpload(field) {\n\t    var service = this;\n\t    field.type = 'cn-csvupload';\n\t  }\n\t\n\t  function processRadios(field) {\n\t    field.type = 'cn-radios';\n\t  }\n\t\n\t  function processRadiobuttons(radios) {\n\t    var service = this;\n\t    radios.type = 'cn-radiobuttons';\n\t    if (radios.fullWidth) {\n\t      radios.btnClass = 'col-sm-' + _.divide(12, radios.titleMap.length);\n\t    }\n\t  }\n\t\n\t  function processDate(date) {\n\t    var service = this;\n\t    date.type = 'cn-datetimepicker';\n\t\n\t    if (date.schema.format === 'time-minutes') {\n\t      date.maxView = 'hour';\n\t      date.iconClass = 'fa fa-clock-o';\n\t\n\t      date.modelFormatter = function (val) {\n\t        if (!val) return;\n\t\n\t        var m = moment(val);\n\t\n\t        return _.add(_.multiply(m.hours(), 60), m.minutes());\n\t      };\n\t\n\t      date.modelParser = function (val) {\n\t        if (!val) return;\n\t\n\t        var d = parseInt(val);\n\t        var hours = _.floor(d / 60);\n\t        var minutes = d % 60;\n\t\n\t        return moment().startOf('day').add('hours', hours).add('minutes', minutes);\n\t      };\n\t\n\t      date.viewFormatter = function (val) {\n\t        if (!val) return;\n\t\n\t        return date.modelParser(val).format(date.dateFormat);\n\t      };\n\t\n\t      date.viewParser = function (val) {\n\t        if (!val) return;\n\t\n\t        var match = val.match(/^(\\d{1,2}):?(\\d{1,2})? (a|p)/);\n\t        if (!match) return;\n\t\n\t        var hours = _.add(match[1] === '12' ? 0 : match[1], match[3] === 'a' ? 0 : 12);\n\t        var minutes = match[2] || '00';\n\t\n\t        if (minutes.length === 1) minutes += '0';\n\t\n\t        return _.add(_.multiply(hours, 60), minutes);\n\t      };\n\t    }\n\t  }\n\t\n\t  function getSelectValProp(select) {\n\t    var isArray = select.getSchemaType() === 'array';\n\t    return select.valueProperty || (isArray ? select.schema.items.type : select.schema.type) !== 'object' && 'value';\n\t  }\n\t\n\t  function getAllowedSelectValue(select, val, titleMap) {\n\t    titleMap = titleMap || select.getTitleMap();\n\t    var valProp = getSelectValProp(select);\n\t    if (!valProp) return;\n\t\n\t    if (select.getSchemaType() === 'array') {\n\t      if (!val || !_.isArray(val)) return;\n\t\n\t      var mapVal = val.map(function (x) {\n\t        return _.find(titleMap, _defineProperty({}, valProp, x));\n\t      }).filter(function (x) {\n\t        return x !== undefined;\n\t      });\n\t\n\t      return mapVal;\n\t    } else {\n\t      return _.find(titleMap, _defineProperty({}, valProp, val));\n\t    }\n\t  }\n\t\n\t  function processSelect(select) {\n\t    var service = this,\n\t        schema = select.schema;\n\t\n\t    if (select.titleMapResolve || select.titleMap) {\n\t      select.getTitleMap = function () {\n\t        return select.titleMap || service.schema.data[select.titleMapResolve];\n\t      };\n\t\n\t      select.onInit = function (val, form, event, setter) {\n\t        // make sure we use correct value\n\t        var modelValue = service.parseExpression(form.key, service.model);\n\t        if (event === 'tag-init') {\n\t          var newVal = getAllowedSelectValue(select, modelValue.get());\n\t          if (newVal !== undefined) setter(newVal);\n\t        }\n\t      };\n\t    }\n\t\n\t    if (select.titleMapQuery) {\n\t      var key = select.titleMapQuery.params.q;\n\t      select.titleQuery = function (q) {\n\t        var params = {};\n\t        if (key) {\n\t          params[key] = q;\n\t        }\n\t        return Api.get({\n\t          url: select.titleMapQuery.url,\n\t          params: params\n\t        });\n\t      };\n\t\n\t      // wrap in string so returns truthy when compiled, but converted to number within directive\n\t      if (!key) select.minLookup = '0';\n\t\n\t      select.onInit = function (val, form, event, setter) {\n\t        if (event === 'tag-init') {\n\t          setter(val);\n\t        }\n\t      };\n\t    }\n\t\n\t    if (schema.items) {\n\t      var defaults = [];\n\t      _.each(schema.items.properties, function (schema, key) {\n\t        if (angular.isDefined(schema.default)) {\n\t          defaults.push({\n\t            \"key\": key,\n\t            default: schema.default\n\t          });\n\t        }\n\t      });\n\t      if (defaults.length) {\n\t        select.onAdd = function (val, form, event) {\n\t          if (val.value && event === 'tag-added') {\n\t            _.each(defaults, function (prop) {\n\t              if (!val.value[prop.key]) val.value[prop.key] = prop.default;\n\t            });\n\t          }\n\t        };\n\t      }\n\t    }\n\t\n\t    if (!select.type.includes('cn-autocomplete')) {\n\t      if (select.items) {\n\t        select.detailedList = true;\n\t\n\t        if (select.items[0].type !== 'component') {\n\t          if (select.items.length > 1) {\n\t            select.items = [{\n\t              type: \"component\",\n\t              items: select.items\n\t            }];\n\t          }\n\t\n\t          service.processFieldset(select);\n\t        }\n\t\n\t        select.type = 'cn-autocomplete-detailed';\n\t      } else {\n\t        if (!select.selectionStyle) {\n\t          select.selectionStyle = select.key === 'tags' ? 'tags' : select.getSchemaType() === 'array' && select.schema.maxItems !== 1 ? 'list' : 'select';\n\t        }\n\t        select.type = 'cn-autocomplete';\n\t      }\n\t\n\t      if (select.titleMapResolve) {\n\t        $rootScope.$on('cnFlexFormDiff:data', function (e, data) {\n\t          if (data[select.titleMapResolve]) {\n\t            var modelValue = service.parseExpression(select.key, service.model);\n\t            var val = modelValue.get();\n\t            if (val !== undefined) {\n\t              var valid = getAllowedSelectValue(select, val, data[select.titleMapResolve]);\n\t              if (valid === undefined) modelValue.set();\n\t            }\n\t          }\n\t        });\n\t      }\n\t    }\n\t\n\t    if (select.displayFormat) {\n\t      select.itemFormatter = service.processTemplate(select.displayFormat);\n\t    }\n\t\n\t    service.registerHandler(select.key, function (val) {\n\t      var form = service.formCtrl && service.formCtrl[service.getKey(select.key)];\n\t      if (form && form.$setDirty) form.$setDirty();\n\t    }, select.updateSchema);\n\t  }\n\t\n\t  function processToggle(toggle) {\n\t    toggle.type = 'cn-toggle';\n\t  }\n\t\n\t  function processHelp(help) {\n\t    help.htmlClass = 'help-block';\n\t  }\n\t\n\t  function processDisplay(display) {\n\t    var service = this;\n\t    display.type = 'cn-display';\n\t    display.getDisplay = service.processTemplate(display.displayFormat, true);\n\t  }\n\t\n\t  function processTemplate(tpl, parseScope) {\n\t    var service = this;\n\t    //var processor = /<(\\S+)[^>]*>.*<\\/\\1>/.test(tpl) ? $compile : $interpolate;\n\t    var processor = $interpolate;\n\t    return function (scope, arrayIndex) {\n\t      if (parseScope) {\n\t        if (angular.isDefined(arrayIndex)) {\n\t          scope = _.map(scope, function (key) {\n\t            return key === 'arrayIndex' ? arrayIndex : key;\n\t          });\n\t        }\n\t        scope = service.parseExpression(scope, service.model).get();\n\t      }\n\t      return processor(tpl)(scope);\n\t    };\n\t  }\n\t\n\t  function processTable(table) {\n\t    var service = this;\n\t    table.type = 'cn-table';\n\t    table.items.forEach(function (row) {\n\t      for (var i = 0; i < table.columns.length; i++) {\n\t        _.extend(row.items[i], table.columns[i]);\n\t        //if(row.columns[i].key) row.columns[i].key = ObjectPath.parse(row.columns[i].key);\n\t        service.processField(row.items[i]);\n\t      }\n\t    });\n\t  }\n\t\n\t  function processSelectDisplay(selectDisplay) {\n\t    var service = this,\n\t        schema = service.getSchema(selectDisplay.key),\n\t        selectField = _.find(selectDisplay.items, 'selectField'),\n\t        handler;\n\t\n\t    if (schema && schema.type === 'array') {\n\t      handler = service.setupArraySelectDisplay(selectDisplay, selectField);\n\t    } else {\n\t      handler = service.setupSelectDisplay(selectDisplay, selectField);\n\t    }\n\t\n\t    selectDisplay.selectDisplay = false;\n\t    service.registerHandler(selectField.key, handler, selectField.updateSchema, true);\n\t    //service.processField(selectDisplay);\n\t  }\n\t\n\t  function setupArraySelectDisplay(selectDisplay, selectField) {\n\t    var service = this;\n\t    _.each(selectDisplay.items, function (item) {\n\t      if (item.condition !== 'false') {\n\t        item.condition = 'true';\n\t      }\n\t    });\n\t    var handler = function handler(val, prev, key) {\n\t      var index = getArrayIndex(key);\n\t      _.each(selectDisplay.items, function (item) {\n\t        var selectKey = service.getKey(selectField.key);\n\t        var key = service.getKey(item.key);\n\t        var splitKey = ObjectPath.parse(key);\n\t        if (selectKey === key) return;\n\t        var indexedSelectKey = service.setArrayIndex(selectKey, index);\n\t        var selectValue = service.parseExpression(indexedSelectKey, service.model).get();\n\t        var formCopies = service.getArrayCopies(key);\n\t        if (_.includes(selectValue, splitKey[splitKey.length - 1])) {\n\t          _.each(formCopies, function (copy) {\n\t            if (getArrayIndex(copy) == index) {\n\t              copy.condition = 'true';\n\t            }\n\t          });\n\t        } else {\n\t          _.each(formCopies, function (copy) {\n\t            if (getArrayIndex(copy) == index) {\n\t              copy.condition = 'false';\n\t              service.parseExpression(service.getKey(copy.key), service.model).set();\n\t            }\n\t          });\n\t        }\n\t      });\n\t    };\n\t    // handle legacy objects that don't have values set in the selectField\n\t    var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n\t    _.each(selectDisplay.items, function (item) {\n\t      var key = service.getKey(item.key);\n\t      var selectKey = service.getKey(selectField.key);\n\t      if (key === selectKey) return;\n\t      _.each(model, function (elem, i) {\n\t        var indexedKey = service.setArrayIndex(key, i);\n\t        var splitIndexedKey = ObjectPath.parse(indexedKey);\n\t        var indexedSelectKey = service.setArrayIndex(selectKey, i);\n\t        var selectModel = service.parseExpression(indexedSelectKey, service.model);\n\t        var selectValue = selectModel.get();\n\t        var itemValue = service.parseExpression(indexedKey, service.model).get();\n\t        if (itemValue && !_.includes(selectValue, splitIndexedKey[splitIndexedKey.length - 1])) {\n\t          if (!selectValue) {\n\t            selectValue = [];\n\t          }\n\t          selectValue.push(splitIndexedKey[splitIndexedKey.length - 1]);\n\t          selectModel.set(selectValue);\n\t        }\n\t      });\n\t    });\n\t    // handle new objects with values set in defaults\n\t    var defaults = service.getSchema(selectDisplay.key).default;\n\t    _.each(defaults, function (elem, i) {\n\t      var selectKey = service.getKey(selectField.key);\n\t      var indexedSelectKey = service.setArrayIndex(selectKey, i);\n\t      var selectModel = service.parseExpression(indexedSelectKey, service.model);\n\t      var selectValue = selectModel.get();\n\t      _.each(elem, function (val, key) {\n\t        if (!selectValue) {\n\t          selectValue = [];\n\t        }\n\t        selectValue.push(key);\n\t        selectModel.set(selectValue);\n\t      });\n\t    });\n\t    // run handler once all arrayCopies have been instantiated\n\t    var count = 0;\n\t    var keyMap = _.pluck(_.reject(selectDisplay.items, { \"condition\": \"false\" }), 'key');\n\t    var once = $rootScope.$on('flexFormArrayCopyAdded', function (event, key) {\n\t      var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n\t      if (model) {\n\t        var total = model.length * keyMap.length;\n\t        if (_.includes(keyMap, key)) {\n\t          count++;\n\t        }\n\t        if (count === total) {\n\t          for (var i = 0; i < model.length; i++) {\n\t            handler(null, null, '[' + i + ']');\n\t          }\n\t          count = 0;\n\t        }\n\t      }\n\t    });\n\t    var resetCount = $rootScope.$on('flexForm.updatePage', function () {\n\t      count = 0;\n\t    });\n\t    service.events.push(once);\n\t    service.events.push(resetCount);\n\t    return handler;\n\t  }\n\t\n\t  function setupSelectDisplay(selectDisplay, selectField) {\n\t    var service = this;\n\t    var handler = function handler() {\n\t      var selectKey = service.getKey(selectField.key);\n\t      _.each(selectDisplay.items, function (item) {\n\t        var key = service.getKey(item.key);\n\t        var splitKey = ObjectPath.parse(key);\n\t        if (selectKey === key) return;\n\t        var selectValue = service.parseExpression(selectKey, service.model).get();\n\t        if (_.includes(selectValue, splitKey[splitKey.length - 1])) {\n\t          item.condition = 'true';\n\t        } else {\n\t          item.condition = 'false';\n\t          service.parseExpression(key, service.model).set();\n\t        }\n\t      });\n\t    };\n\t    // handle legacy objects that don't have values set in the selectField\n\t    var selectKey = service.getKey(selectField.key);\n\t    var selectModel = service.parseExpression(selectKey, service.model);\n\t    var selectValue = selectModel.get();\n\t    _.each(selectDisplay.items, function (item) {\n\t      var key = service.getKey(item.key);\n\t      if (selectKey === key) return;\n\t      var splitKey = ObjectPath.parse(key);\n\t      var itemValue = service.parseExpression(key, service.model).get();\n\t      if (itemValue && !_.includes(selectValue, splitKey[splitKey.length - 1])) {\n\t        if (!selectValue) {\n\t          selectValue = [];\n\t        }\n\t        selectValue.push(splitKey[splitKey.length - 1]);\n\t        selectModel.set(selectValue);\n\t      }\n\t    });\n\t    // handle new objects with values set in the defaults\n\t    var defaults = service.getSchema(selectDisplay.key).default;\n\t    _.each(defaults, function (val, key) {\n\t      if (!selectValue) {\n\t        selectValue = [];\n\t      }\n\t      selectValue.push(key);\n\t      selectModel.set(selectValue);\n\t    });\n\t    // set default values here\n\t    var model = service.parseExpression(selectDisplay.key, service.model);\n\t    if (defaults && !model.get()) {\n\t      model.set(defaults);\n\t    }\n\t\n\t    return handler;\n\t  }\n\t\n\t  function setupSchemaRefresh(refresh) {\n\t    var service = this;\n\t    service.refreshSchema = _.debounce(function (updateSchema) {\n\t      var params = _.extend(cnFlexFormConfig.getStateParams(), service.params);\n\t      var diff = cnUtil.diff(service.schema.params, params, true);\n\t      var keys;\n\t\n\t      if (diff || updateSchema) {\n\t        if (updateSchema) params.updateSchema = updateSchema;else {\n\t          keys = _.keys(diff);\n\t\n\t          if (keys.length > 1) {\n\t            diff = _.omit(diff, _.isNull);\n\t            keys = _.keys(diff);\n\t          }\n\t\n\t          params.updateSchema = _.first(keys);\n\t        }\n\t\n\t        if (!params.updateSchema) {\n\t          diff = cnUtil.diff(params, _.omit(service.schema.params, 'updateSchema'));\n\t          keys = _.keys(diff);\n\t\n\t          params.updateSchema = _.first(keys);\n\t        }\n\t\n\t        refresh(params).then(function (schema) {\n\t          ++service.updates;\n\t          //service.updateSchema(schema);\n\t          service.processUpdatedSchema(schema);\n\t        });\n\t      }\n\t    }, 100);\n\t\n\t    service.refreshData = _.debounce(function () {\n\t      refresh(_.extend(service.schema.params, { updateSchema: 'refreshData' })).then(function (schema) {\n\t        service.processUpdatedSchema(schema);\n\t      });\n\t    }, 100);\n\t\n\t    service.events.push($rootScope.$on('ffRefreshData', service.refreshData));\n\t  }\n\t\n\t  function processUpdatedSchema(schema) {\n\t    var service = this;\n\t    if (schema.diff) {\n\t      service.schema.params = schema.params;\n\t\n\t      if (schema.diff.data) {\n\t        $rootScope.$broadcast('cnFlexFormDiff:data', schema.diff.data);\n\t        _.each(schema.diff.data, function (data, prop) {\n\t          if (data && data.data && !_.isEmpty(service.schema.data[prop].data) && !data.reset) {\n\t            data.data = service.schema.data[prop].data.concat(data.data);\n\t          }\n\t          service.schema.data[prop] = data;\n\t          if (service.resolveRegister[prop]) {\n\t            _.each(service.resolveRegister[prop], function (registers) {\n\t              registers.forEach(function (register) {\n\t                service.handleResolve(register.field, register.prop, register.exp);\n\t              });\n\t            });\n\t          }\n\t        });\n\t      }\n\t\n\t      var keys = [];\n\t\n\t      if (schema.diff.schema) {\n\t        $rootScope.$broadcast('cnFlexFormDiff:schema', schema.diff.schema);\n\t        _.each(schema.diff.schema, function (schema, key) {\n\t          service.schema.schema.properties[key] = schema;\n\t          reprocessSchema(schema, key, keys);\n\t        });\n\t      }\n\t\n\t      if (schema.diff.form) {\n\t        $rootScope.$broadcast('cnFlexFormDiff:form', schema.diff.form);\n\t        _.each(schema.diff.form, function (form) {\n\t\n\t          if (keys.indexOf(form.key) === -1) {\n\t            keys.push(form.key);\n\t          }\n\t\n\t          // don't want to override key when extending cached objects\n\t          //var key = form.key;\n\t          //delete form.key;\n\t\n\t          var cached = service.getFromFormCache(form.key);\n\t          if (cached) {\n\t            service.reprocessField(cached, form);\n\t          }\n\t          var copies = service.getArrayCopies(form.key);\n\t          if (copies) {\n\t            copies.forEach(function (copy) {\n\t              return copy && service.reprocessField(copy, form);\n\t            });\n\t          }\n\t        });\n\t      }\n\t\n\t      if (keys.length) {\n\t        _.each(keys, function (key) {\n\t          var form = service.getFromFormCache(key);\n\t          if (form) service.processField(form);\n\t          if (key.includes('[]')) {\n\t            var copies = service.getArrayCopies(key);\n\t            _.each(copies, function (copy) {\n\t              if (copy) service.processField(copy);\n\t            });\n\t          }\n\t        });\n\t      }\n\t\n\t      service.broadcastErrors();\n\t    } else {\n\t      service.updateSchema(schema);\n\t    }\n\t  }\n\t\n\t  function reprocessField(current, update, isChild) {\n\t    var service = this;\n\t\n\t    // other logic in the service will add conition = 'true' to force\n\t    // condition to eval true, so we set the update condition to 'true'\n\t    // before comparing\n\t    if (!update.condition && current.condition) update.condition = 'true';\n\t    var redraw = !isChild && current.condition !== update.condition;\n\t\n\t    _.extend(current, _.omit(update, 'items', 'key'));\n\t\n\t    current._ogKeys.forEach(function (key) {\n\t      if (!update[key]) delete current[key];\n\t    });\n\t    current._ogKeys = _.keys(update);\n\t\n\t    service.deregisterHandlers(update.key);\n\t\n\t    $rootScope.$broadcast('cnFlexFormReprocessField', update.key);\n\t\n\t    // why do we redraw? If we're doing it to show error message\n\t    // that has been addressed from the angular-schema-form library\n\t    // if there's another issue, try triggering the specific action required\n\t    // instead of redrawing the whole form\n\t    if (redraw && current.redraw) {\n\t      console.log('TODO: see if this can be removed');\n\t      current.redraw();\n\t    }\n\t  }\n\t\n\t  function reprocessSchema(schema, key, keys) {\n\t    keys.push(key);\n\t    if (schema.properties) {\n\t      _.each(schema.properties, function (schema, subKey) {\n\t        reprocessSchema(schema, key + '.' + subKey, keys);\n\t      });\n\t    }\n\t    if (schema.items && schema.items.properties) {\n\t      _.each(schema.properties, function (schema, subKey) {\n\t        reprocessSchema(schema, key + '[].' + subKey, keys);\n\t      });\n\t    }\n\t  }\n\t\n\t  function buildError(field) {\n\t    var service = this;\n\t    var key = service.getKey(field.key);\n\t    return {\n\t      key: key,\n\t      message: field.error\n\t    };\n\t  }\n\t\n\t  function broadcastErrors() {\n\t    var service = this;\n\t    $timeout(function () {\n\t      service.errors.forEach(function (error) {\n\t        $rootScope.$broadcast('schemaForm.error.' + error.key, 'serverValidation', error.message);\n\t      });\n\t    }, 1);\n\t  }\n\t\n\t  function replaceArrayIndex(resolve, key) {\n\t    if (!resolve.includes('arrayIndex')) return resolve;\n\t    var arrayIndexKey = /([^.[]*)\\[arrayIndex\\]/.exec(resolve);\n\t    var re = new RegExp(arrayIndexKey[1] + '\\\\[(-?\\\\d+)\\\\]');\n\t    var index = re.exec(key);\n\t    if (!index) return resolve;\n\t    return resolve.replace(new RegExp(arrayIndexKey[0].replace(/(\\[|\\])/g, '\\\\$1'), 'g'), index[0]);\n\t  }\n\t\n\t  function getArrayIndex(key) {\n\t    if (_.isObject(key)) {\n\t      return _.find(key.key, function (key) {\n\t        return _.isNumber(key);\n\t      });\n\t    } else {\n\t      return (/\\[(\\d+)\\]/.exec(key)[1]\n\t      );\n\t    }\n\t  }\n\t\n\t  function setArrayIndex(key, index, asArray) {\n\t    var service = this;\n\t    var keyCopy;\n\t    if (_.isString(key)) {\n\t      keyCopy = ObjectPath.parse(key);\n\t    } else {\n\t      keyCopy = _.clone(key);\n\t    }\n\t    var indexOfIndex = keyCopy.indexOf('');\n\t    keyCopy[indexOfIndex] = index;\n\t\n\t    if (asArray) {\n\t      return keyCopy;\n\t    } else {\n\t      return service.getKey(keyCopy);\n\t    }\n\t  }\n\t\n\t  function cleanup() {\n\t    var service = this;\n\t    _.each(service.events, function (listener) {\n\t      listener();\n\t    });\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormService', cnFlexFormServiceProvider);\n\t\n\texports.default = cnFlexFormServiceProvider;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tcnFlexFormModalLoaderService.$inject = [\"$stateParams\", \"$q\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar modalMap = {};\n\tvar promiseMap = {};\n\t\n\tfunction getPromises(state) {\n\t  if (promiseMap[state]) return promiseMap[state];\n\t\n\t  var promise = {};\n\t  promiseMap[state] = promise;\n\t  return promise;\n\t}\n\t\n\tfunction getPromise(state, id, $q) {\n\t  var promises = getPromises(state);\n\t  if (promises[id]) return promises[id];\n\t\n\t  var promise = $q.defer();\n\t  promises[id] = promise;\n\t  return promise;\n\t}\n\t\n\tfunction cnFlexFormModalLoaderServiceProvider() {\n\t\n\t  parent.$inject = [\"$stateParams\", \"$q\"];\n\t  return {\n\t    addMapping: addMapping,\n\t    $get: cnFlexFormModalLoaderService\n\t  };\n\t\n\t  ////////////\n\t\n\t  function addMapping(state, def) {\n\t    def.resolve = { parent: parent };\n\t    modalMap[state] = def;\n\t  }\n\t\n\t  function parent($stateParams, $q) {\n\t    'ngInject';\n\t\n\t    return getPromise($stateParams.modal, $stateParams.modalId, $q).promise.then(function (_ref) {\n\t      var parent = _ref.parent;\n\t      return parent;\n\t    });\n\t  }\n\t}\n\t\n\tfunction cnFlexFormModalLoaderService($stateParams, $q) {\n\t  'ngInject';\n\t\n\t  return {\n\t    getMapping: getMapping,\n\t    resolveMapping: resolveMapping\n\t  };\n\t\n\t  /////////////\n\t\n\t  function resolveMapping(state, id, parent) {\n\t    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\t    var scope = options.scope;\n\t\n\t    if (scope) {\n\t      //scope.options = scope.options || {};\n\t      //scope.options.destroyStrategy = 'retain';\n\t      modalMap[state].scope = scope;\n\t    }\n\t    var d = getPromise(state, id, $q);\n\t    d.resolve({ parent: parent, options: options });\n\t    return d.promise;\n\t  }\n\t\n\t  function getMapping(state) {\n\t    var d = $q.defer();\n\t    getPromise($stateParams.modal, $stateParams.modalId, $q).promise.then(function (_ref2) {\n\t      var parent = _ref2.parent,\n\t          options = _ref2.options;\n\t\n\t      d.resolve({ state: modalMap[state], options: options });\n\t      return parent;\n\t    });\n\t    return d.promise;\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.provider('cnFlexFormModalLoaderService', cnFlexFormModalLoaderServiceProvider);\n\t\n\texports.default = cnFlexFormModalLoaderServiceProvider;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tFlexFormModalLoader.$inject = [\"FlexFormModal\", \"$state\", \"$rootScope\", \"$stateParams\"];\n\tFlexFormModal.$inject = [\"cnFlexFormModalLoaderService\", \"$uibModal\", \"$stateParams\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction FlexFormModalLoader(FlexFormModal, $state, $rootScope, $stateParams) {\n\t  'ngInject';\n\t\n\t  var vm = this;\n\t\n\t  activate();\n\t\n\t  //////////\n\t\n\t  function activate() {\n\t    FlexFormModal.open(vm).then(function (_ref) {\n\t      var modal = _ref.modal,\n\t          onDismiss = _ref.options.onDismiss;\n\t\n\t      vm.modal = modal;\n\t      vm.modal.result.finally(goBack);\n\t      if (onDismiss) vm.modal.result.catch(function () {\n\t        return onDismiss($stateParams.restParams);\n\t      });\n\t      vm.dismissEvent = $rootScope.$on('$stateChangeStart', dismissModal);\n\t    });\n\t  }\n\t\n\t  function goBack() {\n\t    if (!$state.transition) {\n\t      $state.go('^');\n\t    }\n\t  }\n\t\n\t  function dismissModal() {\n\t    console.log('dismissModal');\n\t    vm.dismissEvent();\n\t    vm.modal.dismiss();\n\t  }\n\t}\n\t\n\tfunction FlexFormModal(cnFlexFormModalLoaderService, $uibModal, $stateParams) {\n\t  'ngInject';\n\t\n\t  return { open: open };\n\t\n\t  ////////////\n\t\n\t  function open() {\n\t    return cnFlexFormModalLoaderService.getMapping($stateParams.modal).then(function (_ref2) {\n\t      var state = _ref2.state,\n\t          options = _ref2.options;\n\t      return {\n\t        modal: $uibModal.open(state),\n\t        options: options\n\t      };\n\t    });\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.controller('FlexFormModalLoader', FlexFormModalLoader)\n\t//.factory('FlexFormModal', FlexFormModal);\n\t\n\texports.FlexFormModalLoader = FlexFormModalLoader;\n\texports.FlexFormModal = FlexFormModal;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* WEBPACK VAR INJECTION */(function(process) {'use strict';\n\t\n\tFlexForm.$inject = [\"cnFlexFormService\", \"$scope\", \"$location\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexForm() {\n\t  return {\n\t    restrict: 'E',\n\t    template: '\\n      <div ng-if=\"vm.showForm()\">\\n        <ng-form name=\"{{vm.formName}}\"\\n              sf-schema=\"vm.config.schema.schema\"\\n              sf-form=\"vm.form\"\\n              sf-model=\"vm.model\"></ng-form>\\n        <!-- debug panel to display model -->\\n        <section ng-if=\"vm.debug\"><pre pretty-json=\"vm.model\"></pre></section>\\n      </div>\\n    ',\n\t    scope: {\n\t      config: '=ffConfig',\n\t      model: '=ffModel',\n\t      formIndex: '=ffFormIndex',\n\t      formName: '=ffFormName',\n\t      delayForm: '=ffDelayForm',\n\t      cleanupEvent: '=ffCleanupEvent'\n\t    },\n\t    controller: FlexForm,\n\t    controllerAs: 'vm',\n\t    bindToController: true\n\t  };\n\t}\n\t\n\tfunction FlexForm(cnFlexFormService, $scope, $location) {\n\t  'ngInject';\n\t\n\t  var vm = this;\n\t  vm.service = undefined;\n\t  vm.events = [];\n\t\n\t  vm.activate = activate;\n\t  vm.cleanup = cleanup;\n\t  vm.process = process;\n\t  vm.showForm = showForm;\n\t\n\t  vm.events.push($scope.$watch(function () {\n\t    return vm.config.schema;\n\t  }, vm.process));\n\t\n\t  vm.activate();\n\t\n\t  $scope.$on(vm.cleanupEvent || '$destroy', vm.cleanup);\n\t\n\t  //////////\n\t\n\t  function activate() {\n\t    //console.log('vm.formName:', vm.formName);\n\t    if (angular.isNumber(vm.formIndex)) {\n\t      vm.form = vm.config.schema.forms[vm.formIndex].form;\n\t    } else {\n\t      vm.form = vm.config.schema.form;\n\t    }\n\t\n\t    // debug\n\t    if ($location.search().debug) {\n\t      vm.debug = true;\n\t    }\n\t  }\n\t\n\t  function process(cur, prev) {\n\t    //console.log('process:', cur, prev);\n\t    if (vm.form) {\n\t      if (!vm.service) {\n\t        vm.service = cnFlexFormService(vm.config.schema, vm.model, {\n\t          formCtrl: vm.config.formCtrl,\n\t          getSchema: vm.config.getSchema,\n\t          updateSchema: updateSchema\n\t        });\n\t      } else {\n\t        console.log('vm.service.isCompiled():', vm.service.isCompiled());\n\t        vm.service.compile(vm.config.schema, vm.model);\n\t      }\n\t      //$scope.$broadcast('schemaFormRedraw');\n\t    }\n\t  }\n\t\n\t  function showForm() {\n\t    //console.log('showForm:', vm.delayForm, vm.formName);\n\t    return !vm.delayForm && vm.service && vm.service.isCompiled();\n\t  }\n\t\n\t  function updateSchema(schema) {\n\t    vm.config.schema = schema;\n\t    vm.activate();\n\t  }\n\t\n\t  function cleanup() {\n\t    _.each(vm.events, function (listener) {\n\t      listener();\n\t    });\n\t    vm.service.cleanup();\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.directive('cnFlexForm', cnFlexForm);\n\t\n\texports.default = cnFlexForm;\n\t/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(11)))\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\t// shim for using process in browser\n\tvar process = module.exports = {};\n\t\n\t// cached from whatever global is present so that test runners that stub it\n\t// don't break things.  But we need to wrap it in a try catch in case it is\n\t// wrapped in strict mode code which doesn't define any globals.  It's inside a\n\t// function because try/catches deoptimize in certain engines.\n\t\n\tvar cachedSetTimeout;\n\tvar cachedClearTimeout;\n\t\n\tfunction defaultSetTimout() {\n\t    throw new Error('setTimeout has not been defined');\n\t}\n\tfunction defaultClearTimeout () {\n\t    throw new Error('clearTimeout has not been defined');\n\t}\n\t(function () {\n\t    try {\n\t        if (typeof setTimeout === 'function') {\n\t            cachedSetTimeout = setTimeout;\n\t        } else {\n\t            cachedSetTimeout = defaultSetTimout;\n\t        }\n\t    } catch (e) {\n\t        cachedSetTimeout = defaultSetTimout;\n\t    }\n\t    try {\n\t        if (typeof clearTimeout === 'function') {\n\t            cachedClearTimeout = clearTimeout;\n\t        } else {\n\t            cachedClearTimeout = defaultClearTimeout;\n\t        }\n\t    } catch (e) {\n\t        cachedClearTimeout = defaultClearTimeout;\n\t    }\n\t} ())\n\tfunction runTimeout(fun) {\n\t    if (cachedSetTimeout === setTimeout) {\n\t        //normal enviroments in sane situations\n\t        return setTimeout(fun, 0);\n\t    }\n\t    // if setTimeout wasn't available but was latter defined\n\t    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n\t        cachedSetTimeout = setTimeout;\n\t        return setTimeout(fun, 0);\n\t    }\n\t    try {\n\t        // when when somebody has screwed with setTimeout but no I.E. maddness\n\t        return cachedSetTimeout(fun, 0);\n\t    } catch(e){\n\t        try {\n\t            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n\t            return cachedSetTimeout.call(null, fun, 0);\n\t        } catch(e){\n\t            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n\t            return cachedSetTimeout.call(this, fun, 0);\n\t        }\n\t    }\n\t\n\t\n\t}\n\tfunction runClearTimeout(marker) {\n\t    if (cachedClearTimeout === clearTimeout) {\n\t        //normal enviroments in sane situations\n\t        return clearTimeout(marker);\n\t    }\n\t    // if clearTimeout wasn't available but was latter defined\n\t    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n\t        cachedClearTimeout = clearTimeout;\n\t        return clearTimeout(marker);\n\t    }\n\t    try {\n\t        // when when somebody has screwed with setTimeout but no I.E. maddness\n\t        return cachedClearTimeout(marker);\n\t    } catch (e){\n\t        try {\n\t            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n\t            return cachedClearTimeout.call(null, marker);\n\t        } catch (e){\n\t            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n\t            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n\t            return cachedClearTimeout.call(this, marker);\n\t        }\n\t    }\n\t\n\t\n\t\n\t}\n\tvar queue = [];\n\tvar draining = false;\n\tvar currentQueue;\n\tvar queueIndex = -1;\n\t\n\tfunction cleanUpNextTick() {\n\t    if (!draining || !currentQueue) {\n\t        return;\n\t    }\n\t    draining = false;\n\t    if (currentQueue.length) {\n\t        queue = currentQueue.concat(queue);\n\t    } else {\n\t        queueIndex = -1;\n\t    }\n\t    if (queue.length) {\n\t        drainQueue();\n\t    }\n\t}\n\t\n\tfunction drainQueue() {\n\t    if (draining) {\n\t        return;\n\t    }\n\t    var timeout = runTimeout(cleanUpNextTick);\n\t    draining = true;\n\t\n\t    var len = queue.length;\n\t    while(len) {\n\t        currentQueue = queue;\n\t        queue = [];\n\t        while (++queueIndex < len) {\n\t            if (currentQueue) {\n\t                currentQueue[queueIndex].run();\n\t            }\n\t        }\n\t        queueIndex = -1;\n\t        len = queue.length;\n\t    }\n\t    currentQueue = null;\n\t    draining = false;\n\t    runClearTimeout(timeout);\n\t}\n\t\n\tprocess.nextTick = function (fun) {\n\t    var args = new Array(arguments.length - 1);\n\t    if (arguments.length > 1) {\n\t        for (var i = 1; i < arguments.length; i++) {\n\t            args[i - 1] = arguments[i];\n\t        }\n\t    }\n\t    queue.push(new Item(fun, args));\n\t    if (queue.length === 1 && !draining) {\n\t        runTimeout(drainQueue);\n\t    }\n\t};\n\t\n\t// v8 likes predictible objects\n\tfunction Item(fun, array) {\n\t    this.fun = fun;\n\t    this.array = array;\n\t}\n\tItem.prototype.run = function () {\n\t    this.fun.apply(null, this.array);\n\t};\n\tprocess.title = 'browser';\n\tprocess.browser = true;\n\tprocess.env = {};\n\tprocess.argv = [];\n\tprocess.version = ''; // empty string to avoid regexp issues\n\tprocess.versions = {};\n\t\n\tfunction noop() {}\n\t\n\tprocess.on = noop;\n\tprocess.addListener = noop;\n\tprocess.once = noop;\n\tprocess.off = noop;\n\tprocess.removeListener = noop;\n\tprocess.removeAllListeners = noop;\n\tprocess.emit = noop;\n\t\n\tprocess.binding = function (name) {\n\t    throw new Error('process.binding is not supported');\n\t};\n\t\n\tprocess.cwd = function () { return '/' };\n\tprocess.chdir = function (dir) {\n\t    throw new Error('process.chdir is not supported');\n\t};\n\tprocess.umask = function() { return 0; };\n\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tFlexFormHeader.$inject = [\"$scope\"];\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction cnFlexFormHeader() {\n\t  return {\n\t    restrict: 'E',\n\t    scope: {\n\t      config: '=ffHeaderConfig',\n\t      submit: '&ffSubmit',\n\t      loadOffscreen: '&ffLoadOffscreen'\n\t    },\n\t    controller: FlexFormHeader,\n\t    bindToController: true,\n\t    controllerAs: 'vm',\n\t    template: '\\n        <div class=\"col-md-6\">\\n          <h5 ng-if=\"vm.config.title.lead\">{{::vm.config.title.lead}}</h5>\\n          <h1>\\n            <i ng-show=\"vm.config.title.icon\" class=\"{{vm.config.title.icon}}\"/>\\n            {{vm.config.title.main}}\\n          </h1>\\n          <h5 ng-if=\"vm.config.title.sub\">{{::vm.config.title.sub}}</h5>\\n        </div>\\n        <div class=\"{{vm.config.buttonContainerClass || \\'page-action-btns\\'}}\">\\n          <div class=\"btn-options\"\\n               ng-mouseover=\"vm.loadOffscreen()\">\\n            <a class=\"btn btn-default-dark\"\\n               ng-if=\"vm.config.actionConfig.returnState\"\\n               ui-sref=\"{{vm.config.actionConfig.returnState}}\">\\n              {{vm.config.actionConfig.returnText || \\'Cancel\\'}}\\n            </a>\\n            <a class=\"btn btn-{{vm.config.actionConfig.closeButton.style ? vm.config.actionConfig.closeButton.style : \\'default-dark\\'}}\"\\n               ng-if=\"vm.config.actionConfig.closeButton\"\\n               ng-click=\"vm.config.actionConfig.closeButton.handler()\">\\n               Cancel\\n            </a>\\n            <span ng-repeat=\"button in vm.config.actionConfig.actions\">\\n              <span ng-class=\"{\\'btn-group\\': button.options}\">\\n                <a class=\"btn {{button.style ? \\'btn-\\'+button.style : ($index === vm.config.actionConfig.actions.length - 1 ? \\'btn-primary\\' : \\'btn-default-dark\\')}}\"\\n                   ng-disabled=\"vm.isDisabled(button)\"\\n                   ng-click=\"vm.submit({handler: button.handler})\"\\n                   uib-tooltip=\"{{button.helptext}}\"\\n                   uib-tooltip-placement=\"bottom\"\\n                   ng-bind-html=\"button.text || \\'Save\\'\">\\n                </a>\\n                <a class=\"btn {{button.style ? \\'btn-\\'+button.style : ($index === vm.config.actionConfig.actions.length - 1 ? \\'btn-primary\\' : \\'btn-default-dark\\')}} dropdown-toggle\"\\n                        ng-disabled=\"vm.isDisabled(button)\"\\n                        ng-show=\"button.options\"\\n                        data-toggle=\"dropdown\">\\n                  <span class=\"caret\"></span>\\n                </a>\\n                <ul class=\"dropdown-menu\" ng-if=\"button.options\">\\n                  <li ng-repeat=\"option in button.options\"\\n                      ng-disabled=\"vm.isDisabled(option)\">\\n                    <a ng-click=\"vm.submit({handler: option.handler})\"\\n                       ng-bind-html=\"option.text\">\\n                    </a>\\n                  </li>\\n                </ul>\\n              </span>\\n            </span>\\n          </div>\\n          <p class=\"data-updated-at text-right\"\\n             id=\"data-updated-at\"\\n             ng-hide=\"vm.config.noData\">\\n            <a ng-click=\"vm.updateData()\">Update Data</a>\\n          </p>\\n        </div>'\n\t  };\n\t}\n\t\n\tfunction FlexFormHeader($scope) {\n\t  'ngInject';\n\t\n\t  var vm = this;\n\t\n\t  vm.updateData = updateData;\n\t  vm.isDisabled = isDisabled;\n\t\n\t  ///////////\n\t\n\t  function updateData() {\n\t    console.log('updateData:', updateData);\n\t    $scope.$emit('ffRefreshData');\n\t  }\n\t\n\t  function isDisabled(btnConfig) {\n\t    if (vm.config.isDisabled) return vm.config.isDisabled(btnConfig);\n\t    return false;\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.directive('cnFlexFormHeader', cnFlexFormHeader);\n\t\n\texports.default = cnFlexFormHeader;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tfunction ffValidate() {\n\t  return {\n\t    restrict: 'A',\n\t    scope: { form: '=ffValidate' },\n\t    require: 'ngModel',\n\t    link: link\n\t  };\n\t}\n\t\n\tfunction link($scope, elem, attrs, ngModel) {\n\t  //console.log('$scope, ngModel:', $scope.form, ngModel);\n\t  if ($scope.form && $scope.form.required) {\n\t    $scope.$watch(function () {\n\t      return ngModel.$viewValue;\n\t    }, function (value) {\n\t      // override schemaForm validation\n\t      ngModel.$setValidity('schemaForm', true);\n\t      ngModel.$setValidity('tv4-302', value);\n\t    });\n\t  }\n\t}\n\t\n\t//angular\n\t//.module('cn.flex-form')\n\t//.directive('ffValidate', ffValidate);\n\t\n\texports.default = ffValidate;\n\n/***/ }\n/******/ ])\n});\n;\n\n\n// WEBPACK FOOTER //\n// all.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 55f0361318dfd494b69e","import cnFlexFormConfigProvider from './cn-flex-form-config.service';\nimport cnFlexFormTypesProvider from './cn-flex-form-types.service';\nimport { cnFlexFormRoutesProvider, cnFlexFormRoutes } from './cn-flex-form.routes';\nimport { schemaFormConfig, addTemplates } from './schema-form-extensions';\nimport cnFlexFormServiceProvider from './cn-flex-form.service';\nimport cnFlexFormModalLoaderServiceProvider from './cn-flex-form-modal-loader.service';\nimport { FlexFormModalLoader, FlexFormModal } from './cn-flex-form-modal-loader';\nimport cnFlexForm from './cn-flex-form.directive';\nimport cnFlexFormHeader from './cn-flex-form-header.directive';\nimport ffValidate from './cn-flex-form-validate.directive';\n\nconsole.log(cnFlexFormServiceProvider);\n\nexport default angular\n  .module('cn.flex-form', [\n    'ui.router',\n    'schemaForm',\n    'ui.bootstrap.datetimepicker',\n    'cnTagsInput',\n    //'ngJsonExplorer',\n    'cn.util'\n  ])\n  .provider('cnFlexFormConfig', cnFlexFormConfigProvider)\n  .provider('cnFlexFormTypes', cnFlexFormTypesProvider)\n  .provider('cnFlexFormRoutes', cnFlexFormRoutesProvider)\n  .config(cnFlexFormRoutes)\n  .config(schemaFormConfig)\n  .run(addTemplates)\n  .provider('cnFlexFormService', cnFlexFormServiceProvider)\n  .provider('cnFlexFormModalLoaderService', cnFlexFormModalLoaderServiceProvider)\n  .factory('FlexFormModal', FlexFormModal)\n  .controller('FlexFormModalLoader', FlexFormModalLoader)\n  .directive('cnFlexForm', cnFlexForm)\n  .directive('cnFlexFormHeader', cnFlexFormHeader)\n  .directive('ffValidate', ffValidate)\n  .name;\n\n\n\n// WEBPACK FOOTER //\n// ./src/_cn-flex-form.module.js","function cnFlexFormConfigProvider() {\n\n  const ignoreParams = ['page', 'debug', 'sandbox', 'modal', 'modalId'];\n\n  return {\n    addIgnoreParam,\n    $get: cnFlexFormConfig\n  };\n\n  ////////\n\n  function addIgnoreParam(param) {\n    ignoreParams.push(param);\n  }\n\n  function cnFlexFormConfig($stateParams) {\n    'ngInject';\n\n    return {\n      getStateParams,\n      ignoreParams\n    };\n\n    ////////\n\n    function getStateParams() {\n      return _\n          .chain($stateParams)\n          .omit(ignoreParams)\n          .omit(function(v) {\n            return _.isUndefined(v) || _.isNull(v);\n          })\n          .value();\n    }\n  }\n\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.provider('cnFlexFormConfig', cnFlexFormConfigProvider);\n\nexport default cnFlexFormConfigProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-config.service.js","function cnFlexFormTypesProvider() {\n\n  var fieldTypeRegister = [{\n    condition: field => field.type === 'hidden',\n    type: 'hidden'\n  }, {\n    condition: field => field.type.includes('radios'),\n    type: 'cn-radios'\n  }, {\n    condition: field => field.type.includes('radiobuttons'),\n    type: 'cn-radiobuttons'\n  }, {\n    condition: field => field.type.includes('autocomplete') || field.titleMap || field.titleMapResolve || field.titleMapQuery,\n    type: 'cn-autocomplete'\n  }, {\n    condition: field => field.type === 'cn-datetimepicker' || field.type === 'datetime-local' || field.type === 'time-minutes',\n    type: 'cn-datetimepicker'\n  }, {\n    condition: field => field.type === 'help',\n    type: 'help'\n  }, {\n    condition: field => field.type.includes('display'),\n    type: 'cn-display'\n  }, {\n    condition: field => field.schema && field.schema.format && field.schema.format.includes('currency'),\n    type: 'cn-currency'\n  }, {\n    condition: field => field.schema && field.schema.format === 'percentage',\n    type: 'cn-percentage'\n  }, {\n    condition: field => field.type === 'toggle' || field.type === 'boolean',\n    type: 'cn-toggle'\n  }, {\n    condition: field => field.type === 'mediaupload',\n    type: 'cn-mediaupload'\n  }, {\n    condition: field => field.type === 'csvupload',\n    type: 'cn-csvupload'\n  }, {\n    condition: field => field.type === 'reusable',\n    type: 'cn-reusable'\n  }, {\n    condition: field => field.type === 'table',\n    type: 'cn-table'\n  }, {\n    condition: field => field.type === 'array',\n    type: 'array'\n  }];\n\n  return {\n    registerFieldType: registerFieldType,\n    $get: cnFlexFormTypes\n  };\n\n  ////////\n\n  function registerFieldType(fieldType) {\n    fieldTypeRegister.unshift(fieldType);\n  }\n\n  function cnFlexFormTypes() {\n    return {\n      fieldTypeRegister: fieldTypeRegister,\n      getFieldType: getFieldType\n    };\n\n    /////////\n\n    function getFieldType(field) {\n      for(var i = 0, l = fieldTypeRegister.length; i < l; i++) {\n        if(fieldTypeRegister[i].condition(field)) {\n          return fieldTypeRegister[i].type;\n        }\n      }\n      return field.type || field.schema && field.schema.type;\n    }\n  }\n\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.provider('cnFlexFormTypes', cnFlexFormTypesProvider);\n\nexport default cnFlexFormTypesProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-types.service.js","function cnFlexFormRoutesProvider($stateProvider) {\n  'ngInject';\n\n  return {\n    addStates,\n    $get\n  };\n\n  ////////////\n\n  function $get() {\n    // nothing to do here, but required\n  }\n\n  function addStates({ permissions, name }) {\n    const shared = {\n      controller: 'FlexFormModalLoader',\n      controllerAs: 'vm',\n      permissions\n    };\n    $stateProvider\n        .state(`${name}.page.modal`, {\n          url: '/~:modal/:modalId',\n          ...shared\n        })\n        .state(`${name}.page.modalParams`, {\n          url: '/~:modal/:modalId/:restParams',\n          ...shared\n        });\n  }\n}\n\nfunction cnFlexFormRoutes($stateProvider) {\n  'ngInject';\n\n  $stateProvider\n      .state('flex-form-sandbox', {\n        url: '/flex-form/sandbox',\n        controller: 'FlexFormSandbox',\n        controllerAs: 'vm',\n        templateUrl: 'app/components/cn-flex-form/sandbox.html'\n      });\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.provider('cnFlexFormRoutes', cnFlexFormRoutesProvider)\n    //.config(cnFlexFormRoutes);\n\nexport { cnFlexFormRoutes, cnFlexFormRoutesProvider };\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form.routes.js","//angular.module('cn.flex-form')\n    //.config(schemaFormConfig)\n    //.run(addTemplates);\n\nfunction schemaFormConfig(cnFlexFormServiceProvider) {\n  'ngInject';\n\n  tv4.addFormat({\n    'url': data => _.isString(data) && !/^(https?:\\/\\/.{2}|$)/.test(data) && 'invalid url'\n  });\n\n  var extensions = [\n    'cn-fieldset',\n    'cn-toggle',\n    'cn-datetimepicker',\n    'cn-autocomplete',\n    'cn-autocomplete-detailed',\n    'cn-currency',\n    'cn-radios',\n    'cn-radiobuttons',\n    'cn-percentage',\n    'cn-display',\n    'cn-mediaupload',\n    'cn-csvupload',\n    'cn-reusable',\n    'cn-table'\n  ];\n\n  _.each(extensions, function(extension) {\n    cnFlexFormServiceProvider.registerField({\n      type: extension,\n      templateUrl: `app/components/cn-flex-form/forms/${extension}.html`\n    });\n  });\n}\n\nfunction addTemplates($templateCache) {\n  'ngInject';\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-toggle.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n        <div class=\"clearfix\">\n          <cn-toggle-switch\n            class=\"pull-left\"\n            ng-show=\"form.key\"\n            ng-model-options=\"form.ngModelOptions\"\n            ng-model=\"$$value$$\"\n            sf-changed=\"form\"\n            schema-validate=\"form\"\n            on-value=\"form.onValue\"\n            off-value=\"form.offValue\"\n            read-only=\"form.readonly\"\n            undefined-class=\"form.undefinedClass\"/>\n          <span ng-show=\"form.onText && form.offText\">\n            {{$$value$$ === form.onValue ? form.onText : form.offText}}\n          </span>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-datetimepicker.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               for=\"{{form.key.join('.')}}\"\n               ng-show=\"showTitle()\">{{form.title}}</label>\n        <cn-datetimepicker\n          ng-show=\"form.key\"\n          ng-model=\"$$value$$\"\n          ng-model-options=\"form.ngModelOptions\"\n          is-disabled=\"form.readonly\"\n          sf-changed=\"form\"\n          schema-validate=\"form\"\n          input-id=\"{{form.key.join('.')}}\"\n          min-date=\"form.minDate\"\n          max-date=\"form.maxDate\"\n          max-view=\"{{form.maxView}}\"\n          cn-date-required=\"form.required\"\n          placeholder=\"{{form.placeholder}}\"\n          model-type=\"{{form.schema.type}}\"\n          model-formatter=\"form.modelFormatter\"\n          model-parser=\"form.modelParser\"\n          view-formatter=\"form.viewFormatter\"\n          view-parser=\"form.viewParser\"\n          format-string={{form.dateFormat}}\n          icon-class={{form.iconClass}}>\n        </cn-datetimepicker>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  var sharedAutocompleteTpl = `\n        <tags-input\n          ng-show=\"form.key\"\n          ng-model=\"$$value$$\"\n          ng-model-options=\"form.ngModelOptions\"\n          ng-disabled=\"form.readonly\"\n          sf-changed=\"form\"\n          schema-validate=\"form\"\n          input-id=\"{{form.key.join('.')}}\"\n          display-property=\"{{form.displayProperty || 'name'}}\"\n          value-property=\"{{form.valueProperty}}\"\n          placeholder=\"{{form.placeholder || ' '}}\"\n          clear-on-blur=\"true\"\n          add-on-comma=\"false\"\n          add-from-autocomplete-only=\"{{!form.allowNew}}\"\n          on-before-tag-added=\"form.onAdd({value: $tag}, form, $event, $prev)\"\n          on-init=\"form.onInit($tag, form, $event, $setter)\"\n          model-type=\"{{form.getSchemaType()}}\"\n          array-value-type=\"{{form.schema.items.type}}\"\n          hide-tags=\"{{form.detailedList}}\"\n          tags-style=\"{{form.selectionStyle}}\"\n          required=\"{{form.required}}\"\n          min-length=\"{{form.minLength}}\"\n          allowed-tags-pattern=\".*\"\n          dropdown-icon=\"true\"\n          item-formatter=\"form.itemFormatter\"\n          min-tags=\"{{form.schema.minItems}}\"\n          max-tags=\"{{form.schema.maxItems || form.getSchemaType() !== 'array' ? 1 : 0}}\"\n          allow-bulk=\"{{form.bulkAdd}}\"\n          bulk-delimiter=\"{{form.bulkDelimiter}}\"\n          bulk-placeholder=\"{{form.bulkPlaceholder}}\"\n          show-clear-all=\"{{form.showClearAll}}\"\n          show-button=\"true\">\n          <auto-complete\n            source=\"form.getTitleMap && form.getTitleMap() || form.titleQuery($query)\"\n            skip-filtering=\"{{form.titleQuery ? true : false}}\"\n            min-length=\"{{form.minLookup || (form.titleQuery && 3 || 0)}}\">\n          </auto-complete>\n        </tags-input>`;\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-autocomplete.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               for=\"{{form.key.join('.')}}-input\"\n               ng-show=\"showTitle()\">{{form.title}}</label>\n        ${sharedAutocompleteTpl}\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-autocomplete-detailed.html',\n      `\n      <div sf-array=\"form\"\n           class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               for=\"{{form.key.join('.')}}-input\"\n               ng-show=\"showTitle()\">{{form.title}}</label>\n        <ol class=\"list-group cn-autocomplete-list\"\n            ng-show=\"modelArray.length\"\n            ng-model=\"modelArray\">\n          <li class=\"list-group-item {{form.fieldHtmlClass}}\"\n              ng-repeat=\"item in modelArray track by $index\">\n            <button ng-hide=\"form.readonly || form.remove === null\"\n                    ng-click=\"deleteFromArray($index)\"\n                    type=\"button\" class=\"close pull-right\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n            <sf-decorator ng-init=\"arrayIndex = $index\" form=\"copyWithIndex($index)\"/>\n          </li>\n        </ol>\n        ${sharedAutocompleteTpl}\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-currency.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key.join('.')}}\">{{form.title}}</label>\n        <div class=\"{{form.fieldClass}} input-group\">\n          <label class=\"input-group-addon\"\n                 ng-disabled=\"form.readonly\"\n                 for=\"{{form.key.join('.')}}\">$</label>\n          <input class=\"form-control\"\n                 cn-currency-format=\"{{form.currencyFormat}}\"\n                 cn-currency-placeholder=\"{{form.placeholder}}\"\n                 ng-show=\"form.key\"\n                 ng-model-options=\"form.ngModelOptions\"\n                 ng-disabled=\"form.readonly\"\n                 sf-changed=\"form\"\n                 schema-validate=\"form\"\n                 type=\"text\"\n                 step=\"any\"\n                 min=\"{{form.min}}\"\n                 max=\"{{form.max}}\"\n                 id=\"{{form.key.join('.')}}\"\n                 name=\"{{form.key.join('.')}}\"\n                 ng-model=\"$$value$$\">\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-radios.html',\n      `<div class=\"form-group {{form.htmlClass}}\"\n            ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n         <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n         <div class=\"btn-group clearfix\">\n           <label class=\"radio radio-block\"\n                  ng-repeat=\"item in form.titleMap\">\n             <input type=\"radio\"\n                    sf-changed=\"form\"\n                    ng-disabled=\"form.readonly\"\n                    ng-model=\"$$value$$\"\n                    ng-model-options=\"form.ngModelOptions\"\n                    schema-validate=\"form\"\n                    ff-validate=\"form\"\n                    ng-value=\"item.value\"\n                    name=\"{{form.key.join('.')}}\">\n             <span class=\"radio-block-icon\" ng-if=\"item.iconClass\">\n               <i class=\"fa fa-{{item.iconClass}} fa-lg\"></i>\n             </span>\n             <span ng-bind-html=\"item.name\"></span>\n           </label>\n         </div>\n         <span class=\"help-block\" sf-message=\"form.description\"></span>\n       </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-radiobuttons.html',\n      `\n      <div class=\"form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\n        <div class=\"btn-group clearfix\">\n          <label class=\"btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? 'active' : ''}}\"\n                 ng-repeat=\"item in form.titleMap\">\n            <input type=\"radio\"\n                   class=\"{{form.fieldHtmlClass}} hide\"\n                   sf-changed=\"form\"\n                   ng-disabled=\"form.readonly\"\n                   ng-model=\"$$value$$\"\n                   ng-model-options=\"form.ngModelOptions\"\n                   schema-validate=\"form\"\n                   ff-validate=\"form\"\n                   ng-value=\"item.value\"\n                   name=\"{{form.key.join('.')}}\">\n            <i class=\"fa fa-{{item.value}} fa-lg\"></i>\n            <span ng-bind-html=\"item.name\"></span>\n          </label>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-percentage.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <div class=\"{{form.fieldClass}} input-group\">\n          <input class=\"form-control\"\n                 cn-percentage-format\n                 ng-show=\"form.key\"\n                 ng-model-options=\"form.ngModelOptions\"\n                 ng-disabled=\"form.readonly\"\n                 sf-changed=\"form\"\n                 schema-validate=\"form\"\n                 type=\"number\"\n                 step=\"any\"\n                 min=\"{{form.min}}\"\n                 max=\"{{form.max}}\"\n                 id=\"{{form.key && form.key[0]}}\"\n                 name=\"{{form.key && form.key[0]}}\"\n                 ng-model=\"$$value$$\">\n           <div class=\"input-group-addon\"\n                  ng-disabled=\"form.readonly\"\n                  for=\"{{form.key && form.key[0]}}\">%</div>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-display.html',\n      `\n      <div class=\"form-group cn-display{{form.htmlClass}}\">\n        <input ng-show=\"form.key\"\n               class=\"form-control\"\n               id=\"{{form.key.join('.')}}\"\n               name=\"{{form.key.join('.')}}\"\n               ng-disabled=\"true\"\n               value=\"{{form.getDisplay(form.key, form.arrayIndex)}}\">\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-fieldset.html',\n      `\n      <fieldset ng-disabled=\"form.readonly\" class=\"schema-form-fieldset {{form.htmlClass}}\">\n        <legend ng-click=\"form.toggleCollapse(form)\"\n                ng-class=\"{'sr-only': !showTitle(), collapsible: form.collapsible}\"\n                ng-mouseenter=\"form.render = true\">\n          <i ng-show=\"form.collapsible\"\n             class=\"fa fa-caret-{{form.collapsed ? 'right' : 'down'}}\"></i>\n          {{ form.title }}\n        </legend>\n        <div class=\"help-block\" ng-show=\"form.description\" ng-bind-html=\"form.description\"></div>\n        <div uib-collapse=\"form.collapsed\">\n          <div ng-if=\"form.render\">\n            <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\n          </div>\n        </div>\n      </fieldset>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-mediaupload.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <media-upload ng-model=\"$$value$$\"\n                      cn-file-type=\"form.fileType\"\n                      cn-upload-path=\"form.uploadPath\"\n                      cn-data=\"form.data\"\n                      cn-preview-path=\"form.previewPath\"\n                      cn-model-value-key=\"form.modelValueKey\"\n                      ng-model-options=\"form.ngModelOptions\"\n                      sf-changed=\"form\"\n                      schema-validate=\"form\"\n                      ff-form=\"form\"\n                      class=\"clearfix\">\n        </media-upload>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n     </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-csvupload.html',\n      `\n      <div class=\"form-group {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\n        <csv-upload ng-model=\"$$value$$\"\n                      cn-upload-path=\"form.uploadPath\"\n                      ng-model-options=\"form.ngModelOptions\"\n                      sf-changed=\"form\"\n                      schema-validate=\"form\"\n                      ff-form=\"form\"\n                      class=\"clearfix\">\n        </csv-upload>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n     </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-reusable.html',\n      `\n      <div class=\"form-group cn-reusable {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <label class=\"control-label\"\n               ng-show=\"showTitle()\"\n               for=\"{{form.key.join('.')}}\">{{form.title}}</label>\n        <cn-select-or\n          ng-show=\"form.key\"\n          select-from=\"form.library\"\n          ng-model=\"$$value$$\"\n          ng-model-options=\"form.ngModelOptions\"\n          sf-changed=\"form\"\n          schema-validate=\"form\"\n          ff-form=\"form\"\n          directiveId=\"form.directiveId\"\n          item-template=\"form.itemTemplate\"\n          toggle-text=\"form.toggleText\"\n          disabled=\"form.readonly\"\n          view=\"form.view\">\n          <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\n        </cn-select-or>\n        <p ng-if=\"form.loadMore && form.view === 'list'\">\n          <a ng-click=\"form.loadMore()\"\n             class=\"btn btn-default btn-block\">Load More</a>\n        </p>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n\n  $templateCache.put(\n      'app/components/cn-flex-form/forms/cn-table.html',\n      `\n      <div class=\"form-group cn-ff-table {{form.htmlClass}}\"\n           ng-class=\"{'has-error': hasError(), 'has-success': hasSuccess()}\">\n        <h6>{{form.title}}</h6>\n        <div class=\"row\">\n          <div ng-repeat=\"col in form.columns\" class=\"{{col.columnWidth}}\">\n            <p class=\"column-header\">{{col.columnHeader}}</p>\n          </div>\n        </div>\n        <div class=\"row\" ng-repeat=\"row in form.items\">\n          <div ng-repeat=\"col in row.items\" class=\"{{col.columnWidth}}\">\n            <sf-decorator form=\"col\"></sf-decorator>\n          </div>\n        </div>\n        <span class=\"help-block\" sf-message=\"form.description\"></span>\n      </div>`\n  );\n}\n\nexport { schemaFormConfig, addTemplates };\n\n\n\n// WEBPACK FOOTER //\n// ./src/schema-form-extensions.js","// Need these modules for test bundle\nvar _ = typeof window !== 'undefined' && window._ || require('lodash');\nvar ObjectPath = typeof window !== 'undefined' && window.ObjectPath || require('objectpath');\n\nconst fieldTypeHandlers = {\n  'fieldset': 'processFieldset',\n  'cn-radios': 'processRadios',\n  'cn-radiobuttons': 'processRadiobuttons',\n  'cn-autocomplete': 'processSelect',\n  'cn-datetimepicker': 'processDate',\n  'help': 'processHelp',\n  'cn-display': 'processDisplay',\n  'cn-currency': 'processCurrency',\n  'cn-percentage': 'processPercentage',\n  'cn-mediaupload': 'processMediaUpload',\n  'cn-csvupload': 'processCsvUpload',\n  'cn-reusable': 'processReusable',\n  'cn-toggle': 'processToggle',\n  'cn-table': 'processTable',\n  'component': 'processComponent',\n  'section': 'processSection',\n  'tabarray': 'processSection',\n  'array': 'processArray'\n};\n\nconst fieldPropHandlers = [{\n  prop: 'selectDisplay',\n  handler: (field, service) => service.processSelectDisplay(field)\n}, {\n  prop: 'resolve',\n  handler: (field, service) => service.processResolve(field)\n}, {\n  prop: 'watch',\n  handler: (field, service) => service.processFieldWatch(field)\n}, {\n  prop: 'type',\n  handler: (field, service) => service.processFieldType(field)\n}, {\n  prop: 'conditionals',\n  handler: (field, service) => service.processConditional(field)\n}, {\n  prop: 'default',\n  handler: (field, service) => service.processDefault(field)\n}, {\n  prop: 'schema',\n  handler: (field, service) => \n    _.isUndefined(field.default) && !_.isUndefined(field.schema.default) && service.processDefault(field)\n}, {\n  prop: 'updateSchema',\n  handler: (field, service) => service.registerHandler(field, null, field.updateSchema)\n}];\n\nfunction cnFlexFormServiceProvider(schemaFormDecoratorsProvider, cnFlexFormTypesProvider) {\n  'ngInject';\n\n  return {\n    registerField,\n    $get: CNFlexFormService\n  };\n\n  //////////\n\n  function registerField(fieldType) {\n    if(fieldType.condition) {\n      cnFlexFormTypesProvider.registerFieldType({\n        condition: fieldType.condition,\n        type: fieldType.type\n      });\n    }\n\n    if(fieldType.handler) {\n      fieldTypeHandlers[fieldType.type] = fieldType.handler;\n    }\n\n    if(fieldType.templateUrl) {\n      schemaFormDecoratorsProvider.addMapping(\n          'bootstrapDecorator',\n          fieldType.type,\n          fieldType.templateUrl\n      );\n      schemaFormDecoratorsProvider.createDirective(\n          fieldType.type,\n          fieldType.templateUrl\n      );\n    }\n  }\n}\n\nfunction CNFlexFormService(\n  Api,\n  $parse,\n  cnFlexFormConfig,\n  cnFlexFormTypes,\n  sfPath,\n  $interpolate,\n  $rootScope,\n  $timeout,\n  cnUtil,\n  $stateParams\n) {\n  'ngInject';\n\n  const services = [];\n  const prototype = {\n    compile,\n    addArrayCopy,\n    addToDataCache,\n    addToFormCache,\n    addToScopeCache,\n    broadcastErrors,\n    buildError,\n    cleanup,\n    deregisterHandlers,\n    deregisterArrayHandlers,\n    getArrayCopy,\n    getArrayCopies,\n    getArrayCopiesFor,\n    getArrayScopes,\n    getDefault,\n    getFromDataCache,\n    getFromFormCache,\n    getFromScopeCache,\n    getKey,\n    getSchema,\n    getWatchables,\n    handleResolve,\n    initArrayCopyWatch,\n    initModelWatch,\n    initSchemaParams,\n    isCompiled,\n    onModelWatch,\n    parseCondition,\n    parseExpression,\n    processArray,\n    processDefault,\n    processDisplay,\n    processField,\n    processFieldset,\n    processFieldProps,\n    processFieldType,\n    processFieldWatch,\n    processComponent,\n    processConditional,\n    processCurrency,\n    processPercentage,\n    processDate,\n    processHelp,\n    processRadios,\n    processRadiobuttons,\n    processReusable,\n    processSchema,\n    processSelectDisplay,\n    processResolve,\n    processSection,\n    processSelect,\n    processTable,\n    processTemplate,\n    processToggle,\n    processUpdatedSchema,\n    processMediaUpload,\n    processCsvUpload,\n    registerArrayHandlers,\n    registerHandler,\n    registerResolve,\n    replaceArrayIndex,\n    reprocessField,\n    resolveNestedExpressions,\n    setArrayIndex,\n    setupConfig,\n    setupArraySelectDisplay,\n    setupSelectDisplay,\n    setupSchemaRefresh\n  };\n\n  function CNFlexFormConstructor(schema, model, config) {\n    var service;\n    if(services.length) {\n      for(var i = 0, l = services.length; i < l; i++) {\n        if(services[i].model === model) {\n          service = services[i];\n          service.compile(schema, model, config);\n          break;\n        }\n      }\n    }\n    if(!service) {\n      service = new CNFlexForm(schema, model, config);\n      services.push(service);\n    }\n    return service || new CNFlexForm(schema, model, config);\n  }\n\n  function CNFlexForm(schema, model, config) {\n\n    if($stateParams.debug) {\n      window.services = services;\n    }\n\n    this.arrayCopies = {};\n    this.arrayListeners = {};\n    this.dataCache = {};\n    this.defaults = {};\n    this.errors = [];\n    this.events = [];\n    this.formCache = {};\n    this.scopeCache = {};\n    this.listeners = {};\n    this.resolveRegister = {};\n    this.model = model;\n    this.updates = 0;\n\n    this.params = cnFlexFormConfig.getStateParams();\n\n    this._ = _;\n\n    this.compile(schema, model, config);\n  }\n\n  _.extend(CNFlexForm.prototype, prototype);\n  _.extend(CNFlexFormConstructor, prototype);\n\n  return CNFlexFormConstructor;\n\n  //////////////\n\n  function compile(schema, model, config) {\n    var service = this;\n\n    service.schema = schema;\n    service.model = model;\n\n    if(!service.isCompiled()) {\n      service.setupConfig(config);\n\n      if(schema.forms) {\n        _.each(schema.forms, function(form) {\n          _.each(form.form, service.processField.bind(service));\n        });\n      }\n      else {\n        _.each(schema.form, service.processField.bind(service));\n      }\n\n      service.initModelWatch();\n      service.initArrayCopyWatch();\n      service.isCompiled(true);\n    }\n\n    service.broadcastErrors();\n  }\n\n  function isCompiled(setValue) {\n    var service = this;\n    if(setValue) {\n      service.schema.compiled = setValue;\n    }\n    return service.schema && service.schema.compiled;\n  }\n\n  function setupConfig(config) {\n    var service = this;\n    if(config) {\n      if(config.formCtrl) service.formCtrl = config.formCtrl;\n      if(config.updateSchema) service.updateSchema = config.updateSchema;\n      if(config.getSchema) service.getSchemaForm = service.setupSchemaRefresh(config.getSchema);\n    }\n  }\n\n  function processSchema(field) {\n    const service = this;\n    const { schema } = field;\n\n    field.getSchemaType = () => _.isArray(schema.type) ? _.first(schema.type) : schema.type;\n    if(!field.type) field.type = field.getSchemaType && field.getSchemaType();\n  }\n\n  function processDefault(field) {\n    const service = this;\n    const { schema } = field;\n    const curDefault = field.default || schema.default;\n\n    const key = service.getKey(field.key);\n    // if schemaUpdate hasn't been triggered, let schemaForm directive handle defaults\n    if(service.updates || field.default) {\n      if(key.includes && key.includes('[]')) return;\n      const model = service.parseExpression(field.key, service.model);\n      const modelValue = model.get();\n      // if there's an existing default and it's the same as the current value\n      // update the current value to the new default\n      if(_.isTrulyEmpty(modelValue) || (_.has(service.defaults, key) && angular.equals(modelValue, service.defaults[key]))) {\n        model.set(curDefault);\n      }\n    }\n    service.defaults[key] = angular.copy(curDefault);\n\n    if(schema.format === 'url' && !field.validationMessage) {\n      if(!field.type) field.type = 'url';\n      field.validationMessage = 'Must be a valid url (https://...)';\n    }\n  }\n\n  function processFieldset(fieldset) {\n    var service = this;\n\n    fieldset.type = 'cn-fieldset';\n    fieldset.items.forEach(service.processField.bind(service));\n\n    if(fieldset.collapsible) {\n      fieldset.toggleCollapse = (fieldset) => {\n        if(fieldset.collapsible) {\n          fieldset.collapsed = !fieldset.collapsed;\n        }\n      };\n\n      fieldset.render = !fieldset.collapsed;\n    }\n    else {\n      fieldset.render = true;\n    }\n  }\n\n  function processFieldType(field) {\n    const service = this;\n    const fieldType = cnFlexFormTypes.getFieldType(field);\n    const handler = fieldTypeHandlers[fieldType];\n    if(_.isString(handler)) {\n      service[handler](field);\n    }\n    else if(_.isFunction(handler)) {\n      handler.call(service, field);\n    }\n  }\n\n  function processField(field) {\n    const service = this;\n\n    if(!field._ogKeys) {\n      field._ogKeys = _.without(_.keys(field), 'key', 'htmlClass');\n    }\n\n    const key = service.getKey(field.key);\n\n    if(key) {\n      service.addToFormCache(field, key);\n      const schema = service.getSchema(key);\n\n      if(schema) {\n        field.schema = schema;\n        if(schema.description) field.description = schema.description;\n        if(field.readonly && !schema.readonly) field.readonly = false;\n        if(schema.type === 'array' && !('showClearAll' in field)) field.showClearAll = true;\n      }\n\n      service.processSchema(field);\n    }\n\n    service.processFieldProps(field);\n\n    if(key) {\n      if(_.find(service.errors, { key })) {\n        service.errors = _.reject(service.errors, {key: key});\n        $rootScope.$broadcast('schemaForm.error.' + key, 'schemaForm', true);\n        $rootScope.$broadcast('schemaForm.error.' + key, 'serverValidation', true);\n      }\n      \n      if(field.error) {\n        service.errors.push(service.buildError(field));\n        if(_.isEmpty(field.ngModelOptions)) {\n          field.ngModelOptions = {\n            allowInvalid: true\n          };\n        } else {\n          field.ngModelOptions.allowInvalid = true;\n        }\n      }\n    }\n  }\n\n  function processFieldProps(field) {\n    const service = this;\n    fieldPropHandlers.forEach(({ prop, handler }) =>\n        _.has(field, prop) && handler(field, service)\n    );\n  }\n\n  function getKey(key) {\n    if(_.isArray(key)) {\n      key = _.reduce(key, (total, next) => \n          /^(-?\\d*)$/.test(next) ? total + '[' + next + ']' : total + '.' + next);\n    }\n    return key;\n  }\n\n  function getSchema(key, depth) {\n    var service = this;\n    if(!key) return;\n\n    key = ObjectPath.parse(service.getKey(key));\n    depth = depth || service.schema.schema.properties;\n\n    let first, next;\n\n    while(key.length > 1) {\n      first = key[0];\n      next = key[1];\n      if(/^-?\\d*$/.test(next)) {\n        if(key.length === 2) {\n          depth = depth = depth[key.shift()];\n        }\n        else {\n          depth = depth[key.shift()].items.properties;\n          key.shift();\n        }\n      }\n      else {\n        depth = depth[key.shift()].properties;\n      }\n    }\n\n    // if array item\n    first = key[0] || 'items';\n\n    return depth[first];\n  }\n\n  function getDefault(field) {\n    const service = this;\n    console.log(':: getDefault ::', field);\n    field = field.key ? field : service.getFromFormCache(field);\n    console.log(':: getDefault ::', field);\n    return field && (angular.isDefined(field.default) ? field.default : field.schema && field.schema.default);\n  }\n\n  function getWatchables(exp) {\n    const watchables = [];\n    let nested = matchNestedExpression(exp);\n    let replaceStr = '';\n\n    while(nested) {\n      if(/^-?\\d+$/.test(nested[1])) {\n        replaceStr = nested[0];\n        exp = exp.replace(nested[0], 'ff_replace_ff');\n      }\n      else {\n        watchables.push(nested[1].replace(/ff_replace_ff/g, replaceStr));\n        replaceStr = '';\n        exp = exp.replace(nested[0], '');\n      }\n      nested = matchNestedExpression(exp);\n    }\n\n    return [...watchables, exp.replace(/ff_replace_ff/g, replaceStr)];\n  }\n\n  function processResolve(field) {\n    const service = this;\n    const key = service.getKey(field.key);\n\n    _.each(field.resolve, function(dataProp, fieldProp) {\n      dataProp = replaceArrayIndex(dataProp, key);\n      if(dataProp.includes('[arrayIndex]')) return;\n\n      service.handleResolve(field, fieldProp, dataProp);\n\n      getWatchables(dataProp).forEach((watchable) => {\n        const resolveType = watchable.match(/(schema\\.data\\.|model\\.)(\\S+)/);\n\n        if(resolveType) {\n          if(resolveType[1] === 'schema.data.') {\n            service.registerResolve(field, fieldProp, resolveType[2], dataProp);\n          }\n          else if(resolveType[1] === 'model.') {\n            service.registerHandler(resolveType[2], () => {\n              service.handleResolve(field, fieldProp, dataProp);\n            });\n          }\n        }\n      });\n    });\n\n    return field;\n  }\n\n  function handleResolve(field, fieldProp, exp) {\n    const service = this;\n    let data = service.parseExpression(exp).get();\n    // if we're resolving from model but defaults haven't been applied yet, resolve from default itself\n    if(!data && exp.indexOf('model.') === 0) {\n      const key = exp.replace('model.', '');\n      const cachedField = service.getFromFormCache(key);\n      \n      if(cachedField && cachedField.default) data = cachedField.default;\n      else data = field.default || service.getSchema(key).default;\n    }\n    if(data && data.cursor) {\n      field.loadMore = function() {\n        const dataProp = exp.match(/schema\\.data\\.(.+)/)[1];\n        service.refreshSchema(`data:${dataProp}:${data.cursor}`);\n      };\n    } \n    else {\n      delete field.loadMore;\n    }\n    field[fieldProp] = (data && data.data) ? data.data : data;\n\n    fieldPropHandlers.forEach(({ prop, handler }) => \n        prop === fieldProp && handler(field, service)\n    );\n  }\n\n  function registerResolve(field, fieldProp, dataProp, exp) {\n    var service = this;\n\n    let fieldKey = service.getKey(field.key);\n    service.resolveRegister[dataProp] = service.resolveRegister[dataProp] || {};\n\n    let register = service.resolveRegister[dataProp];\n    register[fieldKey] = register[fieldKey] || [];\n    register[fieldKey].push({ field, prop: fieldProp, exp });\n  }\n\n  function processConditional(field) {\n    const service = this;\n\n    _.each(field.conditionals, (condition, key) => {\n      const handler = (val, prev) => {\n        field[key] = service.parseCondition(condition);\n        const scope = service.getFromScopeCache(service.getKey(field.key));\n        if(key === 'required' && scope) {\n          $rootScope.$broadcast('schemaFormValidate');\n        }\n      };\n      field\n          .conditionals[key]\n          .match(/model\\.([^\\s]+)/g)\n          .map(path => path.match(/model\\.([^\\s]+)/)[1])\n          .forEach(key => {\n            service.registerHandler(key, handler);\n          });\n      handler();\n    });\n  }\n\n  function processFieldWatch(field) {\n    const service = this;\n    let schema = field.schema;\n\n    field.watch = _.isArray(field.watch) ? field.watch : [field.watch];\n\n    _.each(field.watch, function(watch) {\n      if(watch.resolution) {\n        let condition = watch.condition;\n        let resolution = watch.resolution;\n        let handler;\n\n        if(_.isFunction(resolution)) {\n          handler = function(cur, prev) {\n            if(!condition || service.parseCondition(condition)) {\n              resolution(cur, prev);\n            }\n          };\n        }\n        else {\n          var adjustment = {};\n\n          adjustment.date = resolution.match(/\\+ ?(\\d+) days/);\n\n          if(adjustment.date) {\n            adjustment.date = adjustment.date[1];\n            resolution = resolution.replace(adjustment.date, '').trim();\n          }\n          else {\n            adjustment.math = resolution.match(/(\\+|\\-|\\/|\\*) ?(\\S+)/);\n\n            if(adjustment.math) {\n              adjustment.operator = {\n                '+': 'add',\n                '-': 'subtract',\n                '*': 'multiply',\n                '/': 'divide'\n              }[adjustment.math[1]];\n\n              adjustment.adjuster = service.parseExpression(adjustment.math[2]);\n            }\n          }\n\n          resolution = resolution.match(/(\\S+) ?= ?(\\S+)/);\n\n          handler = (val, prev, key, trigger) => {\n            let curCondition = condition && replaceArrayIndex(condition, key);\n            let updatePath = replaceArrayIndex(resolution[1], key);\n            let fromPath = replaceArrayIndex(resolution[2], key);\n\n            let update = service.parseExpression(updatePath);\n\n            // avoid loop where two watches keep triggering each other\n            if(trigger === update.path().key) return;\n            trigger = update.path().key;\n\n            let from = service.parseExpression(fromPath);\n\n            if(!condition || service.parseCondition(curCondition)) {\n              if(adjustment.date) {\n                update.set(moment(from.get()).add(adjustment.date, 'days').toDate());\n              }\n              else if(adjustment.math) {\n                //var result = _[adjustment.operator](from.get(), adjustment.adjuster.get());\n                //let result = eval(from.get() + adjustment.math[1] + adjustment.adjuster.get());\n                let result = $parse(from.get() + adjustment.math[1] + adjustment.adjuster.get())();\n                schema = schema || field.items && (field.items[0].schema || (field.items[0].items && field.items[0].items[0].schema));\n                if(field.type === 'cn-currency') {\n                  let p = schema && schema.format === 'currency-dollars' ? 2 : 0;\n\n                  if(adjustment.math[1] === '*') {\n                    result = _.floor(result, p);\n                  }\n                  else if(adjustment.math[1] === '/') {\n                    result = _.ceil(result, p);\n                  }\n                  else {\n                    result = _.round(result, p);\n                  }\n                }\n                //service.listeners[update.path().key].prev = result;\n                if(service.listeners[trigger]) {\n                  service.listeners[trigger].trigger = key;\n                }\n                update.set(result || 0);\n              }\n              else {\n                update.set(from.get());\n              }\n            }\n          };\n        }\n\n        service.registerHandler(field, handler, field.updateSchema, watch.initialize);\n      }\n    });\n  }\n\n  function parseCondition(condition) {\n    let service = this;\n    if(condition.startsWith(\"_\")) {\n      let exp = /^_\\.(.*?)\\((.*?),[\\s(]*(.*?)\\)?\\s*=>[{\\s]*(?:return)?(.*?)\\}?\\)$/;\n      let [, fn, list, predicateParams, predicateBody] = condition.match(exp);\n      return _[fn]($parse(list)(service), generatePredicate(predicateParams, predicateBody));\n    } else {\n      return $parse(condition)(service);\n    }\n  }\n\n  function generatePredicate(params, body) {\n    return (...args) =>\n      $parse(body)(params\n              .replace(/\\s/g, '')\n              .split(',')\n              .reduce((acc, cur, i) => { acc[cur] = args[i]; return acc; }, {})\n            );\n  }\n\n  function registerHandler(key, handler, updateSchema, runHandler) {\n    var service = this;\n\n    // if field is passed instead of key\n    if(_.isObject(key) && !_.isArray(key)) {\n      if(!key.key && key.items) {\n        _.each(key.items, function(field) {\n          service.registerHandler(field, handler, field.updateSchema);\n        });\n        return;\n      }\n      else {\n        key = key.key;\n      }\n    }\n\n    key = service.getKey(key);\n    var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.*)/);\n\n    if(arrMatch) {\n      service.registerArrayHandlers(arrMatch[1], arrMatch[2], handler, updateSchema, runHandler);\n      return;\n    }\n\n    var cur = service.parseExpression(key, service.model).get();\n    let defaultValue = _.get(service.getSchema(key), 'default');\n\n    if(!service.listeners[key]) {\n      var prev = _.isUndefined(cur) ? angular.copy(defaultValue) : angular.copy(cur);\n      service.listeners[key] = {\n        handlers: [],\n        updateSchema: updateSchema,\n        prev: prev\n      };\n    }\n\n    if(handler) {\n      service.listeners[key].handlers.push(handler);\n      if(runHandler) handler(cur, null, key);\n    }\n  }\n\n  function registerArrayHandlers(arrKey, fieldKey, handler, updateSchema, runHandler) {\n    var service = this;\n    var onArray = function(cur, prev, reorder) {\n\n      if(!prev && prev !== 0 && (cur | 0) < 1) return;\n      var i, l, key;\n\n      if(prev > cur || reorder) {\n        var lastKey = fieldKey ?\n          arrKey + '[' + (prev - 1) + ']' + '.' + fieldKey :\n          arrKey + '[' + (prev - 1) + ']';\n\n        // only deregister handlers once each time an element is removed\n        if(service.listeners[lastKey]) {\n          for(i = 0, l = prev; i < l; i++) {\n            key = fieldKey ?\n              arrKey + '[' + i + ']' + '.' + fieldKey :\n              arrKey + '[' + i + ']';\n\n            service.deregisterHandlers(key);\n          }\n        }\n        for(i = 0, l = cur; i < l; i++) {\n          key = fieldKey ?\n            arrKey + '[' + i + ']' + '.' + fieldKey :\n            arrKey + '[' + i + ']';\n\n          service.registerHandler(key, handler, updateSchema);\n          //no need to call if just reregisering handlers\n          //if(runHandler) handler(null, null, key);\n        }\n      }\n      else if(cur > (prev || 0)) {\n        for(i = prev | 0, l = cur; i < l; i++) {\n          key = fieldKey ?\n            arrKey + '[' + i + ']' + '.' + fieldKey :\n            arrKey + '[' + i + ']';\n\n          service.registerHandler(key, handler, updateSchema, runHandler);\n          //if(runHandler) handler(null, null, key);\n        }\n      }\n    };\n\n    var arrVal = service.parseExpression(arrKey, service.model).get();\n    _.each(arrVal, function(field, i) {\n      var key = fieldKey ?\n        arrKey + '[' + i + ']' + '.' + fieldKey :\n        arrKey + '[' + i + ']';\n\n      service.registerHandler(key, handler, updateSchema);\n      if(runHandler) handler(null, null, key);\n    });\n\n    if(service.arrayListeners[arrKey + '.length']) {\n      service.arrayListeners[arrKey + '.length'].handlers.push(onArray);\n    } else {\n      service.arrayListeners[arrKey + '.length'] = {\n        handlers: [onArray],\n        prev: arrVal ? arrVal.length : 0\n      };\n    }\n  }\n\n  function deregisterHandlers(key) {\n    var service = this;\n\n    key = service.getKey(key);\n\n    var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.*)/);\n\n    if(arrMatch) {\n      service.deregisterArrayHandlers(arrMatch[1], arrMatch[2]);\n      return;\n    }\n\n    if(service.listeners[key]) service.listeners[key].handlers = [];\n  }\n\n  function deregisterArrayHandlers(arrKey, fieldKey) {\n    var service = this;\n\n    service.parseExpression(arrKey, service.model).get().forEach((item, i) => {\n      fieldKey ?\n        service.deregisterHandlers(`${arrKey}[${i}].${fieldKey}`) :\n        service.deregisterHandlers(`${arrKey}[${i}]`);\n    });\n  }\n\n  function initModelWatch() {\n    var service = this;\n    if(service.watching) return;\n    if(service.modelWatch) service.modelWatch();\n\n    service.modelWatch = $rootScope.$watch(\n        function() { return service.model; },\n        service.onModelWatch.bind(service),\n        true\n    );\n\n    service.initSchemaParams();\n    service.watching = true;\n    service.firstUpdate = true;\n  }\n\n  function onModelWatch(cur, prev) {\n    var service = this;\n    // we always run through the listeners on the first update because angular seems to mess up\n    // when the defaults are applied and uses the same object for both cur and prev\n    if(service.firstUpdate || !angular.equals(cur, prev)) {\n      service.firstUpdate = false;\n      cnUtil.cleanModel(service.model);\n\n      service.prevParams = angular.copy(service.params);\n\n      _.each(service.arrayListeners, (listener, key) => {\n        let val = service.parseExpression(key, service.model).get();\n        if(!angular.equals(val, listener.prev)) {\n          listener.handlers.forEach(handler => handler(val, listener.prev));\n          listener.prev = angular.copy(val);\n        }\n      });\n\n      _.each(service.listeners, (listener, key) => {\n        if(listener) {\n          let val = service.parseExpression(key, service.model).get();\n          const isInitArray = angular.equals(val, []) && !listener.prev;\n          if(!angular.equals(val, listener.prev) && !isInitArray) {\n            listener.handlers.forEach(handler => {\n              handler(val, listener.prev, key, listener.trigger);\n            });\n            listener.trigger = null;\n            listener.prev = angular.copy(val);\n          }\n          if(listener.updateSchema && \n            !angular.isUndefined(val) &&\n            !isInitArray &&\n            val !== null/* &&\n            !angular.equals(val, service.getDefault(key))*/) {\n            service.params[key] = val;\n          }\n          else {\n            delete service.params[key];\n          }\n        }\n      });\n\n      if(!angular.equals(service.params, service.prevParams)) {\n        if(service.model.id && !service.updates && _.isEmpty(service.prevParams)) {\n          ++service.updates;\n        }\n        else {\n          service.refreshSchema();\n        }\n      }\n    }\n  }\n\n  function initSchemaParams() {\n    var service = this;\n    _.each(service.listeners, function(listener, key) {\n      if(listener) {\n        var val = service.parseExpression(key, service.model).get();\n        if(listener.updateSchema && !angular.isUndefined(val) && val !== null) {\n          service.params[key] = val;\n        }\n      }\n    });\n  }\n\n  function initArrayCopyWatch() {\n    const service = this;\n\n    service.events.push($rootScope.$on('schemaFormPropagateScope', function(event, scope) {\n      let key = service.getKey(scope.form.key);\n      let index = key.match(/^.*\\[(\\d+)].*$/);\n\n      if(index) {\n        key = key.replace(/\\[\\d+]/g, '[]');\n        index = index && parseInt(index[1]);\n\n        if(!service.getArrayCopy(key, index)) {\n          service.processFieldProps(scope.form);\n        }\n\n        if(!scope.form.condition) scope.form.condition = 'true';\n\n        service.addArrayCopy(scope, key, index);\n        scope.$emit('flexFormArrayCopyAdded', key);\n      }\n      else {\n        service.addToScopeCache(scope, key);\n      }\n    }));\n\n    service.events.push($rootScope.$on('schemaFormDeleteScope', function(event, scope, index) {\n      const key = service.getKey(scope.form.key);\n      const listener = service.listeners[key];\n      if(listener) listener.handlers = [];\n\n      const unindexedKey = key.replace(/\\[\\d+]/g, '[]');\n      const copies = service.getArrayCopiesFor(unindexedKey);\n\n      copies.forEach((list) => list.splice(index, 1));\n\n      if(scope.form.link) {\n        var list = service.parseExpression(scope.form.link, service.model).get();\n        list.splice(index, 1);\n      }\n    }));\n  }\n\n  function addArrayCopy(form, key, index) {\n    const service = this;\n    if(!index || index < 0) index = 0;\n    if(!service.arrayCopies[key]) service.arrayCopies[key] = [];\n    service.arrayCopies[key][index] = form;\n    //service.arrayCopies[key].push(form);\n  }\n\n  function getArrayCopy(key, index) {\n    const service = this;\n    const copies = service.arrayCopies[key];\n    return copies && copies[index];\n  }\n\n  function getArrayCopies(key) {\n    const service = this;\n    return _.pluck(service.getArrayScopes(key), 'form');\n  }\n\n  function getArrayCopiesFor(keyStart) {\n    const service = this;\n    keyStart += '[]';\n\n    return _.filter(service.arrayCopies, (copy, key) => key.includes(keyStart));\n  }\n\n  function getArrayScopes(key) {\n    var service = this;\n    return service.arrayCopies[key];\n  }\n\n  function addToScopeCache(scope, key) {\n    const service = this;\n    if(service.scopeCache[key]) {\n      console.warn('caching duplicate scope for', key);\n    }\n    return service.scopeCache[key] = scope;\n  }\n\n  function getFromScopeCache(key) {\n    const service = this;\n    return service.scopeCache[key];\n  }\n\n  function addToFormCache(field, key) {\n    var service = this;\n    key = key || service.getKey(field.key);\n    if(!service.getFromFormCache(key)) service.formCache[key] = field;\n  }\n\n  function getFromFormCache(key) {\n    var service = this;\n    return service.formCache[key];\n  }\n\n  function addToDataCache(key, modelValue) {\n    var service = this;\n\n    if(key) {\n      service.dataCache[key] = modelValue;\n    }\n  }\n\n  function getFromDataCache(key) {\n    var service = this;\n\n    return service.dataCache[key];\n  }\n\n  function matchNestedExpression(exp) {\n    return exp.match(/\\[([^[\\]]+)]([^[\\]]*)/);\n  }\n\n  function resolveNestedExpressions(exp, depth) {\n    const service = this;\n    let nested = matchNestedExpression(exp);\n\n    while(nested) {\n      exp = exp.replace(`[${nested[1]}]`, `.${service.parseExpression(nested[1], depth).get()}`);\n      nested = matchNestedExpression(exp);\n    }\n\n    return exp;\n  }\n\n  function parseExpression(exp, depth) {\n    const service = this;\n    // if expression is specific value\n    if(!exp || /^(null|false|true|undefined|''|-?[0-9.]+|\\[]|\\{})$/.test(exp)) {\n      return {\n        \"get\": function() {\n          if(!exp) return exp;\n          switch(exp) {\n            case 'null': return null;\n            case 'false': return false;\n            case 'true': return true;\n            case 'undefined': return;\n            case '\\'\\'': return '';\n            case '[]': return [];\n            case '{}': return {};\n            default: return parseFloat(exp);\n          }\n        }\n      };\n    }\n\n    exp = service.getKey(exp);\n\n    const match = exp.match(/^(model\\.)?(\\S+)$/);\n\n    const modelValue = {\n      get() {\n        let resolved = service.resolveNestedExpressions(exp, depth);\n        let path = ObjectPath.parse(resolved);\n        let start = depth || service;\n\n        while(start && path.length > 1) {\n          start = start[path.shift()];\n        }\n\n        return start && start[path[0]];\n      },\n\n      getAssignable() {\n        let resolved = service.resolveNestedExpressions(exp, depth);\n        let path = ObjectPath.parse(resolved);\n        let progress = [];\n        let start = depth || service;\n\n        while(start && path.length > 1) {\n          let key = path.shift();\n          progress.push(key);\n          if(!start[key]) {\n            if(/^\\d?$/.test(path[0])) {\n              start[key] = [];\n            }\n            else {\n              start[key] = {};\n            }\n          }\n          start = start[key];\n        }\n\n        return {\n          obj: start,\n          key: path[0],\n          path: service.getKey(progress),\n          fullPath: service.getKey(progress.concat(path.slice(0, 1)))\n        };\n      },\n\n      set(val) {\n        let resolved = service.resolveNestedExpressions(exp, depth);\n        let path = ObjectPath.parse(resolved);\n        let assignable = this.getAssignable();\n        assignable.obj[assignable.key] = val;\n        return val;\n      },\n\n      path() {\n        return {\n          exp: exp,\n          depth: depth,\n          key: match[2]\n        };\n      }\n    };\n\n    return modelValue;\n  }\n\n  function processArray(array) {\n    var service = this;\n    var key = service.getKey(array.key);\n\n    array.sortOptions = {\n      update: function(e, ui) {\n        let listener = service.arrayListeners[`${key}.length`];\n        listener.handlers.forEach(handler => {\n          handler(listener.prev, listener.prev, true);\n        });\n      }\n    };\n\n    service.processSection(array);\n  }\n\n  function processSection(section) {\n    var service = this;\n    _.each(section.items, service.processField.bind(service));\n  }\n\n  function processComponent(component) {\n    var service = this;\n\n    component.type = 'section';\n    component.htmlClass = 'row';\n\n    var cols = 12 / _.reject(component.items, 'hidden').length;\n\n    _.each(component.items, function(field, i) {\n      service.processField(field);\n      component.items[i] = {\n        type: 'section',\n        htmlClass: 'col-sm-' + cols,\n        items: [field]\n      };\n    });\n  }\n\n  function processCurrency(field) {\n    field.currencyFormat = {\n      'currency-dollars': 'dollars',\n      'currency-microcents': 'microcents',\n      'currency': 'cents'\n    }[field.schema.format];\n\n    field.type = 'cn-currency';\n  }\n\n  function processPercentage(field) {\n    field.type = 'cn-percentage';\n  }\n\n  function processReusable(field) {\n    var service = this;\n    field.type = 'cn-reusable';\n    field.view = field.view || 'new';\n    field.items.forEach(service.processField.bind(service));\n    field.items = [{\n      type: 'section',\n      items: field.items,\n      condition: '!model.' + service.getKey(field.key) + '.id'\n    }];\n  }\n\n  function processMediaUpload(field) {\n    var service = this;\n    field.type = 'cn-mediaupload';\n    _.each(field.data, function(dataProp, key) {\n      field.data[key] = service.parseExpression(dataProp).get();\n    });\n  }\n\n  function processCsvUpload(field) {\n    var service = this;\n    field.type = 'cn-csvupload';\n  }\n\n  function processRadios(field) {\n    field.type = 'cn-radios';\n  }\n\n  function processRadiobuttons(radios) {\n    var service = this;\n    radios.type = 'cn-radiobuttons';\n    if(radios.fullWidth) {\n      radios.btnClass = 'col-sm-' + _.divide(12, radios.titleMap.length);\n    }\n  }\n\n  function processDate(date) {\n    var service = this;\n    date.type = 'cn-datetimepicker';\n\n    if(date.schema.format === 'time-minutes') {\n      date.maxView = 'hour';\n      date.iconClass = 'fa fa-clock-o';\n\n      date.modelFormatter = val => {\n        if(!val) return;\n\n        let m = moment(val);\n\n        return _.add(_.multiply(m.hours(), 60), m.minutes());\n      };\n\n      date.modelParser = val => {\n        if(!val) return;\n\n        let d = parseInt(val);\n        let hours = _.floor(d / 60);\n        let minutes = d % 60;\n\n        return moment().startOf('day').add('hours', hours).add('minutes', minutes);\n      };\n\n      date.viewFormatter = val => {\n        if(!val) return;\n\n        return date.modelParser(val).format(date.dateFormat);\n      };\n\n      date.viewParser = val => {\n        if(!val) return;\n\n        let match = val.match(/^(\\d{1,2}):?(\\d{1,2})? (a|p)/);\n        if(!match) return;\n\n        let hours = _.add(match[1] === '12' ? 0 : match[1], match[3] === 'a' ? 0 : 12);\n        let minutes = match[2] || '00';\n\n        if(minutes.length === 1) minutes += '0';\n\n        return _.add(_.multiply(hours, 60), minutes);\n      };\n    }\n  }\n\n  function getSelectValProp(select) {\n    let isArray = select.getSchemaType() === 'array';\n    return select.valueProperty ||\n      (isArray ? select.schema.items.type : select.schema.type) !== 'object' && 'value';\n  }\n\n  function getAllowedSelectValue(select, val, titleMap) {\n    titleMap = titleMap || select.getTitleMap();\n    let valProp = getSelectValProp(select);\n    if(!valProp) return;\n\n    if(select.getSchemaType() === 'array') {\n      if(!val || !_.isArray(val)) return;\n\n      let mapVal = val.map(x => _.find(titleMap, {[valProp]: x})).filter(x => x !== undefined);\n\n      return mapVal;\n    }\n    else {\n      return _.find(titleMap, {[valProp]: val});\n    }\n  }\n\n  function processSelect(select) {\n    var service = this,\n        schema = select.schema;\n\n    if(select.titleMapResolve || select.titleMap) {\n      select.getTitleMap = function() {\n        return select.titleMap || service.schema.data[select.titleMapResolve];\n      };\n\n      select.onInit = function(val, form, event, setter) {\n        // make sure we use correct value\n        var modelValue = service.parseExpression(form.key, service.model);\n        if(event === 'tag-init') {\n          let newVal = getAllowedSelectValue(select, modelValue.get());\n          if(newVal !== undefined) setter(newVal);\n        }\n      };\n    }\n\n    if(select.titleMapQuery) {\n      var key = select.titleMapQuery.params.q;\n      select.titleQuery = function(q) {\n        var params = {};\n        if(key) {\n          params[key] = q;\n        }\n        return Api.get({\n          url: select.titleMapQuery.url,\n          params: params\n        });\n      };\n\n      // wrap in string so returns truthy when compiled, but converted to number within directive\n      if(!key) select.minLookup = '0';\n\n      select.onInit = function(val, form, event, setter) {\n        if(event === 'tag-init') {\n          setter(val);\n        }\n      };\n    }\n\n    if(schema.items) {\n      var defaults = [];\n      _.each(schema.items.properties, function(schema, key) {\n        if(angular.isDefined(schema.default)) {\n          defaults.push({\n            \"key\": key,\n            default: schema.default\n          });\n        }\n      });\n      if(defaults.length) {\n        select.onAdd = function(val, form, event) {\n          if(val.value && event === 'tag-added') {\n            _.each(defaults, function(prop) {\n              if(!val.value[prop.key]) val.value[prop.key] = prop.default;\n            });\n          }\n        };\n      }\n    }\n\n    if(!select.type.includes('cn-autocomplete')) {\n      if(select.items) {\n        select.detailedList = true;\n\n        if(select.items[0].type !== 'component') {\n          if(select.items.length > 1) {\n            select.items = [{\n              type: \"component\",\n              items: select.items\n            }];\n          }\n\n          service.processFieldset(select);\n        }\n\n        select.type = 'cn-autocomplete-detailed';\n      }\n      else {\n        if(!select.selectionStyle) {\n          select.selectionStyle = select.key === 'tags' ?\n            'tags' : (select.getSchemaType() === 'array' && select.schema.maxItems !== 1) ?\n              'list' : 'select';\n        }\n        select.type = 'cn-autocomplete';\n      }\n\n      if(select.titleMapResolve) {\n        $rootScope.$on('cnFlexFormDiff:data', (e, data) => {\n          if(data[select.titleMapResolve]) {\n            let modelValue = service.parseExpression(select.key, service.model);\n            let val = modelValue.get();\n            if(val !== undefined) {\n              let valid = getAllowedSelectValue(select, val, data[select.titleMapResolve]); \n              if(valid === undefined) modelValue.set();\n            }\n          }\n        });\n      }\n    }\n\n    if(select.displayFormat) {\n      select.itemFormatter = service.processTemplate(select.displayFormat);\n    }\n\n    service.registerHandler(select.key, function(val) {\n      var form = service.formCtrl && service.formCtrl[service.getKey(select.key)];\n      if(form && form.$setDirty) form.$setDirty();\n    }, select.updateSchema);\n  }\n\n  function processToggle(toggle) {\n    toggle.type = 'cn-toggle';\n  }\n\n  function processHelp(help) {\n    help.htmlClass = 'help-block';\n  }\n\n  function processDisplay(display) {\n    var service = this;\n    display.type = 'cn-display';\n    display.getDisplay = service.processTemplate(display.displayFormat, true);\n  }\n\n  function processTemplate(tpl, parseScope) {\n    var service = this;\n    //var processor = /<(\\S+)[^>]*>.*<\\/\\1>/.test(tpl) ? $compile : $interpolate;\n    var processor = $interpolate;\n    return function(scope, arrayIndex) {\n      if(parseScope) {\n        if(angular.isDefined(arrayIndex)) {\n          scope = _.map(scope, function(key) {\n            return key === 'arrayIndex' ? arrayIndex : key;\n          });\n        }\n        scope = service.parseExpression(scope, service.model).get();\n      }\n      return processor(tpl)(scope);\n    };\n  }\n\n  function processTable(table) {\n    var service = this;\n    table.type = 'cn-table';\n    table.items.forEach(function(row) {\n      for (var i = 0; i < table.columns.length; i++) {\n        _.extend(row.items[i], table.columns[i]);\n        //if(row.columns[i].key) row.columns[i].key = ObjectPath.parse(row.columns[i].key);\n        service.processField(row.items[i]);\n      }\n    });\n  }\n\n  function processSelectDisplay(selectDisplay) {\n    var service = this,\n        schema = service.getSchema(selectDisplay.key),\n        selectField = _.find(selectDisplay.items, 'selectField'),\n        handler;\n\n    if(schema && schema.type === 'array') {\n      handler = service.setupArraySelectDisplay(selectDisplay, selectField);\n    } else {\n      handler = service.setupSelectDisplay(selectDisplay, selectField);\n    }\n\n    selectDisplay.selectDisplay = false;\n    service.registerHandler(selectField.key, handler, selectField.updateSchema, true);\n    //service.processField(selectDisplay);\n  }\n\n  function setupArraySelectDisplay(selectDisplay, selectField) {\n    var service = this;\n    _.each(selectDisplay.items, function(item) {\n      if(item.condition !== 'false') {\n        item.condition = 'true';\n      }\n    });\n    var handler = function(val, prev, key) {\n      var index = getArrayIndex(key);\n      _.each(selectDisplay.items, function(item) {\n        var selectKey = service.getKey(selectField.key);\n        var key = service.getKey(item.key);\n        var splitKey = ObjectPath.parse(key);\n        if(selectKey === key) return;\n        var indexedSelectKey = service.setArrayIndex(selectKey, index);\n        var selectValue = service.parseExpression(indexedSelectKey, service.model).get();\n        var formCopies = service.getArrayCopies(key);\n        if(_.includes(selectValue, splitKey[splitKey.length - 1])) {\n          _.each(formCopies, function(copy) {\n            if(getArrayIndex(copy) == index) {\n              copy.condition = 'true';\n            }\n          });\n        } else {\n          _.each(formCopies, function(copy) {\n            if(getArrayIndex(copy) == index) {\n              copy.condition = 'false';\n              service.parseExpression(service.getKey(copy.key), service.model).set();\n            }\n          });\n        }\n      });\n    };\n    // handle legacy objects that don't have values set in the selectField\n    var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n    _.each(selectDisplay.items, function(item) {\n      var key = service.getKey(item.key);\n      var selectKey = service.getKey(selectField.key);\n      if(key === selectKey) return;\n      _.each(model, function(elem, i) {\n        var indexedKey = service.setArrayIndex(key, i);\n        var splitIndexedKey = ObjectPath.parse(indexedKey);\n        var indexedSelectKey = service.setArrayIndex(selectKey, i);\n        var selectModel = service.parseExpression(indexedSelectKey, service.model);\n        var selectValue = selectModel.get();\n        var itemValue = service.parseExpression(indexedKey, service.model).get();\n        if(itemValue && !_.includes(selectValue, splitIndexedKey[splitIndexedKey.length - 1])) {\n          if(!selectValue) {\n            selectValue = [];\n          }\n          selectValue.push(splitIndexedKey[splitIndexedKey.length - 1]);\n          selectModel.set(selectValue);\n        }\n      });\n    });\n    // handle new objects with values set in defaults\n    var defaults = service.getSchema(selectDisplay.key).default;\n    _.each(defaults, function(elem, i) {\n      var selectKey = service.getKey(selectField.key);\n      var indexedSelectKey = service.setArrayIndex(selectKey, i);\n      var selectModel = service.parseExpression(indexedSelectKey, service.model);\n      var selectValue = selectModel.get();\n      _.each(elem, function(val, key) {\n        if(!selectValue) {\n          selectValue = [];\n        }\n        selectValue.push(key);\n        selectModel.set(selectValue);\n      });\n    });\n    // run handler once all arrayCopies have been instantiated\n    var count = 0;\n    var keyMap = _.pluck(_.reject(selectDisplay.items, {\"condition\":\"false\"}), 'key');\n    var once = $rootScope.$on('flexFormArrayCopyAdded', function(event, key) {\n      var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n      if(model) {\n        var total = model.length * (keyMap.length);\n        if(_.includes(keyMap, key)) {\n          count++;\n        }\n        if(count === total) {\n          for (var i = 0; i < model.length; i++) {\n            handler(null, null, '[' + i + ']');\n          }\n          count = 0;\n        }\n      }\n    });\n    var resetCount = $rootScope.$on('flexForm.updatePage', function() {\n      count = 0;\n    });\n    service.events.push(once);\n    service.events.push(resetCount);\n    return handler;\n  }\n\n  function setupSelectDisplay(selectDisplay, selectField) {\n    var service = this;\n    var handler = function() {\n      var selectKey = service.getKey(selectField.key);\n      _.each(selectDisplay.items, function(item) {\n        var key = service.getKey(item.key);\n        var splitKey = ObjectPath.parse(key);\n        if(selectKey === key) return;\n        var selectValue = service.parseExpression(selectKey, service.model).get();\n        if(_.includes(selectValue, splitKey[splitKey.length - 1])) {\n          item.condition = 'true';\n        } else {\n          item.condition = 'false';\n          service.parseExpression(key, service.model).set();\n        }\n      });\n    };\n    // handle legacy objects that don't have values set in the selectField\n    var selectKey = service.getKey(selectField.key);\n    var selectModel = service.parseExpression(selectKey, service.model);\n    var selectValue = selectModel.get();\n    _.each(selectDisplay.items, function(item) {\n      var key = service.getKey(item.key);\n      if(selectKey === key) return;\n      var splitKey = ObjectPath.parse(key);\n      var itemValue = service.parseExpression(key, service.model).get();\n      if(itemValue && !_.includes(selectValue, splitKey[splitKey.length - 1])) {\n        if(!selectValue) {\n          selectValue = [];\n        }\n        selectValue.push(splitKey[splitKey.length - 1]);\n        selectModel.set(selectValue);\n      }\n    });\n    // handle new objects with values set in the defaults\n    var defaults = service.getSchema(selectDisplay.key).default;\n    _.each(defaults, function(val, key) {\n      if(!selectValue) {\n        selectValue = [];\n      }\n      selectValue.push(key);\n      selectModel.set(selectValue);\n    });\n    // set default values here\n    var model = service.parseExpression(selectDisplay.key, service.model);\n    if(defaults && !model.get()) {\n      model.set(defaults);\n    }\n\n    return handler;\n  }\n\n  function setupSchemaRefresh(refresh) {\n    var service = this;\n    service.refreshSchema = _.debounce(function(updateSchema) {\n      var params = _.extend(cnFlexFormConfig.getStateParams(), service.params);\n      var diff = cnUtil.diff(service.schema.params, params, true);\n      var keys;\n\n      if(diff || updateSchema) {\n        if(updateSchema) params.updateSchema = updateSchema;\n        else {\n          keys = _.keys(diff);\n\n          if(keys.length > 1) {\n            diff = _.omit(diff, _.isNull);\n            keys = _.keys(diff);\n          }\n\n          params.updateSchema = _.first(keys);\n        }\n\n        if(!params.updateSchema) {\n          diff = cnUtil.diff(params, _.omit(service.schema.params, 'updateSchema'));\n          keys = _.keys(diff);\n\n          params.updateSchema = _.first(keys);\n        }\n\n        refresh(params).then(function(schema) {\n          ++service.updates;\n          //service.updateSchema(schema);\n          service.processUpdatedSchema(schema);\n        });\n      }\n    }, 100);\n\n    service.refreshData = _.debounce(function() {\n      refresh(_.extend(service.schema.params, {updateSchema: 'refreshData'})).then(function(schema) {\n        service.processUpdatedSchema(schema);\n      });\n    }, 100);\n\n    service.events.push($rootScope.$on('ffRefreshData', service.refreshData));\n  }\n\n  function processUpdatedSchema(schema) {\n    var service = this;\n    if(schema.diff) {\n      service.schema.params = schema.params;\n\n      if(schema.diff.data) {\n        $rootScope.$broadcast('cnFlexFormDiff:data', schema.diff.data);\n        _.each(schema.diff.data, (data, prop) => {\n          if(data && data.data && !_.isEmpty(service.schema.data[prop].data) && !data.reset) {\n            data.data = service.schema.data[prop].data.concat(data.data);\n          }\n          service.schema.data[prop] = data;\n          if(service.resolveRegister[prop]) {\n            _.each(service.resolveRegister[prop], (registers) => {\n              registers.forEach(register => {\n                service.handleResolve(register.field, register.prop, register.exp);\n              });\n            });\n          }\n        });\n      }\n\n      var keys = [];\n\n      if(schema.diff.schema) {\n        $rootScope.$broadcast('cnFlexFormDiff:schema', schema.diff.schema);\n        _.each(schema.diff.schema, function(schema, key) {\n          service.schema.schema.properties[key] = schema;\n          reprocessSchema(schema, key, keys);\n        });\n      }\n\n      if(schema.diff.form) {\n        $rootScope.$broadcast('cnFlexFormDiff:form', schema.diff.form);\n        _.each(schema.diff.form, function(form) {\n\n          if(keys.indexOf(form.key) === -1) {\n            keys.push(form.key);\n          }\n\n          // don't want to override key when extending cached objects\n          //var key = form.key;\n          //delete form.key;\n\n          var cached = service.getFromFormCache(form.key);\n          if(cached) {\n            service.reprocessField(cached, form);\n          }\n          var copies = service.getArrayCopies(form.key);\n          if(copies) {\n            copies.forEach(copy => copy && service.reprocessField(copy, form));\n          }\n        });\n      }\n\n      if(keys.length) {\n        _.each(keys, function(key) {\n          var form = service.getFromFormCache(key);\n          if(form) service.processField(form);\n          if(key.includes('[]')) {\n            var copies = service.getArrayCopies(key);\n            _.each(copies, function(copy) {\n              if(copy) service.processField(copy);\n            });\n          }\n        });\n      }\n\n      service.broadcastErrors();\n    }\n    else {\n      service.updateSchema(schema);\n    }\n  }\n\n  function reprocessField(current, update, isChild) {\n    var service = this;\n\n    // other logic in the service will add conition = 'true' to force\n    // condition to eval true, so we set the update condition to 'true'\n    // before comparing\n    if(!update.condition && current.condition) update.condition = 'true';\n    let redraw = !isChild && current.condition !== update.condition;\n\n    _.extend(current, _.omit(update, 'items', 'key'));\n\n    current._ogKeys.forEach(key => {\n      if(!update[key]) delete current[key];\n    });\n    current._ogKeys = _.keys(update);\n\n    service.deregisterHandlers(update.key);\n\n    $rootScope.$broadcast('cnFlexFormReprocessField', update.key);\n\n    // why do we redraw? If we're doing it to show error message\n    // that has been addressed from the angular-schema-form library\n    // if there's another issue, try triggering the specific action required\n    // instead of redrawing the whole form\n    if(redraw && current.redraw) {\n      console.log('TODO: see if this can be removed'); \n      current.redraw();\n    }\n  }\n\n  function reprocessSchema(schema, key, keys) {\n    keys.push(key);\n    if(schema.properties) {\n      _.each(schema.properties, function(schema, subKey) {\n        reprocessSchema(schema, key + '.' + subKey, keys);\n      });\n    }\n    if(schema.items && schema.items.properties) {\n      _.each(schema.properties, function(schema, subKey) {\n        reprocessSchema(schema, key + '[].' + subKey, keys);\n      });\n    }\n  }\n\n  function buildError(field) {\n    var service = this;\n    var key = service.getKey(field.key);\n    return {\n      key: key,\n      message: field.error\n    };\n  }\n\n  function broadcastErrors() {\n    var service = this;\n    $timeout(function() {\n      service.errors.forEach(function(error) {\n        $rootScope.$broadcast('schemaForm.error.' + error.key, 'serverValidation', error.message);\n      });\n    }, 1);\n  }\n\n  function replaceArrayIndex(resolve, key) {\n    if(!resolve.includes('arrayIndex')) return resolve;\n    const arrayIndexKey = /([^.[]*)\\[arrayIndex\\]/.exec(resolve);\n    const re = new RegExp(arrayIndexKey[1] + '\\\\[(-?\\\\d+)\\\\]');\n    const index = re.exec(key);\n    if(!index) return resolve;\n    return resolve.replace(new RegExp(arrayIndexKey[0].replace(/(\\[|\\])/g, '\\\\$1'), 'g'), index[0]);\n  }\n\n  function getArrayIndex(key) {\n    if(_.isObject(key)) {\n      return _.find(key.key, function(key) {\n        return _.isNumber(key);\n      });\n    } else {\n      return /\\[(\\d+)\\]/.exec(key)[1];\n    }\n  }\n\n  function setArrayIndex(key, index, asArray) {\n    var service = this;\n    var keyCopy;\n    if(_.isString(key)) {\n      keyCopy = ObjectPath.parse(key);\n    } else {\n      keyCopy = _.clone(key);\n    }\n    var indexOfIndex = keyCopy.indexOf('');\n    keyCopy[indexOfIndex] = index;\n\n    if(asArray) {\n      return keyCopy;\n    } else {\n      return service.getKey(keyCopy);\n    }\n  }\n\n  function cleanup() {\n    var service = this;\n    _.each(service.events, function(listener) {\n      listener();\n    });\n  }\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.provider('cnFlexFormService', cnFlexFormServiceProvider);\n\nexport default cnFlexFormServiceProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form.service.js","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 6\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"objectpath\"\n// module id = 7\n// module chunks = 0","const modalMap = {};\nconst promiseMap = {};\n\nfunction getPromises(state) {\n  if(promiseMap[state]) return promiseMap[state];\n\n  const promise = {};\n  promiseMap[state] = promise;\n  return promise;\n}\n\nfunction getPromise(state, id, $q) {\n  const promises = getPromises(state);\n  if(promises[id]) return promises[id];\n\n  const promise = $q.defer();\n  promises[id] = promise;\n  return promise;\n}\n\nfunction cnFlexFormModalLoaderServiceProvider() {\n\n  return {\n    addMapping,\n    $get: cnFlexFormModalLoaderService\n  };\n\n  ////////////\n\n  function addMapping(state, def) {\n    def.resolve = { parent };\n    modalMap[state] = def;\n  }\n\n  function parent($stateParams, $q) {\n    'ngInject';\n\n    return (\n      getPromise($stateParams.modal, $stateParams.modalId, $q)\n      .promise\n      .then(({ parent }) => parent)\n    );\n  }\n}\n\nfunction cnFlexFormModalLoaderService($stateParams, $q) {\n  'ngInject';\n\n  return {\n    getMapping,\n    resolveMapping\n  };\n\n  /////////////\n\n  function resolveMapping(state, id, parent, options = {}) {\n    const { scope } = options;\n    if(scope) {\n      //scope.options = scope.options || {};\n      //scope.options.destroyStrategy = 'retain';\n      modalMap[state].scope = scope;\n    }\n    const d = getPromise(state, id, $q);\n    d.resolve({ parent, options });\n    return d.promise;\n  }\n\n  function getMapping(state) {\n    const d = $q.defer();\n    getPromise($stateParams.modal, $stateParams.modalId, $q)\n      .promise\n      .then(({ parent, options }) => {\n        d.resolve({ state: modalMap[state], options });\n        return parent;\n      });\n    return d.promise;\n  }\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.provider('cnFlexFormModalLoaderService', cnFlexFormModalLoaderServiceProvider);\n\nexport default cnFlexFormModalLoaderServiceProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-modal-loader.service.js","function FlexFormModalLoader(FlexFormModal, $state, $rootScope, $stateParams) {\n  'ngInject';\n\n  const vm = this;\n\n  activate();\n\n  //////////\n\n  function activate() {\n    FlexFormModal\n      .open(vm)\n      .then(({ modal, options: { onDismiss } }) => {\n        vm.modal = modal;\n        vm.modal.result.finally(goBack);\n        if(onDismiss) vm.modal.result.catch(() => onDismiss($stateParams.restParams));\n        vm.dismissEvent = $rootScope.$on('$stateChangeStart', dismissModal);\n      });\n  }\n\n  function goBack() {\n    if(!$state.transition) {\n      $state.go('^');\n    }\n  }\n\n  function dismissModal() {\n    console.log('dismissModal');\n    vm.dismissEvent();\n    vm.modal.dismiss();\n  }\n}\n\nfunction FlexFormModal(cnFlexFormModalLoaderService, $uibModal, $stateParams) {\n  'ngInject';\n\n  return { open };\n\n  ////////////\n  \n  function open() {\n    return (\n      cnFlexFormModalLoaderService\n        .getMapping($stateParams.modal)\n        .then(({ state, options }) => ({\n          modal: $uibModal.open(state),\n          options \n        }))\n    );\n  }\n\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.controller('FlexFormModalLoader', FlexFormModalLoader)\n    //.factory('FlexFormModal', FlexFormModal);\n\nexport { FlexFormModalLoader, FlexFormModal };\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-modal-loader.js","function cnFlexForm() {\n  return {\n    restrict: 'E',\n    template: `\n      <div ng-if=\"vm.showForm()\">\n        <ng-form name=\"{{vm.formName}}\"\n              sf-schema=\"vm.config.schema.schema\"\n              sf-form=\"vm.form\"\n              sf-model=\"vm.model\"></ng-form>\n        <!-- debug panel to display model -->\n        <section ng-if=\"vm.debug\"><pre pretty-json=\"vm.model\"></pre></section>\n      </div>\n    `,\n    scope: {\n      config: '=ffConfig',\n      model: '=ffModel',\n      formIndex: '=ffFormIndex',\n      formName: '=ffFormName',\n      delayForm: '=ffDelayForm',\n      cleanupEvent: '=ffCleanupEvent'\n    },\n    controller: FlexForm,\n    controllerAs: 'vm',\n    bindToController: true\n  };\n}\n\nfunction FlexForm(cnFlexFormService, $scope, $location) {\n  'ngInject';\n\n  var vm = this;\n  vm.service = undefined;\n  vm.events = [];\n\n  vm.activate = activate;\n  vm.cleanup = cleanup;\n  vm.process = process;\n  vm.showForm = showForm;\n\n  vm.events.push($scope.$watch(function() { return vm.config.schema; }, vm.process));\n\n  vm.activate();\n\n  $scope.$on(vm.cleanupEvent || '$destroy', vm.cleanup);\n\n  //////////\n\n  function activate() {\n    //console.log('vm.formName:', vm.formName);\n    if(angular.isNumber(vm.formIndex)) {\n      vm.form = vm.config.schema.forms[vm.formIndex].form;\n    }\n    else {\n      vm.form = vm.config.schema.form;\n    }\n\n    // debug\n    if($location.search().debug) {\n      vm.debug = true;\n    }\n  }\n\n  function process(cur, prev) {\n    //console.log('process:', cur, prev);\n    if(vm.form) {\n      if(!vm.service) {\n        vm.service = cnFlexFormService(vm.config.schema, vm.model, {\n          formCtrl: vm.config.formCtrl,\n          getSchema: vm.config.getSchema,\n          updateSchema: updateSchema\n        });\n      }\n      else {\n        console.log('vm.service.isCompiled():', vm.service.isCompiled());\n        vm.service.compile(vm.config.schema, vm.model);\n      }\n      //$scope.$broadcast('schemaFormRedraw');\n    }\n  }\n\n  function showForm() {\n    //console.log('showForm:', vm.delayForm, vm.formName);\n    return !vm.delayForm && vm.service && vm.service.isCompiled();\n  }\n\n  function updateSchema(schema) {\n    vm.config.schema = schema;\n    vm.activate();\n  }\n\n  function cleanup() {\n    _.each(vm.events, function(listener) {\n      listener();\n    });\n    vm.service.cleanup();\n  }\n\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.directive('cnFlexForm', cnFlexForm);\n\nexport default cnFlexForm;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form.directive.js","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 11\n// module chunks = 0","function cnFlexFormHeader() {\n  return {\n    restrict: 'E',\n    scope: {\n      config: '=ffHeaderConfig',\n      submit: '&ffSubmit',\n      loadOffscreen: '&ffLoadOffscreen'\n    },\n    controller: FlexFormHeader,\n    bindToController: true,\n    controllerAs: 'vm',\n    template: `\n        <div class=\"col-md-6\">\n          <h5 ng-if=\"vm.config.title.lead\">{{::vm.config.title.lead}}</h5>\n          <h1>\n            <i ng-show=\"vm.config.title.icon\" class=\"{{vm.config.title.icon}}\"/>\n            {{vm.config.title.main}}\n          </h1>\n          <h5 ng-if=\"vm.config.title.sub\">{{::vm.config.title.sub}}</h5>\n        </div>\n        <div class=\"{{vm.config.buttonContainerClass || 'page-action-btns'}}\">\n          <div class=\"btn-options\"\n               ng-mouseover=\"vm.loadOffscreen()\">\n            <a class=\"btn btn-default-dark\"\n               ng-if=\"vm.config.actionConfig.returnState\"\n               ui-sref=\"{{vm.config.actionConfig.returnState}}\">\n              {{vm.config.actionConfig.returnText || 'Cancel'}}\n            </a>\n            <a class=\"btn btn-{{vm.config.actionConfig.closeButton.style ? vm.config.actionConfig.closeButton.style : 'default-dark'}}\"\n               ng-if=\"vm.config.actionConfig.closeButton\"\n               ng-click=\"vm.config.actionConfig.closeButton.handler()\">\n               Cancel\n            </a>\n            <span ng-repeat=\"button in vm.config.actionConfig.actions\">\n              <span ng-class=\"{'btn-group': button.options}\">\n                <a class=\"btn {{button.style ? 'btn-'+button.style : ($index === vm.config.actionConfig.actions.length - 1 ? 'btn-primary' : 'btn-default-dark')}}\"\n                   ng-disabled=\"vm.isDisabled(button)\"\n                   ng-click=\"vm.submit({handler: button.handler})\"\n                   uib-tooltip=\"{{button.helptext}}\"\n                   uib-tooltip-placement=\"bottom\"\n                   ng-bind-html=\"button.text || 'Save'\">\n                </a>\n                <a class=\"btn {{button.style ? 'btn-'+button.style : ($index === vm.config.actionConfig.actions.length - 1 ? 'btn-primary' : 'btn-default-dark')}} dropdown-toggle\"\n                        ng-disabled=\"vm.isDisabled(button)\"\n                        ng-show=\"button.options\"\n                        data-toggle=\"dropdown\">\n                  <span class=\"caret\"></span>\n                </a>\n                <ul class=\"dropdown-menu\" ng-if=\"button.options\">\n                  <li ng-repeat=\"option in button.options\"\n                      ng-disabled=\"vm.isDisabled(option)\">\n                    <a ng-click=\"vm.submit({handler: option.handler})\"\n                       ng-bind-html=\"option.text\">\n                    </a>\n                  </li>\n                </ul>\n              </span>\n            </span>\n          </div>\n          <p class=\"data-updated-at text-right\"\n             id=\"data-updated-at\"\n             ng-hide=\"vm.config.noData\">\n            <a ng-click=\"vm.updateData()\">Update Data</a>\n          </p>\n        </div>`\n  };\n}\n\nfunction FlexFormHeader($scope) {\n  'ngInject';\n\n  const vm = this;\n\n  vm.updateData = updateData;\n  vm.isDisabled = isDisabled;\n\n  ///////////\n\n  function updateData() {\n    console.log('updateData:', updateData);\n    $scope.$emit('ffRefreshData');\n  }\n\n  function isDisabled(btnConfig) {\n    if(vm.config.isDisabled) return vm.config.isDisabled(btnConfig);\n    return false;\n  }\n}\n\n//angular\n  //.module('cn.flex-form')\n  //.directive('cnFlexFormHeader', cnFlexFormHeader);\n\nexport default cnFlexFormHeader;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-header.directive.js","function ffValidate() {\n  return {\n    restrict: 'A',\n    scope: { form: '=ffValidate' },\n    require: 'ngModel',\n    link: link\n  };\n}\n\nfunction link($scope, elem, attrs, ngModel) {\n  //console.log('$scope, ngModel:', $scope.form, ngModel);\n  if($scope.form && $scope.form.required) {\n    $scope.$watch(function() { return ngModel.$viewValue; }, function(value) {\n      // override schemaForm validation\n      ngModel.$setValidity('schemaForm', true);\n      ngModel.$setValidity('tv4-302', value);\n    });\n  }\n}\n\n//angular\n    //.module('cn.flex-form')\n    //.directive('ffValidate', ffValidate);\n\nexport default ffValidate;\n\n\n\n// WEBPACK FOOTER //\n// ./src/cn-flex-form-validate.directive.js"],"sourceRoot":""}