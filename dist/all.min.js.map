{"version":3,"sources":["all.min.js","_cn-flex-form.module.js","cn-flex-form-config.service.js","cn-flex-form-header.directive.js","cn-flex-form-modal-loader.js","cn-flex-form-modal-loader.service.js","cn-flex-form-types.service.js","cn-flex-form-validate.directive.js","cn-flex-form.directive.js","cn-flex-form.routes.js","cn-flex-form.service.js","sandbox.js","schema-form-extensions.js"],"names":["angular","module","cnFlexFormConfigProvider","addIgnoreParam","param","ignoreParams","push","cnFlexFormConfig","$stateParams","getStateParams","_","chain","omit","v","isUndefined","isNull","value","$inject","$get","provider","cnFlexFormHeader","restrict","scope","config","submit","loadOffscreen","controller","FlexFormHeader","bindToController","controllerAs","template","$scope","updateData","console","log","$emit","isDisabled","btnConfig","vm","this","directive","FlexFormModalLoader","FlexFormModal","$state","$rootScope","activate","modal","open","result","goBack","dismiss","$on","dismissModal","go","cnFlexFormModalLoaderService","$modal","openModal","currentModal","getMapping","instance","factory","getPromises","state","promises","promiseMap","getPromise","id","$q","promise","defer","cnFlexFormModalLoaderServiceProvider","addMapping","def","resolve","parent","modalMap","modalId","resolveMapping","service","cnFlexFormTypesProvider","registerFieldType","fieldType","fieldTypeRegister","unshift","cnFlexFormTypes","getFieldType","field","i","l","length","condition","type","schema","includes","titleMap","titleMapResolve","titleMapQuery","format","ffValidate","form","require","link","elem","attrs","ngModel","required","$watch","$viewValue","$setValidity","cnFlexForm","model","formIndex","formName","delayForm","cleanupEvent","FlexForm","cnFlexFormService","$location","isNumber","forms","search","debug","process","cur","prev","isCompiled","compile","formCtrl","getSchema","updateSchema","showForm","cleanup","each","events","listener","undefined","cnFlexFormRoutesProvider","$stateProvider","addStates","options","name","url","permissions","cnFlexFormRoutes","templateUrl","cnFlexFormServiceProvider","schemaFormDecoratorsProvider","registerField","handler","fieldTypeHandlers","createDirective","CNFlexFormService","Api","$parse","$interpolate","$timeout","cnUtil","CNFlexFormConstructor","services","CNFlexForm","arrayCopies","arrayListeners","dataCache","defaults","errors","formCache","listeners","resolveRegister","updates","params","setupConfig","processField","bind","initModelWatch","initArrayCopyWatch","broadcastErrors","setValue","compiled","getSchemaForm","setupSchemaRefresh","processSchema","getSchemaType","isArray","first","processDefault","key","getKey","parseExpression","modelValue","get","equals","set","copy","processFieldset","fieldset","items","collapsible","toggleCollapse","collapsed","render","selectDisplay","processSelectDisplay","_ogKeys","without","keys","addToFormCache","description","readonly","processResolve","watch","processFieldWatch","processSection","processComponent","isString","isFunction","call","registerHandler","error","buildError","reduce","total","next","test","depth","replace","split","properties","matchArray","match","shift","slice","dataKey","fieldKey","handleResolve","resolveType","registerResolve","exp","data","cursor","loadMore","refreshSchema","resolution","functionCondition","isConditionFunction","parsedCondition","parseCondition","adjustment","date","trim","math","operator","+","-","*","/","adjuster","updatePath","fromPath","replaceArrayIndex","arguments","update","from","moment","add","toDate","eval","p","floor","ceil","round","path","invert","functionName","functionArgument","predicate","arr","comparator","comparisonValue","evaluation","forEach","val","evaluatePredicate","toString","val1","val2","runHandler","isObject","arrMatch","registerArrayHandlers","handlers","arrKey","onArray","lastKey","deregisterHandlers","arrVal","watching","modelWatch","onModelWatch","initSchemaParams","cleanModel","prevParams","isEmpty","event","addArrayCopy","index","list","splice","getArrayCopies","getFromFormCache","addToDataCache","getFromDataCache","start","section","component","htmlClass","cols","reject","processCurrency","currencyFormat","currency-dollars","currency-microcents","currency","processPercentage","processReusable","processMediaUpload","processRadiobuttons","radios","fullWidth","btnClass","divide","processDate","processSelect","select","getTitleMap","onInit","setter","newVal","valueProperty","find","q","titleQuery","minLookup","isDefined","default","onAdd","prop","detailedList","selectionStyle","maxItems","displayFormat","itemFormatter","processTemplate","$setDirty","processToggle","toggle","processHelp","help","processDisplay","display","getDisplay","tpl","parseScope","processor","arrayIndex","map","selectField","setupArraySelectDisplay","setupSelectDisplay","item","getArrayIndex","selectKey","splitKey","ObjectPath","parse","indexedSelectKey","setArrayIndex","selectValue","formCopies","indexedKey","splitIndexedKey","selectModel","itemValue","count","keyMap","pluck","once","resetCount","refresh","debounce","extend","diff","then","processUpdatedSchema","refreshData","concat","register","reprocessSchema","indexOf","cached","reprocessField","copies","current","isChild","redraw","subKey","message","$broadcast","arrayIndexKey","exec","re","RegExp","asArray","keyCopy","clone","indexOfIndex","prototype","cn-radiobuttons","cn-autocomplete","cn-datetimepicker","cn-display","cn-currency","cn-percentage","cn-mediaupload","cn-reusable","cn-toggle","FlexFormSandbox","onSchema","schemaStr","fromJson","schemaFormConfig","extensions","extension","addTemplates","$templateCache","put","sharedAutocompleteTpl","run"],"mappings":"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","file":"all.min.js","sourcesContent":["\"use strict\";!function(){angular.module(\"cn.flex-form\",[\"ui.router\",\"schemaForm\",\"ui.bootstrap.datetimepicker\",\"cnTagsInput\",\"cn.util\"])}(),function(){function e(){function e(e){t.push(e)}function r(e){function r(){return _.chain(e).omit(t).omit(function(e){return _.isUndefined(e)||_.isNull(e)}).value()}return{getStateParams:r,ignoreParams:t}}r.$inject=[\"$stateParams\"];var t=[\"page\",\"debug\",\"sandbox\",\"modal\",\"modalId\"];return{addIgnoreParam:e,$get:r}}angular.module(\"cn.flex-form\").provider(\"cnFlexFormConfig\",e)}(),function(){function e(){return{restrict:\"E\",scope:{config:\"=ffHeaderConfig\",submit:\"&ffSubmit\",loadOffscreen:\"&ffLoadOffscreen\"},controller:r,bindToController:!0,controllerAs:\"vm\",template:'<div class=\"col-md-6\">                  <h5 ng-if=\"vm.config.title.lead\">{{::vm.config.title.lead}}</h5>                  <h1>{{vm.config.title.main}}</h1>                  <h5 ng-if=\"vm.config.title.sub\">{{::vm.config.title.sub}}</h5>                </div>                <div class=\"{{vm.config.buttonContainerClass}}\">                  <div class=\"btn-options\"                       ng-mouseover=\"vm.loadOffscreen()\">                    <a class=\"btn\" ui-sref=\"{{vm.config.actionConfig.returnState}}\">                      {{vm.config.actionConfig.returnText || \\'Cancel\\'}}                    </a>                    <span ng-repeat=\"button in vm.config.actionConfig.actions\">                      <a class=\"btn {{button.style && \\'btn-\\'+button.style}}\"                         ng-disabled=\"vm.isDisabled(button)\"                         ng-class=\"{\\'btn-primary\\': $index === vm.config.actionConfig.actions.length - 1}\"                         ng-click=\"vm.submit({ handler: button.handler})\"                         tooltip=\"{{button.helptext}}\"                         tooltip-placement=\"bottom\">                        {{button.text || \\'Save\\'}}                      </a>                    </span>                  </div>                  <p class=\"data-updated-at text-right\" id=\"data-updated-at\">                    <a ng-click=\"vm.updateData()\">Update Data</a>                  </p>                </div>                '}}function r(e){function r(){console.log(\"updateData:\",r),e.$emit(\"ffRefreshData\")}function t(e){return o.config.isDisabled?o.config.isDisabled(e):!1}var o=this;o.updateData=r,o.isDisabled=t}angular.module(\"cn.flex-form\").directive(\"cnFlexFormHeader\",e),r.$inject=[\"$scope\"]}(),function(){function e(e,r,t,o){function a(){i.modal=e.open(i),i.modal.result[\"finally\"](n),i.dismiss=t.$on(\"$stateChangeStart\",s)}function n(){r.go(\"^\")}function s(){i.dismiss(),i.modal.dismiss()}var i=this;console.log(\"FlexFormModalLoader:\",o.modal),a()}function r(e,r,t){function o(){var o=e.getMapping(t.modal);return console.log(\"currentModal:\",o),this.modal=r.open(o),this.modal}var a={open:o};return a}angular.module(\"cn.flex-form\").controller(\"FlexFormModalLoader\",e).factory(\"FlexFormModal\",r),e.$inject=[\"FlexFormModal\",\"$state\",\"$rootScope\",\"$stateParams\"],r.$inject=[\"cnFlexFormModalLoaderService\",\"$modal\",\"$stateParams\"]}(),function(){function e(e){var r=n[e];return r||(r={},n[e]=r),r}function r(r,t,o){var a=e(r),n=a[t];return n||(n=o.defer(),a[t]=n),n}function t(){function e(e,r){r.resolve={parent:t},a[e]=r}function t(e,t){return r(e.modal,e.modalId,t).promise}var n={addMapping:e,$get:o};return t.$inject=[\"$stateParams\",\"$q\"],n}function o(e){function t(t,o,a){r(t,o,e).resolve(a)}function o(e){return a[e]}var n={getMapping:o,resolveMapping:t};return n}angular.module(\"cn.flex-form\").provider(\"cnFlexFormModalLoaderService\",t);var a={},n={};o.$inject=[\"$q\"]}(),function(){function e(){function e(e){t.unshift(e)}function r(){function e(e){for(var r=0,o=t.length;o>r;r++)if(t[r].condition(e))return t[r].type;return e.type||e.schema&&e.schema.type}return{fieldTypeRegister:t,getFieldType:e}}var t=[{condition:function(e){return\"hidden\"===e.type},type:\"hidden\"},{condition:function(e){return e.type.includes(\"radiobuttons\")},type:\"cn-radiobuttons\"},{condition:function(e){return e.type.includes(\"autocomplete\")||e.titleMap||e.titleMapResolve||e.titleMapQuery},type:\"cn-autocomplete\"},{condition:function(e){return\"cn-datetimepicker\"===e.type||\"datetime-local\"===e.type},type:\"cn-datetimepicker\"},{condition:function(e){return\"help\"===e.type},type:\"help\"},{condition:function(e){return e.type.includes(\"display\")},type:\"cn-display\"},{condition:function(e){return e.schema&&e.schema.format&&e.schema.format.includes(\"currency\")},type:\"cn-currency\"},{condition:function(e){return e.schema&&\"percentage\"===e.schema.format},type:\"cn-percentage\"},{condition:function(e){return\"boolean\"===e.type},type:\"cn-toggle\"},{condition:function(e){return\"mediaupload\"===e.type},type:\"cn-mediaupload\"},{condition:function(e){return\"reusable\"===e.type},type:\"cn-reusable\"},{condition:function(e){return\"array\"===e.type},type:\"section\"}];return{registerFieldType:e,$get:r}}angular.module(\"cn.flex-form\").provider(\"cnFlexFormTypes\",e)}(),function(){function e(){return{restrict:\"A\",scope:{form:\"=ffValidate\"},require:\"ngModel\",link:r}}function r(e,r,t,o){e.form&&e.form.required&&e.$watch(function(){return o.$viewValue},function(e){o.$setValidity(\"schemaForm\",!0),o.$setValidity(\"tv4-302\",e)})}angular.module(\"cn.flex-form\").directive(\"ffValidate\",e)}(),function(){function e(){return{restrict:\"E\",template:'        <div ng-if=\"vm.showForm()\">          <ng-form name=\"{{vm.formName}}\"                sf-schema=\"vm.config.schema.schema\"                sf-form=\"vm.form\"                sf-model=\"vm.model\"></ng-form>          <!-- debug panel to display model -->          <pre ng-if=\"vm.debug\">{{vm.model|json}}</pre>        </div>      ',scope:{config:\"=ffConfig\",model:\"=ffModel\",formIndex:\"=ffFormIndex\",formName:\"=ffFormName\",delayForm:\"=ffDelayForm\",cleanupEvent:\"=ffCleanupEvent\"},controller:r,controllerAs:\"vm\",bindToController:!0}}function r(e,r,t){function o(){angular.isNumber(c.formIndex)?c.form=c.config.schema.forms[c.formIndex].form:c.form=c.config.schema.form,t.search().debug&&(c.debug=!0)}function a(r,t){c.form&&(c.service?(console.log(\"vm.service.isCompiled():\",c.service.isCompiled()),c.service.compile(c.config.schema,c.model)):c.service=e(c.config.schema,c.model,{formCtrl:c.config.formCtrl,getSchema:c.config.getSchema,updateSchema:s}))}function n(){return!c.delayForm&&c.service&&c.service.isCompiled()}function s(e){c.config.schema=e,c.activate()}function i(){_.each(c.events,function(e){e()}),c.service.cleanup()}var c=this;c.service=void 0,c.events=[],c.activate=o,c.cleanup=i,c.process=a,c.showForm=n,c.events.push(r.$watch(function(){return c.config.schema},c.process)),c.activate(),r.$on(c.cleanupEvent||\"$destroy\",c.cleanup)}angular.module(\"cn.flex-form\").directive(\"cnFlexForm\",e),r.$inject=[\"cnFlexFormService\",\"$scope\",\"$location\"]}(),function(){function e(e){function r(){}function t(r){e.state(r.name+\".page.modal\",{url:\"/~:modal/:modalId\",controller:\"FlexFormModalLoader\",controllerAs:\"vm\",permissions:r.permissions})}var o={addStates:t,$get:r};return o}function r(e){e.state(\"flex-form-sandbox\",{url:\"/flex-form/sandbox\",controller:\"FlexFormSandbox\",controllerAs:\"vm\",templateUrl:\"app/components/cn-flex-form/sandbox.html\"})}angular.module(\"cn.flex-form\").provider(\"cnFlexFormRoutes\",e).config(r),e.$inject=[\"$stateProvider\"],r.$inject=[\"$stateProvider\"]}(),function(){function cnFlexFormServiceProvider(e,r){function t(t){t.condition&&r.registerFieldType({condition:t.condition,type:t.type}),t.handler&&(fieldTypeHandlers[t.type]=t.handler),t.templateUrl&&(e.addMapping(\"bootstrapDecorator\",t.type,t.templateUrl),e.createDirective(t.type,t.templateUrl))}return{registerField:t,$get:CNFlexFormService}}function CNFlexFormService(Api,$parse,cnFlexFormConfig,cnFlexFormTypes,$interpolate,$rootScope,$timeout,cnUtil){function CNFlexFormConstructor(e,r,t){var o;if(services.length)for(var a=0,n=services.length;n>a;a++)if(services[a].model===r){o=services[a],o.compile(e,r,t);break}return o||(o=new CNFlexForm(e,r,t),services.push(o)),o||new CNFlexForm(e,r,t)}function CNFlexForm(e,r,t){this.arrayCopies={},this.arrayListeners={},this.dataCache={},this.defaults={},this.errors=[],this.events=[],this.formCache={},this.listeners={},this.resolveRegister={},this.model=r,this.updates=0,this.params=cnFlexFormConfig.getStateParams(),this.compile(e,r,t)}function compile(e,r,t){var o=this;o.schema=e,o.model=r,o.isCompiled()||(o.setupConfig(t),e.forms?_.each(e.forms,function(e){_.each(e.form,o.processField.bind(o))}):_.each(e.form,o.processField.bind(o)),o.initModelWatch(),o.initArrayCopyWatch(),o.isCompiled(!0)),o.broadcastErrors()}function isCompiled(e){var r=this;return e&&(r.schema.compiled=e),r.schema&&r.schema.compiled}function setupConfig(e){var r=this;e&&(e.formCtrl&&(r.formCtrl=e.formCtrl),e.updateSchema&&(r.updateSchema=e.updateSchema),e.getSchema&&(r.getSchemaForm=r.setupSchemaRefresh(e.getSchema)))}function processSchema(e){var r=this,t=e.schema;t&&(e.getSchemaType=function(){return _.isArray(t.type)?_.first(t.type):t.type},r.processDefault(e))}function processDefault(e){var r=this,t=e.schema;if(t[\"default\"]){var o=r.getKey(e.key);if(r.updates){if(o.includes&&o.includes(\"[]\"))return;var a=r.parseExpression(e.key,r.model),n=a.get();(!r.defaults[o]||_.isUndefined(n)||angular.equals(n,r.defaults[o]))&&a.set(t[\"default\"])}r.defaults[o]=angular.copy(t[\"default\"])}}function processFieldset(e){var r=this;e.type=\"cn-fieldset\",_.each(e.items,r.processField.bind(r)),e.collapsible?(e.toggleCollapse=function(){e.collapsible&&(e.collapsed=!e.collapsed)},e.render=!e.collapsed):e.render=!0}function processField(e){var r=this;if(e.selectDisplay&&r.processSelectDisplay(e,r.getSchema(e.key)),\"fieldset\"===e.type)r.processFieldset(e);else{e._ogKeys||(e._ogKeys=_.without(_.keys(e),\"key\"));var t=r.getKey(e.key);if(e.key&&(r.addToFormCache(e,t),e.schema=r.getSchema(t),e.schema&&(e.schema.description&&(e.description=e.schema.description),e.readonly&&!e.schema.readonly&&(e.readonly=!1))),r.processSchema(e),e.type||(e.type=e.getSchemaType&&e.getSchemaType()),e.resolve&&r.processResolve(e),e.watch&&r.processFieldWatch(e),\"section\"===e.type||\"tabarray\"===e.type)r.processSection(e);else if(\"component\"===e.type)r.processComponent(e);else{var o=cnFlexFormTypes.getFieldType(e),a=fieldTypeHandlers[o];_.isString(a)?r[a](e):_.isFunction(a)&&a.call(r,e),e.updateSchema&&r.registerHandler(e,null,e.updateSchema),e.error&&r.errors.push(r.buildError(e))}}}function getKey(e){return _.isArray(e)&&(e=_.reduce(e,function(e,r){return/^(\\d*)$/.test(r)?e+\"[\"+r+\"]\":e+\".\"+r})),e}function getSchema(e,r){if(e){var t=this;e=t.getKey(e),e=e.replace(/arrayIndex/g,\"\").replace(/(\\[')([^.]+)\\.([^.]+)('])/g,\".$2%ff_dt%$3\").replace(/\\./g,\"%ff_sp%\").replace(/%ff_dt%/g,\".\").split(\"%ff_sp%\"),r=r||t.schema.schema.properties;for(var o,a;e.length>1;)o=e[0],a=o.match(/\\[\\d*]$/),r=a?r[e.shift().slice(0,o.length-a[0].length)].items.properties:r[e.shift()].properties;return o=e[0],a=o.match(/\\[\\d*]$/),a?r[o.slice(0,o.length-a[0].length)].items:r[o]}}function processResolve(e){var r=this;return _.each(e.resolve,function(t,o){r.handleResolve(e,o,t);var a=t.match(/^(schema\\.data\\.|model\\.)(\\w+)/);a&&(\"schema.data.\"===a[1]?r.registerResolve(e,o,a[2]):\"model.\"===a[1]&&r.registerHandler(a[2],function(){r.handleResolve(e,o,t)}))}),e}function handleResolve(e,r,t){var o=this,a=o.parseExpression(t).get();a&&a.cursor?e.loadMore=function(){var e=t.match(/schema\\.data\\.(.+)/)[1];o.refreshSchema(\"data:\"+e+\":\"+a.cursor)}:delete e.loadMore,e[r]=a&&a.data?a.data:a}function registerResolve(e,r,t){var o=this;o.resolveRegister[t]=o.resolveRegister[t]||{},o.resolveRegister[t][o.getKey(e.key)]={field:e,key:r}}function processFieldWatch(field){var service=this,schema=field.schema;field.watch=_.isArray(field.watch)?field.watch:[field.watch],_.each(field.watch,function(watch){if(watch.resolution){var condition=watch.condition,functionCondition=service.isConditionFunction(condition),resolution=watch.resolution,handler;if(_.isFunction(resolution))handler=function(){var e=functionCondition?service.parseCondition(functionCondition):condition;(!e||$parse(e)(service))&&resolution()};else{var adjustment={};adjustment.date=resolution.match(/\\+ ?(\\d+) days/),adjustment.date?(adjustment.date=adjustment.date[1],resolution=resolution.replace(adjustment.date,\"\").trim()):(adjustment.math=resolution.match(/(\\+|\\-|\\/|\\*) ?(\\S+)/),adjustment.math&&(adjustment.operator={\"+\":\"add\",\"-\":\"subtract\",\"*\":\"multiply\",\"/\":\"divide\"}[adjustment.math[1]],adjustment.adjuster=service.parseExpression(adjustment.math[2]))),resolution=resolution.match(/(\\S+) ?= ?(\\S+)/),handler=function handler(){var updatePath,fromPath;resolution[1].includes(\"arrayIndex\")&&(updatePath=replaceArrayIndex(resolution[1],arguments[2])),resolution[2].includes(\"arrayIndex\")&&(fromPath=replaceArrayIndex(resolution[2],arguments[2]));var update=service.parseExpression(updatePath||resolution[1]),from=service.parseExpression(fromPath||resolution[2]),parsedCondition=functionCondition?service.parseCondition(functionCondition):condition;if(!parsedCondition||$parse(parsedCondition)(service))if(adjustment.date)update.set(moment(from.get()).add(adjustment.date,\"days\").toDate());else if(adjustment.math){var result=eval(from.get()+adjustment.math[1]+adjustment.adjuster.get());if(schema=schema||field.items&&(field.items[0].schema||field.items[0].items&&field.items[0].items[0].schema),\"cn-currency\"===field.type){var p=schema&&\"currency-dollars\"===schema.format?2:0;result=\"*\"===adjustment.math[1]?_.floor(result,p):\"/\"===adjustment.math[1]?_.ceil(result,p):_.round(result,p)}service.listeners[update.path().key].prev=result,update.set(result||0)}else update.set(from.get())}}service.registerHandler(field,handler,field.updateSchema)}})}function isConditionFunction(e){return e&&e.match(/(\\!?)(.+)\\((.+)\\)/)}function parseCondition(e){var r=this,t=e[1],o=e[2],a=e[3];if(\"any\"===o){var n=a.match(/(.+)\\[\\]\\.*(.*)(===|>|<|>=|<=)(.+)/),s=r.parseExpression(n[1]).get(),i=n[3],c=n[4].trim().replace(/'/g,\"\"),l=n[2].trim(),m=!1;return s.forEach(function(e){var r=l?e[l]:e;evaluatePredicate(r,i,c)&&(m=!0)}),t?(!m).toString():m.toString()}}function evaluatePredicate(e,r,t){switch(r){case\"===\":return e===t;case\">=\":return e>=t;case\"<=\":return t>=e;case\">\":return e>t;case\"<\":return t>e}}function registerHandler(e,r,t,o){var a=this;if(_.isObject(e)&&!_.isArray(e)){if(!e.key&&e.items)return void _.each(e.items,function(e){a.registerHandler(e,r,e.updateSchema)});e=e.key}e=a.getKey(e);var n=e.match(/([^[\\]]*)\\[]\\.?(.+)/);if(n)return void a.registerArrayHandlers(n[1],n[2],r,t,o);if(!a.listeners[e]){var s=angular.copy(a.parseExpression(e,a.model).get());a.listeners[e]={handlers:[],updateSchema:t,prev:s}}r&&(a.listeners[e].handlers.push(r),o&&r(null,null,e))}function registerArrayHandlers(e,r,t,o,a){var n=this,s=function(s,i){var c,l,m;if(i&&i>s){var d=e+\"[\"+(i-1)+\"].\"+r;if(n.listeners[d])for(c=0,l=i;l>c;c++)m=e+\"[\"+c+\"].\"+r,n.deregisterHandlers(m);for(c=0,l=s;l>c;c++)m=e+\"[\"+c+\"].\"+r,n.registerHandler(m,t,o),a&&t(null,null,m)}else if(s>(i||0))for(c=i,l=s;l>c;c++)m=e+\"[\"+c+\"].\"+r,n.registerHandler(m,t,o),a&&t(null,null,m)},i=n.parseExpression(e,n.model).get();_.each(i,function(s,i){var c=e+\"[\"+i+\"].\"+r;n.registerHandler(c,t,o),a&&t(null,null,c)}),n.arrayListeners[e+\".length\"]?n.arrayListeners[e+\".length\"].handlers.push(s):n.arrayListeners[e+\".length\"]={handlers:[s],prev:i?i.length:0}}function deregisterHandlers(e){var r=this;r.listeners[e]=void 0}function initModelWatch(){var e=this;e.watching||(e.modelWatch&&e.modelWatch(),e.modelWatch=$rootScope.$watch(function(){return e.model},e.onModelWatch.bind(e),!0),e.initSchemaParams(),e.watching=!0)}function onModelWatch(e,r){var t=this;angular.equals(e,r)||(cnUtil.cleanModel(t.model),t.prevParams=angular.copy(t.params),t.params={},_.each(t.arrayListeners,function(e,r){var o=t.parseExpression(r,t.model).get();angular.equals(o,e.prev)||(_.each(e.handlers,function(r){r(o,e.prev)}),e.prev=angular.copy(o))}),_.each(t.listeners,function(e,r){if(e){var o=t.parseExpression(r,t.model).get();angular.equals(o,e.prev)||(_.each(e.handlers,function(t){t(o,e.prev,r)}),e.prev=angular.copy(o)),e.updateSchema&&!angular.isUndefined(o)&&null!==o&&(t.params[r]=o)}}),angular.equals(t.params,t.prevParams)||(t.model.id&&!t.updates&&_.isEmpty(t.prevParams)?++t.updates:t.refreshSchema()))}function initSchemaParams(){var e=this;_.each(e.listeners,function(r,t){if(r){var o=e.parseExpression(t,e.model).get();r.updateSchema&&!angular.isUndefined(o)&&null!==o&&(e.params[t]=o)}})}function initArrayCopyWatch(){var e=this;e.events.push($rootScope.$on(\"schemaFormPropagateScope\",function(r,t){var o=e.getKey(t.form.key).replace(/\\[\\d+]/g,\"[]\");t.form.condition||(t.form.condition=\"true\"),e.addArrayCopy(t.form,o),t.$emit(\"flexFormArrayCopyAdded\",o)})),e.events.push($rootScope.$on(\"schemaFormDeleteFromArray\",function(r,t,o){if(t.form.link){var a=e.parseExpression(t.form.link,e.model).get();a.splice(o,1)}}))}function addArrayCopy(e,r){var t=this;t.arrayCopies[r]||(t.arrayCopies[r]=[]),t.arrayCopies[r].push(e)}function getArrayCopies(e){var r=this;return r.arrayCopies[e]}function addToFormCache(e,r){var t=this;r=r||t.getKey(e.key),t.getFromFormCache(r)||(t.formCache[r]=e)}function getFromFormCache(e){var r=this;return r.formCache[e]}function addToDataCache(e,r){var t=this;e&&(t.dataCache[e]=r)}function getFromDataCache(e){var r=this;return r.dataCache[e]}function parseExpression(exp,depth){var service=this;if(!exp||/^(null|false|true|undefined|''|[0-9.]+|\\[]|\\{})$/.test(exp))return{get:function get(){return eval(exp)}};exp=service.getKey(exp);var match=exp.match(/^(model\\.)?(\\S+)$/),modelValue={get:function(){for(var e=exp.replace(/\\[]/g,\"\").replace(/\\[(\\d+)]/g,\".$1\").split(\".\"),r=depth||service;r&&e.length>1;)r=r[e.shift()];return r&&r[e[0]]},set:function(e){for(var r=exp.replace(/\\[]/g,\"\").replace(/\\[(\\d+)]/g,\".$1\").split(\".\"),t=depth||service;t&&r.length>1;){var o=r.shift();t[o]||(/^\\d?$/.test(r[0])?t[o]=[]:t[o]={}),t=t[o]}return t[r[0]]=e,e},path:function(){return{exp:exp,depth:depth,key:match[2]}}};return modelValue}function processSection(e){var r=this;_.each(e.items,r.processField.bind(r))}function processComponent(e){var r=this;e.type=\"section\",e.htmlClass=\"row\";var t=12/_.reject(e.items,\"hidden\").length;_.each(e.items,function(o,a){r.processField(o),e.items[a]={type:\"section\",htmlClass:\"col-sm-\"+t,items:[o]}})}function processCurrency(e){e.currencyFormat={\"currency-dollars\":\"dollars\",\"currency-microcents\":\"microcents\",currency:\"cents\"}[e.schema.format],e.type=\"cn-currency\"}function processPercentage(e){e.type=\"cn-percentage\"}function processReusable(e){var r=this;e.type=\"cn-reusable\",e.items.forEach(r.processField.bind(r)),e.items=[{type:\"section\",items:e.items,condition:\"!model.\"+r.getKey(e.key)+\".id\"}]}function processMediaUpload(e){var r=this;e.type=\"cn-mediaupload\",_.each(e.data,function(t,o){e.data[o]=r.parseExpression(t).get()})}function processRadiobuttons(e){e.type=\"cn-radiobuttons\",e.fullWidth&&(e.btnClass=\"col-sm-\"+_.divide(12,e.titleMap.length))}function processDate(e){e.type=\"cn-datetimepicker\"}function processSelect(e){var r=this,t=e.schema;if((e.titleMapResolve||e.titleMap)&&(e.getTitleMap=function(){return e.titleMap||r.schema.data[e.titleMapResolve]},e.onInit=function(t,o,a,n){var s=r.parseExpression(o.key,r.model);if(t=s.get(),\"tag-init\"===a){var i;if(\"array\"===o.schema.type)\"object\"!==o.schema.items.type&&(i=[],_.each(t,function(r){var t={};t[e.valueProperty||\"value\"]=r,i.push(_.find(e.getTitleMap(),t))}));else{var c={};c[e.valueProperty||\"value\"]=t,i=_.find(e.getTitleMap(),c)}i&&n(i)}}),e.titleMapQuery){var o=e.titleMapQuery.params.q;e.titleQuery=function(r){console.log(\"titleMap:\",r);var t={};return o&&(t[o]=r),Api.get({url:e.titleMapQuery.url,params:t})},o||(e.minLookup=\"0\"),e.onInit=function(e,r,t,o){\"tag-init\"===t&&o(e)}}if(t.items){var a=[];_.each(t.items.properties,function(e,r){angular.isDefined(e[\"default\"])&&a.push({key:r,\"default\":e[\"default\"]})}),a.length&&(e.onAdd=function(e,r,t){e.value&&\"tag-added\"===t&&_.each(a,function(r){e.value[r.key]||(e.value[r.key]=r[\"default\"])})})}e.type.includes(\"cn-autocomplete\")||(e.items?(e.detailedList=!0,\"component\"!==e.items[0].type&&(e.items.length>1&&(e.items=[{type:\"component\",items:e.items}]),r.processFieldset(e)),e.type=\"cn-autocomplete-detailed\"):(e.selectionStyle||(\"tags\"===e.key?e.selectionStyle=\"tags\":\"array\"===e.getSchemaType()&&1!==e.schema.maxItems?e.selectionStyle=\"list\":e.selectionStyle=\"select\"),e.type=\"cn-autocomplete\")),e.displayFormat&&(e.itemFormatter=r.processTemplate(e.displayFormat)),r.registerHandler(e.key,function(t){var o=r.formCtrl&&r.formCtrl[r.getKey(e.key)];o&&o.$setDirty&&o.$setDirty()},e.updateSchema)}function processToggle(e){e.type=\"cn-toggle\"}function processHelp(e){e.htmlClass=\"help-block\"}function processDisplay(e){var r=this;e.type=\"cn-display\",e.getDisplay=r.processTemplate(e.displayFormat,!0)}function processTemplate(e,r){var t=this,o=$interpolate;return function(a,n){return r&&(angular.isDefined(n)&&(a=_.map(a,function(e){return\"arrayIndex\"===e?n:e})),a=t.parseExpression(a,t.model).get()),o(e)(a)}}function processSelectDisplay(e,r){var t,o=this,a=_.find(e.items,\"selectField\");t=r&&\"array\"===r.type?setupArraySelectDisplay(e,a,o):setupSelectDisplay(e,a,o),e.selectDisplay=!1,o.registerHandler(a.key,t,a.updateSchema,!0),o.processField(e)}function setupArraySelectDisplay(e,r,t){_.each(e.items,function(e){console.log(\"item.condition:\",e.condition,e.key),\"false\"!==e.condition&&(e.condition=\"true\")});var o=function(){var o=getArrayIndex(arguments[2]);_.each(e.items,function(e){var a=t.getKey(r.key),n=t.getKey(e.key),s=ObjectPath.parse(n);if(a!==n){var i=t.setArrayIndex(a,o),c=t.parseExpression(i,t.model).get(),l=t.getArrayCopies(n);_.includes(c,s[s.length-1])?_.each(l,function(e){console.log(\"copy.condition, copy:\",e.condition,e),getArrayIndex(e)==o&&(e.condition=\"true\")}):_.each(l,function(e){getArrayIndex(e)==o&&(console.log(\"copy.condition, copy:\",e.condition,e),e.condition=\"false\",t.parseExpression(t.getKey(e.key),t.model).set())})}})},a=t.parseExpression(t.getKey(e.key),t.model).get();_.each(e.items,function(e){var o=t.getKey(e.key),n=t.getKey(r.key);o!==n&&_.each(a,function(e,r){var a=t.setArrayIndex(o,r),s=ObjectPath.parse(a),i=t.setArrayIndex(n,r),c=t.parseExpression(i,t.model),l=c.get(),m=t.parseExpression(a,t.model).get();m&&!_.includes(l,s[s.length-1])&&(l||(l=[]),l.push(s[s.length-1]),c.set(l))})});var n=t.getSchema(e.key)[\"default\"];_.each(n,function(e,o){var a=t.getKey(r.key),n=t.setArrayIndex(a,o),s=t.parseExpression(n,t.model),i=s.get();_.each(e,function(e,r){i||(i=[]),i.push(r),s.set(i)})});var s=0,i=_.pluck(_.reject(e.items,{condition:\"false\"}),\"key\"),c=$rootScope.$on(\"flexFormArrayCopyAdded\",function(r,a){var n=t.parseExpression(t.getKey(e.key),t.model).get();if(n){var c=n.length*i.length;if(_.includes(i,a)&&s++,s===c){for(var l=0;l<n.length;l++)o(null,null,\"[\"+l+\"]\");s=0}}}),l=$rootScope.$on(\"flexForm.updatePage\",function(){s=0});return t.events.push(c),t.events.push(l),o}function setupSelectDisplay(e,r,t){var o=function(){var o=t.getKey(r.key);_.each(e.items,function(e){var r=t.getKey(e.key),a=ObjectPath.parse(r);if(o!==r){var n=t.parseExpression(o,t.model).get();_.includes(n,a[a.length-1])?e.condition=\"true\":(e.condition=\"false\",t.parseExpression(r,t.model).set())}})},a=t.getKey(r.key),n=t.parseExpression(a,t.model),s=n.get();_.each(e.items,function(e){var r=t.getKey(e.key);if(a!==r){var o=ObjectPath.parse(r),i=t.parseExpression(r,t.model).get();i&&!_.includes(s,o[o.length-1])&&(s||(s=[]),s.push(o[o.length-1]),n.set(s))}});var i=t.getSchema(e.key)[\"default\"];_.each(i,function(e,r){s||(s=[]),s.push(r),n.set(s)});var c=t.parseExpression(e.key,t.model);return i&&!c.get()&&c.set(i),o}function setupSchemaRefresh(e){var r=this;r.refreshSchema=_.debounce(function(t){var o,a=_.extend(cnFlexFormConfig.getStateParams(),r.params),n=cnUtil.diff(r.schema.params,a,!0);(n||t)&&(t?a.updateSchema=t:(o=_.keys(n),o.length>1&&(n=_.omit(n,_.isNull),o=_.keys(n)),a.updateSchema=_.first(o)),a.updateSchema||(n=cnUtil.diff(a,_.omit(r.schema.params,\"updateSchema\")),o=_.keys(n),a.updateSchema=_.first(o)),e(a).then(function(e){++r.updates,r.processUpdatedSchema(e)}))},100),r.refreshData=_.debounce(function(){e(_.extend(r.schema.params,{updateSchema:\"refreshData\"})).then(function(e){r.processUpdatedSchema(e),console.log(\"service.schema.params:\",r.schema.params)})},100),r.events.push($rootScope.$on(\"ffRefreshData\",r.refreshData))}function processUpdatedSchema(e){var r=this;if(e.diff){r.schema.params=e.params,e.diff.data&&_.each(e.diff.data,function(e,t){_.has(e.cursor)&&!_.isEmpty(r.schema.data[t].data)&&(e.data=r.schema.data[t].data.concat(e.data)),r.schema.data[t]=e,r.resolveRegister[t]&&_.each(r.resolveRegister[t],function(e){r.handleResolve(e.field,e.key,\"schema.data.\"+t)})});var t=[];e.diff.schema&&_.each(e.diff.schema,function(e,o){r.schema.schema.properties[o]=e,reprocessSchema(e,o,t)}),e.diff.form&&_.each(e.diff.form,function(e){-1===t.indexOf(e.key)&&t.push(e.key);var o=e.key;delete e.key;var a=r.getFromFormCache(o);a&&reprocessField(a,e);var n=r.getArrayCopies(o);n&&_.each(n,function(r){reprocessField(r,e)})}),t.length&&_.each(t,function(e){var t=r.getFromFormCache(e);if(t&&r.processField(t),e.includes(\"[]\")){var o=r.getArrayCopies(e);_.each(o,function(e){e&&r.processField(e)})}}),r.broadcastErrors()}else r.updateSchema(e)}function reprocessField(e,r,t){_.extend(e,_.omit(r,\"items\",\"key\")),_.each(e._ogKeys,function(t){r[t]||delete e[t]}),e._ogKeys=_.keys(r),!t&&e.redraw&&e.redraw()}function reprocessSchema(e,r,t){t.push(r),e.properties&&_.each(e.properties,function(e,o){reprocessSchema(e,r+\".\"+o,t)}),e.items&&e.items.properties&&_.each(e.properties,function(e,o){reprocessSchema(e,r+\"[].\"+o,t)})}function buildError(e){var r=this,t=r.getKey(e.key);return{key:t,message:e.error}}function broadcastErrors(){var e=this;$timeout(function(){e.errors.forEach(function(e){$rootScope.$broadcast(\"schemaForm.error.\"+e.key,\"serverValidation\",e.message)})},1)}function replaceArrayIndex(e,r){var t=/([^.]*)\\[arrayIndex\\]/.exec(e),o=new RegExp(t[1]+\"\\\\[(\\\\d+)\\\\]\"),a=o.exec(r);return e.replace(t[0],a[0])}function getArrayIndex(e){return _.isObject(e)?_.find(e.key,function(e){return _.isNumber(e)}):/\\[(\\d+)\\]/.exec(e)[1]}function setArrayIndex(e,r,t){var o,a=this;o=_.isString(e)?ObjectPath.parse(e):_.clone(e);var n=o.indexOf(\"\");return o[n]=r,t?o:a.getKey(o)}function cleanup(){var e=this;_.each(e.events,function(e){e()})}var services=[];return _.extend(CNFlexForm.prototype,{compile:compile,addArrayCopy:addArrayCopy,addToDataCache:addToDataCache,addToFormCache:addToFormCache,broadcastErrors:broadcastErrors,buildError:buildError,cleanup:cleanup,deregisterHandlers:deregisterHandlers,getArrayCopies:getArrayCopies,getFromDataCache:getFromDataCache,getFromFormCache:getFromFormCache,getKey:getKey,getSchema:getSchema,handleResolve:handleResolve,initArrayCopyWatch:initArrayCopyWatch,initModelWatch:initModelWatch,initSchemaParams:initSchemaParams,isCompiled:isCompiled,isConditionFunction:isConditionFunction,onModelWatch:onModelWatch,parseCondition:parseCondition,parseExpression:parseExpression,processDefault:processDefault,processDisplay:processDisplay,processField:processField,processFieldset:processFieldset,processFieldWatch:processFieldWatch,processComponent:processComponent,processCurrency:processCurrency,processPercentage:processPercentage,processDate:processDate,processHelp:processHelp,processRadiobuttons:processRadiobuttons,processReusable:processReusable,processSchema:processSchema,processSelectDisplay:processSelectDisplay,processResolve:processResolve,processSection:processSection,processSelect:processSelect,processTemplate:processTemplate,processToggle:processToggle,processUpdatedSchema:processUpdatedSchema,processMediaUpload:processMediaUpload,registerArrayHandlers:registerArrayHandlers,registerHandler:registerHandler,registerResolve:registerResolve,setArrayIndex:setArrayIndex,setupConfig:setupConfig,setupSchemaRefresh:setupSchemaRefresh}),CNFlexFormConstructor}angular.module(\"cn.flex-form\").provider(\"cnFlexFormService\",cnFlexFormServiceProvider);var fieldTypeHandlers={\"cn-radiobuttons\":\"processRadiobuttons\",\"cn-autocomplete\":\"processSelect\",\"cn-datetimepicker\":\"processDate\",help:\"processHelp\",\"cn-display\":\"processDisplay\",\"cn-currency\":\"processCurrency\",\"cn-percentage\":\"processPercentage\",\"cn-mediaupload\":\"processMediaUpload\",\"cn-reusable\":\"processReusable\",\"cn-toggle\":\"processToggle\",section:\"processSection\"};cnFlexFormServiceProvider.$inject=[\"schemaFormDecoratorsProvider\",\"cnFlexFormTypesProvider\"],CNFlexFormService.$inject=[\"Api\",\"$parse\",\"cnFlexFormConfig\",\"cnFlexFormTypes\",\"$interpolate\",\"$rootScope\",\"$timeout\",\"cnUtil\"]}(),function(){function e(){function e(){console.log(\"FlexFormSandbox\")}function r(){if(t.schemaStr){var e=angular.fromJson(t.schemaStr);console.log(\"schema:\",e),!e.form&&e.forms&&(e.form=e.forms[0].form),t.config.schema=e.form&&e}}var t=this;t.activate=e,t.onSchema=r,t.model={},t.config={},t.schemaStr=\"\",e()}angular.module(\"cn.flex-form\").controller(\"FlexFormSandbox\",e)}(),function(){function e(e){var r=[\"cn-fieldset\",\"cn-toggle\",\"cn-datetimepicker\",\"cn-autocomplete\",\"cn-autocomplete-detailed\",\"cn-currency\",\"cn-radiobuttons\",\"cn-percentage\",\"cn-display\",\"cn-mediaupload\",\"cn-reusable\"];_.each(r,function(r){e.registerField({type:r,templateUrl:\"app/components/cn-flex-form/forms/\"+r+\".html\"})})}function r(e){e.put(\"app/components/cn-flex-form/forms/cn-toggle.html\",'        <div class=\"form-group {{form.htmlClass}}\"              ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>          <div class=\"clearfix\">            <cn-toggle-switch              class=\"pull-left\"              ng-show=\"form.key\"              enabled=\"$$value$$\"              on-value=\"angular.isDefined(form.onValue) ? form.onValue : true\"              off-value=\"angular.isDefined(form.offValue) ? form.offValue : false\">            </cn-toggle-switch>            <span ng-show=\"form.onText && form.offText\">              {{$$value$$ === form.onValue ? form.onText : form.offText}}            </span>          </div>          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-datetimepicker.html\",'        <div class=\"form-group {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 for=\"{{form.key.join(\\'.\\')}}\"                 ng-show=\"showTitle()\">{{form.title}}</label>          <cn-datetimepicker            ng-show=\"form.key\"            ng-model=\"$$value$$\"            ng-model-options=\"form.ngModelOptions\"            is-disabled=\"form.readonly\"            sf-changed=\"form\"            schema-validate=\"form\"            input-id=\"{{form.key.join(\\'.\\')}}\"            min-date=\"form.minDate\"            required=\"form.required\"            model-type=\"{{form.schema.type}}\">          </cn-datetimepicker>          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        ');var r='          <tags-input            ng-show=\"form.key\"            ng-model=\"$$value$$\"            ng-model-options=\"form.ngModelOptions\"            ng-disabled=\"form.readonly\"            sf-changed=\"form\"            schema-validate=\"form\"            input-id=\"{{form.key.join(\\'.\\')}}\"            display-property=\"{{form.displayProperty || \\'name\\'}}\"            value-property=\"{{form.valueProperty || \\'value\\'}}\"            placeholder=\"{{form.placeholder || \\' \\'}}\"            add-on-blur=\"true\"            add-on-comma=\"false\"            add-from-autocomplete-only=\"{{!form.allowNew}}\"            on-before-tag-added=\"form.onAdd({value: $tag}, form, $event, $prev)\"            on-init=\"form.onInit($tag, form, $event, $setter)\"            model-type=\"{{form.getSchemaType()}}\"            array-value-type=\"{{form.schema.items.type}}\"            hide-tags=\"{{form.detailedList}}\"            tags-style=\"{{form.selectionStyle}}\"            required=\"{{form.required}}\"            min-length=\"{{form.minLength}}\"            allowed-tags-pattern=\".*\"            dropdown=\"true\"            item-formatter=\"form.itemFormatter\"            min-tags=\"{{form.schema.minItems}}\"            max-tags=\"{{form.schema.maxItems || form.getSchemaType() !== \\'array\\' ? 1 : 0}}\"            allow-bulk=\"{{form.bulkAdd}}\"            bulk-delimiter=\"{{form.bulkDelimiter}}\"            bulk-placeholder=\"{{form.bulkPlaceholder}}\"            show-button=\"true\">            <auto-complete              source=\"form.getTitleMap && form.getTitleMap() || form.titleQuery($query)\"              skip-filtering=\"{{form.titleQuery ? true : false}}\"              min-length=\"{{form.minLookup || (form.titleQuery && 3 || 0)}}\">            </auto-complete>          </tags-input>          ';\ne.put(\"app/components/cn-flex-form/forms/cn-autocomplete.html\",'        <div class=\"form-group {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 for=\"{{form.key.join(\\'.\\')}}-input\"                 ng-show=\"showTitle()\">{{form.title}}</label>          '+r+'          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-autocomplete-detailed.html\",'        <div sf-array=\"form\"             class=\"form-group {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 for=\"{{form.key.join(\\'.\\')}}-input\"                 ng-show=\"showTitle()\">{{form.title}}</label>          <ol class=\"list-group cn-autocomplete-list\"              ng-show=\"modelArray.length\"              ng-model=\"modelArray\">            <li class=\"list-group-item {{form.fieldHtmlClass}}\"                ng-repeat=\"item in modelArray track by $index\">              <button ng-hide=\"form.readonly || form.remove === null\"                      ng-click=\"deleteFromArray($index)\"                      type=\"button\" class=\"close pull-right\">                <span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span>              </button>              <sf-decorator ng-init=\"arrayIndex = $index\" form=\"copyWithIndex($index)\"></sf-decorator>            </li>          </ol>          '+r+'          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-currency.html\",'        <div class=\"form-group {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 ng-show=\"showTitle()\"                 for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>          <div class=\"{{form.fieldClass}} input-group\">            <label class=\"input-group-addon\"                   ng-disabled=\"form.readonly\"                   for=\"{{form.key.join(\\'.\\')}}\">$</label>            <input class=\"form-control\"                   cn-currency-format=\"{{form.currencyFormat}}\"                   ng-show=\"form.key\"                   ng-model-options=\"form.ngModelOptions\"                   ng-disabled=\"form.readonly\"                   sf-changed=\"form\"                   schema-validate=\"form\"                   ff-validate=\"form\"                   type=\"text\"                   step=\"any\"                   min=\"{{form.min}}\"                   max=\"{{form.max}}\"                   id=\"{{form.key.join(\\'.\\')}}\"                   name=\"{{form.key.join(\\'.\\')}}\"                   ng-model=\"$$value$$\">          </div>          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-radiobuttons.html\",'        <div class=\"form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>          <div class=\"btn-group clearfix\">            <label class=\"btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? \\'active\\' : \\'\\'}}\"                   ng-repeat=\"item in form.titleMap\">              <input type=\"radio\"                     class=\"{{form.fieldHtmlClass}} hide\"                     sf-changed=\"form\"                     ng-disabled=\"form.readonly\"                     ng-model=\"$$value$$\"                     ng-model-options=\"form.ngModelOptions\"                     schema-validate=\"form\"                     ff-validate=\"form\"                     ng-value=\"item.value\"                     name=\"{{form.key.join(\\'.\\')}}\">              <i class=\"fa fa-{{item.value}} fa-lg\"></i>              <span ng-bind-html=\"item.name\"></span>            </label>          </div>          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-percentage.html\",'        <div class=\"form-group {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 ng-show=\"showTitle()\"                 for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>          <div class=\"{{form.fieldClass}} input-group\">            <input class=\"form-control\"                   cn-percentage-format                   ng-show=\"form.key\"                   ng-model-options=\"form.ngModelOptions\"                   ng-disabled=\"form.readonly\"                   sf-changed=\"form\"                   schema-validate=\"form\"                   type=\"number\"                   step=\"any\"                   min=\"{{form.min}}\"                   max=\"{{form.max}}\"                   id=\"{{form.key && form.key[0]}}\"                   name=\"{{form.key && form.key[0]}}\"                   ng-model=\"$$value$$\">             <div class=\"input-group-addon\"                    ng-disabled=\"form.readonly\"                    for=\"{{form.key && form.key[0]}}\">%</div>          </div>          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-display.html\",'        <div class=\"form-group cn-display{{form.htmlClass}}\">          <input ng-show=\"form.key\"                 class=\"form-control\"                 id=\"{{form.key.join(\\'.\\')}}\"                 name=\"{{form.key.join(\\'.\\')}}\"                 ng-disabled=\"true\"                 value=\"{{form.getDisplay(form.key, form.arrayIndex)}}\">        </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-fieldset.html\",'        <fieldset ng-disabled=\"form.readonly\" class=\"schema-form-fieldset {{form.htmlClass}}\">          <legend ng-click=\"form.toggleCollapse()\"                  ng-class=\"{\\'sr-only\\': !showTitle(), collapsible: form.collapsible}\"                  ng-mouseenter=\"form.render = true\">            <i ng-show=\"form.collapsible\"               class=\"fa fa-caret-{{form.collapsed ? \\'right\\' : \\'down\\'}}\"></i>            {{ form.title }}          </legend>          <div class=\"help-block\" ng-show=\"form.description\" ng-bind-html=\"form.description\"></div>          <div collapse=\"form.collapsed\">            <div ng-if=\"form.render\">              <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"></sf-decorator>            </div>          </div>        </fieldset>        '),e.put(\"app/components/cn-flex-form/forms/cn-mediaupload.html\",'        <div class=\"form-group {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 ng-show=\"showTitle()\"                 for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>          <media-upload ng-model=\"$$value$$\"                        cn-file-type=\"form.fileType\"                        cn-upload-path=\"form.uploadPath\"                        cn-data=\"form.data\"                        cn-preview-path=\"form.previewPath\"                        cn-model-value-key=\"form.modelValueKey\"                        ng-model-options=\"form.ngModelOptions\"                        sf-changed=\"form\"                        schema-validate=\"form\"                        ff-form=\"form\"                        class=\"clearfix\">          </media-upload>          <span class=\"help-block\" sf-message=\"form.description\"></span>       </div>        '),e.put(\"app/components/cn-flex-form/forms/cn-reusable.html\",'        <div class=\"form-group cn-reusable {{form.htmlClass}}\"             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">          <label class=\"control-label\"                 ng-show=\"showTitle()\"                 for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>          <cn-select-or            ng-show=\"form.key\"            select-from=\"form.library\"            ng-model=\"$$value$$\"            ng-model-options=\"form.ngModelOptions\"            sf-changed=\"form\"            schema-validate=\"form\"            ff-form=\"form\"            directiveId=\"form.directiveId\"            item-template=\"form.itemTemplate\"            toggle-text=\"form.toggleText\"            disabled=\"form.readonly\"            view=\"form.view\">            <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>          </cn-select-or>          <p ng-if=\"form.loadMore && form.view === \\'list\\'\">            <a ng-click=\"form.loadMore()\"               class=\"btn btn-default btn-block\">Load More</a>          </p>          <span class=\"help-block\" sf-message=\"form.description\"></span>        </div>        ')}angular.module(\"cn.flex-form\").config(e).run(r),e.$inject=[\"cnFlexFormServiceProvider\"],r.$inject=[\"$templateCache\"]}();\n//# sourceMappingURL=all.min.js.map\n","(function() {\n  'use strict';\n  angular.module('cn.flex-form', [\n    'ui.router',\n    'schemaForm',\n    'ui.bootstrap.datetimepicker',\n    'cnTagsInput',\n    'cn.util'\n  ]);\n})();","(function() {\n  'use strict';\n  angular\n      .module('cn.flex-form')\n      .provider('cnFlexFormConfig', cnFlexFormConfigProvider);\n\n  function cnFlexFormConfigProvider() {\n\n    cnFlexFormConfig.$inject = ['$stateParams'];\n\n    var ignoreParams = ['page', 'debug', 'sandbox', 'modal', 'modalId'];\n\n    return {\n      addIgnoreParam: addIgnoreParam,\n      $get: cnFlexFormConfig\n    };\n\n    ////////\n\n    function addIgnoreParam(param) {\n      ignoreParams.push(param);\n    }\n\n    function cnFlexFormConfig($stateParams) {\n      return {\n        getStateParams: getStateParams,\n        ignoreParams: ignoreParams\n      };\n\n      ////////\n\n      function getStateParams() {\n        return _\n            .chain($stateParams)\n            .omit(ignoreParams)\n            .omit(function(v) {\n              return _.isUndefined(v) || _.isNull(v);\n            })\n            .value();\n      }\n    }\n\n  }\n\n})();","(function () {\n  'use strict';\n\n  angular\n    .module('cn.flex-form')\n    .directive('cnFlexFormHeader', cnFlexFormHeader);\n\n  function cnFlexFormHeader() {\n    return {\n      restrict: 'E',\n      scope: {\n        config: '=ffHeaderConfig',\n        submit: '&ffSubmit',\n        loadOffscreen: '&ffLoadOffscreen'\n      },\n      controller: FlexFormHeader,\n      bindToController: true,\n      controllerAs: 'vm',\n      template: '<div class=\"col-md-6\">\\\n                  <h5 ng-if=\"vm.config.title.lead\">{{::vm.config.title.lead}}</h5>\\\n                  <h1>{{vm.config.title.main}}</h1>\\\n                  <h5 ng-if=\"vm.config.title.sub\">{{::vm.config.title.sub}}</h5>\\\n                </div>\\\n                <div class=\"{{vm.config.buttonContainerClass}}\">\\\n                  <div class=\"btn-options\"\\\n                       ng-mouseover=\"vm.loadOffscreen()\">\\\n                    <a class=\"btn\" ui-sref=\"{{vm.config.actionConfig.returnState}}\">\\\n                      {{vm.config.actionConfig.returnText || \\'Cancel\\'}}\\\n                    </a>\\\n                    <span ng-repeat=\"button in vm.config.actionConfig.actions\">\\\n                      <a class=\"btn {{button.style && \\'btn-\\'+button.style}}\"\\\n                         ng-disabled=\"vm.isDisabled(button)\"\\\n                         ng-class=\"{\\'btn-primary\\': $index === vm.config.actionConfig.actions.length - 1}\"\\\n                         ng-click=\"vm.submit({ handler: button.handler})\"\\\n                         tooltip=\"{{button.helptext}}\"\\\n                         tooltip-placement=\"bottom\">\\\n                        {{button.text || \\'Save\\'}}\\\n                      </a>\\\n                    </span>\\\n                  </div>\\\n                  <p class=\"data-updated-at text-right\" id=\"data-updated-at\">\\\n                    <a ng-click=\"vm.updateData()\">Update Data</a>\\\n                  </p>\\\n                </div>\\\n                '\n    };\n  }\n\n  FlexFormHeader.$inject = ['$scope'];\n  function FlexFormHeader($scope) {\n    var vm = this;\n\n    vm.updateData = updateData;\n    vm.isDisabled = isDisabled;\n\n    ///////////\n\n    function updateData() {\n      console.log('updateData:', updateData);\n      $scope.$emit('ffRefreshData');\n    }\n\n    function isDisabled(btnConfig) {\n      if(vm.config.isDisabled) return vm.config.isDisabled(btnConfig);\n      return false;\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular\n      .module('cn.flex-form')\n      .controller('FlexFormModalLoader', FlexFormModalLoader)\n      .factory('FlexFormModal', FlexFormModal);\n\n  FlexFormModalLoader.$inject = [\n    'FlexFormModal', '$state', '$rootScope', '$stateParams'\n  ];\n  function FlexFormModalLoader(FlexFormModal, $state, $rootScope, $stateParams) {\n\n    var vm = this;\n    console.log('FlexFormModalLoader:', $stateParams.modal);\n\n    activate();\n\n    //////////\n\n    function activate() {\n      vm.modal = FlexFormModal.open(vm);\n      vm.modal.result.finally(goBack);\n\n      vm.dismiss = $rootScope.$on('$stateChangeStart', dismissModal);\n    }\n\n    function goBack() {\n      $state.go('^');\n    }\n\n    function dismissModal() {\n      vm.dismiss();\n      vm.modal.dismiss();\n    }\n  }\n\n  FlexFormModal.$inject = ['cnFlexFormModalLoaderService', '$modal', '$stateParams'];\n  function FlexFormModal(cnFlexFormModalLoaderService, $modal, $stateParams) {\n\n    var instance = {\n      open: openModal\n    };\n\n    return instance;\n\n    function openModal() {\n      var currentModal = cnFlexFormModalLoaderService.getMapping($stateParams.modal);\n      console.log('currentModal:', currentModal);\n\n      this.modal = $modal.open(currentModal);\n      return this.modal;\n    }\n\n  }\n\n})();\n","(function() {\n  'use strict';\n\n  angular\n      .module('cn.flex-form')\n      .provider('cnFlexFormModalLoaderService', cnFlexFormModalLoaderServiceProvider);\n\n  var modalMap = {};\n  var promiseMap = {};\n\n  function getPromises(state) {\n    var promises = promiseMap[state];\n    if(!promises) {\n      promises = {};\n      promiseMap[state] = promises;\n    }\n    return promises;\n  }\n\n  function getPromise(state, id, $q) {\n    var promises = getPromises(state);\n    var promise = promises[id];\n    if(!promise) {\n      promise = $q.defer();\n      promises[id] = promise;\n    }\n    return promise;\n  }\n\n  function cnFlexFormModalLoaderServiceProvider() {\n\n    var provider = {\n      addMapping: addMapping,\n      $get: cnFlexFormModalLoaderService\n    };\n\n    parent.$inject = ['$stateParams', '$q'];\n\n    return provider;\n\n    ////////////\n\n    function addMapping(state, def) {\n      def.resolve = {\n        parent: parent\n      };\n      modalMap[state] = def;\n    }\n\n    function parent($stateParams, $q) {\n      return getPromise($stateParams.modal, $stateParams.modalId, $q).promise;\n    }\n  }\n\n  cnFlexFormModalLoaderService.$inject = ['$q'];\n\n  function cnFlexFormModalLoaderService($q) {\n    var service = {\n      getMapping: getMapping,\n      resolveMapping: resolveMapping\n    };\n\n    return service;\n\n    /////////////\n\n    function resolveMapping(state, id, parent) {\n      getPromise(state, id, $q).resolve(parent);\n    }\n\n    function getMapping(state) {\n      return modalMap[state];\n    }\n  }\n\n})();","(function() {\n  'use strict';\n  angular\n      .module('cn.flex-form')\n      .provider('cnFlexFormTypes', cnFlexFormTypesProvider);\n\n  function cnFlexFormTypesProvider() {\n\n    var fieldTypeRegister = [{\n      condition: function(field) {\n        return field.type === 'hidden';\n      },\n      type: 'hidden'\n    }, {\n      condition: function(field) {\n        return field.type.includes('radiobuttons');\n      },\n      type: 'cn-radiobuttons'\n    }, {\n      condition: function(field) {\n        return field.type.includes('autocomplete') || field.titleMap || field.titleMapResolve || field.titleMapQuery;\n      },\n      type: 'cn-autocomplete'\n    }, {\n      condition: function(field) {\n        return field.type === 'cn-datetimepicker' || field.type === 'datetime-local';\n      },\n      type: 'cn-datetimepicker'\n    }, {\n      condition: function(field) {\n        return field.type === 'help';\n      },\n      type: 'help'\n    }, {\n      condition: function(field) {\n        return field.type.includes('display');\n      },\n      type: 'cn-display'\n    }, {\n      condition: function(field) {\n        return field.schema && field.schema.format && field.schema.format.includes('currency');\n      },\n      type: 'cn-currency'\n    }, {\n      condition: function(field) {\n        return field.schema && field.schema.format === 'percentage';\n      },\n      type: 'cn-percentage'\n    }, {\n      condition: function(field) {\n        return field.type === 'boolean';\n      },\n      type: 'cn-toggle'\n    }, {\n      condition: function(field) {\n        return field.type === 'mediaupload';\n      },\n      type: 'cn-mediaupload'\n    }, {\n      condition: function(field) {\n        return field.type === 'reusable';\n      },\n      type: 'cn-reusable'\n    }, {\n      condition: function(field) {\n        return field.type === 'array';\n      },\n      type: 'section'\n    }];\n\n    return {\n      registerFieldType: registerFieldType,\n      $get: cnFlexFormTypes\n    };\n\n    ////////\n\n    function registerFieldType(fieldType) {\n      fieldTypeRegister.unshift(fieldType);\n    }\n\n    function cnFlexFormTypes() {\n      return {\n        fieldTypeRegister: fieldTypeRegister,\n        getFieldType: getFieldType\n      };\n\n      /////////\n\n      function getFieldType(field) {\n        for(var i = 0, l = fieldTypeRegister.length; i < l; i++) {\n          if(fieldTypeRegister[i].condition(field)) {\n            return fieldTypeRegister[i].type;\n          }\n        }\n        return field.type || field.schema && field.schema.type;\n      }\n    }\n\n  }\n\n})();","(function() {\n  'use strict';\n  angular\n      .module('cn.flex-form')\n      .directive('ffValidate', ffValidate);\n\n  function ffValidate() {\n    return {\n      restrict: 'A',\n      scope: { form: '=ffValidate' },\n      require: 'ngModel',\n      link: link\n    };\n  }\n\n  function link($scope, elem, attrs, ngModel) {\n    //console.log('$scope, ngModel:', $scope.form, ngModel);\n    if($scope.form && $scope.form.required) {\n      $scope.$watch(function() { return ngModel.$viewValue; }, function(value) {\n        // override schemaForm validation\n        ngModel.$setValidity('schemaForm', true);\n        ngModel.$setValidity('tv4-302', value);\n      });\n    }\n  }\n})();","(function() {\n  'use strict';\n  angular\n      .module('cn.flex-form')\n      .directive('cnFlexForm', cnFlexForm);\n\n  function cnFlexForm() {\n    return {\n      restrict: 'E',\n      template: '\\\n        <div ng-if=\"vm.showForm()\">\\\n          <ng-form name=\"{{vm.formName}}\"\\\n                sf-schema=\"vm.config.schema.schema\"\\\n                sf-form=\"vm.form\"\\\n                sf-model=\"vm.model\"></ng-form>\\\n          <!-- debug panel to display model -->\\\n          <pre ng-if=\"vm.debug\">{{vm.model|json}}</pre>\\\n        </div>\\\n      ',\n      scope: {\n        config: '=ffConfig',\n        model: '=ffModel',\n        formIndex: '=ffFormIndex',\n        formName: '=ffFormName',\n        delayForm: '=ffDelayForm',\n        cleanupEvent: '=ffCleanupEvent'\n      },\n      controller: FlexForm,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n  }\n\n  FlexForm.$inject = ['cnFlexFormService', '$scope', '$location'];\n  function FlexForm(cnFlexFormService, $scope, $location) {\n    var vm = this;\n    vm.service = undefined;\n    vm.events = [];\n\n    vm.activate = activate;\n    vm.cleanup = cleanup;\n    vm.process = process;\n    vm.showForm = showForm;\n\n    vm.events.push($scope.$watch(function() { return vm.config.schema; }, vm.process));\n\n    vm.activate();\n\n    $scope.$on(vm.cleanupEvent || '$destroy', vm.cleanup);\n\n    //////////\n\n    function activate() {\n      //console.log('vm.formName:', vm.formName);\n      if(angular.isNumber(vm.formIndex)) {\n        vm.form = vm.config.schema.forms[vm.formIndex].form;\n      }\n      else {\n        vm.form = vm.config.schema.form;\n      }\n\n      // debug\n      if($location.search().debug) {\n        vm.debug = true;\n      }\n    }\n\n    function process(cur, prev) {\n      //console.log('process:', cur, prev);\n      if(vm.form) {\n        if(!vm.service) {\n          vm.service = cnFlexFormService(vm.config.schema, vm.model, {\n            formCtrl: vm.config.formCtrl,\n            getSchema: vm.config.getSchema,\n            updateSchema: updateSchema\n          });\n        }\n        else {\n          console.log('vm.service.isCompiled():', vm.service.isCompiled());\n          vm.service.compile(vm.config.schema, vm.model);\n        }\n        //$scope.$broadcast('schemaFormRedraw');\n      }\n    }\n\n    function showForm() {\n      //console.log('showForm:', vm.delayForm, vm.formName);\n      return !vm.delayForm && vm.service && vm.service.isCompiled();\n    }\n\n    function updateSchema(schema) {\n      vm.config.schema = schema;\n      vm.activate();\n    }\n\n    function cleanup() {\n      _.each(vm.events, function(listener) {\n        listener();\n      });\n      vm.service.cleanup();\n    }\n\n  }\n})();","(function() {\n  angular\n      .module('cn.flex-form')\n      .provider('cnFlexFormRoutes', cnFlexFormRoutesProvider)\n      .config(cnFlexFormRoutes);\n\n  cnFlexFormRoutesProvider.$inject = ['$stateProvider'];\n  function cnFlexFormRoutesProvider($stateProvider) {\n    var provider = {\n      addStates: addStates,\n      $get: $get\n    };\n\n    return provider;\n\n    ////////////\n\n    function $get() {\n      // nothing to do here, but required\n    }\n\n    function addStates(options) {\n      $stateProvider\n          .state(options.name + '.page.modal', {\n            url: '/~:modal/:modalId',\n            controller: 'FlexFormModalLoader',\n            controllerAs: 'vm',\n            permissions: options.permissions\n          });\n    }\n  }\n\n  cnFlexFormRoutes.$inject = ['$stateProvider'];\n  function cnFlexFormRoutes($stateProvider) {\n\n    $stateProvider\n        .state('flex-form-sandbox', {\n          url: '/flex-form/sandbox',\n          controller: 'FlexFormSandbox',\n          controllerAs: 'vm',\n          templateUrl: 'app/components/cn-flex-form/sandbox.html'\n        });\n  }\n\n})();","(function() {\n  'use strict';\n  angular\n      .module('cn.flex-form')\n      .provider('cnFlexFormService', cnFlexFormServiceProvider);\n\n  var fieldTypeHandlers = {\n    'cn-radiobuttons': 'processRadiobuttons',\n    'cn-autocomplete': 'processSelect',\n    'cn-datetimepicker': 'processDate',\n    'help': 'processHelp',\n    'cn-display': 'processDisplay',\n    'cn-currency': 'processCurrency',\n    'cn-percentage': 'processPercentage',\n    'cn-mediaupload': 'processMediaUpload',\n    'cn-reusable': 'processReusable',\n    'cn-toggle': 'processToggle',\n    'section': 'processSection'\n  };\n\n  cnFlexFormServiceProvider.$inject = [\n    'schemaFormDecoratorsProvider',\n    'cnFlexFormTypesProvider'\n  ];\n\n  function cnFlexFormServiceProvider(schemaFormDecoratorsProvider,\n                                     cnFlexFormTypesProvider) {\n    return {\n      registerField: registerField,\n      $get: CNFlexFormService\n    };\n\n    //////////\n\n    function registerField(fieldType) {\n      if(fieldType.condition) {\n        cnFlexFormTypesProvider.registerFieldType({\n          condition: fieldType.condition,\n          type: fieldType.type\n        });\n      }\n\n      if(fieldType.handler) {\n        fieldTypeHandlers[fieldType.type] = fieldType.handler;\n      }\n\n      if(fieldType.templateUrl) {\n        schemaFormDecoratorsProvider.addMapping(\n            'bootstrapDecorator',\n            fieldType.type,\n            fieldType.templateUrl\n        );\n        schemaFormDecoratorsProvider.createDirective(\n            fieldType.type,\n            fieldType.templateUrl\n        );\n      }\n    }\n  }\n\n  CNFlexFormService.$inject = [\n    'Api', '$parse', 'cnFlexFormConfig', 'cnFlexFormTypes',\n    '$interpolate', '$rootScope', '$timeout', 'cnUtil'\n  ];\n\n  function CNFlexFormService(Api, $parse, cnFlexFormConfig, cnFlexFormTypes,\n                             $interpolate, $rootScope, $timeout, cnUtil) {\n\n    var services = [];\n\n    function CNFlexFormConstructor(schema, model, config) {\n      var service;\n      if(services.length) {\n        for(var i = 0, l = services.length; i < l; i++) {\n          if(services[i].model === model) {\n            service = services[i];\n            //console.log('service.compile:', service.compile);\n            service.compile(schema, model, config);\n            break;\n          }\n        }\n        //console.log('services1:', services, service);\n      }\n      if(!service) {\n        service = new CNFlexForm(schema, model, config);\n        services.push(service);\n        //console.log('services2:', services, service);\n      }\n      return service || new CNFlexForm(schema, model, config);\n    }\n\n    function CNFlexForm(schema, model, config) {\n      this.arrayCopies = {};\n      this.arrayListeners = {};\n      this.dataCache = {};\n      this.defaults = {};\n      this.errors = [];\n      this.events = [];\n      this.formCache = {};\n      this.listeners = {};\n      this.resolveRegister = {};\n      this.model = model;\n      this.updates = 0;\n\n      this.params = cnFlexFormConfig.getStateParams();\n\n      this.compile(schema, model, config);\n    }\n\n    _.extend(CNFlexForm.prototype, {\n      compile,\n      addArrayCopy,\n      addToDataCache,\n      addToFormCache,\n      broadcastErrors,\n      buildError,\n      cleanup,\n      deregisterHandlers,\n      getArrayCopies,\n      getFromDataCache,\n      getFromFormCache,\n      getKey,\n      getSchema,\n      handleResolve,\n      initArrayCopyWatch,\n      initModelWatch,\n      initSchemaParams,\n      isCompiled,\n      isConditionFunction,\n      onModelWatch,\n      parseCondition,\n      parseExpression,\n      processDefault,\n      processDisplay,\n      processField,\n      processFieldset,\n      processFieldWatch,\n      processComponent,\n      processCurrency,\n      processPercentage,\n      processDate,\n      processHelp,\n      processRadiobuttons,\n      processReusable,\n      processSchema,\n      processSelectDisplay,\n      processResolve,\n      processSection,\n      processSelect,\n      processTemplate,\n      processToggle,\n      processUpdatedSchema,\n      processMediaUpload,\n      registerArrayHandlers,\n      registerHandler,\n      registerResolve,\n      setArrayIndex,\n      setupConfig,\n      setupSchemaRefresh\n    });\n\n    return CNFlexFormConstructor;\n\n    //////////////\n\n    function compile(schema, model, config) {\n      var service = this;\n\n      service.schema = schema;\n      service.model = model;\n\n      //console.log('compile:schema, model:', schema.compiled, service.isCompiled(), schema, model);\n      if(!service.isCompiled()) {\n        service.setupConfig(config);\n\n        if(schema.forms) {\n          _.each(schema.forms, function(form) {\n            _.each(form.form, service.processField.bind(service));\n          });\n        }\n        else {\n          _.each(schema.form, service.processField.bind(service));\n        }\n\n        service.initModelWatch();\n        service.initArrayCopyWatch();\n        service.isCompiled(true);\n      }\n\n      service.broadcastErrors();\n    }\n\n    function isCompiled(setValue) {\n      var service = this;\n      if(setValue) {\n        service.schema.compiled = setValue;\n      }\n      return service.schema && service.schema.compiled;\n    }\n\n    function setupConfig(config) {\n      var service = this;\n      if(config) {\n        if(config.formCtrl) service.formCtrl = config.formCtrl;\n        if(config.updateSchema) service.updateSchema = config.updateSchema;\n        if(config.getSchema) service.getSchemaForm = service.setupSchemaRefresh(config.getSchema);\n      }\n    }\n\n    function processSchema(field) {\n      var service = this,\n          schema = field.schema;\n\n      if(schema) {\n\n        field.getSchemaType = function() {\n          return _.isArray(schema.type) ? _.first(schema.type) : schema.type;\n        };\n\n        service.processDefault(field);\n      }\n    }\n\n    function processDefault(field) {\n      var service = this,\n          schema = field.schema;\n      //console.log('processDefault:', field.key, schema, service.updates);\n      if(schema.default) {\n        var key = service.getKey(field.key);\n        // if schemaUpdate hasn't been triggered, let schemaForm directive handle defaults\n        if(service.updates) {\n          if(key.includes && key.includes('[]')) return;\n          var model = service.parseExpression(field.key, service.model);\n          var modelValue = model.get();\n          // if there's an existing default and it's the same as the current value\n          // update the current value to the new default\n          //console.error('default:', key, modelValue, service.defaults[key], angular.equals(modelValue, service.defaults[key]));\n          if(!service.defaults[key] || _.isUndefined(modelValue) || angular.equals(modelValue, service.defaults[key])) {\n            model.set(schema.default);\n          }\n        }\n        service.defaults[key] = angular.copy(schema.default);\n      }\n    }\n\n    function processFieldset(fieldset) {\n      var service = this;\n\n      fieldset.type = 'cn-fieldset';\n      _.each(fieldset.items, service.processField.bind(service));\n\n      if(fieldset.collapsible) {\n        fieldset.toggleCollapse = function() {\n          if(fieldset.collapsible) {\n            fieldset.collapsed = !fieldset.collapsed;\n          }\n        };\n\n        fieldset.render = !fieldset.collapsed;\n      }\n      else {\n        fieldset.render = true;\n      }\n    }\n\n    function processField(field) {\n      var service = this;\n\n      if (field.selectDisplay) {\n        service.processSelectDisplay(field, service.getSchema(field.key));\n      }\n\n      if(field.type === 'fieldset') {\n        service.processFieldset(field);\n      }\n      else {\n        if(!field._ogKeys) field._ogKeys = _.without(_.keys(field), 'key');\n\n        var key = service.getKey(field.key);\n\n        if(field.key) {\n          service.addToFormCache(field, key);\n          field.schema = service.getSchema(key);\n\n          if(field.schema) {\n            if(field.schema.description) field.description = field.schema.description;\n            if(field.readonly && !field.schema.readonly) field.readonly = false;\n          }\n        }\n\n        service.processSchema(field);\n\n        if(!field.type) field.type = field.getSchemaType && field.getSchemaType();\n\n        if(field.resolve) service.processResolve(field);\n\n        if(field.watch) service.processFieldWatch(field);\n\n        if(field.type === 'section' || field.type === 'tabarray') {\n          service.processSection(field);\n        }\n        else if(field.type === 'component') {\n          service.processComponent(field);\n        }\n        else {\n\n          var fieldType = cnFlexFormTypes.getFieldType(field);\n          var handler = fieldTypeHandlers[fieldType];\n          if(_.isString(handler)) {\n            service[handler](field);\n          }\n          else if(_.isFunction(handler)) {\n            handler.call(service, field);\n          }\n\n          if(field.updateSchema) service.registerHandler(field, null, field.updateSchema);\n          if(field.error) service.errors.push(service.buildError(field));\n        }\n      }\n    }\n\n    function getKey(key) {\n      if(_.isArray(key)) {\n        key = _.reduce(key, function(total, next) {\n          if(/^(\\d*)$/.test(next)) {\n            return total + '[' + next + ']';\n          }\n          return total + '.' + next;\n        });\n      }\n      return key;\n    }\n\n    function getSchema(key, depth) {\n      if(!key) return;\n      var service = this;\n      key = service.getKey(key);\n\n      //console.log('getSchema:', key, depth, service);\n      //key = key.split('.');\n      key = key\n          .replace(/arrayIndex/g, '')\n          .replace(/(\\[')([^.]+)\\.([^.]+)('])/g, '.$2%ff_dt%$3')\n          .replace(/\\./g, '%ff_sp%')\n          .replace(/%ff_dt%/g, '.')\n          .split('%ff_sp%');\n      depth = depth || service.schema.schema.properties;\n\n      var first, matchArray;\n\n      while(key.length > 1) {\n        first = key[0];\n        matchArray = first.match(/\\[\\d*]$/);\n        //if(first.slice(first.length - 2) === '[]') {\n        if(matchArray) {\n          depth = depth[key.shift().slice(0, first.length - matchArray[0].length)].items.properties;\n        }\n        else {\n          depth = depth[key.shift()].properties;\n        }\n      }\n\n      first = key[0];\n      matchArray = first.match(/\\[\\d*]$/);\n\n      if(matchArray) {\n        return depth[first.slice(0, first.length - matchArray[0].length)].items;\n      }\n\n      return depth[first];\n    }\n\n    function processResolve(field) {\n      var service = this;\n\n      _.each(field.resolve, function(dataKey, fieldKey) {\n        service.handleResolve(field, fieldKey, dataKey);\n\n        var resolveType = dataKey.match(/^(schema\\.data\\.|model\\.)(\\w+)/);\n\n        if(resolveType) {\n          if(resolveType[1] === 'schema.data.') {\n            service.registerResolve(field, fieldKey, resolveType[2]);\n          }\n          else if(resolveType[1] === 'model.') {\n            service.registerHandler(resolveType[2], function() {\n              service.handleResolve(field, fieldKey, dataKey);\n            });\n          }\n        }\n      });\n\n      return field;\n    }\n\n    function handleResolve(field, fieldKey, exp) {\n      var service = this;\n      var data = service.parseExpression(exp).get();\n      if (data && data.cursor) {\n        field.loadMore = function() {\n          var dataKey = exp.match(/schema\\.data\\.(.+)/)[1];\n          service.refreshSchema(`data:${dataKey}:${data.cursor}`);\n        };\n      } else {\n        delete field.loadMore;\n      }\n      field[fieldKey] = (data && data.data) ? data.data : data;\n    }\n\n    function registerResolve(field, fieldKey, dataKey) {\n      var service = this;\n\n      service.resolveRegister[dataKey] = service.resolveRegister[dataKey] || {};\n      service.resolveRegister[dataKey][service.getKey(field.key)] = {\n        field: field,\n        key: fieldKey\n      };\n    }\n\n    function processFieldWatch(field) {\n      var service = this,\n          schema = field.schema;\n\n      field.watch = _.isArray(field.watch) ? field.watch : [field.watch];\n\n      _.each(field.watch, function(watch) {\n        if(watch.resolution) {\n          var condition = watch.condition;\n          var functionCondition = service.isConditionFunction(condition);\n\n          var resolution = watch.resolution;\n          var handler;\n\n          if(_.isFunction(resolution)) {\n            handler = function() {\n              var parsedCondition = functionCondition ? service.parseCondition(functionCondition) : condition;\n              if(!parsedCondition || $parse(parsedCondition)(service)) {\n                resolution();\n              }\n            };\n          }\n          else {\n            var adjustment = {};\n\n            adjustment.date = resolution.match(/\\+ ?(\\d+) days/);\n\n            if(adjustment.date) {\n              adjustment.date = adjustment.date[1];\n              resolution = resolution.replace(adjustment.date, '').trim();\n            }\n            else {\n              adjustment.math = resolution.match(/(\\+|\\-|\\/|\\*) ?(\\S+)/);\n\n              if(adjustment.math) {\n                adjustment.operator = {\n                  '+': 'add',\n                  '-': 'subtract',\n                  '*': 'multiply',\n                  '/': 'divide'\n                }[adjustment.math[1]];\n\n                //console.log('adjustment:', adjustment);\n                adjustment.adjuster = service.parseExpression(adjustment.math[2]);\n              }\n            }\n\n            resolution = resolution.match(/(\\S+) ?= ?(\\S+)/);\n            //console.log('resolution:', resolution);\n\n            handler = function() {\n              var updatePath, fromPath;\n              if(resolution[1].includes('arrayIndex')) {\n                updatePath = replaceArrayIndex(resolution[1], arguments[2]);\n              }\n              if (resolution[2].includes('arrayIndex')) {\n                fromPath = replaceArrayIndex(resolution[2], arguments[2]);\n              }\n              var update = service.parseExpression(updatePath || resolution[1]);\n              var from = service.parseExpression(fromPath || resolution[2]);\n\n              //console.log('handler:resolution:', field.key, condition, condition && $parse(condition)(service));\n              var parsedCondition = functionCondition ? service.parseCondition(functionCondition) : condition;\n              if(!parsedCondition || $parse(parsedCondition)(service)) {\n                //console.log('update:', update.get(), from.get());\n                if(adjustment.date) {\n                  update.set(moment(from.get()).add(adjustment.date, 'days').toDate());\n                }\n                else if(adjustment.math) {\n                  //var result = _[adjustment.operator](from.get(), adjustment.adjuster.get());\n                  //console.log('_.%s(%s, %s):', adjustment.operator, from.get(), adjustment.adjuster.get(), result);\n                  var result = eval(from.get() + adjustment.math[1] + adjustment.adjuster.get());\n                  //console.log('eval(%s %s %s):', from.get(), adjustment.math[1], adjustment.adjuster.get(), result);\n                  //console.log('result:', result);\n                  //console.log('adjustment.math:', adjustment, from.get(), adjustment.adjuster.get(), result);\n                  //console.log('schema.format:', schema.format);\n                  schema = schema || field.items && (field.items[0].schema || (field.items[0].items && field.items[0].items[0].schema));\n                  if(field.type === 'cn-currency') {\n                    //console.log('schema.format:', schema.format, result);\n                    var p = schema && schema.format === 'currency-dollars' ? 2 : 0;\n\n                    if(adjustment.math[1] === '*') {\n                      result = _.floor(result, p);\n                    }\n                    else if(adjustment.math[1] === '/') {\n                      result = _.ceil(result, p);\n                    }\n                    else {\n                      result = _.round(result, p);\n                    }\n                  }\n                  service.listeners[update.path().key].prev = result;\n                  update.set(result || 0);\n                }\n                else {\n                  update.set(from.get());\n                }\n              }\n            };\n          }\n\n          service.registerHandler(field, handler, field.updateSchema);\n        }\n      });\n    }\n\n    function isConditionFunction(condition) {\n      return condition && condition.match(/(\\!?)(.+)\\((.+)\\)/);\n    }\n\n    function parseCondition(condition) {\n      var service = this,\n          invert = condition[1],\n          functionName = condition[2],\n          functionArgument = condition[3];\n\n      if(functionName === 'any') {\n        var predicate = functionArgument.match(/(.+)\\[\\]\\.*(.*)(===|>|<|>=|<=)(.+)/),\n            arr = service.parseExpression(predicate[1]).get(),\n            comparator = predicate[3],\n            comparisonValue = predicate[4].trim().replace(/'/g, ''),\n            key = predicate[2].trim(),\n            evaluation = false;\n\n        arr.forEach(function(value) {\n          var val = key ? value[key] : value;\n          if(evaluatePredicate(val, comparator, comparisonValue)) {\n            evaluation = true;\n          }\n        });\n\n        return invert ? (!evaluation).toString() : evaluation.toString();\n      }\n    }\n\n    function evaluatePredicate(val1, comparator, val2) {\n      switch(comparator) {\n        case '===': return val1 === val2;\n        case '>=': return val1 >= val2;\n        case '<=': return val1 <= val2;\n        case '>': return val1 > val2;\n        case '<': return val1 < val2;\n      }\n    }\n\n    function registerHandler(key, handler, updateSchema, runHandler) {\n      var service = this;\n\n      // if field is passed instead of key\n      if(_.isObject(key) && !_.isArray(key)) {\n        if(!key.key && key.items) {\n          _.each(key.items, function(field) {\n            service.registerHandler(field, handler, field.updateSchema);\n          });\n          return;\n        }\n        else {\n          key = key.key;\n        }\n      }\n\n      key = service.getKey(key);\n      var arrMatch = key.match(/([^[\\]]*)\\[]\\.?(.+)/);\n\n      if(arrMatch) {\n        service.registerArrayHandlers(arrMatch[1], arrMatch[2], handler, updateSchema, runHandler);\n        return;\n      }\n\n      if(!service.listeners[key]) {\n        var prev = angular.copy(service.parseExpression(key, service.model).get());\n        //console.log('key, prev:', key, prev, prev === service.parseExpression(key, service.model).get());\n        service.listeners[key] = {\n          handlers: [],\n          updateSchema: updateSchema,\n          prev: prev\n        };\n      }\n\n      if(handler) {\n        service.listeners[key].handlers.push(handler);\n        if(runHandler) handler(null, null, key);\n      }\n    }\n\n    function registerArrayHandlers(arrKey, fieldKey, handler, updateSchema, runHandler) {\n      var service = this;\n      var onArray = function(cur, prev) {\n        var i, l, key;\n\n        if(prev && prev > cur) {\n          var lastKey = arrKey + '[' + (prev - 1) + ']' + '.' + fieldKey;\n          // only deregister handlers once each time an element is removed\n          if (service.listeners[lastKey]) {\n            for(i = 0, l = prev; i < l; i++) {\n              key = arrKey + '[' + i + ']' + '.' + fieldKey;\n              service.deregisterHandlers(key);\n            }\n          }\n          for(i = 0, l = cur; i < l; i++) {\n            key = arrKey + '[' + i + ']' + '.' + fieldKey;\n            service.registerHandler(key, handler, updateSchema);\n            if(runHandler) handler(null, null, key);\n          }\n        }\n        else if(cur > (prev || 0)) {\n          for(i = prev, l = cur; i < l; i++) {\n            key = arrKey + '[' + i + ']' + '.' + fieldKey;\n            service.registerHandler(key, handler, updateSchema);\n            if(runHandler) handler(null, null, key);\n          }\n        }\n      };\n\n      var arrVal = service.parseExpression(arrKey, service.model).get();\n      _.each(arrVal, function(field, i) {\n        var key = arrKey + '[' + i + ']' + '.' + fieldKey;\n        service.registerHandler(key, handler, updateSchema);\n        if(runHandler) handler(null, null, key);\n      });\n\n      if(service.arrayListeners[arrKey + '.length']) {\n        service.arrayListeners[arrKey + '.length'].handlers.push(onArray);\n      } else {\n        service.arrayListeners[arrKey + '.length'] = {\n          handlers: [onArray],\n          prev: arrVal ? arrVal.length : 0\n        };\n      }\n    }\n\n    function deregisterHandlers(key) {\n      var service = this;\n      service.listeners[key] = undefined;\n    }\n\n    function initModelWatch() {\n      //console.log('initModelWatch:', initModelWatch);\n      var service = this;\n      if(service.watching) return;\n      if(service.modelWatch) service.modelWatch();\n\n      service.modelWatch = $rootScope.$watch(\n          function() { return service.model; },\n          service.onModelWatch.bind(service),\n          true\n      );\n\n      service.initSchemaParams();\n      service.watching = true;\n    }\n\n    function onModelWatch(cur, prev) {\n      var service = this;\n      if(!angular.equals(cur, prev)) {\n        cnUtil.cleanModel(service.model);\n\n        service.prevParams = angular.copy(service.params);\n        service.params = {};\n\n        _.each(service.arrayListeners, function(listener, key) {\n          var val = service.parseExpression(key, service.model).get();\n          if(!angular.equals(val, listener.prev)) {\n            _.each(listener.handlers, function(handler) {\n              handler(val, listener.prev);\n            });\n            listener.prev = angular.copy(val);\n          }\n        });\n\n        _.each(service.listeners, function(listener, key) {\n          //console.log('listener:', key, listener);\n          if(listener) {\n            var val = service.parseExpression(key, service.model).get();\n            if(!angular.equals(val, listener.prev)) {\n              _.each(listener.handlers, function(handler) {\n                handler(val, listener.prev, key);\n              });\n              listener.prev = angular.copy(val);\n            }\n            if(listener.updateSchema && !angular.isUndefined(val) && val !== null) {\n              service.params[key] = val;\n            }\n          }\n        });\n\n        //console.log('service.params, service.prevParams:', service.params, service.prevParams, !angular.equals(service.params, service.prevParams), service.updates);\n        if(!angular.equals(service.params, service.prevParams)) {\n          if(service.model.id && !service.updates && _.isEmpty(service.prevParams)) {\n            ++service.updates;\n          }\n          else {\n            service.refreshSchema();\n          }\n        }\n      }\n    }\n\n    function initSchemaParams() {\n      var service = this;\n      _.each(service.listeners, function(listener, key) {\n        if(listener) {\n          var val = service.parseExpression(key, service.model).get();\n          if(listener.updateSchema && !angular.isUndefined(val) && val !== null) {\n            service.params[key] = val;\n          }\n        }\n      });\n    }\n\n    function initArrayCopyWatch() {\n      var service = this;\n      service.events.push($rootScope.$on('schemaFormPropagateScope', function(event, scope) {\n        //console.log('propagated scope:', service.getKey(scope.form.key), scope);\n        var key = service.getKey(scope.form.key).replace(/\\[\\d+]/g, '[]');\n        if(!scope.form.condition) scope.form.condition = 'true';\n        service.addArrayCopy(scope.form, key);\n        scope.$emit('flexFormArrayCopyAdded', key);\n      }));\n      service.events.push($rootScope.$on('schemaFormDeleteFromArray', function(event, scope, index) {\n        if (scope.form.link) {\n          var list = service.parseExpression(scope.form.link, service.model).get();\n          list.splice(index, 1);\n        }\n      }));\n    }\n\n    function addArrayCopy(form, key) {\n      var service = this;\n      if(!service.arrayCopies[key]) service.arrayCopies[key] = [];\n      service.arrayCopies[key].push(form);\n    }\n\n    function getArrayCopies(key) {\n      var service = this;\n      return service.arrayCopies[key];\n    }\n\n    function addToFormCache(field, key) {\n      var service = this;\n      key = key || service.getKey(field.key);\n      if(!service.getFromFormCache(key)) service.formCache[key] = field;\n    }\n\n    function getFromFormCache(key) {\n      var service = this;\n      return service.formCache[key];\n    }\n\n    function addToDataCache(key, modelValue) {\n      var service = this;\n\n      if(key) {\n        service.dataCache[key] = modelValue;\n      }\n    }\n\n    function getFromDataCache(key) {\n      var service = this;\n\n      return service.dataCache[key];\n    }\n\n    function parseExpression(exp, depth) {\n      var service = this;\n      // if expression is specific value\n      if(!exp || /^(null|false|true|undefined|''|[0-9.]+|\\[]|\\{})$/.test(exp)) {\n        return {\n          \"get\": function() {\n            return eval(exp);\n          }\n        };\n      }\n\n      exp = service.getKey(exp);\n\n      //var key;\n      var match = exp.match(/^(model\\.)?(\\S+)$/);\n\n      // cache fucks shit up if the model changes so disabling\n      //var cached;\n\n      // return from cache if possible\n      //if(!/\\[]/.test(exp) && match && match[2]) {\n      //  if(!depth || depth === service.model) {\n      //    key = match[2];\n      //\n      //    cached = service.getFromDataCache(key);\n      //    if(cached) {\n      //      return cached;\n      //    }\n      //  }\n      //}\n\n      var modelValue = {\n        \"get\": function() {\n          var path = exp.replace(/\\[]/g, '').replace(/\\[(\\d+)]/g, '.$1').split('.');\n          var start = depth || service;\n\n          while(start && path.length > 1) {\n            start = start[path.shift()];\n          }\n\n          //if(/\\[]/g.test(exp)) {\n          //  console.log('exp:', exp, start, start && start[path[0]]);\n          //}\n          return start && start[path[0]];\n        },\n        \"set\": function(val) {\n          var path = exp.replace(/\\[]/g, '').replace(/\\[(\\d+)]/g, '.$1').split('.');\n          var start = depth || service;\n\n          while(start && path.length > 1) {\n            var key = path.shift();\n            if(!start[key]) {\n              if(/^\\d?$/.test(path[0])) {\n                start[key] = [];\n              }\n              else {\n                start[key] = {};\n              }\n            }\n            start = start[key];\n          }\n\n          start[path[0]] = val;\n\n          return val;\n        },\n        \"path\": function() {\n          return {\n            exp: exp,\n            depth: depth,\n            key: match[2]\n          };\n        }\n      };\n\n      //if(key) {\n      //  service.addToDataCache(key, modelValue);\n      //}\n\n      return modelValue;\n    }\n\n    function processSection(section) {\n      var service = this;\n\n      _.each(section.items, service.processField.bind(service));\n    }\n\n    function processComponent(component) {\n      var service = this;\n\n      component.type = 'section';\n      component.htmlClass = 'row';\n\n      var cols = 12 / _.reject(component.items, 'hidden').length;\n\n      _.each(component.items, function(field, i) {\n        service.processField(field);\n        component.items[i] = {\n          type: 'section',\n          htmlClass: 'col-sm-' + cols,\n          items: [field]\n        };\n      });\n    }\n\n    function processCurrency(field) {\n      //console.log('processCurrency:', field);\n      field.currencyFormat = {\n        'currency-dollars': 'dollars',\n        'currency-microcents': 'microcents',\n        'currency': 'cents'\n      }[field.schema.format];\n\n      field.type = 'cn-currency';\n    }\n\n    function processPercentage(field) {\n      field.type = 'cn-percentage';\n    }\n\n    function processReusable(field) {\n      var service = this;\n      field.type = 'cn-reusable';\n\n      field.items.forEach(service.processField.bind(service));\n      field.items = [{\n        type: 'section',\n        items: field.items,\n        condition: '!model.' + service.getKey(field.key) + '.id'\n      }];\n    }\n\n    function processMediaUpload(field) {\n      var service = this;\n      field.type = 'cn-mediaupload';\n      _.each(field.data, function(dataKey, key) {\n        field.data[key] = service.parseExpression(dataKey).get();\n      });\n    }\n\n    function processRadiobuttons(radios) {\n      var service = this;\n      radios.type = 'cn-radiobuttons';\n      if(radios.fullWidth) {\n        radios.btnClass = 'col-sm-' + _.divide(12, radios.titleMap.length);\n      }\n    }\n\n    function processDate(date) {\n      date.type = 'cn-datetimepicker';\n    }\n\n    function processSelect(select) {\n      var service = this,\n          schema = select.schema;\n\n      if(select.titleMapResolve || select.titleMap) {\n        select.getTitleMap = function() {\n          return select.titleMap || service.schema.data[select.titleMapResolve];\n        };\n\n        select.onInit = function(val, form, event, setter) {\n          var modelValue = service.parseExpression(form.key, service.model);\n          // make sure we have correct value\n          // console.log('init:', form.key, val, event);\n          val = modelValue.get();\n          if(event === 'tag-init') {\n            var newVal;\n            if(form.schema.type === 'array') {\n              if(form.schema.items.type !== 'object') {\n                newVal = [];\n                _.each(val, function(val) {\n                  var match = {};\n                  match[select.valueProperty || 'value'] = val;\n                  newVal.push(_.find(select.getTitleMap(), match));\n                });\n              }\n            }\n            else {\n              var match = {};\n              match[select.valueProperty || 'value'] = val;\n              newVal = _.find(select.getTitleMap(), match);\n            }\n            //console.log('newVal:', newVal);\n            if(newVal) setter(newVal);\n          }\n        };\n      }\n\n      if(select.titleMapQuery) {\n        var key = select.titleMapQuery.params.q;\n        select.titleQuery = function(q) {\n          console.log('titleMap:', q);\n          var params = {};\n          if(key) {\n            params[key] = q;\n          }\n          return Api.get({\n            url: select.titleMapQuery.url,\n            params: params\n          });\n        };\n\n        // wrap in string so returns truthy when compiled, but converted to number within directive\n        if(!key) select.minLookup = '0';\n\n        select.onInit = function(val, form, event, setter) {\n          //console.log('titleQuery:onInit:', val, form, event, setter);\n          if(event === 'tag-init') {\n            setter(val);\n          }\n        };\n      }\n\n      if(schema.items) {\n        var defaults = [];\n        _.each(schema.items.properties, function(schema, key) {\n          if(angular.isDefined(schema.default)) {\n            defaults.push({\n              \"key\": key,\n              default: schema.default\n            });\n          }\n        });\n        if(defaults.length) {\n          select.onAdd = function(val, form, event) {\n            if(val.value && event === 'tag-added') {\n              _.each(defaults, function(prop) {\n                //console.log('prop:', prop, val);\n                if(!val.value[prop.key]) val.value[prop.key] = prop.default;\n              });\n            }\n          };\n        }\n      }\n\n      if(!select.type.includes('cn-autocomplete')) {\n        if(select.items) {\n          select.detailedList = true;\n\n          if(select.items[0].type !== 'component') {\n            if(select.items.length > 1) {\n              select.items = [{\n                type: \"component\",\n                items: select.items\n              }];\n            }\n\n            service.processFieldset(select);\n          }\n\n          select.type = 'cn-autocomplete-detailed';\n        }\n        else {\n          if(!select.selectionStyle) {\n            if(select.key === 'tags') {\n              select.selectionStyle = 'tags';\n            }\n            else if(select.getSchemaType() === 'array' && select.schema.maxItems !== 1) {\n              select.selectionStyle = 'list';\n            }\n            else {\n              select.selectionStyle = 'select';\n            }\n          }\n          select.type = 'cn-autocomplete';\n        }\n      }\n\n      if(select.displayFormat) {\n        select.itemFormatter = service.processTemplate(select.displayFormat);\n      }\n\n      service.registerHandler(select.key, function(val) {\n        var form = service.formCtrl && service.formCtrl[service.getKey(select.key)];\n        if(form && form.$setDirty) form.$setDirty();\n      }, select.updateSchema);\n    }\n\n    function processToggle(toggle) {\n      toggle.type = 'cn-toggle';\n    }\n\n    function processHelp(help) {\n      help.htmlClass = 'help-block';\n    }\n\n    function processDisplay(display) {\n      var service = this;\n      display.type = 'cn-display';\n      display.getDisplay = service.processTemplate(display.displayFormat, true);\n    }\n\n    function processTemplate(tpl, parseScope) {\n      var service = this;\n      //console.log('tpl:', tpl);\n      //var processor = /<(\\S+)[^>]*>.*<\\/\\1>/.test(tpl) ? $compile : $interpolate;\n      var processor = $interpolate;\n      return function(scope, arrayIndex) {\n        //console.log('tpl, scope, processor:', tpl, scope, processor);\n        //console.log('processor(tpl)(scope):', processor(tpl)(scope));\n        if(parseScope) {\n          if(angular.isDefined(arrayIndex)) {\n            scope = _.map(scope, function(key) {\n              return key === 'arrayIndex' ? arrayIndex : key;\n            });\n          }\n          scope = service.parseExpression(scope, service.model).get();\n        }\n        return processor(tpl)(scope);\n      };\n    }\n\n    function processSelectDisplay(selectDisplay, schema) {\n      var service = this,\n          selectField = _.find(selectDisplay.items, 'selectField'),\n          handler;\n\n      if (schema && schema.type === 'array') {\n        handler = setupArraySelectDisplay(selectDisplay, selectField, service);\n      } else {\n        handler = setupSelectDisplay(selectDisplay, selectField, service);\n      }\n\n      selectDisplay.selectDisplay = false;\n      service.registerHandler(selectField.key, handler, selectField.updateSchema, true);\n      service.processField(selectDisplay);\n    }\n\n    function setupArraySelectDisplay(selectDisplay, selectField, service) {\n      _.each(selectDisplay.items, function(item) {\n        console.log('item.condition:', item.condition, item.key);\n        if(item.condition !== 'false') {\n          item.condition = 'true';\n        }\n      });\n      var handler = function() {\n        var index = getArrayIndex(arguments[2]);\n        _.each(selectDisplay.items, function(item) {\n          var selectKey = service.getKey(selectField.key);\n          var key = service.getKey(item.key);\n          var splitKey = ObjectPath.parse(key);\n          if (selectKey === key) return;\n          var indexedSelectKey = service.setArrayIndex(selectKey, index);\n          var selectValue = service.parseExpression(indexedSelectKey, service.model).get();\n          var formCopies = service.getArrayCopies(key);\n          if (_.includes(selectValue, splitKey[splitKey.length - 1])) {\n            _.each(formCopies, function(copy) {\n              console.log('copy.condition, copy:', copy.condition, copy);\n              if (getArrayIndex(copy) == index) {\n                copy.condition = 'true';\n              }\n            });\n          } else {\n            _.each(formCopies, function(copy) {\n              if (getArrayIndex(copy) == index) {\n                console.log('copy.condition, copy:', copy.condition, copy);\n                copy.condition = 'false';\n                service.parseExpression(service.getKey(copy.key), service.model).set();\n              }\n            });\n          }\n        });\n      };\n      // handle legacy objects that don't have values set in the selectField\n      var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n      _.each(selectDisplay.items, function(item) {\n        var key = service.getKey(item.key);\n        var selectKey = service.getKey(selectField.key);\n        if (key === selectKey) return;\n        _.each(model, function(elem, i) {\n          var indexedKey = service.setArrayIndex(key, i);\n          var splitIndexedKey = ObjectPath.parse(indexedKey);\n          var indexedSelectKey = service.setArrayIndex(selectKey, i);\n          var selectModel = service.parseExpression(indexedSelectKey, service.model);\n          var selectValue = selectModel.get();\n          var itemValue = service.parseExpression(indexedKey, service.model).get();\n          if (itemValue && !_.includes(selectValue, splitIndexedKey[splitIndexedKey.length - 1])) {\n            if (!selectValue) {\n              selectValue = [];\n            }\n            selectValue.push(splitIndexedKey[splitIndexedKey.length - 1]);\n            selectModel.set(selectValue);\n          }\n        });\n      });\n      // handle new objects with values set in defaults\n      var defaults = service.getSchema(selectDisplay.key).default;\n      _.each(defaults, function(elem, i) {\n        var selectKey = service.getKey(selectField.key);\n        var indexedSelectKey = service.setArrayIndex(selectKey, i);\n        var selectModel = service.parseExpression(indexedSelectKey, service.model);\n        var selectValue = selectModel.get();\n        _.each(elem, function(val, key) {\n          if (!selectValue) {\n            selectValue = [];\n          }\n          selectValue.push(key);\n          selectModel.set(selectValue);\n        });\n      });\n      // run handler once all arrayCopies have been instantiated\n      var count = 0;\n      var keyMap = _.pluck(_.reject(selectDisplay.items, {\"condition\":\"false\"}), 'key');\n      var once = $rootScope.$on('flexFormArrayCopyAdded', function(event, key) {\n        var model = service.parseExpression(service.getKey(selectDisplay.key), service.model).get();\n        if (model) {\n          var total = model.length * (keyMap.length);\n          if (_.includes(keyMap, key)) {\n            count++;\n          }\n          if (count === total) {\n            for (var i = 0; i < model.length; i++) {\n              handler(null, null, '[' + i + ']');\n            }\n            count = 0;\n          }\n        }\n      });\n      var resetCount = $rootScope.$on('flexForm.updatePage', function() {\n        count = 0;\n      });\n      service.events.push(once);\n      service.events.push(resetCount);\n      return handler;\n    }\n\n    function setupSelectDisplay(selectDisplay, selectField, service) {\n      var handler = function() {\n        var selectKey = service.getKey(selectField.key);\n        _.each(selectDisplay.items, function(item) {\n          var key = service.getKey(item.key);\n          var splitKey = ObjectPath.parse(key);\n          if (selectKey === key) return;\n          var selectValue = service.parseExpression(selectKey, service.model).get();\n          if (_.includes(selectValue, splitKey[splitKey.length - 1])) {\n            item.condition = \"true\";\n          } else {\n            item.condition = \"false\";\n            service.parseExpression(key, service.model).set();\n          }\n        });\n      };\n      // handle legacy objects that don't have values set in the selectField\n      var selectKey = service.getKey(selectField.key);\n      var selectModel = service.parseExpression(selectKey, service.model);\n      var selectValue = selectModel.get();\n      _.each(selectDisplay.items, function(item) {\n        var key = service.getKey(item.key);\n        if (selectKey === key) return;\n        var splitKey = ObjectPath.parse(key);\n        var itemValue = service.parseExpression(key, service.model).get();\n        if (itemValue && !_.includes(selectValue, splitKey[splitKey.length - 1])) {\n          if (!selectValue) {\n            selectValue = [];\n          }\n          selectValue.push(splitKey[splitKey.length - 1]);\n          selectModel.set(selectValue);\n        }\n      });\n      // handle new objects with values set in the defaults\n      var defaults = service.getSchema(selectDisplay.key).default;\n      _.each(defaults, function(val, key) {\n        if (!selectValue) {\n          selectValue = [];\n        }\n        selectValue.push(key);\n        selectModel.set(selectValue);\n      });\n      // set default values here\n      var model = service.parseExpression(selectDisplay.key, service.model);\n      if (defaults && !model.get()) {\n        model.set(defaults);\n      }\n\n      return handler;\n    }\n\n    function setupSchemaRefresh(refresh) {\n      var service = this;\n      service.refreshSchema = _.debounce(function(updateSchema) {\n        var params = _.extend(cnFlexFormConfig.getStateParams(), service.params);\n        var diff = cnUtil.diff(service.schema.params, params, true);\n        var keys;\n\n        if(diff || updateSchema) {\n          if (updateSchema) params.updateSchema = updateSchema;\n          else {\n            keys = _.keys(diff);\n\n            if(keys.length > 1) {\n              diff = _.omit(diff, _.isNull);\n              keys = _.keys(diff);\n            }\n            //console.log('keys, diff:', keys, diff, {\n            //  cur: _.clone(params),\n            //  prev: _.clone(service.schema.params)\n            //});\n\n            params.updateSchema = _.first(keys);\n          }\n\n          if(!params.updateSchema) {\n            diff = cnUtil.diff(params, _.omit(service.schema.params, 'updateSchema'));\n            keys = _.keys(diff);\n\n            //console.log('keys, diff:', keys, diff);\n            params.updateSchema = _.first(keys);\n          }\n\n          refresh(params).then(function(schema) {\n            ++service.updates;\n            //service.updateSchema(schema);\n            service.processUpdatedSchema(schema);\n          });\n        }\n      }, 100);\n\n      service.refreshData = _.debounce(function() {\n        refresh(_.extend(service.schema.params, {updateSchema: 'refreshData'})).then(function(schema) {\n          service.processUpdatedSchema(schema);\n          console.log('service.schema.params:', service.schema.params);\n        });\n      }, 100);\n\n      service.events.push($rootScope.$on('ffRefreshData', service.refreshData));\n    }\n\n    function processUpdatedSchema(schema) {\n      var service = this;\n      if(schema.diff) {\n        service.schema.params = schema.params;\n\n        if(schema.diff.data) {\n          _.each(schema.diff.data, function(data, key) {\n            if(data.data && !_.isEmpty(service.schema.data[key].data)) {\n              data.data = service.schema.data[key].data.concat(data.data);\n            }\n            service.schema.data[key] = data;\n            if(service.resolveRegister[key]) {\n              _.each(service.resolveRegister[key], function(register) {\n                service.handleResolve(register.field, register.key, `schema.data.${key}`);\n              });\n            }\n          });\n        }\n\n        var keys = [];\n\n        if(schema.diff.schema) {\n          _.each(schema.diff.schema, function(schema, key) {\n            service.schema.schema.properties[key] = schema;\n            reprocessSchema(schema, key, keys);\n          });\n        }\n\n        if(schema.diff.form) {\n          _.each(schema.diff.form, function(form) {\n\n            if(keys.indexOf(form.key) === -1) {\n              keys.push(form.key);\n            }\n\n            // don't want to override key when extending cached objects\n            var key = form.key;\n            delete form.key;\n\n            var cached = service.getFromFormCache(key);\n            if(cached) {\n              reprocessField(cached, form);\n            }\n            var copies = service.getArrayCopies(key);\n            if(copies) {\n              _.each(copies, function(copy) {\n                reprocessField(copy, form);\n              });\n            }\n          });\n        }\n\n        if(keys.length) {\n          _.each(keys, function(key) {\n            var form = service.getFromFormCache(key);\n            if(form) service.processField(form);\n            if(key.includes('[]')) {\n              var copies = service.getArrayCopies(key);\n              _.each(copies, function(copy) {\n                if(copy) service.processField(copy);\n              });\n            }\n          });\n        }\n\n        service.broadcastErrors();\n      }\n      else {\n        service.updateSchema(schema);\n      }\n    }\n\n    function reprocessField(current, update, isChild) {\n      _.extend(current, _.omit(update, 'items', 'key'));\n\n      _.each(current._ogKeys, function(key) {\n        if(!update[key]) delete current[key];\n      });\n      current._ogKeys = _.keys(update);\n\n      // we shouldn't reprocess all child items if they haven't changed, let\n      // the diff tell us which specific fields to update\n      //_.each(update.items, function(child, i) {\n      //  //console.log('child:', child, current.items[i]);\n      //  if(child.key) reprocessField(current.items[i], child, true);\n      //});\n\n      if(!isChild && current.redraw) current.redraw();\n    }\n\n    function reprocessSchema(schema, key, keys) {\n      keys.push(key);\n      if(schema.properties) {\n        _.each(schema.properties, function(schema, subKey) {\n          reprocessSchema(schema, key + '.' + subKey, keys);\n        });\n      }\n      if(schema.items && schema.items.properties) {\n        _.each(schema.properties, function(schema, subKey) {\n          reprocessSchema(schema, key + '[].' + subKey, keys);\n        });\n      }\n    }\n\n    function buildError(field) {\n      var service = this;\n      var key = service.getKey(field.key);\n      return {\n        key: key,\n        message: field.error\n      };\n    }\n\n    function broadcastErrors() {\n      var service = this;\n      $timeout(function() {\n        service.errors.forEach(function(error) {\n          $rootScope.$broadcast('schemaForm.error.' + error.key, 'serverValidation', error.message);\n        });\n      }, 1);\n    }\n\n    function replaceArrayIndex(resolve, key) {\n      var arrayIndexKey = /([^.]*)\\[arrayIndex\\]/.exec(resolve);\n      var re = new RegExp(arrayIndexKey[1] + '\\\\[(\\\\d+)\\\\]');\n      var index = re.exec(key);\n      return resolve.replace(arrayIndexKey[0], index[0]);\n    }\n\n    function getArrayIndex(key) {\n      if (_.isObject(key)) {\n        return _.find(key.key, function(key) {\n          return _.isNumber(key);\n        });\n      } else {\n        return /\\[(\\d+)\\]/.exec(key)[1];\n      }\n    }\n\n    function setArrayIndex(key, index, asArray) {\n      var service = this;\n      var keyCopy;\n      if (_.isString(key)) {\n        keyCopy = ObjectPath.parse(key);\n      } else {\n        keyCopy = _.clone(key);\n      }\n      var indexOfIndex = keyCopy.indexOf('');\n      keyCopy[indexOfIndex] = index;\n\n      if (asArray) {\n        return keyCopy;\n      } else {\n        return service.getKey(keyCopy);\n      }\n    }\n\n    function cleanup() {\n      var service = this;\n      _.each(service.events, function(listener) {\n        listener();\n      });\n    }\n  }\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.flex-form')\n      .controller('FlexFormSandbox', FlexFormSandbox);\n\n  /* @ngInject */\n  function FlexFormSandbox() {\n    /* jshint validthis: true */\n    var vm = this;\n\n    vm.activate = activate;\n    vm.onSchema = onSchema;\n    vm.model = {};\n    vm.config = {};\n    vm.schemaStr = '';\n\n    activate();\n\n    ////////////////\n\n    function activate() {\n      console.log('FlexFormSandbox');\n    }\n\n    function onSchema() {\n      if(vm.schemaStr) {\n        var schema = angular.fromJson(vm.schemaStr);\n        console.log('schema:', schema);\n        if(!schema.form && schema.forms) {\n          schema.form = schema.forms[0].form;\n        }\n        vm.config.schema = schema.form && schema;\n      }\n    }\n\n  }\n})();","(function() {\n  'use strict';\n\n  angular.module('cn.flex-form')\n      .config(schemaFormConfig)\n      .run(addTemplates);\n\n  schemaFormConfig.$inject = ['cnFlexFormServiceProvider'];\n\n  function schemaFormConfig(cnFlexFormServiceProvider) {\n    var extensions = [\n      'cn-fieldset',\n      'cn-toggle',\n      'cn-datetimepicker',\n      'cn-autocomplete',\n      'cn-autocomplete-detailed',\n      'cn-currency',\n      'cn-radiobuttons',\n      'cn-percentage',\n      'cn-display',\n      'cn-mediaupload',\n      'cn-reusable'\n    ];\n\n    _.each(extensions, function(extension) {\n      cnFlexFormServiceProvider.registerField({\n        type: extension,\n        templateUrl: 'app/components/cn-flex-form/forms/' + extension + '.html'\n      });\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n\n  function addTemplates($templateCache) {\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-toggle.html',\n        '\\\n        <div class=\"form-group {{form.htmlClass}}\" \\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\\n          <div class=\"clearfix\">\\\n            <cn-toggle-switch\\\n              class=\"pull-left\"\\\n              ng-show=\"form.key\"\\\n              enabled=\"$$value$$\"\\\n              on-value=\"angular.isDefined(form.onValue) ? form.onValue : true\"\\\n              off-value=\"angular.isDefined(form.offValue) ? form.offValue : false\">\\\n            </cn-toggle-switch>\\\n            <span ng-show=\"form.onText && form.offText\">\\\n              {{$$value$$ === form.onValue ? form.onText : form.offText}}\\\n            </span>\\\n          </div>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-datetimepicker.html',\n        '\\\n        <div class=\"form-group {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 for=\"{{form.key.join(\\'.\\')}}\"\\\n                 ng-show=\"showTitle()\">{{form.title}}</label>\\\n          <cn-datetimepicker\\\n            ng-show=\"form.key\"\\\n            ng-model=\"$$value$$\"\\\n            ng-model-options=\"form.ngModelOptions\"\\\n            is-disabled=\"form.readonly\"\\\n            sf-changed=\"form\"\\\n            schema-validate=\"form\"\\\n            input-id=\"{{form.key.join(\\'.\\')}}\"\\\n            min-date=\"form.minDate\"\\\n            required=\"form.required\"\\\n            model-type=\"{{form.schema.type}}\">\\\n          </cn-datetimepicker>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    var sharedAutocompleteTpl = '\\\n          <tags-input\\\n            ng-show=\"form.key\"\\\n            ng-model=\"$$value$$\"\\\n            ng-model-options=\"form.ngModelOptions\"\\\n            ng-disabled=\"form.readonly\"\\\n            sf-changed=\"form\"\\\n            schema-validate=\"form\"\\\n            input-id=\"{{form.key.join(\\'.\\')}}\"\\\n            display-property=\"{{form.displayProperty || \\'name\\'}}\"\\\n            value-property=\"{{form.valueProperty || \\'value\\'}}\"\\\n            placeholder=\"{{form.placeholder || \\' \\'}}\"\\\n            add-on-blur=\"true\"\\\n            add-on-comma=\"false\"\\\n            add-from-autocomplete-only=\"{{!form.allowNew}}\"\\\n            on-before-tag-added=\"form.onAdd({value: $tag}, form, $event, $prev)\"\\\n            on-init=\"form.onInit($tag, form, $event, $setter)\"\\\n            model-type=\"{{form.getSchemaType()}}\"\\\n            array-value-type=\"{{form.schema.items.type}}\"\\\n            hide-tags=\"{{form.detailedList}}\"\\\n            tags-style=\"{{form.selectionStyle}}\"\\\n            required=\"{{form.required}}\"\\\n            min-length=\"{{form.minLength}}\"\\\n            allowed-tags-pattern=\".*\"\\\n            dropdown=\"true\"\\\n            item-formatter=\"form.itemFormatter\"\\\n            min-tags=\"{{form.schema.minItems}}\"\\\n            max-tags=\"{{form.schema.maxItems || form.getSchemaType() !== \\'array\\' ? 1 : 0}}\"\\\n            allow-bulk=\"{{form.bulkAdd}}\"\\\n            bulk-delimiter=\"{{form.bulkDelimiter}}\"\\\n            bulk-placeholder=\"{{form.bulkPlaceholder}}\"\\\n            show-button=\"true\">\\\n            <auto-complete\\\n              source=\"form.getTitleMap && form.getTitleMap() || form.titleQuery($query)\"\\\n              skip-filtering=\"{{form.titleQuery ? true : false}}\"\\\n              min-length=\"{{form.minLookup || (form.titleQuery && 3 || 0)}}\">\\\n            </auto-complete>\\\n          </tags-input>\\\n          ';\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-autocomplete.html',\n        '\\\n        <div class=\"form-group {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 for=\"{{form.key.join(\\'.\\')}}-input\"\\\n                 ng-show=\"showTitle()\">{{form.title}}</label>\\\n          ' + sharedAutocompleteTpl + '\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-autocomplete-detailed.html',\n        '\\\n        <div sf-array=\"form\"\\\n             class=\"form-group {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 for=\"{{form.key.join(\\'.\\')}}-input\"\\\n                 ng-show=\"showTitle()\">{{form.title}}</label>\\\n          <ol class=\"list-group cn-autocomplete-list\"\\\n              ng-show=\"modelArray.length\"\\\n              ng-model=\"modelArray\">\\\n            <li class=\"list-group-item {{form.fieldHtmlClass}}\"\\\n                ng-repeat=\"item in modelArray track by $index\">\\\n              <button ng-hide=\"form.readonly || form.remove === null\"\\\n                      ng-click=\"deleteFromArray($index)\"\\\n                      type=\"button\" class=\"close pull-right\">\\\n                <span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span>\\\n              </button>\\\n              <sf-decorator ng-init=\"arrayIndex = $index\" form=\"copyWithIndex($index)\"></sf-decorator>\\\n            </li>\\\n          </ol>\\\n          ' + sharedAutocompleteTpl + '\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-currency.html',\n        '\\\n        <div class=\"form-group {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 ng-show=\"showTitle()\"\\\n                 for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\\n          <div class=\"{{form.fieldClass}} input-group\">\\\n            <label class=\"input-group-addon\"\\\n                   ng-disabled=\"form.readonly\"\\\n                   for=\"{{form.key.join(\\'.\\')}}\">$</label>\\\n            <input class=\"form-control\"\\\n                   cn-currency-format=\"{{form.currencyFormat}}\"\\\n                   ng-show=\"form.key\"\\\n                   ng-model-options=\"form.ngModelOptions\"\\\n                   ng-disabled=\"form.readonly\"\\\n                   sf-changed=\"form\"\\\n                   schema-validate=\"form\"\\\n                   ff-validate=\"form\"\\\n                   type=\"text\"\\\n                   step=\"any\"\\\n                   min=\"{{form.min}}\"\\\n                   max=\"{{form.max}}\"\\\n                   id=\"{{form.key.join(\\'.\\')}}\"\\\n                   name=\"{{form.key.join(\\'.\\')}}\"\\\n                   ng-model=\"$$value$$\">\\\n          </div>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-radiobuttons.html',\n        '\\\n        <div class=\"form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\" ng-show=\"showTitle()\">{{form.title}}</label>\\\n          <div class=\"btn-group clearfix\">\\\n            <label class=\"btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? \\'active\\' : \\'\\'}}\"\\\n                   ng-repeat=\"item in form.titleMap\">\\\n              <input type=\"radio\"\\\n                     class=\"{{form.fieldHtmlClass}} hide\"\\\n                     sf-changed=\"form\"\\\n                     ng-disabled=\"form.readonly\"\\\n                     ng-model=\"$$value$$\"\\\n                     ng-model-options=\"form.ngModelOptions\"\\\n                     schema-validate=\"form\"\\\n                     ff-validate=\"form\"\\\n                     ng-value=\"item.value\"\\\n                     name=\"{{form.key.join(\\'.\\')}}\">\\\n              <i class=\"fa fa-{{item.value}} fa-lg\"></i>\\\n              <span ng-bind-html=\"item.name\"></span>\\\n            </label>\\\n          </div>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-percentage.html',\n        '\\\n        <div class=\"form-group {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 ng-show=\"showTitle()\"\\\n                 for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\\n          <div class=\"{{form.fieldClass}} input-group\">\\\n            <input class=\"form-control\"\\\n                   cn-percentage-format\\\n                   ng-show=\"form.key\"\\\n                   ng-model-options=\"form.ngModelOptions\"\\\n                   ng-disabled=\"form.readonly\"\\\n                   sf-changed=\"form\"\\\n                   schema-validate=\"form\"\\\n                   type=\"number\"\\\n                   step=\"any\"\\\n                   min=\"{{form.min}}\"\\\n                   max=\"{{form.max}}\"\\\n                   id=\"{{form.key && form.key[0]}}\"\\\n                   name=\"{{form.key && form.key[0]}}\"\\\n                   ng-model=\"$$value$$\">\\\n             <div class=\"input-group-addon\"\\\n                    ng-disabled=\"form.readonly\"\\\n                    for=\"{{form.key && form.key[0]}}\">%</div>\\\n          </div>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-display.html',\n        '\\\n        <div class=\"form-group cn-display{{form.htmlClass}}\">\\\n          <input ng-show=\"form.key\"\\\n                 class=\"form-control\"\\\n                 id=\"{{form.key.join(\\'.\\')}}\"\\\n                 name=\"{{form.key.join(\\'.\\')}}\"\\\n                 ng-disabled=\"true\"\\\n                 value=\"{{form.getDisplay(form.key, form.arrayIndex)}}\">\\\n        </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-fieldset.html',\n        '\\\n        <fieldset ng-disabled=\"form.readonly\" class=\"schema-form-fieldset {{form.htmlClass}}\">\\\n          <legend ng-click=\"form.toggleCollapse()\"\\\n                  ng-class=\"{\\'sr-only\\': !showTitle(), collapsible: form.collapsible}\"\\\n                  ng-mouseenter=\"form.render = true\">\\\n            <i ng-show=\"form.collapsible\"\\\n               class=\"fa fa-caret-{{form.collapsed ? \\'right\\' : \\'down\\'}}\"></i>\\\n            {{ form.title }}\\\n          </legend>\\\n          <div class=\"help-block\" ng-show=\"form.description\" ng-bind-html=\"form.description\"></div>\\\n          <div collapse=\"form.collapsed\">\\\n            <div ng-if=\"form.render\">\\\n              <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"></sf-decorator>\\\n            </div>\\\n          </div>\\\n        </fieldset>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-mediaupload.html',\n        '\\\n        <div class=\"form-group {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 ng-show=\"showTitle()\"\\\n                 for=\"{{form.key && form.key[0]}}\">{{form.title}}</label>\\\n          <media-upload ng-model=\"$$value$$\"\\\n                        cn-file-type=\"form.fileType\"\\\n                        cn-upload-path=\"form.uploadPath\"\\\n                        cn-data=\"form.data\"\\\n                        cn-preview-path=\"form.previewPath\"\\\n                        cn-model-value-key=\"form.modelValueKey\"\\\n                        ng-model-options=\"form.ngModelOptions\"\\\n                        sf-changed=\"form\"\\\n                        schema-validate=\"form\"\\\n                        ff-form=\"form\"\\\n                        class=\"clearfix\">\\\n          </media-upload>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n       </div>\\\n        '\n    );\n\n    $templateCache.put(\n        'app/components/cn-flex-form/forms/cn-reusable.html',\n        '\\\n        <div class=\"form-group cn-reusable {{form.htmlClass}}\"\\\n             ng-class=\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\">\\\n          <label class=\"control-label\"\\\n                 ng-show=\"showTitle()\"\\\n                 for=\"{{form.key.join(\\'.\\')}}\">{{form.title}}</label>\\\n          <cn-select-or\\\n            ng-show=\"form.key\"\\\n            select-from=\"form.library\"\\\n            ng-model=\"$$value$$\"\\\n            ng-model-options=\"form.ngModelOptions\"\\\n            sf-changed=\"form\"\\\n            schema-validate=\"form\"\\\n            ff-form=\"form\"\\\n            directiveId=\"form.directiveId\"\\\n            item-template=\"form.itemTemplate\"\\\n            toggle-text=\"form.toggleText\"\\\n            disabled=\"form.readonly\"\\\n            view=\"form.view\">\\\n            <sf-decorator ng-repeat=\"item in form.items\" form=\"item\"/>\\\n          </cn-select-or>\\\n          <p ng-if=\"form.loadMore && form.view === \\'list\\'\">\\\n            <a ng-click=\"form.loadMore()\"\\\n               class=\"btn btn-default btn-block\">Load More</a>\\\n          </p>\\\n          <span class=\"help-block\" sf-message=\"form.description\"></span>\\\n        </div>\\\n        '\n    );\n  }\n\n})();"],"sourceRoot":"/source/"}