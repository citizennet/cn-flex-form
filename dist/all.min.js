!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("lodash"),require("objectpath")):"function"==typeof define&&define.amd?define("cn-flex-form",["lodash","objectpath"],n):"object"==typeof exports?exports["cn-flex-form"]=n(require("lodash"),require("objectpath")):e["cn-flex-form"]=n(e.lodash,e.objectpath)}(this,function(e,n){return function(e){function n(t){if(r[t])return r[t].exports;var o=r[t]={exports:{},id:t,loaded:!1};return e[t].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var r={};return n.m=e,n.c=r,n.p="",n(0)}([function(e,n,r){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(1),a=t(o),s=r(2),i=t(s),c=r(3),l=r(4),f=r(5),d=t(f),m=r(8),u=t(m),p=r(9),h=r(10),g=t(h),v=r(12),y=t(v),b=r(13),x=t(b);console.log(d.default),n.default=angular.module("cn.flex-form",["ui.router","schemaForm","ui.bootstrap.datetimepicker","cnTagsInput","cn.util"]).provider("cnFlexFormConfig",a.default).provider("cnFlexFormTypes",i.default).provider("cnFlexFormRoutes",c.cnFlexFormRoutesProvider).config(c.cnFlexFormRoutes).config(l.schemaFormConfig).run(l.addTemplates).provider("cnFlexFormService",d.default).provider("cnFlexFormModalLoaderService",u.default).factory("FlexFormModal",p.FlexFormModal).controller("FlexFormModalLoader",p.FlexFormModalLoader).directive("cnFlexForm",g.default).directive("cnFlexFormHeader",y.default).directive("ffValidate",x.default).name},function(e,n){"use strict";function r(){function e(e){r.push(e)}function n(e){"ngInject";function n(){return _.chain(e).omit(r).omit(function(e){return _.isUndefined(e)||_.isNull(e)}).value()}return{getStateParams:n,ignoreParams:r}}n.$inject=["$stateParams"];var r=["page","debug","sandbox","modal","modalId"];return{addIgnoreParam:e,$get:n}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},function(e,n){"use strict";function r(){function e(e){r.unshift(e)}function n(){function e(e){for(var n=0,t=r.length;n<t;n++)if(r[n].condition(e))return r[n].type;return e.type||e.schema&&e.schema.type}return{fieldTypeRegister:r,getFieldType:e}}var r=[{condition:function(e){return"hidden"===e.type},type:"hidden"},{condition:function(e){return e.type.includes("radios")},type:"cn-radios"},{condition:function(e){return e.type.includes("radiobuttons")},type:"cn-radiobuttons"},{condition:function(e){return e.type.includes("autocomplete")||e.titleMap||e.titleMapResolve||e.titleMapQuery},type:"cn-autocomplete"},{condition:function(e){return"cn-datetimepicker"===e.type||"datetime-local"===e.type||"time-minutes"===e.type},type:"cn-datetimepicker"},{condition:function(e){return"help"===e.type},type:"help"},{condition:function(e){return e.type.includes("display")},type:"cn-display"},{condition:function(e){return e.schema&&e.schema.format&&e.schema.format.includes("currency")},type:"cn-currency"},{condition:function(e){return e.schema&&"percentage"===e.schema.format},type:"cn-percentage"},{condition:function(e){return"toggle"===e.type||"boolean"===e.type},type:"cn-toggle"},{condition:function(e){return"mediaupload"===e.type},type:"cn-mediaupload"},{condition:function(e){return"csvupload"===e.type},type:"cn-csvupload"},{condition:function(e){return"reusable"===e.type},type:"cn-reusable"},{condition:function(e){return"table"===e.type},type:"cn-table"},{condition:function(e){return"array"===e.type},type:"array"}];return{registerFieldType:e,$get:n}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},function(e,n){"use strict";function r(e){"ngInject";function n(){}function r(n){var r=n.permissions,t=n.name,a={controller:"FlexFormModalLoader",controllerAs:"vm",permissions:r};e.state(t+".page.modal",o({url:"/~:modal/:modalId"},a)).state(t+".page.modalParams",o({url:"/~:modal/:modalId/:restParams"},a))}return{addStates:r,$get:n}}function t(e){"ngInject";e.state("flex-form-sandbox",{url:"/flex-form/sandbox",controller:"FlexFormSandbox",controllerAs:"vm",templateUrl:"app/components/cn-flex-form/sandbox.html"})}r.$inject=["$stateProvider"],t.$inject=["$stateProvider"],Object.defineProperty(n,"__esModule",{value:!0});var o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e};n.cnFlexFormRoutes=t,n.cnFlexFormRoutesProvider=r},function(e,n){"use strict";function r(e){"ngInject";tv4.addFormat({url:function(e){return _.isString(e)&&!/^(https?:\/\/.{2}|$)/.test(e)&&"invalid url"}});var n=["cn-fieldset","cn-toggle","cn-datetimepicker","cn-autocomplete","cn-autocomplete-detailed","cn-currency","cn-radios","cn-radiobuttons","cn-percentage","cn-display","cn-mediaupload","cn-csvupload","cn-reusable","cn-table"];_.each(n,function(n){e.registerField({type:n,templateUrl:"app/components/cn-flex-form/forms/"+n+".html"})})}function t(e){"ngInject";e.put("app/components/cn-flex-form/forms/cn-toggle.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label" ng-show="showTitle()">{{form.title}}</label>\n        <div class="clearfix">\n          <cn-toggle-switch\n            class="pull-left"\n            ng-show="form.key"\n            ng-model-options="form.ngModelOptions"\n            ng-model="$$value$$"\n            sf-changed="form"\n            schema-validate="form"\n            on-value="form.onValue"\n            off-value="form.offValue"\n            read-only="form.readonly"\n            undefined-class="form.undefinedClass"/>\n          <span ng-show="form.onText && form.offText">\n            {{$$value$$ === form.onValue ? form.onText : form.offText}}\n          </span>\n        </div>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-datetimepicker.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               for="{{form.key.join(\'.\')}}"\n               ng-show="showTitle()">{{form.title}}</label>\n        <cn-datetimepicker\n          ng-show="form.key"\n          ng-model="$$value$$"\n          ng-model-options="form.ngModelOptions"\n          is-disabled="form.readonly"\n          sf-changed="form"\n          schema-validate="form"\n          input-id="{{form.key.join(\'.\')}}"\n          min-date="form.minDate"\n          max-date="form.maxDate"\n          max-view="{{form.maxView}}"\n          cn-date-required="form.required"\n          placeholder="{{form.placeholder}}"\n          model-type="{{form.schema.type}}"\n          model-formatter="form.modelFormatter"\n          model-parser="form.modelParser"\n          view-formatter="form.viewFormatter"\n          view-parser="form.viewParser"\n          format-string={{form.dateFormat}}\n          icon-class={{form.iconClass}}>\n        </cn-datetimepicker>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>');var n='\n        <tags-input\n          ng-show="form.key"\n          ng-model="$$value$$"\n          ng-model-options="form.ngModelOptions"\n          ng-disabled="form.readonly"\n          sf-changed="form"\n          schema-validate="form"\n          input-id="{{form.key.join(\'.\')}}"\n          display-property="{{form.displayProperty || \'name\'}}"\n          value-property="{{form.valueProperty}}"\n          placeholder="{{form.placeholder || \' \'}}"\n          clear-on-blur="true"\n          add-on-comma="false"\n          add-from-autocomplete-only="{{!form.allowNew}}"\n          on-before-tag-added="form.onAdd({value: $tag}, form, $event, $prev)"\n          on-init="form.onInit($tag, form, $event, $setter)"\n          model-type="{{form.getSchemaType()}}"\n          array-value-type="{{form.schema.items.type}}"\n          hide-tags="{{form.detailedList}}"\n          tags-style="{{form.selectionStyle}}"\n          required="{{form.required}}"\n          min-length="{{form.minLength}}"\n          allowed-tags-pattern=".*"\n          dropdown-icon="true"\n          item-formatter="form.itemFormatter"\n          min-tags="{{form.schema.minItems}}"\n          max-tags="{{form.schema.maxItems || form.getSchemaType() !== \'array\' ? 1 : 0}}"\n          allow-bulk="{{form.bulkAdd}}"\n          bulk-delimiter="{{form.bulkDelimiter}}"\n          bulk-placeholder="{{form.bulkPlaceholder}}"\n          show-clear-all="{{form.showClearAll}}"\n          show-button="true">\n          <auto-complete\n            source="form.getTitleMap && form.getTitleMap() || form.titleQuery($query)"\n            skip-filtering="{{form.titleQuery ? true : false}}"\n            min-length="{{form.minLookup || (form.titleQuery && 3 || 0)}}">\n          </auto-complete>\n        </tags-input>';e.put("app/components/cn-flex-form/forms/cn-autocomplete.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               for="{{form.key.join(\'.\')}}-input"\n               ng-show="showTitle()">{{form.title}}</label>\n        '+n+'\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-autocomplete-detailed.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               for="{{form.key.join(\'.\')}}-input"\n               ng-show="showTitle()">{{form.title}}</label>\n        <ol sf-array="form"\n            class="list-group cn-autocomplete-list"\n            ng-show="modelArray.length"\n            ng-model="modelArray">\n          <li class="list-group-item {{form.fieldHtmlClass}}"\n              ng-repeat="item in modelArray track by $index">\n            <button ng-hide="form.readonly || form.remove === null"\n                    ng-click="deleteFromArray($index)"\n                    type="button" class="close pull-right">\n              <span aria-hidden="true">&times;</span>\n            </button>\n            <sf-decorator form="copyWithIndex($index)"/>\n          </li>\n        </ol>\n        '+n+'\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-currency.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               ng-show="showTitle()"\n               for="{{form.key.join(\'.\')}}">{{form.title}}</label>\n        <div class="{{form.fieldClass}} input-group">\n          <label class="input-group-addon"\n                 ng-disabled="form.readonly"\n                 for="{{form.key.join(\'.\')}}">$</label>\n          <input class="form-control"\n                 cn-currency-format="{{form.currencyFormat}}"\n                 cn-currency-placeholder="{{form.placeholder}}"\n                 ng-show="form.key"\n                 ng-model-options="form.ngModelOptions"\n                 ng-disabled="form.readonly"\n                 sf-changed="form"\n                 schema-validate="form"\n                 type="text"\n                 step="any"\n                 min="{{form.min}}"\n                 max="{{form.max}}"\n                 id="{{form.key.join(\'.\')}}"\n                 name="{{form.key.join(\'.\')}}"\n                 ng-model="$$value$$">\n        </div>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-radios.html",'<div class="form-group {{form.htmlClass}}"\n            ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n         <label class="control-label" ng-show="showTitle()">{{form.title}}</label>\n         <div class="btn-group clearfix">\n           <label class="radio radio-block"\n                  ng-repeat="item in form.titleMap">\n             <input type="radio"\n                    sf-changed="form"\n                    ng-disabled="form.readonly"\n                    ng-model="$$value$$"\n                    ng-model-options="form.ngModelOptions"\n                    schema-validate="form"\n                    ff-validate="form"\n                    ng-value="item.value"\n                    name="{{form.key.join(\'.\')}}">\n             <span class="radio-block-icon" ng-if="item.iconClass">\n               <i class="fa fa-{{item.iconClass}} fa-lg"></i>\n             </span>\n             <span ng-bind-html="item.name"></span>\n           </label>\n         </div>\n         <span class="help-block" sf-message="form.description"></span>\n       </div>'),e.put("app/components/cn-flex-form/forms/cn-radiobuttons.html",'\n      <div class="form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label" ng-show="showTitle()">{{form.title}}</label>\n        <div class="btn-group clearfix">\n          <label class="btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? \'active\' : \'\'}}"\n                 ng-repeat="item in form.titleMap">\n            <input type="radio"\n                   class="{{form.fieldHtmlClass}} hide"\n                   sf-changed="form"\n                   ng-disabled="form.readonly"\n                   ng-model="$$value$$"\n                   ng-model-options="form.ngModelOptions"\n                   schema-validate="form"\n                   ff-validate="form"\n                   ng-value="item.value"\n                   name="{{form.key.join(\'.\')}}">\n            <i class="fa fa-{{item.value}} fa-lg"></i>\n            <span ng-bind-html="item.name"></span>\n          </label>\n        </div>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-percentage.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               ng-show="showTitle()"\n               for="{{form.key && form.key[0]}}">{{form.title}}</label>\n        <div class="{{form.fieldClass}} input-group">\n          <input class="form-control"\n                 cn-percentage-format\n                 ng-show="form.key"\n                 ng-model-options="form.ngModelOptions"\n                 ng-disabled="form.readonly"\n                 sf-changed="form"\n                 schema-validate="form"\n                 type="number"\n                 step="any"\n                 min="{{form.min}}"\n                 max="{{form.max}}"\n                 id="{{form.key && form.key[0]}}"\n                 name="{{form.key && form.key[0]}}"\n                 ng-model="$$value$$">\n           <div class="input-group-addon"\n                  ng-disabled="form.readonly"\n                  for="{{form.key && form.key[0]}}">%</div>\n        </div>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-display.html",'\n      <div class="form-group cn-display{{form.htmlClass}}">\n        <input ng-show="form.key"\n               class="form-control"\n               id="{{form.key.join(\'.\')}}"\n               name="{{form.key.join(\'.\')}}"\n               ng-disabled="true"\n               value="{{form.getDisplay(form.key, form.arrayIndex)}}">\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-fieldset.html",'\n      <fieldset \n        ng-disabled="form.readonly"\n        class="schema-form-fieldset {{form.htmlClass}}"\n        ng-class="{\'borderless\': form.pos === 0}">\n        <legend ng-click="form.toggleCollapse(form)"\n                ng-class="{\'sr-only\': !showTitle(), collapsible: form.collapsible}"\n                ng-mouseenter="form.render = true">\n          <i ng-show="form.collapsible"\n             class="fa fa-caret-{{form.collapsed ? \'right\' : \'down\'}}"></i>\n          {{ form.title }}\n        </legend>\n        <div class="help-block" ng-show="form.description" ng-bind-html="form.description"></div>\n        <div uib-collapse="form.collapsed">\n          <div ng-if="form.render">\n            <sf-decorator ng-repeat="item in form.items" form="item"/>\n          </div>\n        </div>\n      </fieldset>'),e.put("app/components/cn-flex-form/forms/cn-mediaupload.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               ng-show="showTitle()"\n               for="{{form.key && form.key[0]}}">{{form.title}}</label>\n        <media-upload ng-model="$$value$$"\n                      cn-file-type="form.fileType"\n                      cn-upload-path="form.uploadPath"\n                      cn-data="form.data"\n                      cn-preview-path="form.previewPath"\n                      cn-model-value-key="form.modelValueKey"\n                      ng-model-options="form.ngModelOptions"\n                      sf-changed="form"\n                      schema-validate="form"\n                      ff-form="form"\n                      class="clearfix">\n        </media-upload>\n        <span class="help-block" sf-message="form.description"></span>\n     </div>'),e.put("app/components/cn-flex-form/forms/cn-csvupload.html",'\n      <div class="form-group {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               ng-show="showTitle()"\n               for="{{form.key && form.key[0]}}">{{form.title}}</label>\n        <csv-upload ng-model="$$value$$"\n                      cn-upload-path="form.uploadPath"\n                      ng-model-options="form.ngModelOptions"\n                      sf-changed="form"\n                      schema-validate="form"\n                      ff-form="form"\n                      class="clearfix">\n        </csv-upload>\n        <span class="help-block" sf-message="form.description"></span>\n     </div>'),e.put("app/components/cn-flex-form/forms/cn-reusable.html",'\n      <div class="form-group cn-reusable {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <label class="control-label"\n               ng-show="showTitle()"\n               for="{{form.key.join(\'.\')}}">{{form.title}}</label>\n        <cn-select-or\n          ng-show="form.key"\n          select-from="form.library"\n          ng-model="$$value$$"\n          ng-model-options="form.ngModelOptions"\n          sf-changed="form"\n          schema-validate="form"\n          ff-form="form"\n          directiveId="form.directiveId"\n          item-template="form.itemTemplate"\n          toggle-text="form.toggleText"\n          disabled="form.readonly"\n          view="form.view">\n          <sf-decorator ng-repeat="item in form.items" form="item"/>\n        </cn-select-or>\n        <p ng-if="form.loadMore && form.view === \'list\'">\n          <a ng-click="form.loadMore()"\n             class="btn btn-default btn-block">Load More</a>\n        </p>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>'),e.put("app/components/cn-flex-form/forms/cn-table.html",'\n      <div class="form-group cn-ff-table {{form.htmlClass}}"\n           ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">\n        <h6>{{form.title}}</h6>\n        <div class="row">\n          <div ng-repeat="col in form.columns" class="{{col.columnWidth}}">\n            <p class="column-header">{{col.columnHeader}}</p>\n          </div>\n        </div>\n        <div class="row" ng-repeat="row in form.items">\n          <div ng-repeat="col in row.items" class="{{col.columnWidth}}">\n            <sf-decorator form="col"></sf-decorator>\n          </div>\n        </div>\n        <span class="help-block" sf-message="form.description"></span>\n      </div>')}r.$inject=["cnFlexFormServiceProvider"],t.$inject=["$templateCache"],Object.defineProperty(n,"__esModule",{value:!0}),n.schemaFormConfig=r,n.addTemplates=t},function(e,n,r){"use strict";function t(e){if(Array.isArray(e)){for(var n=0,r=Array(e.length);n<e.length;n++)r[n]=e[n];return r}return Array.from(e)}function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){"ngInject";function r(r){r.condition&&n.registerFieldType({condition:r.condition,type:r.type}),r.handler&&(f[r.type]=r.handler),r.templateUrl&&(e.addMapping("bootstrapDecorator",r.type,r.templateUrl),e.createDirective(r.type,r.templateUrl))}return{registerField:r,$get:s}}function s(e,n,r,a,s,m,u,p,h,g){"ngInject";function v(e){return c.find(ze,e)}function y(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(n.length>1)var t=n[0],o=n[1],a=n[2];else var s=n[0],t=s.schema,o=s.model,a=s.config;var i=v(function(e){return e.model===o});if(i)return t&&i.compile(t,o,a),i;var c=new b(t,o,a);return ze.push(c),c}function b(e,n,t){g.debug&&(window.services=ze),this.arrayCopies={},this.arrayListeners={},this.dataCache={},this.defaults={},this.errors=[],this.events=[],this.formCache={},this.scopeCache={},this.listeners={},this.resolveRegister={},this.model=n,this.updates=0,this.skipDefault={},this.params=r.getStateParams(),this._=c,this.compile(e,n,t)}function x(e,n,r){var t=this;t.schema=e,t.model=n,t.isCompiled()||(t.setupConfig(r),e.forms?c.each(e.forms,function(e){c.each(e.form,t.processField.bind(t))}):c.each(e.form,t.processField.bind(t)),t.initModelWatch(),t.initArrayCopyWatch(),t.isCompiled(!0)),t.broadcastErrors()}function k(e){var n=this;return e&&(n.schema.compiled=e),n.schema&&n.schema.compiled}function F(e){var n=this;e&&(e.formCtrl&&(n.formCtrl=e.formCtrl),e.updateSchema&&(n.updateSchema=e.updateSchema),e.getSchema&&(n.getSchemaForm=n.setupSchemaRefresh(e.getSchema)))}function $(e){var n=e.schema;e.getSchemaType=function(){return c.isArray(n.type)?c.first(n.type):n.type},e.type||(e.type=e.getSchemaType&&e.getSchemaType())}function C(e){var n=this,r=e.schema,t=e.default||r.default,o=n.getKey(e.key);if(n.skipDefault[o])return void delete n.skipDefault[o];if(!n.updates&&e.updateSchema&&angular.isDefined(t)&&!n.schema.params[o]&&(n.schema.params[o]=t),!c.isUndefined(t)){if(o.includes&&o.includes("[]"))return;var a=n.parseExpression(e.key,n.model),s=a.get();(c.has(n.defaults,o)?angular.equals(s,n.defaults[o]):c.isTrulyEmpty(s))&&!angular.equals(s,t)&&a.set(angular.copy(t))}n.defaults[o]=angular.copy(t),"url"!==r.format||e.validationMessage||(e.type||(e.type="url"),e.validationMessage="Must be a valid url (https://...)")}function S(e){var n=this;e.type="cn-fieldset",e.items.forEach(n.processField.bind(n)),c.has(e,"pos")&&0===e.pos&&(e.htmlClass=(e.htmlClass||"")+" borderless"),e.collapsible?(e.toggleCollapse=function(e){e.collapsible&&(e.collapsed=!e.collapsed)},e.render=!e.collapsed):e.render=!0}function w(e,n){var r=this,t=a.getFieldType(e),o=f[t];c.isString(o)?r[o](e,n):c.isFunction(o)&&o.call(r,e,n)}function E(e){return c.reject(c.keys(e),function(e){return/^key$|^htmlClass$|^_/.test(e)})}function T(e,n){var r=this;angular.isDefined(n)&&(e.pos=n),e._ogKeys||(e._ogKeys=E(e));var t=r.getKey(e.key);if(t){r.addToFormCache(e,t);var o=r.getSchema(t);o&&(e.schema=o,o.description&&(e.description=o.description),e.readonly&&!o.readonly&&(e.readonly=!1),"array"!==o.type||"showClearAll"in e||(e.showClearAll=!0)),r.processSchema(e)}r.processFieldProps(e),t&&(!function(e){c.find(r.errors,{key:e})&&(r.errors=c.reject(r.errors,{key:e}),u.$broadcast("schemaForm.error."+e,"schemaForm",!0),u.$broadcast("schemaForm.error."+e,"serverValidation",!0))}(He(t)),e.error&&(r.errors.push(r.buildError(e)),c.isEmpty(e.ngModelOptions)?e.ngModelOptions={allowInvalid:!0}:e.ngModelOptions.allowInvalid=!0))}function M(e,n){var r=this;d.forEach(function(t){var o=t.prop,a=t.handler;return c.has(e,o)&&a(e,r,n)})}function j(e){return c.isArray(e)&&(e=c.reduce(e,function(e,n){return/^(-?\d*)$/.test(n)?e+"["+n+"]":e+"."+n})),e}function A(e,n){var r=this;if(e){e=l.parse(r.getKey(e)),n=n||r.schema.schema.properties;for(var t=void 0,o=void 0;e.length>1;)t=e[0],o=e[1],/^-?\d*$/.test(o)?2===e.length?n=n=n[e.shift()]:(n=n[e.shift()].items.properties,e.shift()):n=n[e.shift()].properties;return t=e[0]||"items",n[t]}}function D(e){var n=this;return e=e.key?e:n.getFromFormCache(e),e&&(angular.isDefined(e.default)?e.default:e.schema&&e.schema.default)}function P(e){for(var n=[],r=ce(e),t="";r;)/^-?\d+$/.test(r[1])||/^("|').*("|')$/.test(r[1])?(t=r[0],e=e.replace(r[0],"ff_replace_ff")):(n.push(r[1].replace(/ff_replace_ff/g,t)),t="",e=e.replace(r[0],"")),r=ce(e);return[].concat(n,[e.replace(/ff_replace_ff/g,t)])}function I(e){var n=this,r=n.getKey(e.key);return c.each(e.resolve,function(t,o){t=We(t,r||e.arrayIndex),t.includes("[arrayIndex]")||(n.handleResolve(e,o,t,!0),P(t).forEach(function(r){var a=r.match(/(schema\.data\.|model\.)(\S+)/)||[],s=i(a,3),c=s[1],l=s[2];c&&("schema.data."===c?n.registerResolve(e,o,l,t):"model."===c&&n.registerHandler(l,function(){n.handleResolve(e,o,t)}))}))}),e}function _(e,n,r,t){var o=this,a=void 0;if(r.includes(" || "))for(var s=r.split(" || "),i=0,c=s.length;i<c;i++){var l=o.parseExpression(s[i]).get();if(angular.isDefined(l)){a=l;break}}else if(r.includes(" && "))for(var f=r.split(" && "),m=0,u=f.length;m<u;m++){var p=o.parseExpression(f[m]).get();if(!angular.isDefined(p)){a=void 0;break}a=p}else a=o.parseExpression(r).get();if(!a&&0===r.indexOf("model.")){var h=r.replace("model.",""),g=z(h),v=o.getFromFormCache(h)||o.getFromFormCache(g);a=function(){if(v&&v.default)return v.default;if(angular.isDefined(e.default))return e.default;var n=o.getSchema(g);return n?n.default:void 0}()}a&&a.cursor?e.loadMore=function(){var e=r.match(/schema\.data\.(.+)/)[1];o.refreshSchema("data:"+e+":"+a.cursor)}:delete e.loadMore,e[n]=a&&a.data?a.data:a,t||d.forEach(function(r){var t=r.prop,a=r.handler;return t===n&&a(e,o)})}function O(e,n,r,t){var o=this,a=o.getKey(e.key);o.resolveRegister[r]=o.resolveRegister[r]||{};var s=o.resolveRegister[r];s[a]=s[a]||[],s[a].push({field:e,prop:n,exp:t})}function K(e){var n=this;c.each(e.conditionals,function(r,t){var o=function(o,a){e[t]=n.parseCondition(r);var s=n.getFromScopeCache(n.getKey(e.key));"required"===t&&s&&u.$broadcast("schemaFormValidate")};e.conditionals[t].match(/model\.([^\s]+)/g).map(function(e){return e.match(/model\.([^\s]+)/)[1]}).forEach(function(e){n.registerHandler(e,o)}),o()})}function R(e){var r=this;if(e.watch){var t=e.schema;e.watch=c.isArray(e.watch)?e.watch:[e.watch],c.each(e.watch,function(o){if(o.resolution){var a=o.condition,s=o.resolution,i=void 0;if(c.isFunction(s))i=function(e,n){a&&!r.parseCondition(a)||s(e,n)};else{var l={};l.date=s.match(/\+ ?(\d+) days/),l.date?(l.date=l.date[1],s=s.replace(l.date,"").trim()):(l.math=s.match(/(\+|\-|\/|\*) ?(\S+)/),l.math&&(l.operator={"+":"add","-":"subtract","*":"multiply","/":"divide"}[l.math[1]],l.adjuster=r.parseExpression(l.math[2]))),s=s.match(/(\S+) ?= ?(\S+)/),i=function(o,i,f,d){var m=a&&We(a,f),u=We(s[1],f),p=We(s[2],f),h=r.parseExpression(u);if(d!==h.path().key){d=h.path().key;var g=r.parseExpression(p);if(!a||r.parseCondition(m))if(l.date)h.set(moment(g.get()).add(l.date,"days").toDate());else if(l.math){var v=n(g.get()+l.math[1]+l.adjuster.get())();if(t=t||e.items&&(e.items[0].schema||e.items[0].items&&e.items[0].items[0].schema),"cn-currency"===e.type){var y=t&&"currency-dollars"===t.format?2:0;v="*"===l.math[1]?c.floor(v,y):"/"===l.math[1]?c.ceil(v,y):c.round(v,y)}r.listeners[d]&&(r.listeners[d].trigger=f),h.set(v||0)}else h.set(g.get())}}}r.registerHandler(e,i,e.updateSchema,o.initialize)}})}}function U(e){var r=this;if(e.startsWith("_")){var t=/^_\.(.*?)\((.*?),[\s(]*(.*?)\)?\s*=>[{\s]*(?:return)?(.*?)\}?\)$/,o=e.match(t),a=i(o,5),s=a[1],l=a[2],f=a[3],d=a[4];return c[s](n(l)(r),H(f,d))}return n(e)(r)}function H(e,r){return function(){for(var t=arguments.length,o=Array(t),a=0;a<t;a++)o[a]=arguments[a];return n(r)(e.replace(/\s/g,"").split(",").reduce(function(e,n,r){return e[n]=o[r],e},{}))}}function L(e,n,r,t){var o=this;if(c.isObject(e)&&!c.isArray(e)){if(!e.key&&e.items)return void c.each(e.items,function(e){o.registerHandler(e,n,e.updateSchema)});e=e.key}e=o.getKey(e);var a=e.match(/(.*)\[]\.?(.*)/);if(a)return void o.registerArrayHandlers(a[1],a[2],n,r,t);var s=o.parseExpression(e,o.model).get(),i=c.get(o.getSchema(e),"default");if(!o.listeners[e]){var l=c.isUndefined(s)?angular.copy(i):angular.copy(s);o.listeners[e]={handlers:[],updateSchema:r,prev:l}}n&&(o.listeners[e].handlers.push(n),t&&n(s,null,e))}function q(e,n,r,t,o){var a=this,s=function(s,i,c){if(i||0===i||!((0|s)<1)){var l,f,d;if(i>s||c){var m=n?e+"["+(i-1)+"]."+n:e+"["+(i-1)+"]";if(a.listeners[m])for(l=0,f=i;l<f;l++)d=n?e+"["+l+"]."+n:e+"["+l+"]",a.deregisterHandlers(d);for(l=0,f=s;l<f;l++)d=n?e+"["+l+"]."+n:e+"["+l+"]",a.registerHandler(d,r,t)}else if(s>(i||0))for(l=0|i,f=s;l<f;l++)d=n?e+"["+l+"]."+n:e+"["+l+"]",a.registerHandler(d,r,t,o)}},i=a.parseExpression(e,a.model).get();c.each(i,function(s,i){var c=n?e+"["+i+"]."+n:e+"["+i+"]";a.registerHandler(c,r,t),o&&r(null,null,c)});var l=e+".length";a.arrayListeners[l]?a.arrayListeners[l].handlers.push(s):a.arrayListeners[l]={handlers:[s],prev:i?i.length:0}}function W(e){var n=this;e=n.getKey(e);var r=e.match(/([^[\]]*)\[]\.?(.*)/);return r?void n.deregisterArrayHandlers(r[1],r[2]):void(n.listeners[e]&&(n.listeners[e].handlers=[]))}function N(e,n){var r=this;r.parseExpression(e,r.model).get().forEach(function(t,o){n?r.deregisterHandlers(e+"["+o+"]."+n):r.deregisterHandlers(e+"["+o+"]")})}function V(){var e=this;e.watching||(e.modelWatch&&e.modelWatch(),e.modelWatch=u.$watch(function(){return e.model},e.onModelWatch.bind(e),!0),e.initSchemaParams(),e.watching=!0,e.firstUpdate=!0)}function Q(e,n){var r=this;!r.firstUpdate&&angular.equals(e,n)||(r.firstUpdate=!1,h.cleanModel(r.model),r.prevParams=angular.copy(r.params),c.each(r.arrayListeners,function(e,n){var t=r.parseExpression(n,r.model).get();angular.equals(t,e.prev)||(e.handlers.forEach(function(n){return n(t,e.prev)}),e.prev=angular.copy(t))}),c.each(r.listeners,function(e,n){if(e){var t=r.parseExpression(n,r.model).get(),o=angular.equals(t,[])&&!e.prev;angular.equals(t,e.prev)||o||(e.handlers.forEach(function(r){r(t,e.prev,n,e.trigger)}),e.trigger=null,e.prev=angular.copy(t)),!e.updateSchema||angular.isUndefined(t)||o||null===t?delete r.params[n]:r.params[n]=t}}),angular.equals(r.params,r.prevParams)||(r.model.id&&!r.updates&&c.isEmpty(r.prevParams)?r.incrementUpdates():r.refreshSchema()))}function B(){var e=this;c.each(e.listeners,function(n,r){if(n){var t=e.parseExpression(r,e.model).get();n.updateSchema&&!angular.isUndefined(t)&&null!==t&&(e.params[r]=t)}})}function z(e){return e.replace(/\[\d+]/g,"[]")}function G(){var e=this;e.events.push(u.$on("schemaFormPropagateFormController",function(n,r){var t=r.form;t.key||(t.cacheKey=t.type+"-"+c.uniqueId());var o=t.cacheKey||e.getKey(t.key);if(c.isNumber(r.arrayIndex)){var a=z(o),s=r.arrayIndex;t.arrayIndex=s,e.getArrayCopy(a,s)||e.processFieldProps(t,!0),t.condition?t.condition.includes("arrayIndex")&&(t.condition=e.replaceArrayIndex(t.condition,o)):t.condition="true",e.addArrayCopy(r,a,s),r.$emit("flexFormArrayCopyAdded",a)}else e.addToScopeCache(r,o)})),e.events.push(u.$on("schemaFormDeleteFormController",function(n,r,t){var o=e.getKey(r.form.key),a=e.listeners[o];a&&(a.handlers=[]);var s=z(o),i=e.getArrayCopiesFor(s);if(i.length||i.push(e.getArrayScopes(s)||[]),
i.forEach(function(e){return e&&e.splice(r.arrayIndex,1)}),r.form.link){var c=e.parseExpression(r.form.link,e.model).get();c.splice(t,1)}}))}function J(e,n,r){var t=this;(!r||r<0)&&(r=0),t.arrayCopies[n]||(t.arrayCopies[n]=[]),t.arrayCopies[n][r]=e}function X(e,n){var r=this,t=r.arrayCopies[e];return t&&t[n]}function Y(e){var n=this;return c.pluck(n.getArrayScopes(e),"form")}function Z(e){var n=this;return e+="[]",c.filter(n.arrayCopies,function(n,r){return r.includes(e)})}function ee(e){var n=this;return n.arrayCopies[e]}function ne(e,n){var r=this;return r.scopeCache[n]&&console.warn("caching duplicate scope for",n),r.scopeCache[n]=e}function re(e){var n=this;return n.scopeCache[e]}function te(e,n){var r=this;n=n||r.getKey(e.key),r.getFromFormCache(n)||(r.formCache[n]=e)}function oe(e){var n=this;return n.formCache[e]}function ae(e,n){var r=this;e&&(r.dataCache[e]=n)}function se(e){var n=this;return n.dataCache[e]}function ie(e){return e.match(/\[(-?\d+|".*"|'.*')]/)}function ce(e){for(var n=ie(e)||[],r=i(n,1),t=r[0],o=[];t;){o.push(t),e=e.replace(t,"ff_r"+(o.length-1)+"_ff");var a=ie(e)||[],s=i(a,1);t=s[0]}var c=e.match(/\[([^[\]]+)]([^[\]]*)/);return c&&o.length?c.map(function(e){for(var n=e.match(/ff_r(\d+)_ff/)||[],r=i(n,2),t=r[0],a=r[1];t;){e=e.replace(t,o[a]);var s=e.match(/ff_r(\d+)_ff/)||[],c=i(s,2);t=c[0],a=c[1]}return e}):c}function le(e,n){for(var r=this,t=ce(e)||[],o=i(t,2),a=o[1];a;){var s=r.parseExpression(a,n).get(),l=c.isUndefined(s)?"":c.isString(s)?'"'+s+'"':s;e=e.replace("["+a+"]","["+l+"]");var f=ce(e)||[],d=i(f,2);a=d[1]}return e}function fe(e,n){var r=this;if(!c.isString(e)&&!c.isArray(e))return{get:function(){return e}};if(/^(null|false|true|undefined|'[^\']*'|"[^\"]*"|-?[0-9.]+|\[]|\{})$/.test(e))return{get:function(){if(!e)return e;var n=e.match(/"([^\"]*)"/)||e.match(/'([^\']*)'/);if(n)return n[1];switch(e){case"null":return null;case"false":return!1;case"true":return!0;case"undefined":return;case"[]":return[];case"{}":return{};default:return parseFloat(e)}}};e=r.getKey(e);var t=e.match(/^(model\.)?(\S+)$/),o={get:function(){for(var t=r.resolveNestedExpressions(e,n),o=l.parse(t),a=n||r;a&&o.length>1;)a=a[o.shift()];return a&&a[o[0]]},getAssignable:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.noConstruction,a=r.resolveNestedExpressions(e,n),s=l.parse(a),i=[],c=n||r;c&&s.length>1;){var f=s.shift();if(i.push(f),!c[f]){if(o)return null;/^\d?$/.test(s[0])?c[f]=[]:c[f]={}}c=c[f]}return{obj:c,key:s[0],path:r.getKey(i),fullPath:r.getKey(i.concat(s.slice(0,1)))}},set:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.resolveNestedExpressions(e,n);l.parse(a);if("remove"===t){var s=this.getAssignable({noConstruction:!0})||{},i=s.obj,c=s.key;delete r.defaults[a.replace("model.","")],i&&delete i[c]}else{var f=this.getAssignable(),d=f.obj,m=f.key;d[m]=t}return o.silent&&(r.silenceListeners(a,n),r.skipDefaults(a)),t},path:function(){return{exp:e,depth:n,key:t[2]}}};return o}function de(e,n){var r=this;c.each(r.listeners,function(t,o){0===o.indexOf(e)&&(t.prev=angular.copy(r.parseExpression(o,n).get()))})}function me(e){var n=this,r=e.match(/\[\d*\]/)?Ne(e):null,t=z(e);c.each(n.formCache,function(e,o){if(o.startsWith(t)){var a=n.setArrayIndex(o,r);n.skipDefault[a]=!0}})}function ue(e){var n=this,r=n.getKey(e.key);e.sortOptions={update:function(e,t){var o=n.arrayListeners[r+".length"];o.handlers.forEach(function(e){e(o.prev,o.prev,!0)})}},n.processSection(e)}function pe(e,n){var r=this;n||c.each(e.items,r.processField.bind(r))}function he(e){var n=this;e.type="section",e.htmlClass="row";var r=12/c.reject(e.items,"hidden").length;c.each(e.items,function(t,o){n.processField(t),e.items[o]={type:"section",htmlClass:"col-sm-"+r,items:[t]}})}function ge(e){e.currencyFormat={"currency-dollars":"dollars","currency-microcents":"microcents",currency:"cents"}[e.schema.format],e.type="cn-currency"}function ve(e){e.type="cn-percentage"}function ye(e){var n=this;e.type="cn-reusable",e.view=e.view||"new",e.items.forEach(n.processField.bind(n)),e.items=[{type:"section",items:e.items,condition:"!model."+n.getKey(e.key)+".id"}]}function be(e){var n=this;e.type="cn-mediaupload",c.each(e.data,function(r,t){e.data[t]=n.parseExpression(r).get()})}function xe(e){e.type="cn-csvupload"}function ke(e){e.type="cn-radios"}function Fe(e){e.type="cn-radiobuttons",e.fullWidth&&(e.btnClass="col-sm-"+c.divide(12,e.titleMap.length))}function $e(e){e.type="cn-datetimepicker","time-minutes"===e.schema.format&&(e.maxView="hour",e.iconClass="fa fa-clock-o",e.modelFormatter=function(e){if(e){var n=moment(e);return c.add(c.multiply(n.hours(),60),n.minutes())}},e.modelParser=function(e){if(e){var n=parseInt(e),r=c.floor(n/60),t=n%60;return moment().startOf("day").add("hours",r).add("minutes",t)}},e.viewFormatter=function(n){if(n)return e.modelParser(n).format(e.dateFormat)},e.viewParser=function(e){if(e){var n=e.match(/^(\d{1,2}):?(\d{1,2})? (a|p)/);if(n){var r=c.add("12"===n[1]?0:n[1],"a"===n[3]?0:12),t=n[2]||"00";return 1===t.length&&(t+="0"),c.add(c.multiply(r,60),t)}}})}function Ce(e){var n="array"===e.getSchemaType();return e.valueProperty||"object"!==(n?e.schema.items.type:e.schema.type)&&"value"}function Se(e,n,r){r=r||e.getTitleMap();var t=Ce(e);if(t){if("array"===e.getSchemaType()){if(!n||!c.isArray(n))return;var a=n.map(function(e){return c.find(r,o({},t,e))}).filter(function(e){return void 0!==e});return a}return c.find(r,o({},t,n))}}function we(n){var r=this,t=n.schema;if((n.titleMapResolve||n.titleMap)&&(n.getTitleMap=function(){return n.titleMap||r.schema.data[n.titleMapResolve]},n.onInit=function(e,t,o,a){var s=r.parseExpression(t.key,r.model);if("tag-init"===o){var i=Se(n,s.get());void 0!==i&&a(i)}}),n.titleMapQuery){var o=n.titleMapQuery.params.q;n.titleQuery=function(r){var t={};return o&&(t[o]=r),e.get({url:n.titleMapQuery.url,params:t})},o||(n.minLookup="0"),n.onInit=function(e,n,r,t){"tag-init"===r&&t(e)}}if(t.items){var a=[];c.each(t.items.properties,function(e,n){angular.isDefined(e.default)&&a.push({key:n,default:e.default})}),a.length&&(n.onAdd=function(e,n,r){e.value&&"tag-added"===r&&c.each(a,function(n){e.value[n.key]||(e.value[n.key]=n.default)})})}n.displayFormat&&(n.itemFormatter=r.processTemplate(n.displayFormat)),n.type.includes("cn-autocomplete")||(n.items?(n.detailedList=!0,"component"!==n.items[0].type&&(n.items.length>1&&(c.each(n.items,function(e){return e.destroyStrategy="retain"}),n.items=[{type:"component",items:n.items}]),r.processFieldset(n)),n.type="cn-autocomplete-detailed",n.destroyStrategy="retain"):(n.selectionStyle||(n.selectionStyle="tags"===n.key?"tags":"array"===n.getSchemaType()&&1!==n.schema.maxItems?"list":"select"),n.type="cn-autocomplete"),n.titleMapResolve&&u.$on("cnFlexFormDiff:data",function(e,t){if(t[n.titleMapResolve]){var o=r.parseExpression(n.key,r.model),a=o.get();if(void 0!==a){var s=Se(n,a,t[n.titleMapResolve]);void 0===s&&o.set()}}}),r.registerHandler(n.key,function(e){var t=r.formCtrl&&r.formCtrl[r.getKey(n.key)];t&&t.$setDirty&&t.$setDirty()},n.updateSchema))}function Ee(e){e.type="cn-toggle"}function Te(e){e.htmlClass="help-block"}function Me(e){var n=this;e.type="cn-display",e.getDisplay=n.processTemplate(e.displayFormat,!0)}function je(e,n){var r=this,t=m;return function(o,a){return n&&(angular.isDefined(a)&&(o=c.map(o,function(e){return"arrayIndex"===e?a:e})),o=r.parseExpression(o,r.model).get()),t(e)(o)}}function Ae(e){var n=this;e.type="cn-table",e.items.forEach(function(r){for(var t=0;t<e.columns.length;t++)c.extend(r.items[t],e.columns[t]),n.processField(r.items[t])})}function De(e){var n,r=this,t=r.getSchema(e.key),o=c.find(e.items,"selectField");n=t&&"array"===t.type?r.setupArraySelectDisplay(e,o):r.setupSelectDisplay(e,o),e.selectDisplay=!1,r.registerHandler(o.key,n,o.updateSchema,!0)}function Pe(e,n){var r=this;c.each(e.items,function(e){"false"!==e.condition&&(e.condition="true")});var t=function(t,o,a){var s=Ne(a);c.each(e.items,function(e){var t=r.getKey(n.key),o=r.getKey(e.key),a=l.parse(o);if(t!==o){var i=r.setArrayIndex(t,s),f=r.parseExpression(i,r.model).get(),d=r.getArrayCopies(o);c.includes(f,a[a.length-1])?c.each(d,function(e){Ne(e)==s&&(e.condition="true")}):c.each(d,function(e){Ne(e)==s&&(e.condition="false",r.parseExpression(r.getKey(e.key),r.model).set())})}})},o=r.parseExpression(r.getKey(e.key),r.model).get();c.each(e.items,function(e){var t=r.getKey(e.key),a=r.getKey(n.key);t!==a&&c.each(o,function(e,n){var o=r.setArrayIndex(t,n),s=l.parse(o),i=r.setArrayIndex(a,n),f=r.parseExpression(i,r.model),d=f.get(),m=r.parseExpression(o,r.model).get();m&&!c.includes(d,s[s.length-1])&&(d||(d=[]),d.push(s[s.length-1]),f.set(d))})});var a=r.getSchema(e.key).default;c.each(a,function(e,t){var o=r.getKey(n.key),a=r.setArrayIndex(o,t),s=r.parseExpression(a,r.model),i=s.get();c.each(e,function(e,n){i||(i=[]),i.push(n),s.set(i)})});var s=0,i=c.pluck(c.reject(e.items,{condition:"false"}),"key"),f=u.$on("flexFormArrayCopyAdded",function(n,o){var a=r.parseExpression(r.getKey(e.key),r.model).get();if(a){var l=a.length*i.length;if(c.includes(i,o)&&s++,s===l){for(var f=0;f<a.length;f++)t(null,null,"["+f+"]");s=0}}}),d=u.$on("flexForm.updatePage",function(){s=0});return r.events.push(f),r.events.push(d),t}function Ie(e,n){var r=this,t=function(){var t=r.getKey(n.key);c.each(e.items,function(e){var n=r.getKey(e.key),o=l.parse(n);if(t!==n){var a=r.parseExpression(t,r.model).get();c.includes(a,o[o.length-1])?e.condition="true":(e.condition="false",r.parseExpression(n,r.model).set())}})},o=r.getKey(n.key),a=r.parseExpression(o,r.model),s=a.get();c.each(e.items,function(e){var n=r.getKey(e.key);if(o!==n){var t=l.parse(n),i=r.parseExpression(n,r.model).get();i&&!c.includes(s,t[t.length-1])&&(s||(s=[]),s.push(t[t.length-1]),a.set(s))}});var i=r.getSchema(e.key).default;c.each(i,function(e,n){s||(s=[]),s.push(n),a.set(s)});var f=r.parseExpression(e.key,r.model);return i&&!f.get()&&f.set(i),t}function _e(e){var n=this;n.refreshSchema=c.debounce(function(t){var o,a=c.extend(r.getStateParams(),n.params),s=c.omit(h.diff(n.schema.params,a,!0),"updates");c.isEmpty(s)&&!t||(t?a.updateSchema=t:(o=c.keys(s),o.length>1&&(s=c.omit(s,c.isNull),o=c.keys(s)),a.updateSchema=c.first(o)),a.updateSchema||(s=h.diff(a,c.omit(n.schema.params,["updateSchema","updates"])),o=c.keys(s),a.updateSchema=c.first(o)),e(a).then(function(e){n.incrementUpdates(),n.processUpdatedSchema(e)}))},100),n.refreshData=c.debounce(function(){e(c.extend(n.schema.params,{updateSchema:"refreshData"})).then(function(e){n.processUpdatedSchema(e)})},100),n.events.push(u.$on("ffRefreshData",n.refreshData))}function Oe(e){var n=this;if(e.diff){n.schema.params=e.params,e.diff.data&&(u.$broadcast("cnFlexFormDiff:data",e.diff.data),c.each(e.diff.data,function(e,r){e&&e.data&&!c.isEmpty(n.schema.data[r].data)&&!e.reset&&(e.data=n.schema.data[r].data.concat(e.data)),n.schema.data[r]=e,n.resolveRegister[r]&&c.each(n.resolveRegister[r],function(e){e.forEach(function(e){n.handleResolve(e.field,e.prop,e.exp)})})}));var r=[];e.diff.schema&&(u.$broadcast("cnFlexFormDiff:schema",e.diff.schema),c.each(e.diff.schema,function(e,t){n.schema.schema.properties[t]=e,Ue(e,t,r)})),e.diff.form&&(u.$broadcast("cnFlexFormDiff:form",e.diff.form),c.each(e.diff.form,function(e,t){r.includes(t)||r.push(t),c.each(n.getFormsToProcess(t),function(r){return r&&n.reprocessField(r,e)})})),r.length&&c.each(r,function(e){c.each(n.getFormsToProcess(e),function(e){return e&&n.processField(e)})}),n.broadcastErrors()}else n.updateSchema(e)}function Ke(e){var n=this,r=e.match(/\[(\d)+]/)||[],o=i(r,2),a=o[1],s=n.getArrayCopies(e.replace(/\[\d+]/g,"[]"));if(c.isUndefined(a)){var l=n.getFromFormCache(e);return[l].concat(t(s))}return[s[a]]}function Re(e,n,r){var t=this,o=t.getKey(e.key);!n.condition&&e.condition&&(n.condition="true");var a=!r&&e.condition!==n.condition;c.extend(e,c.omit(n,"items","key")),e._ogKeys.forEach(function(r){n[r]||delete e[r]}),e._ogKeys=E(n),t.deregisterHandlers(o),u.$broadcast("cnFlexFormReprocessField",o),a&&e.redraw&&(console.log("TODO: see if this can be removed"),e.redraw())}function Ue(e,n,r){r.push(n),e.properties&&c.each(e.properties,function(e,t){Ue(e,n+"."+t,r)}),e.items&&e.items.properties&&c.each(e.properties,function(e,t){Ue(e,n+"[]."+t,r)})}function He(e){return(c.isString(e)?l.parse(e):e).join(".")}function Le(e){return{key:He(e.key),message:e.error}}function qe(){var e=this;p(function(){e.errors.forEach(function(e){u.$broadcast("schemaForm.error."+e.key,"serverValidation",e.message)})},1)}function We(e,n){for(;e.includes("arrayIndex");){if(c.isNumber(n))return e.replace(/arrayIndex/g,n);var r=/([^.[]*)\[arrayIndex\]/.exec(e),t=new RegExp(r[1]+"\\[(-?\\d+)\\]"),o=t.exec(n);if(!o)return e;e=e.replace(new RegExp(r[0].replace(/(\[|\])/g,"\\$1"),"g"),o[0])}return e}function Ne(e){return c.isObject(e)?c.find(e.key,function(e){return c.isNumber(e)}):/\[(\d+)\]/.exec(e)[1]}function Ve(e,n,r){var t,o=this;t=c.isString(e)?l.parse(e):c.clone(e);var a=t.indexOf("");return t[a]=n,r?t:o.getKey(t)}function Qe(){var e=this;c.each(e.events,function(e){e()})}function Be(){var e=this;++e.updates,e.params.updates=e.updates}var ze=[],Ge={compile:x,addArrayCopy:J,addToDataCache:ae,addToFormCache:te,addToScopeCache:ne,broadcastErrors:qe,buildError:Le,cleanup:Qe,deregisterHandlers:W,deregisterArrayHandlers:N,getArrayCopy:X,getArrayCopies:Y,getArrayCopiesFor:Z,getArrayScopes:ee,getDefault:D,getFromDataCache:se,getFromFormCache:oe,getFromScopeCache:re,getFormsToProcess:Ke,getKey:j,getSchema:A,getWatchables:P,handleResolve:_,incrementUpdates:Be,initArrayCopyWatch:G,initModelWatch:V,initSchemaParams:B,isCompiled:k,onModelWatch:Q,parseCondition:U,parseExpression:fe,processArray:ue,processDefault:C,processDisplay:Me,processField:T,processFieldset:S,processFieldProps:M,processFieldType:w,processFieldWatch:R,processComponent:he,processConditional:K,processCurrency:ge,processPercentage:ve,processDate:$e,processHelp:Te,processRadios:ke,processRadiobuttons:Fe,processReusable:ye,processSchema:$,processSelectDisplay:De,processResolve:I,processSection:pe,processSelect:we,processTable:Ae,processTemplate:je,processToggle:Ee,processUpdatedSchema:Oe,processMediaUpload:be,processCsvUpload:xe,registerArrayHandlers:q,registerHandler:L,registerResolve:O,replaceArrayIndex:We,reprocessField:Re,resolveNestedExpressions:le,setArrayIndex:Ve,setupConfig:F,setupArraySelectDisplay:Pe,setupSelectDisplay:Ie,setupSchemaRefresh:_e,silenceListeners:de,skipDefaults:me};return c.extend(b.prototype,Ge),c.extend(y,Ge,{getService:v}),y}a.$inject=["schemaFormDecoratorsProvider","cnFlexFormTypesProvider"],s.$inject=["Api","$parse","cnFlexFormConfig","cnFlexFormTypes","sfPath","$interpolate","$rootScope","$timeout","cnUtil","$stateParams"],Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,n){var r=[],t=!0,o=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done)&&(r.push(s.value),!n||r.length!==n);t=!0);}catch(e){o=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(o)throw a}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c="undefined"!=typeof window&&window._||r(6),l="undefined"!=typeof window&&window.ObjectPath||r(7),f={fieldset:"processFieldset","cn-radios":"processRadios","cn-radiobuttons":"processRadiobuttons","cn-autocomplete":"processSelect","cn-datetimepicker":"processDate",help:"processHelp","cn-display":"processDisplay","cn-currency":"processCurrency","cn-percentage":"processPercentage","cn-mediaupload":"processMediaUpload","cn-csvupload":"processCsvUpload","cn-reusable":"processReusable","cn-toggle":"processToggle","cn-table":"processTable",component:"processComponent",section:"processSection",tabarray:"processSection",array:"processArray"},d=[{prop:"resolve",handler:function(e,n){return n.processResolve(e)}},{prop:"selectDisplay",handler:function(e,n){return n.processSelectDisplay(e)}},{prop:"watch",handler:function(e,n){return e.watch&&n.processFieldWatch(e)}},{prop:"type",handler:function(e,n,r){return n.processFieldType(e,r)}},{prop:"conditionals",handler:function(e,n){return n.processConditional(e)}},{prop:"default",handler:function(e,n){return n.processDefault(e)}},{prop:"schema",handler:function(e,n){return c.isUndefined(e.default)&&!c.isUndefined(e.schema.default)&&n.processDefault(e)}},{prop:"updateSchema",handler:function(e,n){return n.registerHandler(e,null,e.updateSchema)}}];n.default=a},function(n,r){n.exports=e},function(e,r){e.exports=n},function(e,n){"use strict";function r(e){if(i[e])return i[e];var n={};return i[e]=n,n}function t(e,n,t){var o=r(e);if(o[n])return o[n];var a=t.defer();return o[n]=a,a}function o(){function e(e,r){r.resolve={parent:n},s[e]=r}function n(e,n){"ngInject";return t(e.modal,e.modalId,n).promise.then(function(e){var n=e.parent;return n})}return n.$inject=["$stateParams","$q"],{addMapping:e,$get:a}}function a(e,n){"ngInject";function r(e,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.scope;i&&(i.options=i.options||{},i.options.destroyStrategy="retain",s[e].scope=i);var c=t(e,r,n);return c.resolve({parent:o,options:a}),c.promise}function o(r){var o=n.defer();return t(e.modal,e.modalId,n).promise.then(function(e){var n=e.parent,t=e.options;return o.resolve({state:s[r],options:t}),n}),o.promise}return{getMapping:o,resolveMapping:r}}a.$inject=["$stateParams","$q"],Object.defineProperty(n,"__esModule",{value:!0});var s={},i={};n.default=o},function(e,n){"use strict";function r(e,n,r,t){"ngInject";function o(){e.open(i).then(function(e){var n=e.modal,o=e.options,c=o.onDismiss;o.onAfterDismiss;i.modal=n,i.modal.result.finally(a),c&&i.modal.result.catch(function(){return c(t.restParams)}),i.dismissEvent=r.$on("$stateChangeStart",s)})}function a(){n.transition||n.go("^")}function s(){console.log("dismissModal"),i.dismissEvent(),i.modal.dismiss()}var i=this;o()}function t(e,n,r){"ngInject";function t(){return e.getMapping(r.modal).then(function(e){var r=e.state,t=e.options;return{modal:n.open(r),options:t}})}return{open:t}}r.$inject=["FlexFormModal","$state","$rootScope","$stateParams"],t.$inject=["cnFlexFormModalLoaderService","$uibModal","$stateParams"],Object.defineProperty(n,"__esModule",{value:!0}),n.FlexFormModalLoader=r,n.FlexFormModal=t},function(e,n,r){(function(e){"use strict";function r(){return{restrict:"E",template:'\n      <div ng-if="vm.showForm()">\n        <ng-form \n          class="clearfix"\n          name="{{vm.formName}}"\n          sf-schema="vm.config.schema.schema"\n          sf-form="vm.form"\n          sf-model="vm.model">\n        </ng-form>\n        <!-- debug panel to display model -->\n        <section ng-if="vm.debug">\n          <json-explorer json-data="vm.model || \'...model not loaded yet\'"/>\n        </section>\n      </div>\n    ',scope:{config:"=ffConfig",model:"=ffModel",formIndex:"=ffFormIndex",formName:"=ffFormName",delayForm:"=ffDelayForm",cleanupEvent:"=ffCleanupEvent"},controller:t,controllerAs:"vm",bindToController:!0}}function t(e,n,r){"ngInject";function t(){angular.isNumber(c.formIndex)?c.form=c.config.schema.forms[c.formIndex].form:c.form=c.config.schema.form,r.search().debug&&(c.debug=!0)}function o(n,r){c.form&&(c.service?(console.log("vm.service.isCompiled():",c.service.isCompiled()),c.service.compile(c.config.schema,c.model)):c.service=e(c.config.schema,c.model,{formCtrl:c.config.formCtrl,getSchema:c.config.getSchema,updateSchema:s}))}function a(){return!c.delayForm&&c.service&&c.service.isCompiled()}function s(e){c.config.schema=e,c.activate()}function i(){_.each(c.events,function(e){e()}),c.service.cleanup()}var c=this;c.service=void 0,c.events=[],c.activate=t,c.cleanup=i,c.process=o,c.showForm=a,c.events.push(n.$watch(function(){return c.config.schema},c.process)),c.activate(),n.$on(c.cleanupEvent||"$destroy",c.cleanup)}t.$inject=["cnFlexFormService","$scope","$location"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=r}).call(n,r(11))},function(e,n){function r(){throw new Error("setTimeout has not been defined")}function t(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(n){try{return f.call(null,e,0)}catch(n){return f.call(this,e,0)}}}function a(e){if(d===clearTimeout)return clearTimeout(e);if((d===t||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(n){try{return d.call(null,e)}catch(n){return d.call(this,e)}}}function s(){h&&u&&(h=!1,u.length?p=u.concat(p):g=-1,p.length&&i())}function i(){if(!h){var e=o(s);h=!0;for(var n=p.length;n;){for(u=p,p=[];++g<n;)u&&u[g].run();g=-1,n=p.length}u=null,h=!1,a(e)}}function c(e,n){this.fun=e,this.array=n}function l(){}var f,d,m=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{d="function"==typeof clearTimeout?clearTimeout:t}catch(e){d=t}}();var u,p=[],h=!1,g=-1;m.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new c(e,n)),1!==p.length||h||o(i)},c.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=l,m.addListener=l,m.once=l,m.off=l,m.removeListener=l,m.removeAllListeners=l,m.emit=l,m.binding=function(e){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(e){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(e,n){"use strict";function r(){return{restrict:"E",scope:{config:"=ffHeaderConfig",submit:"&ffSubmit",loadOffscreen:"&ffLoadOffscreen"},controller:t,bindToController:!0,controllerAs:"vm",template:'\n        <div class="col-md-6">\n          <h5 ng-if="vm.title.lead">{{::vm.title.lead}}</h5>\n          <h1>\n            <i ng-show="vm.title.icon" class="{{vm.title.icon}}"/>\n            {{vm.title.main}}\n          </h1>\n          <h5 ng-if="vm.title.sub">{{::vm.title.sub}}</h5>\n        </div>\n        <div class="{{vm.buttonContainerClass || \'page-action-btns\'}}">\n          <div class="btn-options"\n               ng-mouseover="vm.loadOffscreen()">\n            <a class="btn btn-{{vm.returnStyle ? vm.returnStyle : \'default-dark\'"\n               ng-if="vm.returnState"\n               ui-sref="{{vm.returnState}}">\n              {{vm.returnText || \'Cancel\'}}\n            </a>\n            <a class="btn btn-{{vm.closeButton.style ? vm.closeButton.style : \'default-dark\'}}"\n               ng-if="vm.closeButton"\n               ng-click="vm.closeButton.handler()">\n               Cancel\n            </a>\n            <span ng-repeat="button in vm.actions">\n              <span ng-class="{\'btn-group\': button.options}">\n                <a class="btn {{button.style ? \'btn-\'+button.style : ($index === vm.actions.length - 1 ? \'btn-primary\' : \'btn-default-dark\')}}"\n                   ng-disabled="vm.isDisabled(button)"\n                   ng-click="vm.submit({handler: button.handler})"\n                   uib-tooltip="{{button.helptext}}"\n                   uib-tooltip-placement="bottom"\n                   ng-bind-html="button.text || \'Save\'">\n                </a>\n                <a class="btn {{button.style ? \'btn-\'+button.style : ($index === vm.actions.length - 1 ? \'btn-primary\' : \'btn-default-dark\')}} dropdown-toggle"\n                        ng-disabled="vm.isDisabled(button)"\n                        ng-show="button.options"\n                        data-toggle="dropdown">\n                  <span class="caret"></span>\n                </a>\n                <ul class="dropdown-menu" ng-if="button.options">\n                  <li ng-repeat="option in button.options"\n                      ng-disabled="vm.isDisabled(option)">\n                    <a ng-click="vm.submit({handler: option.handler})"\n                       ng-bind-html="option.text">\n                    </a>\n                  </li>\n                </ul>\n              </span>\n            </span>\n          </div>\n          <p class="data-updated-at text-right"\n             id="data-updated-at"\n             ng-hide="vm.config.noData">\n            <a ng-click="vm.updateData()">Update Data</a>\n          </p>\n        </div>'}}function t(e){"ngInject";function n(){o.title=o.config.title;var e=o.config.actionConfig||{};o.returnState=e.returnState,o.returnStyle=e.returnStyle,o.returnText=e.returnText,o.closeButton=e.closeButton,o.actions=e.actions}function r(){console.log("updateData:",r),e.$emit("ffRefreshData")}function t(e){return!!o.config.isDisabled&&o.config.isDisabled(e)}var o=this;o.updateData=r,o.isDisabled=t,n()}t.$inject=["$scope"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},function(e,n){"use strict";function r(){return{restrict:"A",scope:{form:"=ffValidate"},require:"ngModel",link:t}}function t(e,n,r,t){e.form&&e.form.required&&e.$watch(function(){return t.$viewValue},function(e){t.$setValidity("schemaForm",!0),t.$setValidity("tv4-302",e)})}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r}])});
//# sourceMappingURL=all.min.js.map