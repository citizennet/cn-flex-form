!function(){"use strict";angular.module("cn.flex-form",["ui.router","schemaForm","ui.bootstrap.datetimepicker","cnTagsInput","cn.util"])}(),function(){"use strict";function e(e,r,t,o){function a(){i.modal=e.open(i),i.modal.result["finally"](s),i.dismiss=t.$on("$stateChangeStart",n)}function s(){r.go("^")}function n(){i.dismiss(),i.modal.dismiss()}var i=this;console.log("FlexFormModalLoader:",o.modal),a()}function r(e,r,t){function o(){var o=e.getMapping(t.modal);return console.log("currentModal:",o),this.modal=r.open(o),this.modal}var a={open:o};return a}angular.module("cn.flex-form").controller("FlexFormModalLoader",e).factory("FlexFormModal",r),e.$inject=["FlexFormModal","$state","$rootScope","$stateParams"],r.$inject=["cnFlexFormModalLoaderService","$modal","$stateParams"]}(),function(){"use strict";function e(e){var r=s[e];return r||(r={},s[e]=r),r}function r(r,t,o){var a=e(r),s=a[t];return s||(s=o.defer(),a[t]=s),s}function t(){function e(e,r){r.resolve={parent:t},a[e]=r}function t(e,t){return r(e.modal,e.modalId,t).promise}var s={addMapping:e,$get:o};return t.$inject=["$stateParams","$q"],s}function o(e){function t(t,o,a){r(t,o,e).resolve(a)}function o(e){return a[e]}var s={getMapping:o,resolveMapping:t};return s}angular.module("cn.flex-form").provider("cnFlexFormModalLoaderService",t);var a={},s={};o.$inject=["$q"]}(),function(){"use strict";function e(){return{restrict:"A",scope:{form:"=ffValidate"},require:"ngModel",link:r}}function r(e,r,t,o){e.form&&e.form.required&&e.$watch(function(){return o.$viewValue},function(e){o.$setValidity("schemaForm",!0),o.$setValidity("tv4-302",e)})}angular.module("cn.flex-form").directive("ffValidate",e)}(),function(){"use strict";function e(){return{restrict:"E",template:'        <div ng-if="vm.showForm()">          <ng-form name="{{vm.formName}}"                sf-schema="vm.config.schema.schema"                sf-form="vm.form"                sf-model="vm.model"></ng-form>        </div>      ',scope:{config:"=ffConfig",model:"=ffModel",formIndex:"=ffFormIndex",formName:"=ffFormName",delayForm:"=ffDelayForm"},controller:r,controllerAs:"vm",bindToController:!0}}function r(e,r){function t(){angular.isNumber(i.formIndex)?i.form=i.config.schema.forms[i.formIndex].form:i.form=i.config.schema.form}function o(r,t){i.form&&(i.service?(console.log("vm.service.isCompiled():",i.service.isCompiled()),i.service.compile(i.config.schema,i.model)):i.service=e(i.config.schema,i.model,{formCtrl:i.config.formCtrl,getSchema:i.config.getSchema,updateSchema:s}))}function a(){return!i.delayForm&&i.service&&i.service.isCompiled()}function s(e){i.config.schema=e,i.activate()}function n(){_.each(i.events,function(e){e()}),i.service.cleanup()}var i=this;i.service=void 0,i.events=[],i.activate=t,i.cleanup=n,i.process=o,i.showForm=a,i.events.push(r.$watch(function(){return i.config.schema},i.process)),i.activate(),r.$on("$destroy",i.cleanup)}angular.module("cn.flex-form").directive("cnFlexForm",e),r.$inject=["cnFlexFormService","$scope"]}(),function(){function e(e){function r(){}function t(r){e.state(r.name+".page.modal",{url:"/~:modal/:modalId",controller:"FlexFormModalLoader",controllerAs:"vm",permissions:r.permissions})}var o={addStates:t,$get:r};return o}function r(e){e.state("flex-form-sandbox",{url:"/flex-form/sandbox",controller:"FlexFormSandbox",controllerAs:"vm",templateUrl:"app/components/cn-flex-form/sandbox.html"})}angular.module("cn.flex-form").provider("cnFlexFormRoutes",e).config(r),e.$inject=["$stateProvider"],r.$inject=["$stateProvider"]}(),function(){"use strict";function cnFlexFormServiceProvider(e){function r(r){r.condition&&r.handler&&fieldTypeRegister.unshift(r),r.type&&r.templateUrl&&(e.addMapping("bootstrapDecorator",r.type,r.templateUrl),e.createDirective(r.type,r.templateUrl))}return{registerField:r,$get:CNFlexFormService}}function CNFlexFormService(Api,$parse,$q,$stateParams,$interpolate,$compile,$rootScope,$timeout,cnUtil){function CNFlexFormConstructor(e,r,t){var o;if(services.length)for(var a=0,s=services.length;s>a;a++)if(services[a].model===r){o=services[a],o.compile(e,r,t);break}return o||(o=new CNFlexForm(e,r,t),services.push(o)),o||new CNFlexForm(e,r,t)}function CNFlexForm(e,r,t){this.arrayCopies={},this.arrayListeners={},this.defaults={},this.errors=[],this.events=[],this.formCache={},this.listeners={},this.dataCache={},this.model=r,this.updates=0,this.params=this.getStateParams(),this.compile(e,r,t)}function compile(e,r,t){var o=this;o.schema=e,o.isCompiled()||(o.setupConfig(t),e.forms?_.each(e.forms,function(e){_.each(e.form,o.processField.bind(o))}):_.each(e.form,o.processField.bind(o)),o.initModelWatch(),o.initArrayCopyWatch(),o.isCompiled(!0)),o.broadcastErrors()}function isCompiled(e){var r=this;return e&&(r.schema.compiled=e),r.schema&&r.schema.compiled}function setupConfig(e){var r=this;e&&(e.formCtrl&&(r.formCtrl=e.formCtrl),e.updateSchema&&(r.updateSchema=e.updateSchema),e.getSchema&&(r.getSchemaForm=r.setupSchemaRefresh(e.getSchema)))}function processSchema(e){var r=this,t=e.schema;t&&(e.getSchemaType=function(){return _.isArray(t.type)?_.first(t.type):t.type},r.processDefault(e))}function processDefault(e){var r=this,t=e.schema;if(t["default"]){var o=r.getKey(e.key);if(r.updates){if(o.includes&&o.includes("[]"))return;var a=r.parseExpression(e.key,r.model),s=a.get();(!r.defaults[o]||_.isUndefined(s)||angular.equals(s,r.defaults[o]))&&a.set(t["default"])}r.defaults[o]=angular.copy(t["default"])}}function processFieldset(e){var r=this;e.type="cn-fieldset",_.each(e.items,r.processField.bind(r)),e.collapsible?(e.toggleCollapse=function(){e.collapsible&&(e.collapsed=!e.collapsed)},e.render=!e.collapsed):e.render=!0}function processField(e){var r=this;if("fieldset"===e.type)r.processFieldset(e);else{e._ogKeys||(e._ogKeys=_.without(_.keys(e),"key"));var t=r.getKey(e.key);if(e.key&&(r.addToFormCache(e,t),e.schema=r.getSchema(t),e.schema&&(e.schema.description&&(e.description=e.schema.description),e.readonly&&!e.schema.readonly&&(e.readonly=!1))),r.processSchema(e),e.type||(e.type=e.getSchemaType&&e.getSchemaType()),e.resolve&&r.processResolve(e),e.watch&&r.processFieldWatch(e),"section"===e.type||"tabarray"===e.type)r.processSection(e);else if("component"===e.type)r.processComponent(e);else{for(var o=0,a=fieldTypeRegister.length;a>o;o++){var s=fieldTypeRegister[o];if(s.condition(e)){_.isString(s.handler)?r[s.handler](e):_.isFunction(s.handler)&&s.handler.call(r,e);break}}e.updateSchema&&r.registerHandler(e,null,e.updateSchema),e.error&&r.errors.push(r.buildError(e))}}}function getKey(e){return _.isArray(e)&&(e=_.reduce(e,function(e,r){return/^(\d*)$/.test(r)?e+"["+r+"]":e+"."+r})),e}function getSchema(e,r){if(e){var t=this;e=t.getKey(e),e=e.replace(/arrayIndex/g,"").replace(/(\[')([^.]+)\.([^.]+)('])/g,".$2%ff_dt%$3").replace(/\./g,"%ff_sp%").replace(/%ff_dt%/g,".").split("%ff_sp%"),r=r||t.schema.schema.properties;for(var o,a;e.length>1;)o=e[0],a=o.match(/\[\d*]$/),r=a?r[e.shift().slice(0,o.length-a[0].length)].items.properties:r[e.shift()].properties;return o=e[0],a=o.match(/\[\d*]$/),a?r[o.slice(0,o.length-a[0].length)].items:r[o]}}function processResolve(e){var r=this;return _.each(e.resolve,function(t,o){e[o]=r.parseExpression(t).get()}),e}function processFieldWatch(field){var service=this,schema=field.schema;field.watch=_.isArray(field.watch)?field.watch:[field.watch],_.each(field.watch,function(watch){if(watch.resolution){var condition=watch.condition,resolution=watch.resolution,adjustment={};adjustment.date=resolution.match(/\+ ?(\d+) days/),adjustment.date?(adjustment.date=adjustment.date[1],resolution=resolution.replace(adjustment.date,"").trim()):(adjustment.math=resolution.match(/(\+|\-|\/|\*) ?(\S+)/),adjustment.math&&(adjustment.operator={"+":"add","-":"subtract","*":"multiply","/":"divide"}[adjustment.math[1]],adjustment.adjuster=service.parseExpression(adjustment.math[2]))),resolution=resolution.match(/(\S+) ?= ?(\S+)/);var handler=function(){var updatePath,fromPath;resolution[1].includes("arrayIndex")&&(updatePath=replaceArrayIndex(resolution[1],arguments[2])),resolution[2].includes("arrayIndex")&&(fromPath=replaceArrayIndex(resolution[2],arguments[2]));var update=service.parseExpression(updatePath||resolution[1]),from=service.parseExpression(fromPath||resolution[2]),functionCondition=service.isConditionFunction(condition),parsedCondition=functionCondition?service.parseCondition(functionCondition):condition;if(!parsedCondition||$parse(parsedCondition)(service))if(adjustment.date)update.set(moment(from.get()).add(adjustment.date,"days").toDate());else if(adjustment.math){var result=eval(from.get()+adjustment.math[1]+adjustment.adjuster.get());if(schema=schema||field.items&&(field.items[0].schema||field.items[0].items&&field.items[0].items[0].schema),"cn-currency"===field.type){var p=schema&&"currency-dollars"===schema.format?2:0;result="*"===adjustment.math[1]?_.floor(result,p):"/"===adjustment.math[1]?_.ceil(result,p):_.round(result,p)}service.listeners[update.path().exp].prev=result,update.set(result||0)}else update.set(from.get())};service.registerHandler(field,handler,field.updateSchema)}})}function isConditionFunction(e){return e&&e.match(/(\!?)(.+)\((.+)\)/)}function parseCondition(e){var r=this,t=e[1],o=e[2],a=e[3];if("any"===o){var s=a.match(/(.+)\[\]\.*(.*)(===|>|<|>=|<=)(.+)/),n=r.parseExpression(s[1]).get(),i=s[3],c=s[4].trim().replace(/'/g,""),l=s[2].trim(),m=!1;return n.forEach(function(e){var r=l?e[l]:e;evaluatePredicate(r,i,c)&&(m=!0)}),t?(!m).toString():m.toString()}}function evaluatePredicate(e,r,t){switch(r){case"===":return e===t;case">=":return e>=t;case"<=":return t>=e;case">":return e>t;case"<":return t>e}}function registerHandler(e,r,t){var o=this;if(_.isObject(e)&&!_.isArray(e)){if(!e.key&&e.items)return void _.each(e.items,function(e){o.registerHandler(e,r,e.updateSchema)});e=e.key}e=o.getKey(e);var a=e.match(/([^[\]]*)\[]\.?(.+)/);if(a)return void o.registerArrayHandlers(a[1],a[2],r,t);if(!o.listeners[e]){var s=angular.copy(o.parseExpression(e,o.model).get());o.listeners[e]={handlers:[],updateSchema:t,prev:s}}r&&o.listeners[e].handlers.push(r)}function registerArrayHandlers(e,r,t,o){var a=this,s=function(s,n){var i,c,l;if(n&&n>s){for(i=0,c=n;c>i;i++)l=e+"["+i+"]."+r,a.deregisterHandlers(l);for(i=0,c=s;c>i;i++)l=e+"["+i+"]."+r,a.registerHandler(l,t,o)}else if(s>(n||0))for(i=n,c=s;c>i;i++)l=e+"["+i+"]."+r,a.registerHandler(l,t,o)},n=a.parseExpression(e,a.model).get();_.each(n,function(s,n){var i=e+"["+n+"]."+r;a.registerHandler(i,t,o)}),a.arrayListeners[e+".length"]?a.arrayListeners[e+".length"].handlers.push(s):a.arrayListeners[e+".length"]={handlers:[s],prev:n?n.length:0}}function deregisterHandlers(e){var r=this;r.listeners[e]=void 0}function initModelWatch(){var e=this;e.watching||(e.modelWatch&&e.modelWatch(),e.modelWatch=$rootScope.$watch(function(){return e.model},e.onModelWatch.bind(e),!0),e.initSchemaParams(),e.watching=!0)}function onModelWatch(e,r){var t=this;angular.equals(e,r)||(t.prevParams=angular.copy(t.params),t.params={},_.each(t.arrayListeners,function(e,r){var o=t.parseExpression(r,t.model).get();angular.equals(o,e.prev)||(_.each(e.handlers,function(r){r(o,e.prev)}),e.prev=angular.copy(o))}),_.each(t.listeners,function(e,r){if(e){var o=t.parseExpression(r,t.model).get();angular.equals(o,e.prev)||(_.each(e.handlers,function(t){t(o,e.prev,r)}),e.prev=angular.copy(o)),e.updateSchema&&!angular.isUndefined(o)&&null!==o&&(t.params[r]=o)}}),angular.equals(t.params,t.prevParams)||(t.model.id&&!t.updates&&_.isEmpty(t.prevParams)?++t.updates:t.refreshSchema()))}function initSchemaParams(){var e=this;_.each(e.listeners,function(r,t){if(r){var o=e.parseExpression(t,e.model).get();r.updateSchema&&!angular.isUndefined(o)&&null!==o&&(e.params[t]=o)}})}function initArrayCopyWatch(){var e=this;e.events.push($rootScope.$on("schemaFormPropagateScope",function(r,t){var o=e.getKey(t.form.key).replace(/\[\d+]/g,"[]");e.addArrayCopy(t.form,o)}))}function addArrayCopy(e,r){var t=this;t.arrayCopies[r]||(t.arrayCopies[r]=[]),t.arrayCopies[r].push(e)}function getArrayCopies(e){var r=this;return r.arrayCopies[e]}function addToFormCache(e,r){var t=this;r=r||t.getKey(e.key),t.getFromFormCache(r)||(t.formCache[r]=e)}function getFromFormCache(e){var r=this;return r.formCache[e]}function addToDataCache(e,r){var t=this;e&&(t.dataCache[e]=r)}function getFromDataCache(e){var r=this;return r.dataCache[e]}function parseExpression(exp,depth){var service=this;if(!exp||/^(null|false|true|undefined|''|[0-9.]+|\[]|\{})$/.test(exp))return{get:function(){return eval(exp)}};exp=service.getKey(exp);var key,cached,match=exp.match(/^(model\.)?(\S+)$/);if(!/\[]/.test(exp)&&match&&match[2]&&(!depth||depth===service.model)&&(key=match[2],cached=service.getFromDataCache(key)))return cached;var modelValue={get:function(){for(var e=exp.replace(/\[]/g,"").replace(/\[(\d+)]/g,".$1").split("."),r=depth||service;r&&e.length>1;)r=r[e.shift()];return r&&r[e[0]]},set:function(e){for(var r=exp.replace(/\[]/g,"").replace(/\[(\d+)]/g,".$1").split("."),t=depth||service;t&&r.length>1;){var o=r.shift();t[o]||(t[o]={}),t=t[o]}return t[r[0]]=e,e},path:function(){return{exp:exp,depth:depth}}};return key&&service.addToDataCache(key,modelValue),modelValue}function processSection(e){var r=this;_.each(e.items,r.processField.bind(r))}function processComponent(e){var r=this;e.type="section",e.htmlClass="row";var t=12/_.reject(e.items,"hidden").length;_.each(e.items,function(o,a){r.processField(o),e.items[a]={type:"section",htmlClass:"col-sm-"+t,items:[o]}})}function processCurrency(e){e.currencyFormat="currency-dollars"===e.schema.format?"dollars":"cents",e.type="cn-currency"}function processPercentage(e){e.type="cn-percentage"}function processRadiobuttons(e){e.type="cn-radiobuttons",e.fullWidth&&(e.btnClass="col-sm-"+_.divide(12,e.titleMap.length))}function processDate(e){e.type="cn-datetimepicker"}function processSelect(e){var r=this,t=e.schema;if((e.titleMapResolve||e.titleMap)&&(e.getTitleMap=function(){return e.titleMap||r.schema.data[e.titleMapResolve]},e.onInit=function(t,o,a,s){var n=r.parseExpression(o.key,r.model);if(t=n.get(),"tag-init"===a){var i;if("array"===o.schema.type)"object"!==o.schema.items.type&&(i=[],_.each(t,function(r){var t={};t[e.valueProperty||"value"]=r,i.push(_.find(e.getTitleMap(),t))}));else{var c={};c[e.valueProperty||"value"]=t,i=_.find(e.getTitleMap(),c)}i&&s(i)}}),e.titleMapQuery){var o=e.titleMapQuery.params.q;e.titleQuery=function(r){console.log("titleMap:",r);var t={};return o&&(t[o]=r),Api.get({url:e.titleMapQuery.url,params:t})},o||(e.minLookup="0"),e.onInit=function(e,r,t,o){"tag-init"===t&&o(e)}}if(t.items){var a=[];_.each(t.items.properties,function(e,r){angular.isDefined(e["default"])&&a.push({key:r,"default":e["default"]})}),a.length&&(e.onAdd=function(e,r,t){e.value&&"tag-added"===t&&_.each(a,function(r){e.value[r.key]||(e.value[r.key]=r["default"])})})}e.type.includes("cn-autocomplete")||(e.items?(e.detailedList=!0,"component"!==e.items[0].type&&(e.items.length>1&&(e.items=[{type:"component",items:e.items}]),r.processFieldset(e)),e.type="cn-autocomplete-detailed"):("tags"===e.key?e.selectionStyle="tags":"array"===e.getSchemaType()&&1!==e.schema.maxItems?e.selectionStyle="list":e.selectionStyle="select",e.type="cn-autocomplete")),e.displayFormat&&(e.itemFormatter=r.processTemplate(e.displayFormat)),r.registerHandler(e.key,function(t){var o=r.formCtrl&&r.formCtrl[r.getKey(e.key)];o&&o.$setDirty&&o.$setDirty()},e.updateSchema)}function processToggle(e){e.type="cn-toggle"}function processHelp(e){e.htmlClass="help-block"}function processDisplay(e){var r=this;e.type="cn-display",e.getDisplay=r.processTemplate(e.displayFormat,!0)}function processTemplate(e,r){var t=this,o=$interpolate;return function(a,s){return r&&(angular.isDefined(s)&&(a=_.map(a,function(e){return"arrayIndex"===e?s:e})),a=t.parseExpression(a,t.model).get()),o(e)(a)}}function getStateParams(){return _.chain($stateParams).omit(omitParams).omit(function(e){return _.isUndefined(e)||_.isNull(e)}).value()}function setupSchemaRefresh(e){var r=this;r.refreshSchema=_.debounce(function(t){var o=_.extend(r.getStateParams(),r.params),a=cnUtil.diff(r.schema.params,o,!0);if(a||t){var s=_.keys(a);s.length>1&&(a=_.omit(a,_.isNull),s=_.keys(a)),o.updateSchema=_.first(s),o.updateSchema||(a=cnUtil.diff(o,_.omit(r.schema.params,"updateSchema")),s=_.keys(a),o.updateSchema=_.first(s)),e(o).then(function(e){++r.updates,r.processUpdatedSchema(e)})}},100),r.refreshData=_.debounce(function(){e(_.extend(r.schema.params,{updateSchema:"refreshData"})).then(function(e){r.processUpdatedSchema(e),console.log("service.schema.params:",r.schema.params)})},100),r.events.push($rootScope.$on("ffRefreshData",r.refreshData))}function processUpdatedSchema(e){var r=this;if(e.diff){r.schema.params=e.params,e.diff.data&&_.each(e.diff.data,function(e,t){r.schema.data[t]=e});var t=[];e.diff.schema&&_.each(e.diff.schema,function(e,o){r.schema.schema.properties[o]=e,reprocessSchema(e,o,t)}),e.diff.form&&_.each(e.diff.form,function(e){-1===t.indexOf(e.key)&&t.push(e.key);var o=e.key;delete e.key;var a=r.getFromFormCache(o);a&&reprocessField(a,e);var s=r.getArrayCopies(o);s&&_.each(s,function(r){reprocessField(r,e)})}),t.length&&_.each(t,function(e){var t=r.getFromFormCache(e);if(t&&r.processField(t),e.includes("[]")){var o=r.getArrayCopies(e);_.each(o,function(e){e&&r.processField(e)})}}),r.broadcastErrors()}else r.updateSchema(e)}function reprocessField(e,r,t){_.extend(e,_.omit(r,"items","key")),_.each(e._ogKeys,function(t){r[t]||delete e[t]}),e._ogKeys=_.keys(r),!t&&e.redraw&&e.redraw()}function reprocessSchema(e,r,t){t.push(r),e.properties&&_.each(e.properties,function(e,o){reprocessSchema(e,r+"."+o,t)}),e.items&&e.items.properties&&_.each(e.properties,function(e,o){reprocessSchema(e,r+"[]."+o,t)})}function buildError(e){var r=this,t=r.getKey(e.key);return{key:t,message:e.error}}function broadcastErrors(){var e=this;$timeout(function(){e.errors.forEach(function(e){$rootScope.$broadcast("schemaForm.error."+e.key,"serverValidation",e.message)})},1)}function replaceArrayIndex(e,r){var t=/([^.]*)\[arrayIndex\]/.exec(e),o=new RegExp(t[1]+"\\[(\\d+)\\]"),a=o.exec(r);return e.replace(t[0],a[0])}function cleanup(){var e=this;_.each(e.events,function(e){e()})}var omitParams=["page","debug","sandbox"],optionalFormKeys=["error","type","notitle"],services=[];return _.extend(CNFlexForm.prototype,{compile:compile,addArrayCopy:addArrayCopy,addToDataCache:addToDataCache,addToFormCache:addToFormCache,broadcastErrors:broadcastErrors,buildError:buildError,cleanup:cleanup,deregisterHandlers:deregisterHandlers,getArrayCopies:getArrayCopies,getFromDataCache:getFromDataCache,getFromFormCache:getFromFormCache,getKey:getKey,getSchema:getSchema,getStateParams:getStateParams,initArrayCopyWatch:initArrayCopyWatch,initModelWatch:initModelWatch,initSchemaParams:initSchemaParams,isCompiled:isCompiled,isConditionFunction:isConditionFunction,onModelWatch:onModelWatch,parseCondition:parseCondition,parseExpression:parseExpression,processDefault:processDefault,processDisplay:processDisplay,processField:processField,processFieldset:processFieldset,processFieldWatch:processFieldWatch,processComponent:processComponent,processCurrency:processCurrency,processPercentage:processPercentage,processDate:processDate,processHelp:processHelp,processRadiobuttons:processRadiobuttons,processSchema:processSchema,processResolve:processResolve,processSection:processSection,processSelect:processSelect,processTemplate:processTemplate,processToggle:processToggle,processUpdatedSchema:processUpdatedSchema,registerArrayHandlers:registerArrayHandlers,registerHandler:registerHandler,setupConfig:setupConfig,setupSchemaRefresh:setupSchemaRefresh}),CNFlexFormConstructor}angular.module("cn.flex-form").provider("cnFlexFormService",cnFlexFormServiceProvider);var fieldTypeRegister=[{condition:function(e){return"hidden"===e.type},handler:_.noop},{condition:function(e){return"boolean"===e.type},handler:"processToggle"},{condition:function(e){return"radiobuttons"===e.type},handler:"processRadiobuttons"},{condition:function(e){return"datetime-local"===e.type},handler:"processDate"},{condition:function(e){return"help"===e.type},handler:"processHelp"},{condition:function(e){return"display"===e.type},handler:"processDisplay"},{condition:function(e){return e.schema&&("currency"===e.schema.format||"currency-dollars"===e.schema.format)},handler:"processCurrency"},{condition:function(e){return e.schema&&"percentage"===e.schema.format},handler:"processPercentage"},{condition:function(e){return e.titleMap||e.titleMapResolve||e.titleMapQuery},handler:"processSelect"},{condition:function(e){return"array"===e.type},handler:"processSection"}];cnFlexFormServiceProvider.$inject=["schemaFormDecoratorsProvider"],CNFlexFormService.$inject=["Api","$parse","$q","$stateParams","$interpolate","$compile","$rootScope","$timeout","cnUtil"]}(),function(){"use strict";function e(){function e(){console.log("FlexFormSandbox")}function r(){if(t.schemaStr){var e=angular.fromJson(t.schemaStr);console.log("schema:",e),!e.form&&e.forms&&(e.form=e.forms[0].form),t.config.schema=e.form&&e}}var t=this;t.activate=e,t.onSchema=r,t.model={},t.config={},t.schemaStr="",e()}angular.module("cn.flex-form").controller("FlexFormSandbox",e)}(),function(){"use strict";function e(e){var r=["cn-fieldset","cn-toggle","cn-datetimepicker","cn-autocomplete","cn-autocomplete-detailed","cn-currency","cn-radiobuttons","cn-percentage","cn-display"];_.each(r,function(r){e.registerField({type:r,templateUrl:"app/components/cn-flex-form/forms/"+r+".html"})})}function r(e){e.put("app/components/cn-flex-form/forms/cn-toggle.html",'        <div class="form-group {{form.htmlClass}}"              ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label" ng-show="showTitle()">{{form.title}}</label>          <div class="clearfix">            <cn-toggle-switch              class="pull-left"              ng-show="form.key"              enabled="$$value$$"              on-value="angular.isDefined(form.onValue) ? form.onValue : true"              off-value="angular.isDefined(form.offValue) ? form.offValue : false">            </cn-toggle-switch>            <span ng-show="form.onText && form.offText">              {{$$value$$ === form.onValue ? form.onText : form.offText}}            </span>          </div>          <span class="help-block" sf-message="form.description"></span>        </div>        '),e.put("app/components/cn-flex-form/forms/cn-datetimepicker.html",'        <div class="form-group {{form.htmlClass}}"             ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label"                 for="{{form.key.join(\'.\')}}"                 ng-show="showTitle()">{{form.title}}</label>          <cn-datetimepicker            ng-show="form.key"            ng-model="$$value$$"            ng-model-options="form.ngModelOptions"            is-disabled="form.readonly"            sf-changed="form"            schema-validate="form"            input-id="{{form.key.join(\'.\')}}"            min-date="form.minDate"            required="form.required"            model-type="{{form.schema.type}}">          </cn-datetimepicker>          <span class="help-block" sf-message="form.description"></span>        </div>        ');var r='          <tags-input            ng-show="form.key"            ng-model="$$value$$"            ng-model-options="form.ngModelOptions"            ng-disabled="form.readonly"            sf-changed="form"            schema-validate="form"            input-id="{{form.key.join(\'.\')}}"            display-property="{{form.displayProperty || \'name\'}}"            value-property="{{form.valueProperty || \'value\'}}"            placeholder="{{form.placeholder || \' \'}}"            add-on-blur="{{form.allowNew}}"            add-from-autocomplete-only="{{!form.allowNew}}"            on-before-tag-added="form.onAdd({value: $tag}, form, $event, $prev)"            on-init="form.onInit($tag, form, $event, $setter)"            model-type="{{form.getSchemaType()}}"            array-value-type="{{form.schema.items.type}}"            hide-tags="{{form.detailedList}}"            tags-style="{{form.selectionStyle}}"            required="{{form.required}}"            min-length="{{form.minLength}}"            allowed-tags-pattern=".*"            dropdown="true"            item-formatter="form.itemFormatter"            min-tags="{{form.schema.minItems}}"            max-tags="{{form.schema.maxItems || form.getSchemaType() !== \'array\' ? 1 : 0}}"            allow-bulk="{{form.bulkAdd}}"            bulk-delimiter="{{form.bulkDelimiter}}"            bulk-placeholder="{{form.bulkPlaceholder}}"            show-button="true">            <auto-complete              source="form.getTitleMap && form.getTitleMap() || form.titleQuery($query)"              skip-filtering="{{form.titleQuery ? true : false}}"              min-length="{{form.minLookup || (form.titleQuery && 3 || 0)}}">            </auto-complete>          </tags-input>          ';e.put("app/components/cn-flex-form/forms/cn-autocomplete.html",'        <div class="form-group {{form.htmlClass}}"             ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label"                 for="{{form.key.join(\'.\')}}-input"                 ng-show="showTitle()">{{form.title}}</label>          '+r+'          <span class="help-block" sf-message="form.description"></span>        </div>        '),e.put("app/components/cn-flex-form/forms/cn-autocomplete-detailed.html",'        <div sf-array="form"             class="form-group {{form.htmlClass}}"             ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label"                 for="{{form.key.join(\'.\')}}-input"                 ng-show="showTitle()">{{form.title}}</label>          <ol class="list-group cn-autocomplete-list"              ng-show="modelArray.length"              ng-model="modelArray">            <li class="list-group-item {{form.fieldHtmlClass}}"                ng-repeat="item in modelArray track by $index">              <button ng-hide="form.readonly || form.remove === null"                      ng-click="deleteFromArray($index)"                      type="button" class="close pull-right">                <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>              </button>              <sf-decorator ng-init="arrayIndex = $index" form="copyWithIndex($index)"></sf-decorator>            </li>          </ol>          '+r+'          <span class="help-block" sf-message="form.description"></span>        </div>        '),e.put("app/components/cn-flex-form/forms/cn-currency.html",'        <div class="form-group {{form.htmlClass}}"             ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label"                 ng-show="showTitle()"                 for="{{form.key.join(\'.\')}}">{{form.title}}</label>          <div class="{{form.fieldClass}} input-group">            <label class="input-group-addon"                   ng-disabled="form.readonly"                   for="{{form.key.join(\'.\')}}">$</label>            <input class="form-control"                   cn-currency-format="{{form.currencyFormat}}"                   ng-show="form.key"                   ng-model-options="form.ngModelOptions"                   ng-disabled="form.readonly"                   sf-changed="form"                   schema-validate="form"                   ff-validate="form"                   type="text"                   step="any"                   min="{{form.min}}"                   max="{{form.max}}"                   id="{{form.key.join(\'.\')}}"                   name="{{form.key.join(\'.\')}}"                   ng-model="$$value$$">          </div>          <span class="help-block" sf-message="form.description"></span>        </div>        '),e.put("app/components/cn-flex-form/forms/cn-radiobuttons.html",'        <div class="form-group schema-form-radiobuttons cn-radiobuttons {{form.htmlClass}}"             ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label" ng-show="showTitle()">{{form.title}}</label>          <div class="btn-group clearfix">            <label class="btn btn-{{item.value}} {{form.btnClass}} {{item.value === $$value$$ ? \'active\' : \'\'}}"                   ng-repeat="item in form.titleMap">              <input type="radio"                     class="{{form.fieldHtmlClass}} hide"                     sf-changed="form"                     ng-disabled="form.readonly"                     ng-model="$$value$$"                     ng-model-options="form.ngModelOptions"                     schema-validate="form"                     ff-validate="form"                     ng-value="item.value"                     name="{{form.key.join(\'.\')}}">              <i class="fa fa-{{item.value}} fa-lg"></i>              <span ng-bind-html="item.name"></span>            </label>          </div>          <span class="help-block" sf-message="form.description"></span>        </div>        '),e.put("app/components/cn-flex-form/forms/cn-percentage.html",'        <div class="form-group {{form.htmlClass}}"             ng-class="{\'has-error\': hasError(), \'has-success\': hasSuccess()}">          <label class="control-label"                 ng-show="showTitle()"                 for="{{form.key && form.key[0]}}">{{form.title}}</label>          <div class="{{form.fieldClass}} input-group">            <input class="form-control"                   cn-percentage-format                   ng-show="form.key"                   ng-model-options="form.ngModelOptions"                   ng-disabled="form.readonly"                   sf-changed="form"                   schema-validate="form"                   type="number"                   step="any"                   min="{{form.min}}"                   max="{{form.max}}"                   id="{{form.key && form.key[0]}}"                   name="{{form.key && form.key[0]}}"                   ng-model="$$value$$">             <div class="input-group-addon"                    ng-disabled="form.readonly"                    for="{{form.key && form.key[0]}}">%</div>          </div>          <span class="help-block" sf-message="form.description"></span>        </div>        '),e.put("app/components/cn-flex-form/forms/cn-display.html",'        <div class="form-group cn-display{{form.htmlClass}}">          <input ng-show="form.key"                 class="form-control"                 id="{{form.key.join(\'.\')}}"                 name="{{form.key.join(\'.\')}}"                 ng-disabled="true"                 value="{{form.getDisplay(form.key, form.arrayIndex)}}">        </div>        '),e.put("app/components/cn-flex-form/forms/cn-fieldset.html",'        <fieldset ng-disabled="form.readonly" class="schema-form-fieldset {{form.htmlClass}}">          <legend ng-click="form.toggleCollapse()"                  ng-class="{\'sr-only\': !showTitle(), collapsible: form.collapsible}"                  ng-mouseenter="form.render = true">            <i ng-show="form.collapsible"               class="fa fa-caret-{{form.collapsed ? \'right\' : \'down\'}}"></i>            {{ form.title }}          </legend>          <div class="help-block" ng-show="form.description" ng-bind-html="form.description"></div>          <div collapse="form.collapsed">            <div ng-if="form.render">              <sf-decorator ng-repeat="item in form.items" form="item"></sf-decorator>            </div>          </div>        </fieldset>        ')}angular.module("cn.flex-form").config(e).run(r),e.$inject=["cnFlexFormServiceProvider"],r.$inject=["$templateCache"]}();